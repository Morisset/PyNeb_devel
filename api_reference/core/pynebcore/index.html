
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="http://research.iac.es/proyecto/PyNeb/api_reference/core/pynebcore/">
      
      
        <link rel="prev" href="../icf/">
      
      
        <link rel="next" href="../../extinction/red_corr/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>PyNebCore - PyNeb</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.2afb09e1.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pyneb.core.pynebcore" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="PyNeb" class="md-header__button md-logo" aria-label="PyNeb" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PyNeb
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              PyNebCore
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="PyNeb" class="md-nav__button md-logo" aria-label="PyNeb" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    PyNeb
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            API reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Core
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../continuum/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Continuum
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../diags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Diags
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../emisGrid/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EmisGrid
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../icf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ICF
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    PyNebCore
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    PyNebCore
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore" class="md-nav__link">
    <span class="md-ellipsis">
      pynebcore
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom" class="md-nav__link">
    <span class="md-ellipsis">
      Atom
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Atom">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.getA" class="md-nav__link">
    <span class="md-ellipsis">
      getA
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.getB" class="md-nav__link">
    <span class="md-ellipsis">
      getB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.getCollRates" class="md-nav__link">
    <span class="md-ellipsis">
      getCollRates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.getCritDensity" class="md-nav__link">
    <span class="md-ellipsis">
      getCritDensity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.getDensityRange" class="md-nav__link">
    <span class="md-ellipsis">
      getDensityRange
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.getEmissivity" class="md-nav__link">
    <span class="md-ellipsis">
      getEmissivity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.getHighDensRatio" class="md-nav__link">
    <span class="md-ellipsis">
      getHighDensRatio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.getIonAbundance" class="md-nav__link">
    <span class="md-ellipsis">
      getIonAbundance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.getLowDensRatio" class="md-nav__link">
    <span class="md-ellipsis">
      getLowDensRatio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.getOmega" class="md-nav__link">
    <span class="md-ellipsis">
      getOmega
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.getPopulations" class="md-nav__link">
    <span class="md-ellipsis">
      getPopulations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.getTemDen" class="md-nav__link">
    <span class="md-ellipsis">
      getTemDen
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.getTransition" class="md-nav__link">
    <span class="md-ellipsis">
      getTransition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.plotEmiss" class="md-nav__link">
    <span class="md-ellipsis">
      plotEmiss
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.plotGrotrian" class="md-nav__link">
    <span class="md-ellipsis">
      plotGrotrian
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.printIonic" class="md-nav__link">
    <span class="md-ellipsis">
      printIonic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.printTemDen" class="md-nav__link">
    <span class="md-ellipsis">
      printTemDen
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.printTransition" class="md-nav__link">
    <span class="md-ellipsis">
      printTransition
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.EmissionLine" class="md-nav__link">
    <span class="md-ellipsis">
      EmissionLine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmissionLine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.EmissionLine.addObs" class="md-nav__link">
    <span class="md-ellipsis">
      addObs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.EmissionLine.correctIntens" class="md-nav__link">
    <span class="md-ellipsis">
      correctIntens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.EmissionLine.printLine" class="md-nav__link">
    <span class="md-ellipsis">
      printLine
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation" class="md-nav__link">
    <span class="md-ellipsis">
      Observation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Observation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.lineLabels" class="md-nav__link">
    <span class="md-ellipsis">
      lineLabels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.n_lines" class="md-nav__link">
    <span class="md-ellipsis">
      n_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.n_obs" class="md-nav__link">
    <span class="md-ellipsis">
      n_obs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.n_obs_origin" class="md-nav__link">
    <span class="md-ellipsis">
      n_obs_origin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.n_valid_lines" class="md-nav__link">
    <span class="md-ellipsis">
      n_valid_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.__normalize" class="md-nav__link">
    <span class="md-ellipsis">
      __normalize
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.addLine" class="md-nav__link">
    <span class="md-ellipsis">
      addLine
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.addMonteCarloObs" class="md-nav__link">
    <span class="md-ellipsis">
      addMonteCarloObs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.addObs" class="md-nav__link">
    <span class="md-ellipsis">
      addObs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.addSum" class="md-nav__link">
    <span class="md-ellipsis">
      addSum
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.correctData" class="md-nav__link">
    <span class="md-ellipsis">
      correctData
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.def_EBV" class="md-nav__link">
    <span class="md-ellipsis">
      def_EBV
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.fillObs" class="md-nav__link">
    <span class="md-ellipsis">
      fillObs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.getError" class="md-nav__link">
    <span class="md-ellipsis">
      getError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.getIntens" class="md-nav__link">
    <span class="md-ellipsis">
      getIntens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.getLine" class="md-nav__link">
    <span class="md-ellipsis">
      getLine
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.getSortedLines" class="md-nav__link">
    <span class="md-ellipsis">
      getSortedLines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.getUniqueAtoms" class="md-nav__link">
    <span class="md-ellipsis">
      getUniqueAtoms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.printIntens" class="md-nav__link">
    <span class="md-ellipsis">
      printIntens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.readData" class="md-nav__link">
    <span class="md-ellipsis">
      readData
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.removeLine" class="md-nav__link">
    <span class="md-ellipsis">
      removeLine
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.reshape" class="md-nav__link">
    <span class="md-ellipsis">
      reshape
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.setAllErrors" class="md-nav__link">
    <span class="md-ellipsis">
      setAllErrors
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.RecAtom" class="md-nav__link">
    <span class="md-ellipsis">
      RecAtom
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RecAtom">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.RecAtom.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.RecAtom.getEmissivity" class="md-nav__link">
    <span class="md-ellipsis">
      getEmissivity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.RecAtom.getEnergy" class="md-nav__link">
    <span class="md-ellipsis">
      getEnergy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.RecAtom.getIonAbundance" class="md-nav__link">
    <span class="md-ellipsis">
      getIonAbundance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.RecAtom.getTotRecombination" class="md-nav__link">
    <span class="md-ellipsis">
      getTotRecombination
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.RecAtom.getTransition" class="md-nav__link">
    <span class="md-ellipsis">
      getTransition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.RecAtom.getWave" class="md-nav__link">
    <span class="md-ellipsis">
      getWave
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.RecAtom.grepLabels" class="md-nav__link">
    <span class="md-ellipsis">
      grepLabels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.RecAtom.initWaves" class="md-nav__link">
    <span class="md-ellipsis">
      initWaves
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.RecAtom.printTransition" class="md-nav__link">
    <span class="md-ellipsis">
      printTransition
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.getAtomDict" class="md-nav__link">
    <span class="md-ellipsis">
      getAtomDict
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.getHbEmissivity" class="md-nav__link">
    <span class="md-ellipsis">
      getHbEmissivity
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.getLineLabel" class="md-nav__link">
    <span class="md-ellipsis">
      getLineLabel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.getRecEmissivity" class="md-nav__link">
    <span class="md-ellipsis">
      getRecEmissivity
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.isValid" class="md-nav__link">
    <span class="md-ellipsis">
      isValid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.parseLineLabel" class="md-nav__link">
    <span class="md-ellipsis">
      parseLineLabel
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Extinction
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Extinction
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extinction/red_corr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Red Corr
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Plot
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Plot
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plot/plot_atomic_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Plot Atomic Data
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore" class="md-nav__link">
    <span class="md-ellipsis">
      pynebcore
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom" class="md-nav__link">
    <span class="md-ellipsis">
      Atom
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Atom">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.getA" class="md-nav__link">
    <span class="md-ellipsis">
      getA
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.getB" class="md-nav__link">
    <span class="md-ellipsis">
      getB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.getCollRates" class="md-nav__link">
    <span class="md-ellipsis">
      getCollRates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.getCritDensity" class="md-nav__link">
    <span class="md-ellipsis">
      getCritDensity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.getDensityRange" class="md-nav__link">
    <span class="md-ellipsis">
      getDensityRange
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.getEmissivity" class="md-nav__link">
    <span class="md-ellipsis">
      getEmissivity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.getHighDensRatio" class="md-nav__link">
    <span class="md-ellipsis">
      getHighDensRatio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.getIonAbundance" class="md-nav__link">
    <span class="md-ellipsis">
      getIonAbundance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.getLowDensRatio" class="md-nav__link">
    <span class="md-ellipsis">
      getLowDensRatio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.getOmega" class="md-nav__link">
    <span class="md-ellipsis">
      getOmega
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.getPopulations" class="md-nav__link">
    <span class="md-ellipsis">
      getPopulations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.getTemDen" class="md-nav__link">
    <span class="md-ellipsis">
      getTemDen
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.getTransition" class="md-nav__link">
    <span class="md-ellipsis">
      getTransition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.plotEmiss" class="md-nav__link">
    <span class="md-ellipsis">
      plotEmiss
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.plotGrotrian" class="md-nav__link">
    <span class="md-ellipsis">
      plotGrotrian
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.printIonic" class="md-nav__link">
    <span class="md-ellipsis">
      printIonic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.printTemDen" class="md-nav__link">
    <span class="md-ellipsis">
      printTemDen
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Atom.printTransition" class="md-nav__link">
    <span class="md-ellipsis">
      printTransition
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.EmissionLine" class="md-nav__link">
    <span class="md-ellipsis">
      EmissionLine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmissionLine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.EmissionLine.addObs" class="md-nav__link">
    <span class="md-ellipsis">
      addObs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.EmissionLine.correctIntens" class="md-nav__link">
    <span class="md-ellipsis">
      correctIntens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.EmissionLine.printLine" class="md-nav__link">
    <span class="md-ellipsis">
      printLine
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation" class="md-nav__link">
    <span class="md-ellipsis">
      Observation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Observation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.lineLabels" class="md-nav__link">
    <span class="md-ellipsis">
      lineLabels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.n_lines" class="md-nav__link">
    <span class="md-ellipsis">
      n_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.n_obs" class="md-nav__link">
    <span class="md-ellipsis">
      n_obs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.n_obs_origin" class="md-nav__link">
    <span class="md-ellipsis">
      n_obs_origin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.n_valid_lines" class="md-nav__link">
    <span class="md-ellipsis">
      n_valid_lines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.__normalize" class="md-nav__link">
    <span class="md-ellipsis">
      __normalize
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.addLine" class="md-nav__link">
    <span class="md-ellipsis">
      addLine
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.addMonteCarloObs" class="md-nav__link">
    <span class="md-ellipsis">
      addMonteCarloObs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.addObs" class="md-nav__link">
    <span class="md-ellipsis">
      addObs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.addSum" class="md-nav__link">
    <span class="md-ellipsis">
      addSum
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.correctData" class="md-nav__link">
    <span class="md-ellipsis">
      correctData
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.def_EBV" class="md-nav__link">
    <span class="md-ellipsis">
      def_EBV
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.fillObs" class="md-nav__link">
    <span class="md-ellipsis">
      fillObs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.getError" class="md-nav__link">
    <span class="md-ellipsis">
      getError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.getIntens" class="md-nav__link">
    <span class="md-ellipsis">
      getIntens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.getLine" class="md-nav__link">
    <span class="md-ellipsis">
      getLine
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.getSortedLines" class="md-nav__link">
    <span class="md-ellipsis">
      getSortedLines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.getUniqueAtoms" class="md-nav__link">
    <span class="md-ellipsis">
      getUniqueAtoms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.printIntens" class="md-nav__link">
    <span class="md-ellipsis">
      printIntens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.readData" class="md-nav__link">
    <span class="md-ellipsis">
      readData
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.removeLine" class="md-nav__link">
    <span class="md-ellipsis">
      removeLine
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.reshape" class="md-nav__link">
    <span class="md-ellipsis">
      reshape
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.Observation.setAllErrors" class="md-nav__link">
    <span class="md-ellipsis">
      setAllErrors
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.RecAtom" class="md-nav__link">
    <span class="md-ellipsis">
      RecAtom
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RecAtom">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.RecAtom.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.RecAtom.getEmissivity" class="md-nav__link">
    <span class="md-ellipsis">
      getEmissivity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.RecAtom.getEnergy" class="md-nav__link">
    <span class="md-ellipsis">
      getEnergy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.RecAtom.getIonAbundance" class="md-nav__link">
    <span class="md-ellipsis">
      getIonAbundance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.RecAtom.getTotRecombination" class="md-nav__link">
    <span class="md-ellipsis">
      getTotRecombination
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.RecAtom.getTransition" class="md-nav__link">
    <span class="md-ellipsis">
      getTransition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.RecAtom.getWave" class="md-nav__link">
    <span class="md-ellipsis">
      getWave
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.RecAtom.grepLabels" class="md-nav__link">
    <span class="md-ellipsis">
      grepLabels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.RecAtom.initWaves" class="md-nav__link">
    <span class="md-ellipsis">
      initWaves
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.RecAtom.printTransition" class="md-nav__link">
    <span class="md-ellipsis">
      printTransition
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.getAtomDict" class="md-nav__link">
    <span class="md-ellipsis">
      getAtomDict
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.getHbEmissivity" class="md-nav__link">
    <span class="md-ellipsis">
      getHbEmissivity
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.getLineLabel" class="md-nav__link">
    <span class="md-ellipsis">
      getLineLabel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.getRecEmissivity" class="md-nav__link">
    <span class="md-ellipsis">
      getRecEmissivity
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.isValid" class="md-nav__link">
    <span class="md-ellipsis">
      isValid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyneb.core.pynebcore.parseLineLabel" class="md-nav__link">
    <span class="md-ellipsis">
      parseLineLabel
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>PyNebCore</h1>

<div class="doc doc-object doc-module">



<a id="pyneb.core.pynebcore"></a>
    <div class="doc doc-contents first">

        <p>@module pynebcore
Main PyNeb module
Tools to manage atoms, emission lines and observational data.</p>
<p>@class Atom           atom object
@class EmissionLine   emission line object
@class Observation    observation object</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="pyneb.core.pynebcore.Atom" class="doc doc-heading">
            <code>Atom</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


        <p>Define the atom object, fill it with data, explore the data, and 
compute quantities such as level populations and line emissivities.</p>

              <details class="quote">
                <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span>
<span class="normal">2336</span>
<span class="normal">2337</span>
<span class="normal">2338</span>
<span class="normal">2339</span>
<span class="normal">2340</span>
<span class="normal">2341</span>
<span class="normal">2342</span>
<span class="normal">2343</span>
<span class="normal">2344</span>
<span class="normal">2345</span>
<span class="normal">2346</span>
<span class="normal">2347</span>
<span class="normal">2348</span>
<span class="normal">2349</span>
<span class="normal">2350</span>
<span class="normal">2351</span>
<span class="normal">2352</span>
<span class="normal">2353</span>
<span class="normal">2354</span>
<span class="normal">2355</span>
<span class="normal">2356</span>
<span class="normal">2357</span>
<span class="normal">2358</span>
<span class="normal">2359</span>
<span class="normal">2360</span>
<span class="normal">2361</span>
<span class="normal">2362</span>
<span class="normal">2363</span>
<span class="normal">2364</span>
<span class="normal">2365</span>
<span class="normal">2366</span>
<span class="normal">2367</span>
<span class="normal">2368</span>
<span class="normal">2369</span>
<span class="normal">2370</span>
<span class="normal">2371</span>
<span class="normal">2372</span>
<span class="normal">2373</span>
<span class="normal">2374</span>
<span class="normal">2375</span>
<span class="normal">2376</span>
<span class="normal">2377</span>
<span class="normal">2378</span>
<span class="normal">2379</span>
<span class="normal">2380</span>
<span class="normal">2381</span>
<span class="normal">2382</span>
<span class="normal">2383</span>
<span class="normal">2384</span>
<span class="normal">2385</span>
<span class="normal">2386</span>
<span class="normal">2387</span>
<span class="normal">2388</span>
<span class="normal">2389</span>
<span class="normal">2390</span>
<span class="normal">2391</span>
<span class="normal">2392</span>
<span class="normal">2393</span>
<span class="normal">2394</span>
<span class="normal">2395</span>
<span class="normal">2396</span>
<span class="normal">2397</span>
<span class="normal">2398</span>
<span class="normal">2399</span>
<span class="normal">2400</span>
<span class="normal">2401</span>
<span class="normal">2402</span>
<span class="normal">2403</span>
<span class="normal">2404</span>
<span class="normal">2405</span>
<span class="normal">2406</span>
<span class="normal">2407</span>
<span class="normal">2408</span>
<span class="normal">2409</span>
<span class="normal">2410</span>
<span class="normal">2411</span>
<span class="normal">2412</span>
<span class="normal">2413</span>
<span class="normal">2414</span>
<span class="normal">2415</span>
<span class="normal">2416</span>
<span class="normal">2417</span>
<span class="normal">2418</span>
<span class="normal">2419</span>
<span class="normal">2420</span>
<span class="normal">2421</span>
<span class="normal">2422</span>
<span class="normal">2423</span>
<span class="normal">2424</span>
<span class="normal">2425</span>
<span class="normal">2426</span>
<span class="normal">2427</span>
<span class="normal">2428</span>
<span class="normal">2429</span>
<span class="normal">2430</span>
<span class="normal">2431</span>
<span class="normal">2432</span>
<span class="normal">2433</span>
<span class="normal">2434</span>
<span class="normal">2435</span>
<span class="normal">2436</span>
<span class="normal">2437</span>
<span class="normal">2438</span>
<span class="normal">2439</span>
<span class="normal">2440</span>
<span class="normal">2441</span>
<span class="normal">2442</span>
<span class="normal">2443</span>
<span class="normal">2444</span>
<span class="normal">2445</span>
<span class="normal">2446</span>
<span class="normal">2447</span>
<span class="normal">2448</span>
<span class="normal">2449</span>
<span class="normal">2450</span>
<span class="normal">2451</span>
<span class="normal">2452</span>
<span class="normal">2453</span>
<span class="normal">2454</span>
<span class="normal">2455</span>
<span class="normal">2456</span>
<span class="normal">2457</span>
<span class="normal">2458</span>
<span class="normal">2459</span>
<span class="normal">2460</span>
<span class="normal">2461</span>
<span class="normal">2462</span>
<span class="normal">2463</span>
<span class="normal">2464</span>
<span class="normal">2465</span>
<span class="normal">2466</span>
<span class="normal">2467</span>
<span class="normal">2468</span>
<span class="normal">2469</span>
<span class="normal">2470</span>
<span class="normal">2471</span>
<span class="normal">2472</span>
<span class="normal">2473</span>
<span class="normal">2474</span>
<span class="normal">2475</span>
<span class="normal">2476</span>
<span class="normal">2477</span>
<span class="normal">2478</span>
<span class="normal">2479</span>
<span class="normal">2480</span>
<span class="normal">2481</span>
<span class="normal">2482</span>
<span class="normal">2483</span>
<span class="normal">2484</span>
<span class="normal">2485</span>
<span class="normal">2486</span>
<span class="normal">2487</span>
<span class="normal">2488</span>
<span class="normal">2489</span>
<span class="normal">2490</span>
<span class="normal">2491</span>
<span class="normal">2492</span>
<span class="normal">2493</span>
<span class="normal">2494</span>
<span class="normal">2495</span>
<span class="normal">2496</span>
<span class="normal">2497</span>
<span class="normal">2498</span>
<span class="normal">2499</span>
<span class="normal">2500</span>
<span class="normal">2501</span>
<span class="normal">2502</span>
<span class="normal">2503</span>
<span class="normal">2504</span>
<span class="normal">2505</span>
<span class="normal">2506</span>
<span class="normal">2507</span>
<span class="normal">2508</span>
<span class="normal">2509</span>
<span class="normal">2510</span>
<span class="normal">2511</span>
<span class="normal">2512</span>
<span class="normal">2513</span>
<span class="normal">2514</span>
<span class="normal">2515</span>
<span class="normal">2516</span>
<span class="normal">2517</span>
<span class="normal">2518</span>
<span class="normal">2519</span>
<span class="normal">2520</span>
<span class="normal">2521</span>
<span class="normal">2522</span>
<span class="normal">2523</span>
<span class="normal">2524</span>
<span class="normal">2525</span>
<span class="normal">2526</span>
<span class="normal">2527</span>
<span class="normal">2528</span>
<span class="normal">2529</span>
<span class="normal">2530</span>
<span class="normal">2531</span>
<span class="normal">2532</span>
<span class="normal">2533</span>
<span class="normal">2534</span>
<span class="normal">2535</span>
<span class="normal">2536</span>
<span class="normal">2537</span>
<span class="normal">2538</span>
<span class="normal">2539</span>
<span class="normal">2540</span>
<span class="normal">2541</span>
<span class="normal">2542</span>
<span class="normal">2543</span>
<span class="normal">2544</span>
<span class="normal">2545</span>
<span class="normal">2546</span>
<span class="normal">2547</span>
<span class="normal">2548</span>
<span class="normal">2549</span>
<span class="normal">2550</span>
<span class="normal">2551</span>
<span class="normal">2552</span>
<span class="normal">2553</span>
<span class="normal">2554</span>
<span class="normal">2555</span>
<span class="normal">2556</span>
<span class="normal">2557</span>
<span class="normal">2558</span>
<span class="normal">2559</span>
<span class="normal">2560</span>
<span class="normal">2561</span>
<span class="normal">2562</span>
<span class="normal">2563</span>
<span class="normal">2564</span>
<span class="normal">2565</span>
<span class="normal">2566</span>
<span class="normal">2567</span>
<span class="normal">2568</span>
<span class="normal">2569</span>
<span class="normal">2570</span>
<span class="normal">2571</span>
<span class="normal">2572</span>
<span class="normal">2573</span>
<span class="normal">2574</span>
<span class="normal">2575</span>
<span class="normal">2576</span>
<span class="normal">2577</span>
<span class="normal">2578</span>
<span class="normal">2579</span>
<span class="normal">2580</span>
<span class="normal">2581</span>
<span class="normal">2582</span>
<span class="normal">2583</span>
<span class="normal">2584</span>
<span class="normal">2585</span>
<span class="normal">2586</span>
<span class="normal">2587</span>
<span class="normal">2588</span>
<span class="normal">2589</span>
<span class="normal">2590</span>
<span class="normal">2591</span>
<span class="normal">2592</span>
<span class="normal">2593</span>
<span class="normal">2594</span>
<span class="normal">2595</span>
<span class="normal">2596</span>
<span class="normal">2597</span>
<span class="normal">2598</span>
<span class="normal">2599</span>
<span class="normal">2600</span>
<span class="normal">2601</span>
<span class="normal">2602</span>
<span class="normal">2603</span>
<span class="normal">2604</span>
<span class="normal">2605</span>
<span class="normal">2606</span>
<span class="normal">2607</span>
<span class="normal">2608</span>
<span class="normal">2609</span>
<span class="normal">2610</span>
<span class="normal">2611</span>
<span class="normal">2612</span>
<span class="normal">2613</span>
<span class="normal">2614</span>
<span class="normal">2615</span>
<span class="normal">2616</span>
<span class="normal">2617</span>
<span class="normal">2618</span>
<span class="normal">2619</span>
<span class="normal">2620</span>
<span class="normal">2621</span>
<span class="normal">2622</span>
<span class="normal">2623</span>
<span class="normal">2624</span>
<span class="normal">2625</span>
<span class="normal">2626</span>
<span class="normal">2627</span>
<span class="normal">2628</span>
<span class="normal">2629</span>
<span class="normal">2630</span>
<span class="normal">2631</span>
<span class="normal">2632</span>
<span class="normal">2633</span>
<span class="normal">2634</span>
<span class="normal">2635</span>
<span class="normal">2636</span>
<span class="normal">2637</span>
<span class="normal">2638</span>
<span class="normal">2639</span>
<span class="normal">2640</span>
<span class="normal">2641</span>
<span class="normal">2642</span>
<span class="normal">2643</span>
<span class="normal">2644</span>
<span class="normal">2645</span>
<span class="normal">2646</span>
<span class="normal">2647</span>
<span class="normal">2648</span>
<span class="normal">2649</span>
<span class="normal">2650</span>
<span class="normal">2651</span>
<span class="normal">2652</span>
<span class="normal">2653</span>
<span class="normal">2654</span>
<span class="normal">2655</span>
<span class="normal">2656</span>
<span class="normal">2657</span>
<span class="normal">2658</span>
<span class="normal">2659</span>
<span class="normal">2660</span>
<span class="normal">2661</span>
<span class="normal">2662</span>
<span class="normal">2663</span>
<span class="normal">2664</span>
<span class="normal">2665</span>
<span class="normal">2666</span>
<span class="normal">2667</span>
<span class="normal">2668</span>
<span class="normal">2669</span>
<span class="normal">2670</span>
<span class="normal">2671</span>
<span class="normal">2672</span>
<span class="normal">2673</span>
<span class="normal">2674</span>
<span class="normal">2675</span>
<span class="normal">2676</span>
<span class="normal">2677</span>
<span class="normal">2678</span>
<span class="normal">2679</span>
<span class="normal">2680</span>
<span class="normal">2681</span>
<span class="normal">2682</span>
<span class="normal">2683</span>
<span class="normal">2684</span>
<span class="normal">2685</span>
<span class="normal">2686</span>
<span class="normal">2687</span>
<span class="normal">2688</span>
<span class="normal">2689</span>
<span class="normal">2690</span>
<span class="normal">2691</span>
<span class="normal">2692</span>
<span class="normal">2693</span>
<span class="normal">2694</span>
<span class="normal">2695</span>
<span class="normal">2696</span>
<span class="normal">2697</span>
<span class="normal">2698</span>
<span class="normal">2699</span>
<span class="normal">2700</span>
<span class="normal">2701</span>
<span class="normal">2702</span>
<span class="normal">2703</span>
<span class="normal">2704</span>
<span class="normal">2705</span>
<span class="normal">2706</span>
<span class="normal">2707</span>
<span class="normal">2708</span>
<span class="normal">2709</span>
<span class="normal">2710</span>
<span class="normal">2711</span>
<span class="normal">2712</span>
<span class="normal">2713</span>
<span class="normal">2714</span>
<span class="normal">2715</span>
<span class="normal">2716</span>
<span class="normal">2717</span>
<span class="normal">2718</span>
<span class="normal">2719</span>
<span class="normal">2720</span>
<span class="normal">2721</span>
<span class="normal">2722</span>
<span class="normal">2723</span>
<span class="normal">2724</span>
<span class="normal">2725</span>
<span class="normal">2726</span>
<span class="normal">2727</span>
<span class="normal">2728</span>
<span class="normal">2729</span>
<span class="normal">2730</span>
<span class="normal">2731</span>
<span class="normal">2732</span>
<span class="normal">2733</span>
<span class="normal">2734</span>
<span class="normal">2735</span>
<span class="normal">2736</span>
<span class="normal">2737</span>
<span class="normal">2738</span>
<span class="normal">2739</span>
<span class="normal">2740</span>
<span class="normal">2741</span>
<span class="normal">2742</span>
<span class="normal">2743</span>
<span class="normal">2744</span>
<span class="normal">2745</span>
<span class="normal">2746</span>
<span class="normal">2747</span>
<span class="normal">2748</span>
<span class="normal">2749</span>
<span class="normal">2750</span>
<span class="normal">2751</span>
<span class="normal">2752</span>
<span class="normal">2753</span>
<span class="normal">2754</span>
<span class="normal">2755</span>
<span class="normal">2756</span>
<span class="normal">2757</span>
<span class="normal">2758</span>
<span class="normal">2759</span>
<span class="normal">2760</span>
<span class="normal">2761</span>
<span class="normal">2762</span>
<span class="normal">2763</span>
<span class="normal">2764</span>
<span class="normal">2765</span>
<span class="normal">2766</span>
<span class="normal">2767</span>
<span class="normal">2768</span>
<span class="normal">2769</span>
<span class="normal">2770</span>
<span class="normal">2771</span>
<span class="normal">2772</span>
<span class="normal">2773</span>
<span class="normal">2774</span>
<span class="normal">2775</span>
<span class="normal">2776</span>
<span class="normal">2777</span>
<span class="normal">2778</span>
<span class="normal">2779</span>
<span class="normal">2780</span>
<span class="normal">2781</span>
<span class="normal">2782</span>
<span class="normal">2783</span>
<span class="normal">2784</span>
<span class="normal">2785</span>
<span class="normal">2786</span>
<span class="normal">2787</span>
<span class="normal">2788</span>
<span class="normal">2789</span>
<span class="normal">2790</span>
<span class="normal">2791</span>
<span class="normal">2792</span>
<span class="normal">2793</span>
<span class="normal">2794</span>
<span class="normal">2795</span>
<span class="normal">2796</span>
<span class="normal">2797</span>
<span class="normal">2798</span>
<span class="normal">2799</span>
<span class="normal">2800</span>
<span class="normal">2801</span>
<span class="normal">2802</span>
<span class="normal">2803</span>
<span class="normal">2804</span>
<span class="normal">2805</span>
<span class="normal">2806</span>
<span class="normal">2807</span>
<span class="normal">2808</span>
<span class="normal">2809</span>
<span class="normal">2810</span>
<span class="normal">2811</span>
<span class="normal">2812</span>
<span class="normal">2813</span>
<span class="normal">2814</span>
<span class="normal">2815</span>
<span class="normal">2816</span>
<span class="normal">2817</span>
<span class="normal">2818</span>
<span class="normal">2819</span>
<span class="normal">2820</span>
<span class="normal">2821</span>
<span class="normal">2822</span>
<span class="normal">2823</span>
<span class="normal">2824</span>
<span class="normal">2825</span>
<span class="normal">2826</span>
<span class="normal">2827</span>
<span class="normal">2828</span>
<span class="normal">2829</span>
<span class="normal">2830</span>
<span class="normal">2831</span>
<span class="normal">2832</span>
<span class="normal">2833</span>
<span class="normal">2834</span>
<span class="normal">2835</span>
<span class="normal">2836</span>
<span class="normal">2837</span>
<span class="normal">2838</span>
<span class="normal">2839</span>
<span class="normal">2840</span>
<span class="normal">2841</span>
<span class="normal">2842</span>
<span class="normal">2843</span>
<span class="normal">2844</span>
<span class="normal">2845</span>
<span class="normal">2846</span>
<span class="normal">2847</span>
<span class="normal">2848</span>
<span class="normal">2849</span>
<span class="normal">2850</span>
<span class="normal">2851</span>
<span class="normal">2852</span>
<span class="normal">2853</span>
<span class="normal">2854</span>
<span class="normal">2855</span>
<span class="normal">2856</span>
<span class="normal">2857</span>
<span class="normal">2858</span>
<span class="normal">2859</span>
<span class="normal">2860</span>
<span class="normal">2861</span>
<span class="normal">2862</span>
<span class="normal">2863</span>
<span class="normal">2864</span>
<span class="normal">2865</span>
<span class="normal">2866</span>
<span class="normal">2867</span>
<span class="normal">2868</span>
<span class="normal">2869</span>
<span class="normal">2870</span>
<span class="normal">2871</span>
<span class="normal">2872</span>
<span class="normal">2873</span>
<span class="normal">2874</span>
<span class="normal">2875</span>
<span class="normal">2876</span>
<span class="normal">2877</span>
<span class="normal">2878</span>
<span class="normal">2879</span>
<span class="normal">2880</span>
<span class="normal">2881</span>
<span class="normal">2882</span>
<span class="normal">2883</span>
<span class="normal">2884</span>
<span class="normal">2885</span>
<span class="normal">2886</span>
<span class="normal">2887</span>
<span class="normal">2888</span>
<span class="normal">2889</span>
<span class="normal">2890</span>
<span class="normal">2891</span>
<span class="normal">2892</span>
<span class="normal">2893</span>
<span class="normal">2894</span>
<span class="normal">2895</span>
<span class="normal">2896</span>
<span class="normal">2897</span>
<span class="normal">2898</span>
<span class="normal">2899</span>
<span class="normal">2900</span>
<span class="normal">2901</span>
<span class="normal">2902</span>
<span class="normal">2903</span>
<span class="normal">2904</span>
<span class="normal">2905</span>
<span class="normal">2906</span>
<span class="normal">2907</span>
<span class="normal">2908</span>
<span class="normal">2909</span>
<span class="normal">2910</span>
<span class="normal">2911</span>
<span class="normal">2912</span>
<span class="normal">2913</span>
<span class="normal">2914</span>
<span class="normal">2915</span>
<span class="normal">2916</span>
<span class="normal">2917</span>
<span class="normal">2918</span>
<span class="normal">2919</span>
<span class="normal">2920</span>
<span class="normal">2921</span>
<span class="normal">2922</span>
<span class="normal">2923</span>
<span class="normal">2924</span>
<span class="normal">2925</span>
<span class="normal">2926</span>
<span class="normal">2927</span>
<span class="normal">2928</span>
<span class="normal">2929</span>
<span class="normal">2930</span>
<span class="normal">2931</span>
<span class="normal">2932</span>
<span class="normal">2933</span>
<span class="normal">2934</span>
<span class="normal">2935</span>
<span class="normal">2936</span>
<span class="normal">2937</span>
<span class="normal">2938</span>
<span class="normal">2939</span>
<span class="normal">2940</span>
<span class="normal">2941</span>
<span class="normal">2942</span>
<span class="normal">2943</span>
<span class="normal">2944</span>
<span class="normal">2945</span>
<span class="normal">2946</span>
<span class="normal">2947</span>
<span class="normal">2948</span>
<span class="normal">2949</span>
<span class="normal">2950</span>
<span class="normal">2951</span>
<span class="normal">2952</span>
<span class="normal">2953</span>
<span class="normal">2954</span>
<span class="normal">2955</span>
<span class="normal">2956</span>
<span class="normal">2957</span>
<span class="normal">2958</span>
<span class="normal">2959</span>
<span class="normal">2960</span>
<span class="normal">2961</span>
<span class="normal">2962</span>
<span class="normal">2963</span>
<span class="normal">2964</span>
<span class="normal">2965</span>
<span class="normal">2966</span>
<span class="normal">2967</span>
<span class="normal">2968</span>
<span class="normal">2969</span>
<span class="normal">2970</span>
<span class="normal">2971</span>
<span class="normal">2972</span>
<span class="normal">2973</span>
<span class="normal">2974</span>
<span class="normal">2975</span>
<span class="normal">2976</span>
<span class="normal">2977</span>
<span class="normal">2978</span>
<span class="normal">2979</span>
<span class="normal">2980</span>
<span class="normal">2981</span>
<span class="normal">2982</span>
<span class="normal">2983</span>
<span class="normal">2984</span>
<span class="normal">2985</span>
<span class="normal">2986</span>
<span class="normal">2987</span>
<span class="normal">2988</span>
<span class="normal">2989</span>
<span class="normal">2990</span>
<span class="normal">2991</span>
<span class="normal">2992</span>
<span class="normal">2993</span>
<span class="normal">2994</span>
<span class="normal">2995</span>
<span class="normal">2996</span>
<span class="normal">2997</span>
<span class="normal">2998</span>
<span class="normal">2999</span>
<span class="normal">3000</span>
<span class="normal">3001</span>
<span class="normal">3002</span>
<span class="normal">3003</span>
<span class="normal">3004</span>
<span class="normal">3005</span>
<span class="normal">3006</span>
<span class="normal">3007</span>
<span class="normal">3008</span>
<span class="normal">3009</span>
<span class="normal">3010</span>
<span class="normal">3011</span>
<span class="normal">3012</span>
<span class="normal">3013</span>
<span class="normal">3014</span>
<span class="normal">3015</span>
<span class="normal">3016</span>
<span class="normal">3017</span>
<span class="normal">3018</span>
<span class="normal">3019</span>
<span class="normal">3020</span>
<span class="normal">3021</span>
<span class="normal">3022</span>
<span class="normal">3023</span>
<span class="normal">3024</span>
<span class="normal">3025</span>
<span class="normal">3026</span>
<span class="normal">3027</span>
<span class="normal">3028</span>
<span class="normal">3029</span>
<span class="normal">3030</span>
<span class="normal">3031</span>
<span class="normal">3032</span>
<span class="normal">3033</span>
<span class="normal">3034</span>
<span class="normal">3035</span>
<span class="normal">3036</span>
<span class="normal">3037</span>
<span class="normal">3038</span>
<span class="normal">3039</span>
<span class="normal">3040</span>
<span class="normal">3041</span>
<span class="normal">3042</span>
<span class="normal">3043</span>
<span class="normal">3044</span>
<span class="normal">3045</span>
<span class="normal">3046</span>
<span class="normal">3047</span>
<span class="normal">3048</span>
<span class="normal">3049</span>
<span class="normal">3050</span>
<span class="normal">3051</span>
<span class="normal">3052</span>
<span class="normal">3053</span>
<span class="normal">3054</span>
<span class="normal">3055</span>
<span class="normal">3056</span>
<span class="normal">3057</span>
<span class="normal">3058</span>
<span class="normal">3059</span>
<span class="normal">3060</span>
<span class="normal">3061</span>
<span class="normal">3062</span>
<span class="normal">3063</span>
<span class="normal">3064</span>
<span class="normal">3065</span>
<span class="normal">3066</span>
<span class="normal">3067</span>
<span class="normal">3068</span>
<span class="normal">3069</span>
<span class="normal">3070</span>
<span class="normal">3071</span>
<span class="normal">3072</span>
<span class="normal">3073</span>
<span class="normal">3074</span>
<span class="normal">3075</span>
<span class="normal">3076</span>
<span class="normal">3077</span>
<span class="normal">3078</span>
<span class="normal">3079</span>
<span class="normal">3080</span>
<span class="normal">3081</span>
<span class="normal">3082</span>
<span class="normal">3083</span>
<span class="normal">3084</span>
<span class="normal">3085</span>
<span class="normal">3086</span>
<span class="normal">3087</span>
<span class="normal">3088</span>
<span class="normal">3089</span>
<span class="normal">3090</span>
<span class="normal">3091</span>
<span class="normal">3092</span>
<span class="normal">3093</span>
<span class="normal">3094</span>
<span class="normal">3095</span>
<span class="normal">3096</span>
<span class="normal">3097</span>
<span class="normal">3098</span>
<span class="normal">3099</span>
<span class="normal">3100</span>
<span class="normal">3101</span>
<span class="normal">3102</span>
<span class="normal">3103</span>
<span class="normal">3104</span>
<span class="normal">3105</span>
<span class="normal">3106</span>
<span class="normal">3107</span>
<span class="normal">3108</span>
<span class="normal">3109</span>
<span class="normal">3110</span>
<span class="normal">3111</span>
<span class="normal">3112</span>
<span class="normal">3113</span>
<span class="normal">3114</span>
<span class="normal">3115</span>
<span class="normal">3116</span>
<span class="normal">3117</span>
<span class="normal">3118</span>
<span class="normal">3119</span>
<span class="normal">3120</span>
<span class="normal">3121</span>
<span class="normal">3122</span>
<span class="normal">3123</span>
<span class="normal">3124</span>
<span class="normal">3125</span>
<span class="normal">3126</span>
<span class="normal">3127</span>
<span class="normal">3128</span>
<span class="normal">3129</span>
<span class="normal">3130</span>
<span class="normal">3131</span>
<span class="normal">3132</span>
<span class="normal">3133</span>
<span class="normal">3134</span>
<span class="normal">3135</span>
<span class="normal">3136</span>
<span class="normal">3137</span>
<span class="normal">3138</span>
<span class="normal">3139</span>
<span class="normal">3140</span>
<span class="normal">3141</span>
<span class="normal">3142</span>
<span class="normal">3143</span>
<span class="normal">3144</span>
<span class="normal">3145</span>
<span class="normal">3146</span>
<span class="normal">3147</span>
<span class="normal">3148</span>
<span class="normal">3149</span>
<span class="normal">3150</span>
<span class="normal">3151</span>
<span class="normal">3152</span>
<span class="normal">3153</span>
<span class="normal">3154</span>
<span class="normal">3155</span>
<span class="normal">3156</span>
<span class="normal">3157</span>
<span class="normal">3158</span>
<span class="normal">3159</span>
<span class="normal">3160</span>
<span class="normal">3161</span>
<span class="normal">3162</span>
<span class="normal">3163</span>
<span class="normal">3164</span>
<span class="normal">3165</span>
<span class="normal">3166</span>
<span class="normal">3167</span>
<span class="normal">3168</span>
<span class="normal">3169</span>
<span class="normal">3170</span>
<span class="normal">3171</span>
<span class="normal">3172</span>
<span class="normal">3173</span>
<span class="normal">3174</span>
<span class="normal">3175</span>
<span class="normal">3176</span>
<span class="normal">3177</span>
<span class="normal">3178</span>
<span class="normal">3179</span>
<span class="normal">3180</span>
<span class="normal">3181</span>
<span class="normal">3182</span>
<span class="normal">3183</span>
<span class="normal">3184</span>
<span class="normal">3185</span>
<span class="normal">3186</span>
<span class="normal">3187</span>
<span class="normal">3188</span>
<span class="normal">3189</span>
<span class="normal">3190</span>
<span class="normal">3191</span>
<span class="normal">3192</span>
<span class="normal">3193</span>
<span class="normal">3194</span>
<span class="normal">3195</span>
<span class="normal">3196</span>
<span class="normal">3197</span>
<span class="normal">3198</span>
<span class="normal">3199</span>
<span class="normal">3200</span>
<span class="normal">3201</span>
<span class="normal">3202</span>
<span class="normal">3203</span>
<span class="normal">3204</span>
<span class="normal">3205</span>
<span class="normal">3206</span>
<span class="normal">3207</span>
<span class="normal">3208</span>
<span class="normal">3209</span>
<span class="normal">3210</span>
<span class="normal">3211</span>
<span class="normal">3212</span>
<span class="normal">3213</span>
<span class="normal">3214</span>
<span class="normal">3215</span>
<span class="normal">3216</span>
<span class="normal">3217</span>
<span class="normal">3218</span>
<span class="normal">3219</span>
<span class="normal">3220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Atom</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define the atom object, fill it with data, explore the data, and </span>
<span class="sd">    compute quantities such as level populations and line emissivities.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># This following Class variable will hold the (unique) references of every Atom instance created.</span>
    <span class="c1"># This allows to list all the references used in a project.</span>


    <span class="nd">@profile</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">OmegaInterp</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">noExtrapol</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">NLevels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">pumpingSED</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">i_temp</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Atom constructor</span>

<span class="sd">        Parameters:</span>
<span class="sd">            elem:          symbol of the selected element</span>
<span class="sd">            spec:          ionization stage in spectroscopic notation (I = 1, II = 2, etc.)</span>
<span class="sd">            atom:          ion (e.g. &#39;O3&#39;).</span>
<span class="sd">            OmegaInterp [linear]:   option &quot;kind&quot; from scipy.interpolate.interp1d method: </span>
<span class="sd">                            &#39;linear&#39;, &#39;nearest&#39;, &#39;zero&#39;, &#39;slinear&#39;, &#39;quadratic&#39;, &#39;cubic&#39;, &#39;previous&#39;, &#39;next&#39;, </span>
<span class="sd">                            where &#39;zero&#39;, &#39;slinear&#39;, &#39;quadratic&#39; and &#39;cubic&#39; refer to a spline interpolation of </span>
<span class="sd">                            zeroth, first, second or third order; &#39;previous&#39; and &#39;next&#39; simply return the </span>
<span class="sd">                            previous or next value of the point. </span>
<span class="sd">                            &quot;Cheb&quot; works only for fits files for historical reasons.</span>
<span class="sd">            noExtrapol [False]:     if set to False (default), Omega will be extrapolated above and below</span>
<span class="sd">                            the highest and lowest temperatures where it is defined. If set to True</span>
<span class="sd">                            a NaN will be return.</span>
<span class="sd">            NLevels [None]: If specified, set the maximum number of levels the atom will consider. </span>
<span class="sd">                            The actual value may be lower, depending on the number of levels</span>
<span class="sd">                            available in the coll and atom data.</span>
<span class="sd">            pumpingSED [None]: If specified, fluorescence pumping is performed in the level population estimation.</span>
<span class="sd">                            It is a function of the wavelength (Angstrom) givien the flux as </span>
<span class="sd">            i_temp [None] : Default value for the temperature table in case multiple are read from coll datafile (stout format)</span>

<span class="sd">        **Usage:**</span>
<span class="sd">            O3 = pn.Atom(&#39;O&#39;,3)</span>

<span class="sd">            N2 = pn.Atom(atom=&#39;N2&#39;)</span>

<span class="sd">            S2 = pn.Atom(atom=&#39;S2&#39;, OmegaInterp=&#39;linear&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span> <span class="o">=</span> <span class="n">log_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;coll&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_valid</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">atom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elem</span> <span class="o">=</span> <span class="n">parseAtom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parseAtom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">elem</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;At least elem or atom needs to be given&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;Atom&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isalpha</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">elem</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">elem</span> <span class="o">=</span> <span class="n">elem</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elem</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">sym2name</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">elem</span> <span class="ow">in</span> <span class="n">IP</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">IP</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">IP_up</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">IP</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">IP_up</span> <span class="o">=</span> <span class="n">IP</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">IP</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>                    
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">IP</span> <span class="o">=</span> <span class="n">IP</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">IP</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">IP_up</span> <span class="o">=</span> <span class="n">IP</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">IP</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>                    
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IP</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IP_up</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">=</span> <span class="s1">&#39;Atom &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;Making atom object for </span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span> <span class="o">=</span> <span class="n">NLevels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pumpingSED</span> <span class="o">=</span> <span class="n">pumpingSED</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i_temp</span> <span class="o">=</span> <span class="n">i_temp</span>
        <span class="n">dataFile</span> <span class="o">=</span> <span class="n">atomicData</span><span class="o">.</span><span class="n">getDataFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;atom&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dataFile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">atomFileType</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">atomFileType</span> <span class="o">=</span> <span class="n">dataFile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomFileType</span> <span class="o">==</span> <span class="s1">&#39;fits&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span> <span class="o">=</span> <span class="n">_AtomDataFits</span><span class="p">(</span><span class="n">elem</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">NLevels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomFileType</span> <span class="o">==</span> <span class="s1">&#39;dat&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span> <span class="o">=</span> <span class="n">_AtomDataAscii</span><span class="p">(</span><span class="n">elem</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">NLevels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomFileType</span> <span class="o">==</span> <span class="s1">&#39;chianti&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span> <span class="o">=</span> <span class="n">_AtomChianti</span><span class="p">(</span><span class="n">elem</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">NLevels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomFileType</span> <span class="o">==</span> <span class="s1">&#39;stout&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span> <span class="o">=</span> <span class="n">_AtomDataStout</span><span class="p">(</span><span class="n">elem</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">NLevels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">)</span> 
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomFileType</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span> <span class="o">=</span> <span class="n">_AtomDataNone</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_valid</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Atom file extensions must be fits, dat or chianti&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">atomFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span><span class="o">.</span><span class="n">atomFile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atomPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span><span class="o">.</span><span class="n">atomPath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atomFitsFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomFile</span> <span class="c1"># Obsolete</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atomFitsPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomPath</span> <span class="c1"># Obsolete</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span><span class="o">.</span><span class="n">wave_Ang</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getStatWeight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span><span class="o">.</span><span class="n">getStatWeight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span><span class="o">.</span><span class="n">getEnergy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atomNLevels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span><span class="o">.</span><span class="n">NLevels</span>


        <span class="n">dataFile</span> <span class="o">=</span> <span class="n">atomicData</span><span class="o">.</span><span class="n">getDataFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;coll&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dataFile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">collFileType</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">collFileType</span> <span class="o">=</span> <span class="n">dataFile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collFileType</span> <span class="o">==</span> <span class="s1">&#39;fits&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span> <span class="o">=</span> <span class="n">_CollDataFits</span><span class="p">(</span><span class="n">elem</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> 
                                         <span class="n">OmegaInterp</span><span class="o">=</span><span class="n">OmegaInterp</span><span class="p">,</span> <span class="n">noExtrapol</span> <span class="o">=</span> <span class="n">noExtrapol</span><span class="p">,</span> <span class="n">NLevels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">collFileType</span> <span class="o">==</span> <span class="s1">&#39;dat&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span> <span class="o">=</span> <span class="n">_CollDataAscii</span><span class="p">(</span><span class="n">elem</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> 
                                          <span class="n">OmegaInterp</span><span class="o">=</span><span class="n">OmegaInterp</span><span class="p">,</span> <span class="n">noExtrapol</span> <span class="o">=</span> <span class="n">noExtrapol</span><span class="p">,</span> <span class="n">NLevels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">collFileType</span> <span class="o">==</span> <span class="s1">&#39;chianti&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span> <span class="o">=</span> <span class="n">_CollChianti</span><span class="p">(</span><span class="n">elem</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">NLevels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">collFileType</span> <span class="o">==</span> <span class="s1">&#39;stout&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span> <span class="o">=</span> <span class="n">_CollDataStout</span><span class="p">(</span><span class="n">elem</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> 
                                         <span class="n">OmegaInterp</span><span class="o">=</span><span class="n">OmegaInterp</span><span class="p">,</span> <span class="n">noExtrapol</span> <span class="o">=</span> <span class="n">noExtrapol</span><span class="p">,</span> <span class="n">NLevels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">)</span>          
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">collFileType</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span> <span class="o">=</span> <span class="n">_CollDataNone</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_valid</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CollHeader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">CollHeader</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="s2">&quot;comments&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">comments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getOmegaArray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">getOmegaArray</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getTemArray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">getTemArray</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">collFile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">collPath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collFitsFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collFile</span> <span class="c1"># Obsolete</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collFitsPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collPath</span> <span class="c1"># Obsolete</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collNLevels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">NLevels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tem_units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">tem_units</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">atomNLevels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">collNLevels</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gs</span> <span class="o">=</span> <span class="n">gsFromAtom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AtomHeader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span><span class="o">.</span><span class="n">AtomHeader</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AtomHeader</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NIST</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span><span class="o">.</span><span class="n">NIST</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">NIST</span> <span class="o">=</span> <span class="n">getLevelsNIST</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">NIST</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lineList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lineList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineList</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineList</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">energy_Ryd</span> <span class="o">=</span> <span class="n">quiet_divide</span><span class="p">(</span><span class="n">CST</span><span class="o">.</span><span class="n">RYD_ANG</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">energy_eV</span> <span class="o">=</span> <span class="n">CST</span><span class="o">.</span><span class="n">RYD_EV</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy_Ryd</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span> <span class="c1"># index = quantum number - 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atomNLevels</span><span class="p">):</span> <span class="c1">#upper</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> <span class="c1">#lower</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">HPLANCK</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;cm-1&#39;</span><span class="p">)</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;cm-1&#39;</span><span class="p">))</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">_B</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStatWeight</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStatWeight</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">()</span> <span class="c1"># Angstrom^-1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_StatWeight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStatWeight</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EnergyNLevels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EnergyNLevels</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSources</span><span class="p">()</span>
        <span class="n">atomicData</span><span class="o">.</span><span class="n">add2usedFiles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomFile</span><span class="p">)</span>
        <span class="n">atomicData</span><span class="o">.</span><span class="n">add2usedFiles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">collFile</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ANN_n_temden</span><span class="o">=</span><span class="mi">30</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ANN_inst_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;RM_type&#39;</span> <span class="p">:</span> <span class="s1">&#39;SK_ANN&#39;</span><span class="p">,</span> 
                                <span class="s1">&#39;verbose&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">,</span> 
                                <span class="s1">&#39;scaling&#39;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                                <span class="s1">&#39;use_log&#39;</span> <span class="p">:</span> <span class="kc">True</span>
                                <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ANN_init_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;solver&#39;</span> <span class="p">:</span> <span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span> 
                                <span class="s1">&#39;activation&#39;</span> <span class="p">:</span> <span class="s1">&#39;tanh&#39;</span><span class="p">,</span> 
                                <span class="s1">&#39;hidden_layer_sizes&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> 
                                <span class="s1">&#39;tol&#39;</span> <span class="p">:</span> <span class="mf">1e-6</span><span class="p">,</span>
                                <span class="s1">&#39;max_iter&#39;</span> <span class="p">:</span> <span class="mi">20000</span>
                                <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ANN_Pop_inst_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;RM_type&#39;</span> <span class="p">:</span> <span class="s1">&#39;SK_ANN&#39;</span><span class="p">,</span> 
                                <span class="s1">&#39;verbose&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">,</span> 
                                <span class="s1">&#39;scaling&#39;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                                <span class="s1">&#39;use_log&#39;</span> <span class="p">:</span> <span class="kc">True</span>
                                <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ANN_Pop_init_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;solver&#39;</span> <span class="p">:</span> <span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span> 
                                <span class="s1">&#39;activation&#39;</span> <span class="p">:</span> <span class="s1">&#39;tanh&#39;</span><span class="p">,</span> 
                                <span class="s1">&#39;hidden_layer_sizes&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> 
                                <span class="s1">&#39;tol&#39;</span> <span class="p">:</span> <span class="mf">1e-6</span><span class="p">,</span>
                                <span class="s1">&#39;max_iter&#39;</span> <span class="p">:</span> <span class="mi">20000</span>
                                <span class="p">}</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">getB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lev_1</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_2</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the value of B(i,j) or B(j,i)</span>

<span class="sd">        Parameters:</span>
<span class="sd">            lev_1:  first level</span>
<span class="sd">            lev_2:  end level</span>

<span class="sd">        **Usage:**</span>

<span class="sd">            O3.getB(5,2)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_B</span><span class="p">[</span><span class="n">lev_1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_2</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getOmega</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tem</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return interpolated value of the collision strength value at the given temperature </span>
<span class="sd">            for the complete array or a specified transition.</span>
<span class="sd">        If kappa is not None (non-maxwellian distribution of e-velocities), the collision </span>
<span class="sd">            strength is corrected as in Mendoza &amp; Bautista, 2014 ApJ 785, 91.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            tem:    electronic temperature in K. May be an array.</span>
<span class="sd">            lev_i:  upper level</span>
<span class="sd">            lev_j:  lower level</span>

<span class="sd">        **Usage:**</span>

<span class="sd">            O3.getOmega(15000.)</span>

<span class="sd">            O3.getOmega([8e3, 1e4, 1.2e4])</span>

<span class="sd">            O3.getOmega([8e3, 1e4, 1.2e4], 5, 4)</span>
<span class="sd">        &quot;&quot;&quot;</span>



        <span class="k">if</span> <span class="n">wave</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
        <span class="n">kappa</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">kappa</span> 
        <span class="k">if</span> <span class="n">kappa</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">to_return</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">getOmega</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#ToDo The Kappa correction should come AFTER the transformation into CS unit</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">lev_i</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">lev_j</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">tem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span>
                <span class="n">res_shape</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">collNLevels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">collNLevels</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="n">tem</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                    <span class="n">res_shape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span>
                <span class="n">Omega</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">res_shape</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collNLevels</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">while</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">collNLevels</span><span class="p">):</span>
                        <span class="n">Omega</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getOmega</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">OmegaMB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">getOmega</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="p">)</span>
                <span class="n">delta_E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;eV&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">lev_j</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;eV&#39;</span><span class="p">)</span>
                <span class="n">correc</span> <span class="o">=</span> <span class="p">((</span><span class="n">kappa</span> <span class="o">-</span> <span class="mf">3.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">(</span><span class="n">kappa</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">(</span><span class="n">kappa</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> 
                          <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">delta_E</span><span class="o">/</span><span class="p">((</span><span class="n">kappa</span><span class="o">-</span><span class="mf">1.5</span><span class="p">)</span><span class="o">*</span><span class="n">CST</span><span class="o">.</span><span class="n">BOLTZMANN_eVK</span><span class="o">*</span><span class="n">tem</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">kappa</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">delta_E</span><span class="o">/</span><span class="n">CST</span><span class="o">.</span><span class="n">BOLTZMANN_eVK</span><span class="o">/</span><span class="n">tem</span><span class="p">)</span>

                <span class="n">Omega</span> <span class="o">=</span> <span class="n">correc</span> <span class="o">*</span> <span class="n">OmegaMB</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;Correcting for Kappa=</span><span class="si">{0}</span><span class="s1"> by </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">correc</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>

            <span class="n">to_return</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">Omega</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;COEFF&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">comments</span><span class="p">:</span>
            <span class="n">to_return</span> <span class="o">*=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">comments</span><span class="p">[</span><span class="s1">&#39;COEFF&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;O_UNIT&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">comments</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">comments</span><span class="p">[</span><span class="s1">&#39;O_UNIT&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;DEEX RATE COEFF&#39;</span><span class="p">:</span>
                <span class="n">to_return</span> <span class="o">/=</span> <span class="n">CST</span><span class="o">.</span><span class="n">KCOLLRATE</span> <span class="o">/</span> <span class="n">tem</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStatWeight</span><span class="p">(</span><span class="n">lev_i</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">comments</span><span class="p">[</span><span class="s1">&#39;O_UNIT&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;RATE COEFF&#39;</span><span class="p">:</span>
                <span class="n">deltaE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;erg&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">lev_j</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;erg&#39;</span><span class="p">)</span>
                <span class="n">to_return</span> <span class="o">*=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getStatWeight</span><span class="p">(</span><span class="n">lev_j</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStatWeight</span><span class="p">(</span><span class="n">lev_i</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">deltaE</span> <span class="o">/</span><span class="p">(</span><span class="n">CST</span><span class="o">.</span><span class="n">BOLTZMANN</span> <span class="o">*</span> <span class="n">tem</span><span class="p">)))</span> <span class="c1">#q21</span>
                <span class="n">to_return</span> <span class="o">/=</span> <span class="n">CST</span><span class="o">.</span><span class="n">KCOLLRATE</span> <span class="o">/</span> <span class="n">tem</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStatWeight</span><span class="p">(</span><span class="n">lev_i</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">comments</span><span class="p">[</span><span class="s1">&#39;O_UNIT&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;COOLING&#39;</span><span class="p">:</span>
                <span class="n">deltaE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;erg&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">lev_j</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;erg&#39;</span><span class="p">)</span>
                <span class="n">to_return</span> <span class="o">/=</span> <span class="n">deltaE</span> <span class="c1"># Loss to q12                </span>
                <span class="n">to_return</span> <span class="o">*=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getStatWeight</span><span class="p">(</span><span class="n">lev_j</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStatWeight</span><span class="p">(</span><span class="n">lev_i</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">deltaE</span> <span class="o">/</span><span class="p">(</span><span class="n">CST</span><span class="o">.</span><span class="n">BOLTZMANN</span> <span class="o">*</span> <span class="n">tem</span><span class="p">)))</span> <span class="c1">#q21</span>
                <span class="n">to_return</span> <span class="o">/=</span> <span class="p">(</span><span class="n">CST</span><span class="o">.</span><span class="n">KCOLLRATE</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStatWeight</span><span class="p">(</span><span class="n">lev_i</span><span class="p">))</span> <span class="c1"># Omega</span>

        <span class="k">return</span> <span class="n">to_return</span>

    <span class="nd">@profile</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">getCollRates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tem</span><span class="p">,</span> <span class="n">NLevels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return (n_levels x n_levels) array of collision rates at given temperature. </span>

<span class="sd">        Parameters:</span>
<span class="sd">            tem:     electronic temperature in K. May be an array.</span>

<span class="sd">        **Usage:**</span>

<span class="sd">            O3.getCollRates(tem=10000)</span>

<span class="sd">            O3.getCollRates([8e3, 1e4, 1.2e4])</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">NLevels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">NLevels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">collNLevels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">EnergyNLevels</span><span class="p">))</span>
        <span class="n">res_shape</span> <span class="o">=</span> <span class="p">[</span><span class="n">NLevels</span><span class="p">,</span> <span class="n">NLevels</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="n">tem</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="n">res_shape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span>
        <span class="n">resultArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">res_shape</span><span class="p">)</span>
        <span class="n">Omegas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getOmega</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NLevels</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">lev_i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">energy_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">stat_weight_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_StatWeight</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;</span> <span class="n">NLevels</span><span class="p">):</span>
                <span class="n">lev_j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span> 
                <span class="n">energy_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">stat_weight_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_StatWeight</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">resultArray</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">CST</span><span class="o">.</span><span class="n">KCOLLRATE</span> <span class="o">/</span> <span class="n">tem</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">stat_weight_j</span> <span class="o">*</span> <span class="n">Omegas</span><span class="p">[</span><span class="n">lev_j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">resultArray</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">stat_weight_j</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">stat_weight_i</span><span class="p">)</span> <span class="o">*</span> 
                                      <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">energy_i</span> <span class="o">-</span> <span class="n">energy_j</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">CST</span><span class="o">.</span><span class="n">BOLTZMANN_ANGK</span> <span class="o">*</span> <span class="n">tem</span><span class="p">))</span> <span class="o">*</span> 
                                      <span class="n">resultArray</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">resultArray</span><span class="p">)</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">_Transition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="n">maxErrorA</span> <span class="o">=</span> <span class="mf">5.e-3</span><span class="p">,</span> <span class="n">maxErrorm</span> <span class="o">=</span> <span class="mf">5.e-2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an array with computed upper level, computed lower level, computed wavelength, </span>
<span class="sd">            input wavelength</span>

<span class="sd">        Parameters:</span>
<span class="sd">            wave:       wavelength either in Angstrom (a float or a label: e.g., 5007, &#39;5007A&#39;) </span>
<span class="sd">                            or in micron (a label: &#39;51.5m&#39;)</span>
<span class="sd">            maxErrorA: tolerance if the input wavelength is in Angstrom</span>
<span class="sd">            maxErrorm: tolerance if the input wavelength is in micron                 </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">wave</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
            <span class="n">inputWave</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wave</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">wave</span><span class="p">)</span>
            <span class="n">maxError</span> <span class="o">=</span> <span class="n">maxErrorA</span>
        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">wave</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
            <span class="n">inputWave</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wave</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e4</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">wave</span><span class="p">)</span>
            <span class="n">maxError</span> <span class="o">=</span> <span class="n">maxErrorm</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inputWave</span> <span class="o">=</span> <span class="n">wave</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">A&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">wave</span><span class="p">))</span>
            <span class="n">maxError</span> <span class="o">=</span> <span class="n">maxErrorA</span>

        <span class="c1">#self.log_.debug(&#39;{}&#39;.format(label2levelDict), calling=&#39;_Transition&#39;)</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">label2levelDict</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">label2levelDict</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">label2levelDict</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">inputWave</span><span class="p">,</span> <span class="n">inputWave</span><span class="p">]</span>
            <span class="c1">#self.log_.debug(&#39;label2levelDict[{}] = {}&#39;.format(label, label2levelDict[label]),calling=&#39;_Transition&#39;)</span>
            <span class="k">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="n">j</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span> <span class="o">-</span> <span class="n">inputWave</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">bestWave</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">bestWave</span> <span class="o">-</span> <span class="n">inputWave</span><span class="p">)</span> <span class="o">/</span> <span class="n">inputWave</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bestWave</span><span class="p">,</span> <span class="n">inputWave</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">error</span> <span class="o">&gt;</span> <span class="n">maxError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;_Transition: wavelengths differ by more than </span><span class="si">{0:.2f}</span><span class="s1">%: input = </span><span class="si">{1:.2f}</span><span class="s1">, output = </span><span class="si">{2:.2f}</span><span class="s1">&#39;</span>\
                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">maxError</span><span class="p">,</span> <span class="n">inputWave</span><span class="p">,</span> <span class="n">bestWave</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">getTransition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="n">maxErrorA</span> <span class="o">=</span> <span class="mf">5.e-3</span><span class="p">,</span> <span class="n">maxErrorm</span> <span class="o">=</span> <span class="mf">5.e-2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the indexes (upper level, lower level) of a transition for a given atom </span>
<span class="sd">            from the wavelength.</span>



<span class="sd">        Parameters:</span>
<span class="sd">            wave:      wavelength in Angstrom (a float or a label: e.g., 5007, &#39;5007A&#39;) </span>
<span class="sd">                or in micron (a label: &#39;51.5m&#39;)</span>
<span class="sd">            maxErrorA: tolerance if the input wavelength is in Angstrom</span>
<span class="sd">            maxErrorm: tolerance if the input wavelength is in micron</span>

<span class="sd">        **Usage:**</span>

<span class="sd">            O3.getTransition(4959)   </span>
<span class="sd">        &quot;&quot;&quot;</span> 
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Transition</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">maxErrorA</span> <span class="o">=</span> <span class="n">maxErrorA</span><span class="p">,</span> <span class="n">maxErrorm</span> <span class="o">=</span> <span class="n">maxErrorm</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">printTransition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wave</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print info on transition associated to input wavelength.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            wave:      wavelength in Angstrom (a float or a label: e.g., 5007, &#39;5007A&#39;) </span>
<span class="sd">                or in micron (a label: &#39;51.5m&#39;)</span>

<span class="sd">        **Usage:**</span>

<span class="sd">            O3.printTransition(4959)        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">closestTransition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Transition</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
        <span class="n">relativeError</span> <span class="o">=</span> <span class="n">closestTransition</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">closestTransition</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Input wave: </span><span class="si">{0:.1F}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">closestTransition</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Closest wave found: </span><span class="si">{0:.1F}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">closestTransition</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Relative error: </span><span class="si">{0:.0E}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">relativeError</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Transition: </span><span class="si">{0[0]}</span><span class="s1"> -&gt; </span><span class="si">{0[1]}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">closestTransition</span><span class="p">))</span>
        <span class="k">return</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">printSources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSources</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>    

    <span class="k">def</span><span class="w"> </span><span class="nf">getSources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sources</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="p">:</span>
            <span class="n">sources</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span><span class="o">.</span><span class="n">getSources</span><span class="p">())</span>
            <span class="n">sources</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">getSources</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sources</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span><span class="o">.</span><span class="n">getSources</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">sources</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_test_lev</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test whether selected level is legal</span>

<span class="sd">        Parameters:</span>
<span class="sd">            level:        selected atom level</span>

<span class="sd">        &quot;&quot;&quot;</span>       
        <span class="k">if</span> <span class="n">level</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">level</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Wrong value for level: </span><span class="si">{0}</span><span class="s1">, maximum = </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">),</span>
                            <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the transition probability data. </span>
<span class="sd">        If no arguments are given, the whole array of A is returned.</span>
<span class="sd">        A specific A value can be obtained by giving either the upper and lower levels or </span>
<span class="sd">            the wavelength of the transition (keyword wave).</span>

<span class="sd">        Parameters:</span>
<span class="sd">            lev_i:  upper level of transition (default= -1, returns complete array)</span>
<span class="sd">            lev_j:  lower level of transition (default= -1, returns complete array)</span>
<span class="sd">            wave:   wavelength of transition. Takes precedence on lev_i and lev_j. Ignored if not set.</span>

<span class="sd">        **Usage:**</span>

<span class="sd">            A_O3 = O3.getA()          # The whole A array is stored in A_O3</span>

<span class="sd">            O3.getA(4, 2)      # A(4, 2) of the O3 atom is printed</span>

<span class="sd">            O3.getA(2, 4)      # Returns 0</span>

<span class="sd">            O3.getA(wave=4959)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">wave</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span><span class="o">.</span><span class="n">getA</span><span class="p">(</span><span class="n">lev_i</span><span class="o">=</span> <span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span> <span class="n">lev_j</span><span class="p">)</span>

    <span class="nd">@profile</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_getPopulations_ANN</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">NLevels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private method to obtain level population using Artificial Neuron Network.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">INSTALLED</span><span class="p">[</span><span class="s1">&#39;ai4neb&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;_getPopulations_ANN cannot be used if ai4neb is not imported. Try to run pn.config.import_AI4Neb().&#39;</span><span class="p">,</span>
                          <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">ai4neb</span><span class="w"> </span><span class="kn">import</span> <span class="n">manage_RM</span>

        <span class="n">N</span> <span class="o">=</span> <span class="mi">5000</span>
        <span class="n">tem_min</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTemArray</span><span class="p">())</span>
        <span class="n">tem_max</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTemArray</span><span class="p">())</span>

        <span class="n">tem_train</span> <span class="o">=</span> <span class="n">tem_min</span> <span class="o">+</span> <span class="p">(</span><span class="n">tem_max</span> <span class="o">-</span> <span class="n">tem_min</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="n">den_train</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>

        <span class="n">pop_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPopulations</span><span class="p">(</span><span class="n">tem_train</span><span class="p">,</span> <span class="n">den_train</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">NLevels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_levels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n_levels</span> <span class="o">=</span> <span class="n">NLevels</span>
        <span class="n">pop_train</span> <span class="o">=</span> <span class="n">pop_train</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n_levels</span><span class="p">,:]</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">((</span><span class="n">tem_train</span><span class="p">,</span> <span class="n">den_train</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pop_train</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">RM</span> <span class="o">=</span> <span class="n">manage_RM</span><span class="p">(</span><span class="n">X_train</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y_train</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">ANN_Pop_inst_kwargs</span><span class="p">)</span>
        <span class="n">RM</span><span class="o">.</span><span class="n">init_RM</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">ANN_Pop_init_kwargs</span><span class="p">)</span>
        <span class="n">RM</span><span class="o">.</span><span class="n">train_RM</span><span class="p">()</span>



    <span class="nd">@profile</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">getPopulations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">NLevels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return array of populations at given temperature and density.</span>
<span class="sd">        The method returns a 1-, 2- or 3-D array containing the population of each level </span>
<span class="sd">            for all temperatures and densities specified in the input vectors tem and den </span>
<span class="sd">            (which can be n-element or 1-element vectors).</span>
<span class="sd">        If either quantity (tem or den) is a 1-element vector -that is, a single value-, </span>
<span class="sd">            the resulting population array is collapsed along that dimension; </span>
<span class="sd">            as a result, the result population array can be a 1-D, 2-D or 3-D array </span>
<span class="sd">            (the three cases corresponding to situations in which both tem and den are single values; </span>
<span class="sd">            one of them is a single value and the other an n-element vector; or both are multielement </span>
<span class="sd">            vectors, respectively). In the general case, the level index is the first </span>
<span class="sd">            [WARNING! It is not in physical unit, i.e. ground level = 0; to be normalized], </span>
<span class="sd">            followed by the temperature index (if it exists) and the density index. </span>

<span class="sd">        Parameters:</span>
<span class="sd">            tem:       electronic temperature in K</span>
<span class="sd">            den:       electronic density in cm^-3</span>
<span class="sd">            product:   operate on all possible combinations of temperature and density </span>
<span class="sd">                      (product = True, default case) or on those resulting from combining </span>
<span class="sd">                      the i-th value of tem with the i-th value of den (product = False).</span>
<span class="sd">                      If product = False, then tem and den must be the same size.</span>

<span class="sd">        **Usage:**</span>

<span class="sd">            O3.getPopulations(1e4, 1e2)</span>

<span class="sd">            tem=np.array([10000., 12000., 15000., 20000]) # An array of four temperatures</span>

<span class="sd">            den=np.array([600., 800., 1000])      # An array of three densities</span>

<span class="sd">            O3.getPopulations(tem, den)           # is a (6, 4, 3) array</span>

<span class="sd">            O3.getPopulations(tem, den)[0,2,1]    # Returns the population of level 1 for T = 15000 </span>
<span class="sd">                                                    and Ne = 800</span>

<span class="sd">            tem = 20000                           # tem is no longer an array</span>

<span class="sd">            O3.getPopulations(tem, den)[0,2,1]  # Crashes: one index too much</span>

<span class="sd">            O3.getPopulations(tem, den)[0,1]    # Returns the population of level 1 for T = 20000 </span>
<span class="sd">                                                    and Ne = 800 [see warning]</span>

<span class="sd">            tem=np.array([10000., 15000., 20000]) # An array of three temperatures</span>

<span class="sd">            O3.getPopulations(tem, den, product = False)# is a (6, 3) array, tem and den beeing </span>
<span class="sd">                                                            taken 2 by 2.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span>
        <span class="n">den</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">den</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">NLevels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n_level</span> <span class="o">=</span> <span class="n">NLevels</span>
        <span class="k">if</span> <span class="n">product</span><span class="p">:</span>
            <span class="n">n_tem</span> <span class="o">=</span> <span class="n">tem</span><span class="o">.</span><span class="n">size</span>
            <span class="n">n_den</span> <span class="o">=</span> <span class="n">den</span><span class="o">.</span><span class="n">size</span>
            <span class="n">tem_ones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_tem</span><span class="p">)</span>
            <span class="n">den_ones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_den</span><span class="p">)</span>
            <span class="c1"># q is vector-indexed (q(0, 1) = rate between levels 1 and 2)</span>
            <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCollRates</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">n_level</span><span class="p">)</span>
            <span class="n">Atem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">[:</span><span class="n">n_level</span><span class="p">,</span> <span class="p">:</span><span class="n">n_level</span><span class="p">],</span> <span class="n">tem_ones</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_level</span><span class="p">,</span> <span class="n">n_level</span><span class="p">,</span> <span class="n">n_tem</span><span class="p">)</span>
            <span class="n">pop_result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_level</span><span class="p">,</span> <span class="n">n_tem</span><span class="p">,</span> <span class="n">n_den</span><span class="p">))</span>
            <span class="n">sum_q_up</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_level</span><span class="p">,</span> <span class="n">n_tem</span><span class="p">))</span>
            <span class="n">sum_q_down</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_level</span><span class="p">,</span> <span class="n">n_tem</span><span class="p">))</span>
            <span class="n">sum_A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">Atem</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_critDensity</span> <span class="o">=</span> <span class="n">sum_A</span> <span class="o">/</span> <span class="n">q</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_level</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_level</span><span class="p">):</span>
                    <span class="n">sum_q_up</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_q_up</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                    <span class="n">sum_q_down</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_q_down</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
            <span class="n">coeff_matrix</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">den</span><span class="p">)</span> <span class="o">+</span> 
                             <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">Atem</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">den_ones</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_level</span><span class="p">,</span> <span class="n">n_level</span><span class="p">,</span> <span class="n">n_tem</span><span class="p">,</span> <span class="n">n_den</span><span class="p">))</span>
            <span class="n">coeff_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_level</span><span class="p">):</span>
                <span class="n">coeff_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">((</span><span class="n">sum_q_up</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">sum_q_down</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">den</span><span class="p">)</span> <span class="o">+</span> 
                                        <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">sum_A</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">den_ones</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_tem</span><span class="p">,</span> <span class="n">n_den</span><span class="p">))</span>
            <span class="n">vect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_level</span><span class="p">)</span>
            <span class="n">vect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>

            <span class="k">for</span> <span class="n">i_tem</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_tem</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i_den</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_den</span><span class="p">):</span>
                    <span class="n">pop_result</span><span class="p">[:,</span> <span class="n">i_tem</span><span class="p">,</span> <span class="n">i_den</span><span class="p">]</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">coeff_matrix</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i_tem</span><span class="p">,</span> <span class="n">i_den</span><span class="p">]),</span> <span class="n">vect</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">pop_result</span><span class="p">[:,</span> <span class="n">i_tem</span><span class="p">,</span> <span class="n">i_den</span><span class="p">]</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">coeff_matrix</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i_tem</span><span class="p">,</span> <span class="n">i_den</span><span class="p">]),</span> <span class="n">vect</span><span class="p">)</span>
                    <span class="c1">#except np.linalg.LinAlgError:</span>
                    <span class="c1">#    pop_result[:, i_tem, i_den] = np.nan</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error solving population matrix&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="n">pop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">pop_result</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tem</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">den</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;tem and den must have the same shape&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">res_shape1</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_level</span><span class="p">]</span>
            <span class="n">res_shape_rav1</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_level</span><span class="p">,</span> <span class="n">tem</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>
            <span class="n">res_shape_rav2</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_level</span><span class="p">,</span> <span class="n">n_level</span><span class="p">,</span> <span class="n">tem</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="n">tem</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                <span class="n">res_shape1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span>
            <span class="n">tem_rav</span> <span class="o">=</span> <span class="n">tem</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">den_rav</span> <span class="o">=</span> <span class="n">den</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCollRates</span><span class="p">(</span><span class="n">tem_rav</span><span class="p">,</span> <span class="n">n_level</span><span class="p">)</span>
            <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">[:</span><span class="n">n_level</span><span class="p">,</span> <span class="p">:</span><span class="n">n_level</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pumpingSED</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">FB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_B</span><span class="p">[:</span><span class="n">n_level</span><span class="p">,</span> <span class="p">:</span><span class="n">n_level</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">FB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_B</span><span class="p">[:</span><span class="n">n_level</span><span class="p">,</span> <span class="p">:</span><span class="n">n_level</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pumpingSED</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="p">[:</span><span class="n">n_level</span><span class="p">,</span> <span class="p">:</span><span class="n">n_level</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_level</span><span class="p">):</span>
                    <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">pop_result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">res_shape_rav1</span><span class="p">)</span>
            <span class="n">coeff_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">res_shape_rav2</span><span class="p">)</span>
            <span class="n">sum_q_up</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">res_shape_rav1</span><span class="p">)</span>
            <span class="n">sum_q_down</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">res_shape_rav1</span><span class="p">)</span>
            <span class="n">sum_A</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">sum_FB</span> <span class="o">=</span> <span class="n">FB</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">n_tem</span> <span class="o">=</span> <span class="n">tem_rav</span><span class="o">.</span><span class="n">size</span>
            <span class="c1"># Following line changed 29/11/2012. It made the code crash when atom_nlevels diff coll_nlevels</span>
            <span class="c1">#Atem = np.outer(self._A, np.ones(n_tem)).reshape(n_level, n_level, n_tem)</span>
            <span class="n">Atem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">[:</span><span class="n">n_level</span><span class="p">,</span> <span class="p">:</span><span class="n">n_level</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_tem</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_level</span><span class="p">,</span> <span class="n">n_level</span><span class="p">,</span> <span class="n">n_tem</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_critDensity</span> <span class="o">=</span> <span class="n">Atem</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">q</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_level</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_level</span><span class="p">):</span>
                    <span class="n">sum_q_up</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_q_up</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                    <span class="n">sum_q_down</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_q_down</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_level</span><span class="p">):</span>
                <span class="c1"># upper right half            </span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_level</span><span class="p">):</span>
                    <span class="n">coeff_matrix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">den_rav</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">]</span> <span class="o">+</span> <span class="n">A</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">]</span> <span class="o">+</span> <span class="n">FB</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">]</span>
                <span class="c1"># lower left half</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                    <span class="n">coeff_matrix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">den_rav</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">]</span> <span class="o">+</span> <span class="n">FB</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">]</span>
                <span class="c1"># diagonal</span>
                <span class="n">coeff_matrix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">den_rav</span> <span class="o">*</span> <span class="p">(</span><span class="n">sum_q_up</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">+</span> <span class="n">sum_q_down</span><span class="p">[</span><span class="n">row</span><span class="p">])</span> <span class="o">+</span> <span class="n">sum_A</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">+</span> <span class="n">sum_FB</span><span class="p">[</span><span class="n">row</span><span class="p">])</span>

            <span class="n">vect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_level</span><span class="p">)</span>
            <span class="n">vect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tem</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">pop_result</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">coeff_matrix</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]),</span> <span class="n">vect</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">:</span>
                    <span class="n">pop_result</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error solving population matrix&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>

            <span class="n">pop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">pop_result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">res_shape1</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">pop</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getLowDensRatio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> 
                        <span class="n">wave1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="mf">1e4</span><span class="p">,</span> <span class="n">lowden</span> <span class="o">=</span> <span class="mf">1e-20</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the value of a diagostic ratio at the low density limit</span>

<span class="sd">        Parameters:</span>
<span class="sd">            lev_i1 (int):</span>
<span class="sd">            lev_i2 (int):</span>
<span class="sd">            lev_j1 (int):</span>
<span class="sd">            lev_j2 (int):</span>
<span class="sd">            wave1 (int):</span>
<span class="sd">            wave2 (int):</span>
<span class="sd">            to_eval (str): </span>
<span class="sd">            tem (float) [1e4]:</span>
<span class="sd">            lowden (float) [1e-20]</span>

<span class="sd">        **Usage:**</span>

<span class="sd">            S2.getLowDensRatio(1e4, lev_i1 = 3, lev_i2 = 2, lev_j1 = 1, lev_j2 = 1)</span>

<span class="sd">            S2.getLowDensRatio(1e4, wave1 = 6716, wave2 = 6731)</span>

<span class="sd">            S2.getLowDensRatio(1e4, to_eval = &#39;L(6716)/L(6731)&#39;, tem=1.5e4)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">wave1</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_j1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wave2</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">to_eval</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">L</span><span class="p">(</span><span class="n">wave</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">lowden</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="n">to_eval</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">lowden</span><span class="p">,</span> <span class="n">lev_i</span> <span class="o">=</span> <span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_j</span> <span class="o">=</span> <span class="n">lev_j1</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">lowden</span><span class="p">,</span> <span class="n">lev_i</span> <span class="o">=</span> <span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j</span> <span class="o">=</span> <span class="n">lev_j2</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>         

    <span class="k">def</span><span class="w"> </span><span class="nf">getHighDensRatio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> 
                         <span class="n">wave1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="mf">1e4</span><span class="p">,</span> <span class="n">highden</span><span class="o">=</span><span class="mf">1e20</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the value of a diagostic ratio at the high density limit</span>

<span class="sd">        Parameters:</span>
<span class="sd">            tem (float):</span>
<span class="sd">            lev_i1 (int):</span>
<span class="sd">            lev_i2 (int):</span>
<span class="sd">            wave1 (int):</span>
<span class="sd">            wave2 (int):</span>
<span class="sd">            to_eval (str): </span>
<span class="sd">            tem (float) [1e4]:</span>
<span class="sd">            highden (float) [1e20]</span>

<span class="sd">        **Usage:**</span>

<span class="sd">            S2.getHighDensRatio(lev_i1 = 3, lev_i2 = 2, lev_j1 = 1, lev_j2 = 1)</span>

<span class="sd">            S2.getHighDensRatio(wave1 = 6716, wave2 = 6731)</span>

<span class="sd">            S2.getHighDensRatio(to_eval = &#39;L(6716)/L(6731)&#39;, tem=1.5e4)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">wave1</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_j1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wave2</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">to_eval</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">L</span><span class="p">(</span><span class="n">wave</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">highden</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="n">to_eval</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">highden</span><span class="p">,</span> <span class="n">lev_i</span> <span class="o">=</span> <span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_j</span> <span class="o">=</span> <span class="n">lev_j1</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">highden</span><span class="p">,</span> <span class="n">lev_i</span> <span class="o">=</span> <span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j</span> <span class="o">=</span> <span class="n">lev_j2</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>   

    <span class="k">def</span><span class="w"> </span><span class="nf">getDensityRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> 
                        <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="mf">1e4</span><span class="p">,</span> <span class="n">lowden</span><span class="o">=</span><span class="mf">1e-20</span><span class="p">,</span> <span class="n">highden</span><span class="o">=</span><span class="mf">1e20</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the range of density where a given line ratio is between 10% and 90% of the low and high density limits</span>

<span class="sd">        Parameters:</span>
<span class="sd">            lev_i1 (int):</span>
<span class="sd">            lev_i2 (int):</span>
<span class="sd">            wave1 (int):</span>
<span class="sd">            wave2 (int):</span>
<span class="sd">            to_eval (str):</span>
<span class="sd">            tol (float): </span>
<span class="sd">            tem (float) [1e4]:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">LowLim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLowDensRatio</span><span class="p">(</span><span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j1</span><span class="p">,</span> <span class="n">lev_j2</span><span class="p">,</span> <span class="n">wave1</span><span class="p">,</span> <span class="n">wave2</span><span class="p">,</span> <span class="n">to_eval</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="n">tem</span><span class="p">,</span> <span class="n">lowden</span><span class="o">=</span><span class="n">lowden</span><span class="p">)</span>
        <span class="n">HighLim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getHighDensRatio</span><span class="p">(</span><span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j1</span><span class="p">,</span> <span class="n">lev_j2</span><span class="p">,</span> <span class="n">wave1</span><span class="p">,</span> <span class="n">wave2</span><span class="p">,</span> <span class="n">to_eval</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="n">tem</span><span class="p">,</span> <span class="n">highden</span><span class="o">=</span><span class="n">highden</span><span class="p">)</span>

        <span class="n">delta</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">LowLim</span> <span class="o">-</span> <span class="n">HighLim</span><span class="p">)</span>
        <span class="n">minRatio</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="n">LowLim</span><span class="p">,</span> <span class="n">HighLim</span><span class="p">))</span> <span class="o">+</span> <span class="n">tol</span> <span class="o">*</span> <span class="n">delta</span>
        <span class="n">maxRatio</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="n">LowLim</span><span class="p">,</span> <span class="n">HighLim</span><span class="p">))</span> <span class="o">-</span> <span class="n">tol</span> <span class="o">*</span> <span class="n">delta</span>
        <span class="n">dens1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTemDen</span><span class="p">(</span><span class="n">minRatio</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="n">tem</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=</span> <span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=</span> <span class="n">lev_j1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=</span> <span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=</span> <span class="n">lev_j2</span><span class="p">,</span>
                  <span class="n">wave1</span><span class="o">=</span> <span class="n">wave1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=</span> <span class="n">wave2</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="n">to_eval</span><span class="p">)</span>
        <span class="n">dens2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTemDen</span><span class="p">(</span><span class="n">maxRatio</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="n">tem</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=</span> <span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=</span> <span class="n">lev_j1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=</span> <span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=</span> <span class="n">lev_j2</span><span class="p">,</span>
                  <span class="n">wave1</span><span class="o">=</span> <span class="n">wave1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=</span> <span class="n">wave2</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="n">to_eval</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">((</span><span class="n">dens1</span><span class="p">,</span> <span class="n">dens2</span><span class="p">)))</span>

    <span class="nd">@profile</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">getCritDensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tem</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the critical density of selected level at given temperature. </span>
<span class="sd">        If no transition is selected, return complete array.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            tem:    electronic temperature in K. May be an array.</span>
<span class="sd">            level:  selected atomic level (default= -1)</span>

<span class="sd">        **Usage:**</span>

<span class="sd">            O3.getCritDensity(12000)</span>

<span class="sd">            O3.getCritDensity(12000, 4)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getPopulations</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="mf">100.</span><span class="p">)</span> <span class="c1"># Any density would do</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_critDensity</span><span class="p">[</span><span class="n">level</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_critDensity</span>        

    <span class="nd">@profile</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">getEmissivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_ANN</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the line emissivity (in erg.s-1.cm3) of selected transition or complete array of emissivities</span>
<span class="sd">        The transition is selected by the argument wave (if given); </span>
<span class="sd">        if wave is not supplied, it is selected by the upper and lower levels (lev_i and lev_j); </span>
<span class="sd">        if neither is given, the whole array is computed</span>

<span class="sd">        Parameters:</span>
<span class="sd">            tem:      electronic temperature in K. May be an array.</span>
<span class="sd">            den:      electronic density in cm^-3. May be an array.</span>
<span class="sd">            lev_i:    upper level (default= -1)</span>
<span class="sd">            lev_j:    lower level (default= -1)</span>
<span class="sd">            wave:     wavelength of transition. Takes precedence on lev_i and lev_j if set, </span>
<span class="sd">                        ignored otherwise. It can also be a blend label.</span>
<span class="sd">            product:  Boolean. If True (default), all the combination of (tem, den) are used. </span>
<span class="sd">                         If False, tem and den must have the same size and are joined.</span>

<span class="sd">        **Usage:**      </span>

<span class="sd">            O3.getEmissivity(12000, 100, 4, 2)         # (4, 2) transition</span>

<span class="sd">            O3.getEmissivity(10000, 10000, wave=5007)  # (4, 2) transition</span>

<span class="sd">            O3.getEmissivity(12000, 100)               # all transitions</span>

<span class="sd">            O3.getEmissivity([10000, 12000], [100, 500], 4, 2)</span>

<span class="sd">            O3.getEmissivity([10000, 12000], [100, 500])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">wave</span><span class="p">)</span> <span class="ow">in</span> <span class="n">BLEND_LIST</span><span class="p">:</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">L</span><span class="p">(</span><span class="n">wave</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span><span class="n">wave</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="n">product</span><span class="p">)</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">I</span><span class="p">(</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">=</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span><span class="n">lev_j</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="n">product</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">BLEND_LIST</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">wave</span><span class="p">)])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> is not understood&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wave</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">+</span> <span class="s1">&#39;getEmissivity&#39;</span><span class="p">)</span>
                <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">res</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">lev_i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">lev_j</span><span class="p">)</span>
        <span class="n">tem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span>
        <span class="n">den</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">den</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wave</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
        <span class="n">NLevels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span>
        <span class="k">if</span> <span class="n">lev_i</span> <span class="o">&gt;</span> <span class="n">NLevels</span> <span class="ow">or</span> <span class="n">lev_j</span> <span class="o">&gt;</span> <span class="n">NLevels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;The number of levels </span><span class="si">{}</span><span class="s1"> does not allow getting this emissivity (</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">). Consider changing the atomic data&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">NLevels</span><span class="p">,</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="p">),</span>
                          <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span> 
        <span class="k">if</span> <span class="n">product</span><span class="p">:</span>
            <span class="n">n_tem</span> <span class="o">=</span> <span class="n">tem</span><span class="o">.</span><span class="n">size</span>
            <span class="n">n_den</span> <span class="o">=</span> <span class="n">den</span><span class="o">.</span><span class="n">size</span>
            <span class="n">tem_ones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_tem</span><span class="p">)</span>
            <span class="n">populations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPopulations</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">lev_i</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">lev_j</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
                <span class="n">resultArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">NLevels</span><span class="p">,</span> <span class="n">NLevels</span><span class="p">,</span> <span class="n">n_tem</span><span class="p">,</span> <span class="n">n_den</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NLevels</span><span class="p">):</span>
                    <span class="n">lev_i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span> 
                    <span class="k">while</span> <span class="p">(</span><span class="n">j</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="n">lev_j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="n">deltaE</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">HPLANCK</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">CLIGHT</span> <span class="o">*</span> <span class="mf">1.e8</span> 
                        <span class="n">resultArray</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">deltaE</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">populations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_tem</span><span class="p">,</span> <span class="n">n_den</span><span class="p">)</span> <span class="o">/</span> 
                                             <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">tem_ones</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_tem</span><span class="p">,</span> <span class="n">n_den</span><span class="p">))</span>
                        <span class="n">j</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">resultArray</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">lev_i</span> <span class="o">&lt;=</span> <span class="n">lev_j</span><span class="p">):</span>
                    <span class="k">return</span> <span class="mf">0.</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">lev_i</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="n">j</span> <span class="o">=</span> <span class="n">lev_j</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="n">deltaE</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">HPLANCK</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">CLIGHT</span> <span class="o">*</span> <span class="mf">1.e8</span> 
                    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">((</span><span class="n">populations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">deltaE</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_tem</span><span class="p">,</span> <span class="n">n_den</span><span class="p">)</span> <span class="o">/</span> 
                                      <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">tem_ones</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_tem</span><span class="p">,</span> <span class="n">n_den</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tem</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">den</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;tem and den must have the same shape&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">populations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPopulations</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">lev_i</span> <span class="o">&lt;=</span> <span class="n">lev_j</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">lev_i</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">lev_j</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">deltaE</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">HPLANCK</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">CLIGHT</span> <span class="o">*</span> <span class="mf">1.e8</span> 
                <span class="k">return</span> <span class="n">populations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">deltaE</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">den</span>


    <span class="nd">@profile</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_getTemDen_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">int_ratio</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                  <span class="n">wave1</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxError</span><span class="o">=</span><span class="mf">1.e-3</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nsect_recur&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">start_x</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">end_x</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                  <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nCut</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">maxIter</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>

        <span class="c1">##</span>
        <span class="c1"># @todo manage blends</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">lev_i1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">lev_j1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">lev_i2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">lev_j2</span><span class="p">)</span>
        <span class="n">tem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span>
        <span class="n">den</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">den</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">int_ratio</span><span class="p">)</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">int_ratio</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">int_ratio</span><span class="p">)</span><span class="o">.</span><span class="n">size</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> 
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">shape</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;getTemDen: int_ratio and tem/den must have the same size&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
                <span class="n">tem_ravel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">den_ravel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="n">den</span>
            <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">den</span><span class="p">)</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">den</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">shape</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;getTemDen: int_ratio and tem/den must have the same size&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
                <span class="n">den_ravel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">den</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">tem_ravel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="n">tem</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">den_ravel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="n">den</span>
                <span class="n">tem_ravel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="n">tem</span>
            <span class="n">int_ratio_ravel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">int_ratio</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
                <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getTemDen_1</span><span class="p">(</span><span class="n">int_ratio_ravel</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tem</span><span class="o">=</span><span class="n">tem_ravel</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">den</span><span class="o">=</span><span class="n">den_ravel</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                           <span class="n">lev_i1</span><span class="o">=</span><span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=</span><span class="n">lev_j1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=</span><span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=</span><span class="n">lev_j2</span><span class="p">,</span>
                                           <span class="n">wave1</span><span class="o">=</span><span class="n">wave1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=</span><span class="n">wave2</span><span class="p">,</span> <span class="n">maxError</span><span class="o">=</span><span class="n">maxError</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                                           <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span> <span class="n">start_x</span><span class="o">=</span><span class="n">start_x</span><span class="p">,</span> <span class="n">end_x</span><span class="o">=</span><span class="n">end_x</span><span class="p">,</span>
                                           <span class="n">to_eval</span><span class="o">=</span><span class="n">to_eval</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">wave1</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_j1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wave2</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">to_eval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">to_eval</span> <span class="o">=</span> <span class="s1">&#39;I(&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lev_i1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lev_j1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)/I(&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lev_i2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lev_j2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>


        <span class="k">if</span> <span class="n">tem</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">temArray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTemArray</span><span class="p">(</span><span class="n">keep_unit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">start_x</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">temArray</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> <span class="c1"># multiple temperature tables in coll file</span>
                    <span class="n">start_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">temArray</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">i_temp</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">start_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">temArray</span><span class="p">)</span> 
                <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                    <span class="n">start_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">start_x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">end_x</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">temArray</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">end_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">temArray</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">i_temp</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">end_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">temArray</span><span class="p">)</span> 
                <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                    <span class="n">end_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">end_x</span><span class="p">)</span>

            <span class="nd">@profile</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">_func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                The function for which a root is looked for.</span>
<span class="sd">                It must return an array if x is an array, if an nsect-like method is used.</span>
<span class="sd">                The returned value is already normalized to the intensity ratio.</span>

<span class="sd">                &quot;&quot;&quot;</span>
                <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                    <span class="n">populations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPopulations</span><span class="p">(</span><span class="mf">10.</span><span class="o">**</span><span class="n">x</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">populations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPopulations</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span>
                <span class="k">def</span><span class="w"> </span><span class="nf">I</span><span class="p">(</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">populations</span><span class="p">[</span><span class="n">lev_i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">[</span><span class="n">lev_i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lev_j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="n">lev_i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="n">lev_j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
                <span class="k">def</span><span class="w"> </span><span class="nf">L</span><span class="p">(</span><span class="n">wave</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">populations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
                <span class="n">result</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">to_eval</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">quiet_divide</span><span class="p">((</span><span class="n">result</span> <span class="o">-</span> <span class="n">int_ratio</span><span class="p">),</span> <span class="n">int_ratio</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">den</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">start_x</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">start_x</span> <span class="o">=</span> <span class="mf">1.e0</span>
                <span class="k">if</span> <span class="n">log</span><span class="p">:</span> <span class="n">start_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">start_x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">end_x</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">end_x</span> <span class="o">=</span> <span class="mf">1e8</span>
                <span class="k">if</span> <span class="n">log</span><span class="p">:</span> <span class="n">end_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">end_x</span><span class="p">)</span>

            <span class="nd">@profile</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">_func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                The function for which a root is looked for.</span>
<span class="sd">                It must return an array if x is an array, if an nsect-like method is used.</span>
<span class="sd">                The returned value is already normalized to the intensity ratio.</span>

<span class="sd">                &quot;&quot;&quot;</span>
                <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                    <span class="n">populations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPopulations</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="nb">pow</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">populations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPopulations</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                <span class="k">def</span><span class="w"> </span><span class="nf">I</span><span class="p">(</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">populations</span><span class="p">[</span><span class="n">lev_i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">[</span><span class="n">lev_i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lev_j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="n">lev_i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="n">lev_j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
                <span class="k">def</span><span class="w"> </span><span class="nf">L</span><span class="p">(</span><span class="n">wave</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">populations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
                <span class="n">result</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">to_eval</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">quiet_divide</span><span class="p">((</span><span class="n">result</span> <span class="o">-</span> <span class="n">int_ratio</span><span class="p">),</span> <span class="n">int_ratio</span><span class="p">)</span>
        <span class="c1"># improve exception handling (we must include cases where both tem, den = -1) </span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;ERROR in getTemDen: temperature and density cannot be simultaneously given&#39;</span><span class="p">,</span>
                            <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;nsect_recur&#39;</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Recursive n-section method for finding a root</span>
<span class="sd">            It works by looking for the minumum of abs(f) using the fact that f(array) </span>
<span class="sd">                returns an array</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="nd">@profile</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">nsect_recur</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">nCut</span><span class="p">,</span> <span class="n">maxIter</span><span class="p">,</span> <span class="n">_iter</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">_iter</span> <span class="o">&gt;</span> <span class="n">maxIter</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">nCut</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                <span class="n">x_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">x_min</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">maxError</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="n">x_min</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">x_min</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">x_min</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">x_min</span> <span class="o">==</span> <span class="n">nCut</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">x_min</span> <span class="o">=</span> <span class="n">nCut</span> <span class="o">-</span> <span class="mi">2</span>
                    <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">x_min</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">x_min</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">_iter</span> <span class="o">=</span> <span class="n">_iter</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="c1">#print(x1, x2)</span>
                    <span class="k">return</span> <span class="n">nsect_recur</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">nCut</span><span class="o">=</span><span class="n">nCut</span><span class="p">,</span> <span class="n">maxIter</span><span class="o">=</span><span class="n">maxIter</span><span class="p">,</span> <span class="n">_iter</span><span class="o">=</span><span class="n">_iter</span><span class="p">)</span>

            <span class="n">result</span> <span class="o">=</span> <span class="n">nsect_recur</span><span class="p">(</span><span class="n">_func</span><span class="p">,</span> <span class="n">start_x</span><span class="p">,</span> <span class="n">end_x</span><span class="p">,</span> <span class="n">nCut</span><span class="p">,</span> <span class="n">maxIter</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;nsect_iter&#39;</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Iterative n-section method for finding a root (analogous to the bisection method)</span>
<span class="sd">            It works by looking for the minimum of abs(f) using the fact that f(array) returns an array</span>

<span class="sd">            &quot;&quot;&quot;</span>

            <span class="nd">@profile</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">nsect_iter</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">nCut</span><span class="p">,</span> <span class="n">maxIter</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxIter</span><span class="p">):</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">nCut</span><span class="p">)</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                    <span class="n">x_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">x_min</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">maxError</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="n">x_min</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">x_min</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">x_min</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">x_min</span> <span class="o">==</span> <span class="n">nCut</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span> <span class="n">x_min</span> <span class="o">=</span> <span class="n">nCut</span> <span class="o">-</span> <span class="mi">2</span>
                        <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">x_min</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">x_min</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

            <span class="n">result</span> <span class="o">=</span> <span class="n">nsect_iter</span><span class="p">(</span><span class="n">_func</span><span class="p">,</span> <span class="n">start_x</span><span class="p">,</span> <span class="n">end_x</span><span class="p">,</span> <span class="n">nCut</span><span class="p">,</span> <span class="n">maxIter</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;ERROR in getTemDen: no valid method given&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">log</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">_getTemDen_MP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">int_ratio</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                  <span class="n">wave1</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxError</span><span class="o">=</span><span class="mf">1.e-3</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nsect_recur&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">start_x</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">end_x</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                  <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nCut</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">maxIter</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">INSTALLED</span><span class="p">[</span><span class="s1">&#39;mp&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;_getTemDen_MP cannot be used in absence of multiprocessing package&#39;</span><span class="p">,</span>
                          <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">lev_i1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">lev_j1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">lev_i2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">lev_j2</span><span class="p">)</span>
        <span class="n">tem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span>
        <span class="n">den</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">den</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">int_ratio</span><span class="p">)</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">int_ratio</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">int_ratio</span><span class="p">)</span><span class="o">.</span><span class="n">size</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> 
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">shape</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;getTemDen: int_ratio and tem/den must have the same size&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
                <span class="n">tem_ravel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">den_ravel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="n">den</span>
            <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">den</span><span class="p">)</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">den</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">shape</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;getTemDen: int_ratio and tem/den must have the same size&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
                <span class="n">den_ravel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">den</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">tem_ravel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="n">tem</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">den_ravel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="n">den</span>
                <span class="n">tem_ravel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="n">tem</span>
            <span class="n">int_ratio_ravel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">int_ratio</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getTemDen_1</span><span class="p">(</span><span class="n">int_ratio</span><span class="o">=</span><span class="n">int_ratio</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="n">den</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=</span><span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=</span><span class="n">lev_j1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=</span><span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=</span><span class="n">lev_j2</span><span class="p">,</span>
                  <span class="n">wave1</span><span class="o">=</span><span class="n">wave1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=</span><span class="n">wave2</span><span class="p">,</span> <span class="n">maxError</span><span class="o">=</span><span class="n">maxError</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span> <span class="n">start_x</span><span class="o">=</span><span class="n">start_x</span><span class="p">,</span>
                  <span class="n">end_x</span><span class="o">=</span><span class="n">end_x</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="n">to_eval</span><span class="p">,</span> <span class="n">nCut</span><span class="o">=</span><span class="n">nCut</span><span class="p">,</span> <span class="n">maxIter</span><span class="o">=</span><span class="n">maxIter</span><span class="p">)</span>

        <span class="n">Nprocs</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">Nprocs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;number of CPUs = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Nprocs</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">+</span> <span class="s1">&#39;.getTemDenMP&#39;</span><span class="p">)</span>
        <span class="n">gTDWorkerQ</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>
        <span class="n">gTDDoneQ</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;Queues initialized&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">+</span> <span class="s1">&#39;.getTemDenMP&#39;</span><span class="p">)</span>
        <span class="n">jobid</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">int_rat1</span><span class="p">,</span> <span class="n">tem1</span><span class="p">,</span> <span class="n">den1</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">int_ratio_ravel</span><span class="p">,</span> <span class="n">tem_ravel</span><span class="p">,</span> <span class="n">den_ravel</span><span class="p">):</span>
            <span class="n">gTDWorkerQ</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="n">jobid</span><span class="p">,</span> <span class="n">int_rat1</span><span class="p">,</span> <span class="n">tem1</span><span class="p">,</span> <span class="n">den1</span><span class="p">))</span>
            <span class="n">jobid</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;put done&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">+</span> <span class="s1">&#39;.getTemDenMP&#39;</span><span class="p">)</span>
        <span class="c1">#gTDWorkerQSize = gTDWorkerQ.qsize() # this crash on OSX</span>
        <span class="n">gTDWorkerQSize</span> <span class="o">=</span> <span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;Queue size </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gTDWorkerQSize</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">+</span> <span class="s1">&#39;.getTemDenMP&#39;</span><span class="p">)</span>


        <span class="n">gTDProcesses</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nprocs</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">getTemDen_helper</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">gTDWorkerQ</span><span class="p">,</span> <span class="n">gTDDoneQ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j2</span><span class="p">,</span>
                  <span class="n">wave1</span><span class="p">,</span> <span class="n">wave2</span><span class="p">,</span> <span class="n">maxError</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">start_x</span><span class="p">,</span> <span class="n">end_x</span><span class="p">,</span> <span class="n">to_eval</span><span class="p">,</span> <span class="n">nCut</span><span class="p">,</span> <span class="n">maxIter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">))</span>
            <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="n">gTDProcesses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;processes started&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">+</span> <span class="s1">&#39;.getTemDenMP&#39;</span><span class="p">)</span>

        <span class="c1">#</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gTDWorkerQSize</span><span class="p">):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gTDDoneQ</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;Result obtained&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">+</span> <span class="s1">&#39;.getTemDenMP&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">gTDProcesses</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;Joined&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">+</span> <span class="s1">&#39;.getTemDenMP&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nprocs</span><span class="p">):</span>
            <span class="n">gTDWorkerQ</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;STOP&#39;</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">to_return</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">to_return</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">int_ratio</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>


    <span class="nd">@profile</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_getTemDen_ANN</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">int_ratio</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                  <span class="n">wave1</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">start_x</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">end_x</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">INSTALLED</span><span class="p">[</span><span class="s1">&#39;ai4neb&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;_getTemDen_ANN cannot be used if ai4neb is not imported. Try to run pn.config.import_AI4Neb().&#39;</span><span class="p">,</span>
                          <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">ai4neb</span><span class="w"> </span><span class="kn">import</span> <span class="n">manage_RM</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">lev_i1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">lev_j1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">lev_i2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">lev_j2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wave1</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_j1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wave2</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">to_eval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">to_eval</span> <span class="o">=</span> <span class="s1">&#39;I(&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lev_i1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lev_j1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)/I(&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lev_i2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lev_j2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>

        <span class="n">tem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span>
        <span class="n">den</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">den</span><span class="p">)</span>


        <span class="n">X1_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">int_ratio</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tem</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span> <span class="c1"># Looking for Tem</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">den</span><span class="p">)</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># Single density</span>
                <span class="n">N_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ANN_n_temden</span>
                <span class="n">X2_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">X1_test</span><span class="p">)</span> <span class="o">+</span> <span class="n">den</span>
                <span class="n">X2_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N_train</span><span class="p">)</span> <span class="o">+</span> <span class="n">den</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># Multiple densities</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">den</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">int_ratio</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;getTemDen: int_ratio and tem/den must have the same size&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
                <span class="n">N_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ANN_n_temden</span><span class="o">**</span><span class="mi">2</span>
                <span class="n">X2_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">den</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">X2_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">den</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N_train</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">den</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">den</span><span class="p">))</span> 

            <span class="n">temArray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTemArray</span><span class="p">(</span><span class="n">keep_unit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">start_x</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">temArray</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> <span class="c1"># multiple temperature tables in coll file</span>
                    <span class="n">start_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">temArray</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">i_temp</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">start_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">temArray</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                    <span class="n">start_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">start_x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">end_x</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">temArray</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">end_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">temArray</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">i_temp</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">end_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">temArray</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                    <span class="n">end_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">end_x</span><span class="p">)</span> 
            <span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">start_x</span><span class="p">,</span> <span class="n">end_x</span><span class="p">,</span> <span class="n">N_train</span><span class="p">)</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">I</span><span class="p">(</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="p">):</span>  <span class="c1"># noqa: E743</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="n">X2_train</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">=</span> <span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span> <span class="n">lev_j</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 
            <span class="k">def</span><span class="w"> </span><span class="nf">L</span><span class="p">(</span><span class="n">wave</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="n">X2_train</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span><span class="n">wave</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 

        <span class="k">elif</span> <span class="p">(</span><span class="n">den</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span> <span class="c1"># Looking for density</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">N_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ANN_n_temden</span>
                <span class="n">X2_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">X1_test</span><span class="p">)</span> <span class="o">+</span> <span class="n">tem</span>
                <span class="n">X2_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N_train</span><span class="p">)</span> <span class="o">+</span> <span class="n">tem</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">int_ratio</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;getTemDen: int_ratio and tem/den must have the same size&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
                <span class="n">N_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ANN_n_temden</span><span class="o">**</span><span class="mi">2</span>
                <span class="n">X2_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">X2_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N_train</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">tem</span><span class="p">))</span> 

            <span class="k">if</span> <span class="n">start_x</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">start_x</span> <span class="o">=</span> <span class="mf">1.e0</span>
                <span class="k">if</span> <span class="n">log</span><span class="p">:</span> <span class="n">start_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">start_x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">end_x</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">end_x</span> <span class="o">=</span> <span class="mf">1e8</span>
                <span class="k">if</span> <span class="n">log</span><span class="p">:</span> <span class="n">end_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">end_x</span><span class="p">)</span>
            <span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">start_x</span><span class="p">,</span> <span class="n">end_x</span><span class="p">,</span> <span class="n">N_train</span><span class="p">)</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">I</span><span class="p">(</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="p">):</span>  <span class="c1"># noqa: E743</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="o">=</span><span class="n">X2_train</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">=</span> <span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span> <span class="n">lev_j</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 
            <span class="k">def</span><span class="w"> </span><span class="nf">L</span><span class="p">(</span><span class="n">wave</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="o">=</span><span class="n">X2_train</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span><span class="n">wave</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;getTemDen: one of tem or den must be unset&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>

        <span class="n">X1_train</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">to_eval</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">X1_train</span><span class="p">,</span> <span class="n">X2_train</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ANN</span> <span class="o">=</span> <span class="n">manage_RM</span><span class="p">(</span><span class="n">X_train</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y_train</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">ANN_inst_kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ANN</span><span class="o">.</span><span class="n">init_RM</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">ANN_init_kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ANN</span><span class="o">.</span><span class="n">train_RM</span><span class="p">()</span>
        <span class="c1"># set the test values to the one we are looking for</span>
        <span class="n">X_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">X1_test</span><span class="p">,</span> <span class="n">X2_test</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ANN</span><span class="o">.</span><span class="n">set_test</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="c1"># predict the result and denormalize them</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ANN</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
        <span class="n">to_return</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">int_ratio</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">to_return</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">ANN</span><span class="o">.</span><span class="n">isfin</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ANN</span><span class="o">.</span><span class="n">pred</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">to_return</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">to_return</span>
        <span class="k">return</span> <span class="n">to_return</span>


    <span class="nd">@profile</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">getTemDen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">int_ratio</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                  <span class="n">wave1</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxError</span><span class="o">=</span><span class="mf">1.e-3</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nsect_recur&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">start_x</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">end_x</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                  <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nCut</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">maxIter</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return either the temperature or the density given the other variable for a selected line ratio </span>
<span class="sd">            of known intensity.</span>
<span class="sd">        The line ratio can involve two or more than two lines. </span>
<span class="sd">        In the first case (only two lines), it can be specified giving either two transitions </span>
<span class="sd">            (four atomic levels, i.e. two for each transition), or two wavelengths.</span>
<span class="sd">        In the general case (any number of lines), it can be specified as an algebraic expression </span>
<span class="sd">            to be evaluated, involving either atomic levels or wavelengths.</span>
<span class="sd">        An array of values, rather than a single value, can also be given, in which case the result </span>
<span class="sd">            will also be an array.</span>

<span class="sd">        Parameters:</span>
<span class="sd">           int_ratio:    intensity ratio of the selected transition</span>
<span class="sd">           tem:          electronic temperature</span>
<span class="sd">           den:          electronic density</span>
<span class="sd">           lev_i1:       upper level of 1st transition</span>
<span class="sd">           lev_j1:       lower level of 1st transition</span>
<span class="sd">           lev_i2:       upper level of 2nd transition</span>
<span class="sd">           lev_j2:       lower level of 2nd transition</span>
<span class="sd">           wave1:        wavelength of 1st transition</span>
<span class="sd">           wave2:        wavelength of 2nd transition</span>
<span class="sd">           maxError:     tolerance on difference between input and computed ratio </span>
<span class="sd">           method:       numerical method for finding the root (nsect_recur, nsect_iter)</span>
<span class="sd">           log:          switch of log (default = True). start_x and end_x are using this parameter.</span>
<span class="sd">           start_x:      lower end of the interval to explore. (default: lower end of collision </span>
<span class="sd">                            strength temperature array for temperature, 1 if density)</span>
<span class="sd">           end_x:        higher end of the interval to explore. (default: higher end of collision </span>
<span class="sd">                            strength temperature array for temperature, 1e8 if density)</span>
<span class="sd">           to_eval:      expression to be evaluated, using either I (for transitions identified </span>
<span class="sd">                            through atomic levels) or L (for transitions identified through wavelengths)</span>
<span class="sd">           nCut:        number of sections in which each step is cut. 2 would be dichotomy.</span>
<span class="sd">           maxIter:     maximum number of iterations</span>

<span class="sd">        **Usage:** </span>

<span class="sd">            O3.getTemDen(150., den=100., wave1=5007, wave2=4363, maxError=1.e-2)</span>

<span class="sd">            O3.getTemDen(150., den=100., to_eval = &#39;(I(4,3) + I(4,2) + I(4,1)) / I(5,4)&#39;)</span>

<span class="sd">            N2.getTemDen(150., den=100., to_eval = &#39;(L(6584) + L(6548)) / L(5755)&#39;)</span>

<span class="sd">            O3.getTemDen([0.02, 0.04], den=[1.e4, 1.1e4], to_eval=&quot;I(5, 4) / (I(4, 3) + I(4, 2))&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;ANN&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getTemDen_ANN</span><span class="p">(</span><span class="n">int_ratio</span><span class="o">=</span><span class="n">int_ratio</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="n">den</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=</span><span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=</span><span class="n">lev_j1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=</span><span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=</span><span class="n">lev_j2</span><span class="p">,</span>
                  <span class="n">wave1</span><span class="o">=</span><span class="n">wave1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=</span><span class="n">wave2</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span> <span class="n">start_x</span><span class="o">=</span><span class="n">start_x</span><span class="p">,</span> <span class="n">end_x</span><span class="o">=</span><span class="n">end_x</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="n">to_eval</span><span class="p">)</span>       
        <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">_use_mp</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getTemDen_MP</span><span class="p">(</span><span class="n">int_ratio</span><span class="o">=</span><span class="n">int_ratio</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="n">den</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=</span><span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=</span><span class="n">lev_j1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=</span><span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=</span><span class="n">lev_j2</span><span class="p">,</span>
                  <span class="n">wave1</span><span class="o">=</span><span class="n">wave1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=</span><span class="n">wave2</span><span class="p">,</span> <span class="n">maxError</span><span class="o">=</span><span class="n">maxError</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span> <span class="n">start_x</span><span class="o">=</span><span class="n">start_x</span><span class="p">,</span>
                  <span class="n">end_x</span><span class="o">=</span><span class="n">end_x</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="n">to_eval</span><span class="p">,</span> <span class="n">nCut</span><span class="o">=</span><span class="n">nCut</span><span class="p">,</span> <span class="n">maxIter</span><span class="o">=</span><span class="n">maxIter</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getTemDen_1</span><span class="p">(</span><span class="n">int_ratio</span><span class="o">=</span><span class="n">int_ratio</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="n">den</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=</span><span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=</span><span class="n">lev_j1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=</span><span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=</span><span class="n">lev_j2</span><span class="p">,</span>
                  <span class="n">wave1</span><span class="o">=</span><span class="n">wave1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=</span><span class="n">wave2</span><span class="p">,</span> <span class="n">maxError</span><span class="o">=</span><span class="n">maxError</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span> <span class="n">start_x</span><span class="o">=</span><span class="n">start_x</span><span class="p">,</span>
                  <span class="n">end_x</span><span class="o">=</span><span class="n">end_x</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="n">to_eval</span><span class="p">,</span> <span class="n">nCut</span><span class="o">=</span><span class="n">nCut</span><span class="p">,</span> <span class="n">maxIter</span><span class="o">=</span><span class="n">maxIter</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getIonAbundance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">int_ratio</span><span class="p">,</span> <span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                        <span class="n">Hbeta</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span> <span class="n">tem_HI</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">den_HI</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extrapHbeta</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_ANN</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the ionic abundance relative to H+ given the intensity of a line or sum of lines, </span>
<span class="sd">        the temperature, and the density. </span>
<span class="sd">        The line can be specified as a transition (i.e., giving the two atomic level involved), </span>
<span class="sd">        as a wavelength, or as an algebraic expression. In the last case, a sum of lines </span>
<span class="sd">        can also be supplied.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            int_ratio:    relative line intensity (default normalization: Hbeta = 100). </span>
<span class="sd">                            May be an array.</span>
<span class="sd">            tem:          electronic temperature in K. May be an array.</span>
<span class="sd">            den:          electronic density in cm^-3. May be an array.</span>
<span class="sd">            lev_i:        upper level of transition</span>
<span class="sd">            lev_j:        lower level of transition</span>
<span class="sd">            wave:         wavelength of transition. Takes precedence on lev_i and lev_j if set, </span>
<span class="sd">                            ignored otherwise </span>
<span class="sd">            to_eval:      expression to be evaluated. Takes precedence on wave if set, </span>
<span class="sd">                            ignored otherwise.</span>
<span class="sd">            Hbeta:        line intensity normalization at Hbeta (default Hbeta = 100)</span>

<span class="sd">            tem_HI:       HI temperature. If not set, tem is used.</span>
<span class="sd">            extrapHbeta: [False] if set to True, Hbeta is extrapolated at low Te using Aller 82 function</span>
<span class="sd">            use_ANN: [False] if set to True, use Machine Learning to compute line emissivities</span>

<span class="sd">        **Usage:**</span>

<span class="sd">            O3.getIonAbundance(100, 1.5e4, 100., wave=5007)</span>

<span class="sd">            O3.getIonAbundance(130, 1.5e4, 100., to_eval=&#39;I(4,3) + I(4,2)&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tem_HI</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tem_HI</span> <span class="o">=</span> <span class="n">tem</span>
        <span class="k">if</span> <span class="n">den_HI</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">den_HI</span> <span class="o">=</span> <span class="n">den</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">lev_i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">lev_j</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">den</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;ten and den must have the same shape&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">int_ratio</span><span class="p">))</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">))</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">|</span> 
            <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">den</span><span class="p">))</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">))</span><span class="o">.</span><span class="n">shape</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;int_ratio, tem and den must does not have the same shape&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lev_i</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lev_j</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wave</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">to_eval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;At least one of lev_i, lev_j, wave or to_eval must be supplied&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">to_eval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">wave</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>     
            <span class="n">to_eval</span> <span class="o">=</span> <span class="s1">&#39;I(&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lev_i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lev_j</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span> 
        <span class="k">def</span><span class="w"> </span><span class="nf">I</span><span class="p">(</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="p">):</span> 
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_ANN</span><span class="o">=</span><span class="n">use_ANN</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">L</span><span class="p">(</span><span class="n">wave</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span><span class="n">wave</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_ANN</span><span class="o">=</span><span class="n">use_ANN</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">emis</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">to_eval</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Unable to eval </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">to_eval</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="c1">#int_ratio is in units of Hb = Hbeta keyword</span>
        <span class="k">if</span> <span class="n">extrapHbeta</span><span class="p">:</span>
            <span class="n">HbEmis</span> <span class="o">=</span> <span class="n">getHbEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="o">=</span> <span class="n">tem_HI</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="n">den_HI</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">HbEmis</span> <span class="o">=</span> <span class="n">getRecEmissivity</span><span class="p">(</span><span class="n">tem_HI</span><span class="p">,</span> <span class="n">den_HI</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="s1">&#39;H1&#39;</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ionAbundance</span> <span class="o">=</span> <span class="p">((</span><span class="n">int_ratio</span> <span class="o">/</span> <span class="n">Hbeta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">HbEmis</span> <span class="o">/</span> <span class="n">emis</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ionAbundance</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">printIonic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">printA</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">printPop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">printCrit</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Print miscellaneous information (wavelengths, level populations, emissivities, </span>
<span class="sd">            critical densities) for given physical conditions.</span>
<span class="sd">        If an electron temperature is given, level critical densities can be printed </span>
<span class="sd">            (using printCrit=True)</span>
<span class="sd">        If an electron density is also given, line emissivities (also for Hbeta) are printed and level </span>
<span class="sd">            populations can be printed (using printPop=True)</span>

<span class="sd">        Parameters:</span>
<span class="sd">            tem:          temperature</span>
<span class="sd">            den:          density</span>
<span class="sd">            printA:       also print transition probabilities (default=False)</span>
<span class="sd">            printPop:     also print level populations (needs tem and den)</span>
<span class="sd">            printCrit:    also print critical densities (needs tem)</span>

<span class="sd">        **Usage:**</span>

<span class="sd">            O3.printIonic()</span>

<span class="sd">            O3.printIonic(printA=True)</span>

<span class="sd">            O3.printIonic(tem=10000., printCrit=True)</span>

<span class="sd">            O3.printIonic(tem=10000., den=1e3, printA=True, printPop=True, printCrit=True)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;elem = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;spec = </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;temperature = </span><span class="si">%6.1f</span><span class="s1"> K&#39;</span> <span class="o">%</span> <span class="n">tem</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">den</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;density = </span><span class="si">%6.1f</span><span class="s1"> cm-3&#39;</span> <span class="o">%</span> <span class="n">den</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">printPop</span> <span class="ow">and</span> <span class="p">((</span><span class="n">tem</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">den</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Cannot print populations as tem or den is missing&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="n">printPop</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">printCrit</span> <span class="ow">and</span> <span class="p">(</span><span class="n">tem</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Cannot print critical densities as tem is missing&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="n">printCrit</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">to_print</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">printPop</span><span class="p">:</span>
            <span class="n">to_print</span> <span class="o">+=</span> <span class="s1">&#39;Level   Populations  &#39;</span>
        <span class="k">if</span> <span class="n">printCrit</span><span class="p">:</span>
            <span class="n">to_print</span> <span class="o">+=</span> <span class="s1">&#39;Critical densities&#39;</span>
        <span class="k">if</span> <span class="n">to_print</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">to_print</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">printCrit</span><span class="p">:</span>
            <span class="n">critdens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCritDensity</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">printPop</span><span class="p">:</span>
            <span class="n">pop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPopulations</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">):</span>
            <span class="n">lev_i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">to_print</span> <span class="o">=</span> <span class="s1">&#39;Level </span><span class="si">%1i</span><span class="s1">:  &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lev_i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">printPop</span><span class="p">:</span>
                <span class="n">to_print</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%.3E</span><span class="s2">  &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pop</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">printCrit</span><span class="p">:</span>
                <span class="n">to_print</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%.3E</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">critdens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">printPop</span> <span class="ow">or</span> <span class="n">printCrit</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">to_print</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">printPop</span> <span class="ow">or</span> <span class="n">printCrit</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">tem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">den</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">emis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">printA</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                    <span class="n">to_print</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:.3E}</span><span class="s2">   &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getA</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">to_print</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">10000.</span><span class="p">:</span>
                    <span class="n">to_print</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%10.2f</span><span class="s2">m &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1e4</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">to_print</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%10.2f</span><span class="s2">A &quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">to_print</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    (</span><span class="si">%1i</span><span class="s2">--&gt;</span><span class="si">%1i</span><span class="s2">) &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">tem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">den</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">%.3E</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">emis</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">den</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">H1</span> <span class="o">=</span> <span class="n">RecAtom</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# H-beta volume emissivity:&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.3E</span><span class="s2"> N(H+) * N(e-)  (erg/s)&quot;</span> <span class="o">%</span> <span class="n">H1</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">printTemDen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">int_ratio</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave1</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">maxError</span><span class="o">=</span><span class="mf">1.e-3</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nsect_recur&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">start_x</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">end_x</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">nCut</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">maxIter</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Print result of getTemDen function. See getTemDen for more details.</span>



<span class="sd">        Parameters:</span>
<span class="sd">            int_ratio:    intensity ratio of the selected transition</span>
<span class="sd">            tem:          electronic temperature</span>
<span class="sd">            den:          electronic density</span>
<span class="sd">            lev_i1:       upper level of 1st transition</span>
<span class="sd">            lev_j1:       lower level of 1st transition</span>
<span class="sd">            lev_i2:       upper level of 2nd transition</span>
<span class="sd">            lev_j2:       lower level of 2nd transition</span>
<span class="sd">            wave1:        wavelength of 1st transition</span>
<span class="sd">            wave2:        wavelength of 2nd transition</span>
<span class="sd">            maxError:     tolerance on difference between input and computed ratio </span>
<span class="sd">            method:       numerical method for finding the root (nsect_recur, nsect_iter)</span>
<span class="sd">            log:          log switch (default = True)</span>
<span class="sd">            start_x:      lower end of the interval to explore (default: lower end of collision </span>
<span class="sd">                            strength temperature array)</span>
<span class="sd">            end_x:        higher end of the interval to explore (default: higher end of collision </span>
<span class="sd">                            strength temperature array)</span>
<span class="sd">            to_eval:      expression to be evaluated, using either I (for transitions identified through </span>
<span class="sd">                            atomic levels) or L (for transitions identified through wavelengths)</span>
<span class="sd">            nCut:        number of sections in which each step is cut. 2 would be dichotomy.</span>
<span class="sd">            maxIter:     maximum number of iterations</span>

<span class="sd">        **Usage:**</span>

<span class="sd">            O3.printTemDen(100, tem=10000, wave1=5007, wave2=4363)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tem</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">option</span> <span class="o">=</span> <span class="s1">&#39;temperature&#39;</span>
            <span class="n">assume</span> <span class="o">=</span> <span class="n">den</span>
            <span class="n">assume_str</span> <span class="o">=</span> <span class="s1">&#39;density&#39;</span>
            <span class="n">assume_unit</span> <span class="o">=</span> <span class="s1">&#39;cm-3&#39;</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;K&#39;</span>
        <span class="k">if</span> <span class="n">den</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">option</span> <span class="o">=</span> <span class="s1">&#39;density&#39;</span>
            <span class="n">assume</span> <span class="o">=</span> <span class="n">tem</span>
            <span class="n">assume_str</span> <span class="o">=</span> <span class="s1">&#39;temperature&#39;</span>
            <span class="n">assume_unit</span> <span class="o">=</span> <span class="s1">&#39;K&#39;</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;cm-3&#39;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTemDen</span><span class="p">(</span><span class="n">int_ratio</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="n">den</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=</span><span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=</span><span class="n">lev_j1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=</span><span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=</span><span class="n">lev_j2</span><span class="p">,</span>
                                <span class="n">wave1</span><span class="o">=</span><span class="n">wave1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=</span><span class="n">wave2</span><span class="p">,</span> <span class="n">maxError</span><span class="o">=</span><span class="n">maxError</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span> <span class="n">start_x</span><span class="o">=</span><span class="n">start_x</span><span class="p">,</span>
                                <span class="n">end_x</span><span class="o">=</span><span class="n">end_x</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="n">to_eval</span><span class="p">,</span> <span class="n">nCut</span><span class="o">=</span><span class="n">nCut</span><span class="p">,</span> <span class="n">maxIter</span><span class="o">=</span><span class="n">maxIter</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ion = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">elem</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">int_to_roman</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Option = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">option</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Assumed </span><span class="si">%s</span><span class="s1"> = </span><span class="si">%.0f</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">assume_str</span><span class="p">,</span> <span class="n">assume</span><span class="p">,</span> <span class="n">assume_unit</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">to_eval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Assumed I(</span><span class="si">%i</span><span class="s1">)/I(</span><span class="si">%i</span><span class="s1">) ratio = </span><span class="si">%.0f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wave1</span><span class="p">,</span> <span class="n">wave2</span><span class="p">,</span> <span class="n">int_ratio</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Assumed </span><span class="si">%s</span><span class="s1"> = </span><span class="si">%.0f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">to_eval</span><span class="p">,</span> <span class="n">int_ratio</span><span class="p">))</span>
<span class="c1">#        print &#39;method = %s&#39; % method</span>
<span class="c1">#        print &#39;maxError on ratio %f&#39; % maxError</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Calculated </span><span class="si">%s</span><span class="s1"> = </span><span class="si">%.0f</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">unit</span><span class="p">))</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">plotEmiss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tem_min</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">tem_max</span><span class="o">=</span><span class="mi">30000</span><span class="p">,</span> <span class="n">ionic_abund</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
                  <span class="n">legend_loc</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">temLog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_total</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_only_total</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">total_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">total_label</span><span class="o">=</span><span class="s1">&#39;TOTAL&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Plot the emissivity as a function of temperature of all the lines of the selected atom.  </span>

<span class="sd">        Parameters:</span>
<span class="sd">            tem_min:         minimum value of the temperature range to span (default=1000)</span>
<span class="sd">            tem_max:         maximum value of the temperature range to span (default=30000)</span>
<span class="sd">            ionic_abund:     relative ionic abundance (default = 1.0)</span>
<span class="sd">            den:             electron density</span>
<span class="sd">            style:           line style of the plot (default: &#39;-&#39; [solid line])</span>
<span class="sd">            legend_loc:      localization of the legend (default: 4 = lower right; see plt.legend </span>
<span class="sd">                                for more details)</span>
<span class="sd">            temLog:          linear (False) or logarithmic temperature axis (default = False)</span>
<span class="sd">            plot_total:      flag to also plot total emissivity (default = False)</span>
<span class="sd">            plot_only_total: flag to only plot total emissivity (default = False)</span>
<span class="sd">            legend:          flag to place legend (default = True)</span>
<span class="sd">            total_color:     color of the total emissivity (default = &#39;black&#39;)</span>
<span class="sd">            total_label:     label of the total emissivity (default = &#39;TOTAL&#39;)</span>
<span class="sd">            ax:              axis where to send the plot. If None, a new axis is done</span>

<span class="sd">        **Usage:**</span>

<span class="sd">            O3.plotEmiss(tem_min=10000, tem_max=20000)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">INSTALLED</span><span class="p">[</span><span class="s1">&#39;plt&#39;</span><span class="p">]:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Matplotlib not available, no plot&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">+</span> <span class="s1">&#39;.plot&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">tem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tem_min</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tem_max</span><span class="p">),</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="n">total_emis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">wave</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineList</span><span class="p">:</span>
            <span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">lev_i</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">lev_j</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">):</span>
                <span class="n">color</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineList</span><span class="p">)))</span> <span class="o">/</span> 
                         <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineList</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineList</span><span class="p">))))</span> <span class="o">**</span> <span class="mf">0.4</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">temLog</span><span class="p">:</span>
                    <span class="n">x_to_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">x_to_plot</span> <span class="o">=</span> <span class="n">tem</span>
                <span class="n">y_to_plot</span> <span class="o">=</span> <span class="n">ionic_abund</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span><span class="n">wave</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">plot_only_total</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">y_to_plot</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">):</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_to_plot</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">y_to_plot</span><span class="p">),</span>
                             <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{0:.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wave</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>
                <span class="n">total_emis</span> <span class="o">+=</span> <span class="n">y_to_plot</span>
        <span class="k">if</span> <span class="n">plot_total</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_to_plot</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">total_emis</span><span class="p">),</span>
                     <span class="n">label</span><span class="o">=</span><span class="n">total_label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">total_color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">legend_loc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">temLog</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;log(T[K])&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;T[K]&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;log [erg.cm3/s]&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Line emissivities&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">plotGrotrian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="mf">1e4</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="mf">1e2</span><span class="p">,</span> <span class="n">thresh_int</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;eV&#39;</span><span class="p">,</span> <span class="n">detailed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a Grotrian plot of the selected atom, labelling only lines above a</span>
<span class="sd">        pecified intensity threshold (relative to the most intense line). </span>
<span class="sd">        For ground state levels, the Russell-Saunders term symbol is also given.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            tem:          temperature at which the intensity threshold is to be computed </span>
<span class="sd">            den:          density at which the intensity threshold is to be computed </span>
<span class="sd">            thresh_int:   intensity threshold (relative to the most intense line, default: 1.e-3)</span>
<span class="sd">            unit:         one of &#39;eV&#39; (default), &#39;1/Ang&#39; or &#39;Ryd&#39;</span>
<span class="sd">            ax:           axis where to plot the result</span>

<span class="sd">        Usage:</span>

<span class="sd">            **O3.plotGrotrian()**</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;eV&#39;</span><span class="p">,</span> <span class="s1">&#39;Ryd&#39;</span><span class="p">,</span> <span class="s1">&#39;1/Ang&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Unit </span><span class="si">{0}</span><span class="s1"> not available&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unit</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">INSTALLED</span><span class="p">[</span><span class="s1">&#39;plt&#39;</span><span class="p">]:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Matplotlib not available, no plot&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">+</span> <span class="s1">&#39;.plot&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">color_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">]</span>
        <span class="n">energies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>

        <span class="c1"># VL 16 Jul 2013 - Detect level inversion, just for warning        </span>
        <span class="n">level_multiplet</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">multiplets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NIST</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">term</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">j</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">en</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NIST</span><span class="p">:</span>
                <span class="n">term</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">j</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">en</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">sorted_indx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">en</span><span class="p">)</span> 
            <span class="n">term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">term</span><span class="p">)[</span><span class="n">sorted_indx</span><span class="p">]</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">j</span><span class="p">)[</span><span class="n">sorted_indx</span><span class="p">]</span>
            <span class="n">en</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">en</span><span class="p">)[</span><span class="n">sorted_indx</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">en</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">term</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">term</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">level_multiplet</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">multiplets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level_multiplet</span><span class="p">)</span> 
                    <span class="n">level_multiplet</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">multiplets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level_multiplet</span><span class="p">)</span> <span class="c1"># append last multiplet</span>
<span class="c1"># Mistakenly rounds off fractional J values. Corrected 26/12/2014            </span>
<span class="c1">#            levelLabels = [&#39;$^{{{0}}}${1}$_{{{2:.0f}}}$&#39;.format(l[&#39;term&#39;][0],l[&#39;term&#39;][1],l[&#39;J&#39;]) for l in self.NIST]</span>
            <span class="n">levelLabels</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NIST</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">denominator</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">levelLabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;$^{{</span><span class="si">{0}</span><span class="s1">}}$</span><span class="si">{1}</span><span class="s1">$_{{</span><span class="si">{2}</span><span class="s1">}}$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="s1">&#39;term&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="s1">&#39;term&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">numerator</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">levelLabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;$^{{</span><span class="si">{0}</span><span class="s1">}}$</span><span class="si">{1}</span><span class="s1">$_{{</span><span class="si">{2}</span><span class="s1">/</span><span class="si">{3}</span><span class="s1">}}$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="s1">&#39;term&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="s1">&#39;term&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">numerator</span><span class="p">,</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">denominator</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delta_e_max</span> <span class="o">=</span> <span class="mf">1.e-5</span>  <span class="c1"># Arbitrary limit to define hyperfine structure and identify multiplets </span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">energies</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">()[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">delta_e_max</span><span class="p">):</span>
                    <span class="c1"># if levels close, append level to multiplet</span>
                    <span class="n">level_multiplet</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> 
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># if levels separated, add current multiplet to array and start a new multiplet</span>
                    <span class="n">multiplets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level_multiplet</span><span class="p">)</span> 
                    <span class="n">level_multiplet</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">multiplets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level_multiplet</span><span class="p">)</span> <span class="c1"># append last multiplet</span>
            <span class="n">warn_label</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">levelLabels</span> <span class="o">=</span> <span class="n">gsLevelDict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gs</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i_multi</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">multiplets</span><span class="p">)):</span>
                <span class="n">stat_weights</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="c1"># check each multiplet for inversion separately</span>
                <span class="k">for</span> <span class="n">i_level</span> <span class="ow">in</span> <span class="n">multiplets</span><span class="p">[</span><span class="n">i_multi</span><span class="p">]:</span>
                    <span class="n">latex_sw</span> <span class="o">=</span> <span class="n">levelLabels</span><span class="p">[</span><span class="n">i_level</span><span class="p">]</span>
                    <span class="n">sw</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">latex_sw</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;{&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;*2.+1.&#39;</span><span class="p">)</span>
                    <span class="n">stat_weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sw</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">stat_weights</span> <span class="o">!=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getStatWeight</span><span class="p">()[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">multiplets</span><span class="p">[</span><span class="n">i_multi</span><span class="p">]]):</span>
                    <span class="n">warn_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i_multi</span><span class="p">)</span>
                    <span class="n">to_print</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Level inversion in multiplet </span><span class="si">{0}</span><span class="s1"> of </span><span class="si">{1}</span><span class="s1">&#39;</span>\
                             <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">The labels of levels </span><span class="si">{2}</span><span class="s1"> are displayed in the wrong order&#39;</span> <span class="o">+</span> \
                             <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Assumed statistical weights: </span><span class="si">{3}</span><span class="s1">&#39;</span> <span class="o">+</span> \
                             <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Statistical weights of data: </span><span class="si">{4}</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">to_print</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i_multi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">multiplets</span><span class="p">[</span><span class="n">i_multi</span><span class="p">],</span> 
                                                 <span class="n">stat_weights</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getStatWeight</span><span class="p">()[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">multiplets</span><span class="p">[</span><span class="n">i_multi</span><span class="p">]]),</span> 
                                 <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">+</span> <span class="s1">&#39;.plot&#39;</span><span class="p">)</span>

        <span class="c1"># where level starts in the plot</span>

        <span class="n">x_span</span> <span class="o">=</span> <span class="mf">0.75</span>
        <span class="n">x_0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x_span</span><span class="p">)</span> <span class="o">/</span> <span class="mf">4.</span>    
        <span class="n">dx</span> <span class="o">=</span> <span class="mf">0.005</span>
        <span class="n">max_en</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>
        <span class="n">blow</span> <span class="o">=</span> <span class="mf">0.02</span> <span class="o">*</span> <span class="n">max_en</span> <span class="c1"># blowup scale for multiplets</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">max_en</span> <span class="o">*</span> <span class="mf">1.05</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;[</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">,</span> <span class="n">int_to_roman</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">)))</span>

        <span class="c1"># Blow up of multiplets in the plot</span>
        <span class="n">i_tot</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i_multi</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">multiplets</span><span class="p">)):</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">multiplets</span><span class="p">[</span><span class="n">i_multi</span><span class="p">]))</span> <span class="o">/</span> <span class="mf">2.</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">multiplets</span><span class="p">[</span><span class="n">i_multi</span><span class="p">])):</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">energies</span><span class="p">[</span><span class="n">multiplets</span><span class="p">[</span><span class="n">i_multi</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">shift</span> <span class="o">*</span> <span class="n">blow</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x_0</span><span class="p">,</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">x_0</span><span class="p">,</span> <span class="mf">1.6</span> <span class="o">*</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">x_0</span> <span class="o">+</span> <span class="n">x_span</span><span class="p">],</span> 
                         <span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">energies</span><span class="p">[</span><span class="n">multiplets</span><span class="p">[</span><span class="n">i_multi</span><span class="p">][</span><span class="n">i</span><span class="p">]],</span> 
                          <span class="n">energies</span><span class="p">[</span><span class="n">multiplets</span><span class="p">[</span><span class="n">i_multi</span><span class="p">][</span><span class="n">i</span><span class="p">]]],</span> <span class="n">lw</span> <span class="o">=</span> <span class="mf">1.2</span><span class="p">,</span> 
                         <span class="n">color</span> <span class="o">=</span> <span class="n">color_list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">multiplets</span><span class="p">[</span><span class="n">i_multi</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_list</span><span class="p">))])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_span</span> <span class="o">+</span> <span class="n">x_0</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{0:7.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">energies</span><span class="p">[</span><span class="n">multiplets</span><span class="p">[</span><span class="n">i_multi</span><span class="p">][</span><span class="n">i</span><span class="p">]]),</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">,</span> 
                         <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">detailed</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">):</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">levelLabels</span><span class="p">[</span><span class="n">i_tot</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i_tot</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="n">levelLabels</span><span class="p">[</span><span class="n">i_tot</span><span class="p">]</span> <span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> 
                                <span class="n">color</span> <span class="o">=</span> <span class="n">color_list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">multiplets</span><span class="p">[</span><span class="n">i_multi</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_list</span><span class="p">))])</span>
                    <span class="n">i_tot</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="n">shift</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">dx</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;E [</span><span class="si">{0:s}</span><span class="s1">] &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unit</span><span class="p">),</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Ground-state configuration: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gs</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#004400&quot;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>

        <span class="n">all_emis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span>
        <span class="n">emis_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">all_emis</span><span class="p">)</span>
        <span class="n">N_lines</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="mf">1e4</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">)</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">emis_max</span> <span class="o">*</span> <span class="n">thresh_int</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="c1"># number of lines plotted</span>
        <span class="n">x_pad</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="p">(</span><span class="n">x_span</span> <span class="o">-</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="n">x_0</span><span class="p">)</span>     
        <span class="k">if</span> <span class="n">N_lines</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">delta_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_span</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x_pad</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N_lines</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="mf">1.6</span> <span class="o">*</span> <span class="n">x_0</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">x_pad</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delta_x</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.6</span> <span class="o">*</span> <span class="n">x_0</span> <span class="o">+</span> <span class="n">x_span</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
        <span class="n">cc</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">ColorConverter</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">emis</span> <span class="o">=</span> <span class="n">all_emis</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">emis</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">emis_max</span> <span class="o">*</span> <span class="n">thresh_int</span><span class="p">):</span>
                    <span class="n">N_seg</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c1">#number of segments to draw emission line, to make it look smooth</span>
                    <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N_seg</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span>  <span class="c1"># x coord of segmente making up one line</span>
                    <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">),</span> <span class="n">N_seg</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N_seg</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">alpha</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">scale</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># to make alpha vary as a smooth step function</span>
                    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> 
                    <span class="n">segments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">points</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">:]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
                    <span class="n">cmap1</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">cmap2</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="n">segments</span><span class="p">:</span>
                            <span class="n">yy0</span> <span class="o">=</span> <span class="n">seg</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> 
                            <span class="n">alpha0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">yy0</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
                            <span class="n">rgb1</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">to_rgb</span><span class="p">(</span><span class="n">color_list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_list</span><span class="p">))])</span> 
                            <span class="n">rgb2</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">to_rgb</span><span class="p">(</span><span class="n">color_list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_list</span><span class="p">))])</span> 
                            <span class="n">cmap1</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">rgb1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rgb1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rgb1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">alpha0</span><span class="p">])</span> 
                            <span class="n">cmap2</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">rgb2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rgb2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rgb2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="o">-</span><span class="n">alpha0</span><span class="p">])</span>
                    <span class="n">lc1</span> <span class="o">=</span> <span class="n">LineCollection</span><span class="p">(</span><span class="n">segments</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">3.5</span><span class="p">)</span>
                    <span class="n">lc1</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">cmap1</span><span class="p">)</span> 
                    <span class="n">lc2</span> <span class="o">=</span> <span class="n">LineCollection</span><span class="p">(</span><span class="n">segments</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">3.5</span><span class="p">)</span>
                    <span class="n">lc2</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">cmap2</span><span class="p">)</span> 
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">lc1</span><span class="p">)</span> 
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">lc2</span><span class="p">)</span> 
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1e4</span><span class="p">:</span>
                        <span class="n">to_print</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.1f}</span><span class="s1">m&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1e4</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">to_print</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.1f}</span><span class="s1">A&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">delta_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span><span class="o">-</span><span class="n">blow</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">to_print</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">delta_x</span>

        <span class="c1"># issue warning on plot if level inversion </span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">warn_label</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">multiplets</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">),</span> <span class="s1">&#39;Warning &#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>


    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;Atom </span><span class="si">{0}{1}</span><span class="s1"> from </span><span class="si">{2}</span><span class="s1"> and </span><span class="si">{3}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomFile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">collFile</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Atom.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">elem</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">OmegaInterp</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">noExtrapol</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">NLevels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pumpingSED</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">i_temp</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Atom constructor</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>elem</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>symbol of the selected element</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>spec</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ionization stage in spectroscopic notation (I = 1, II = 2, etc.)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>atom</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ion (e.g. 'O3').</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>OmegaInterp</code></td>
            <td>
                  <code>[linear]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>option "kind" from scipy.interpolate.interp1d method: 
            'linear', 'nearest', 'zero', 'slinear', 'quadratic', 'cubic', 'previous', 'next', 
            where 'zero', 'slinear', 'quadratic' and 'cubic' refer to a spline interpolation of 
            zeroth, first, second or third order; 'previous' and 'next' simply return the 
            previous or next value of the point. 
            "Cheb" works only for fits files for historical reasons.</p>
              </div>
            </td>
            <td>
                  <code>&#39;linear&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>noExtrapol</code></td>
            <td>
                  <code>[False]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if set to False (default), Omega will be extrapolated above and below
            the highest and lowest temperatures where it is defined. If set to True
            a NaN will be return.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>NLevels</code></td>
            <td>
                  <code>[None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If specified, set the maximum number of levels the atom will consider. 
            The actual value may be lower, depending on the number of levels
            available in the coll and atom data.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>pumpingSED</code></td>
            <td>
                  <code>[None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If specified, fluorescence pumping is performed in the level population estimation.
            It is a function of the wavelength (Angstrom) givien the flux as </p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>i_temp</code></td>
            <td>
                  <code>[None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Default value for the temperature table in case multiple are read from coll datafile (stout format)</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong>
    O3 = pn.Atom('O',3)</p>
<pre><code>N2 = pn.Atom(atom='N2')

S2 = pn.Atom(atom='S2', OmegaInterp='linear')
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@profile</span>
<span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">OmegaInterp</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">noExtrapol</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">NLevels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">pumpingSED</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">i_temp</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Atom constructor</span>

<span class="sd">    Parameters:</span>
<span class="sd">        elem:          symbol of the selected element</span>
<span class="sd">        spec:          ionization stage in spectroscopic notation (I = 1, II = 2, etc.)</span>
<span class="sd">        atom:          ion (e.g. &#39;O3&#39;).</span>
<span class="sd">        OmegaInterp [linear]:   option &quot;kind&quot; from scipy.interpolate.interp1d method: </span>
<span class="sd">                        &#39;linear&#39;, &#39;nearest&#39;, &#39;zero&#39;, &#39;slinear&#39;, &#39;quadratic&#39;, &#39;cubic&#39;, &#39;previous&#39;, &#39;next&#39;, </span>
<span class="sd">                        where &#39;zero&#39;, &#39;slinear&#39;, &#39;quadratic&#39; and &#39;cubic&#39; refer to a spline interpolation of </span>
<span class="sd">                        zeroth, first, second or third order; &#39;previous&#39; and &#39;next&#39; simply return the </span>
<span class="sd">                        previous or next value of the point. </span>
<span class="sd">                        &quot;Cheb&quot; works only for fits files for historical reasons.</span>
<span class="sd">        noExtrapol [False]:     if set to False (default), Omega will be extrapolated above and below</span>
<span class="sd">                        the highest and lowest temperatures where it is defined. If set to True</span>
<span class="sd">                        a NaN will be return.</span>
<span class="sd">        NLevels [None]: If specified, set the maximum number of levels the atom will consider. </span>
<span class="sd">                        The actual value may be lower, depending on the number of levels</span>
<span class="sd">                        available in the coll and atom data.</span>
<span class="sd">        pumpingSED [None]: If specified, fluorescence pumping is performed in the level population estimation.</span>
<span class="sd">                        It is a function of the wavelength (Angstrom) givien the flux as </span>
<span class="sd">        i_temp [None] : Default value for the temperature table in case multiple are read from coll datafile (stout format)</span>

<span class="sd">    **Usage:**</span>
<span class="sd">        O3 = pn.Atom(&#39;O&#39;,3)</span>

<span class="sd">        N2 = pn.Atom(atom=&#39;N2&#39;)</span>

<span class="sd">        S2 = pn.Atom(atom=&#39;S2&#39;, OmegaInterp=&#39;linear&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>        
    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span> <span class="o">=</span> <span class="n">log_</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;coll&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_valid</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">atom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elem</span> <span class="o">=</span> <span class="n">parseAtom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parseAtom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">elem</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;At least elem or atom needs to be given&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;Atom&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isalpha</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elem</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elem</span> <span class="o">=</span> <span class="n">elem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elem</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">sym2name</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">elem</span> <span class="ow">in</span> <span class="n">IP</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IP</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IP_up</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IP</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">IP_up</span> <span class="o">=</span> <span class="n">IP</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">IP</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>                    
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">IP</span> <span class="o">=</span> <span class="n">IP</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">IP</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">IP_up</span> <span class="o">=</span> <span class="n">IP</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">IP</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>                    
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IP</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IP_up</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">=</span> <span class="s1">&#39;Atom &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;Making atom object for </span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span> <span class="o">=</span> <span class="n">NLevels</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pumpingSED</span> <span class="o">=</span> <span class="n">pumpingSED</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">i_temp</span> <span class="o">=</span> <span class="n">i_temp</span>
    <span class="n">dataFile</span> <span class="o">=</span> <span class="n">atomicData</span><span class="o">.</span><span class="n">getDataFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;atom&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dataFile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atomFileType</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atomFileType</span> <span class="o">=</span> <span class="n">dataFile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomFileType</span> <span class="o">==</span> <span class="s1">&#39;fits&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span> <span class="o">=</span> <span class="n">_AtomDataFits</span><span class="p">(</span><span class="n">elem</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">NLevels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomFileType</span> <span class="o">==</span> <span class="s1">&#39;dat&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span> <span class="o">=</span> <span class="n">_AtomDataAscii</span><span class="p">(</span><span class="n">elem</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">NLevels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomFileType</span> <span class="o">==</span> <span class="s1">&#39;chianti&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span> <span class="o">=</span> <span class="n">_AtomChianti</span><span class="p">(</span><span class="n">elem</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">NLevels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomFileType</span> <span class="o">==</span> <span class="s1">&#39;stout&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span> <span class="o">=</span> <span class="n">_AtomDataStout</span><span class="p">(</span><span class="n">elem</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">NLevels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomFileType</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span> <span class="o">=</span> <span class="n">_AtomDataNone</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_valid</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Atom file extensions must be fits, dat or chianti&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">atomFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span><span class="o">.</span><span class="n">atomFile</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">atomPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span><span class="o">.</span><span class="n">atomPath</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">atomFitsFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomFile</span> <span class="c1"># Obsolete</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">atomFitsPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomPath</span> <span class="c1"># Obsolete</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span><span class="o">.</span><span class="n">wave_Ang</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">getStatWeight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span><span class="o">.</span><span class="n">getStatWeight</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span><span class="o">.</span><span class="n">getEnergy</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">atomNLevels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span><span class="o">.</span><span class="n">NLevels</span>


    <span class="n">dataFile</span> <span class="o">=</span> <span class="n">atomicData</span><span class="o">.</span><span class="n">getDataFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;coll&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dataFile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collFileType</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collFileType</span> <span class="o">=</span> <span class="n">dataFile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collFileType</span> <span class="o">==</span> <span class="s1">&#39;fits&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span> <span class="o">=</span> <span class="n">_CollDataFits</span><span class="p">(</span><span class="n">elem</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> 
                                     <span class="n">OmegaInterp</span><span class="o">=</span><span class="n">OmegaInterp</span><span class="p">,</span> <span class="n">noExtrapol</span> <span class="o">=</span> <span class="n">noExtrapol</span><span class="p">,</span> <span class="n">NLevels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">collFileType</span> <span class="o">==</span> <span class="s1">&#39;dat&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span> <span class="o">=</span> <span class="n">_CollDataAscii</span><span class="p">(</span><span class="n">elem</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> 
                                      <span class="n">OmegaInterp</span><span class="o">=</span><span class="n">OmegaInterp</span><span class="p">,</span> <span class="n">noExtrapol</span> <span class="o">=</span> <span class="n">noExtrapol</span><span class="p">,</span> <span class="n">NLevels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">collFileType</span> <span class="o">==</span> <span class="s1">&#39;chianti&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span> <span class="o">=</span> <span class="n">_CollChianti</span><span class="p">(</span><span class="n">elem</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">NLevels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">collFileType</span> <span class="o">==</span> <span class="s1">&#39;stout&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span> <span class="o">=</span> <span class="n">_CollDataStout</span><span class="p">(</span><span class="n">elem</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> 
                                     <span class="n">OmegaInterp</span><span class="o">=</span><span class="n">OmegaInterp</span><span class="p">,</span> <span class="n">noExtrapol</span> <span class="o">=</span> <span class="n">noExtrapol</span><span class="p">,</span> <span class="n">NLevels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">)</span>          
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">collFileType</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span> <span class="o">=</span> <span class="n">_CollDataNone</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_valid</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CollHeader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">CollHeader</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">if</span> <span class="s2">&quot;comments&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">comments</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">getOmegaArray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">getOmegaArray</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">getTemArray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">getTemArray</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">collFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">collFile</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">collPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">collPath</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">collFitsFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collFile</span> <span class="c1"># Obsolete</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">collFitsPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collPath</span> <span class="c1"># Obsolete</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">collNLevels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">NLevels</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tem_units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">tem_units</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">atomNLevels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">collNLevels</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">gs</span> <span class="o">=</span> <span class="n">gsFromAtom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AtomHeader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span><span class="o">.</span><span class="n">AtomHeader</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AtomHeader</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NIST</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span><span class="o">.</span><span class="n">NIST</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NIST</span> <span class="o">=</span> <span class="n">getLevelsNIST</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NIST</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lineList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lineList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lineList</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineList</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">energy_Ryd</span> <span class="o">=</span> <span class="n">quiet_divide</span><span class="p">(</span><span class="n">CST</span><span class="o">.</span><span class="n">RYD_ANG</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">energy_eV</span> <span class="o">=</span> <span class="n">CST</span><span class="o">.</span><span class="n">RYD_EV</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy_Ryd</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getA</span><span class="p">()</span> <span class="c1"># index = quantum number - 1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atomNLevels</span><span class="p">):</span> <span class="c1">#upper</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> <span class="c1">#lower</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">HPLANCK</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;cm-1&#39;</span><span class="p">)</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;cm-1&#39;</span><span class="p">))</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">_B</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStatWeight</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStatWeight</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">()</span> <span class="c1"># Angstrom^-1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_StatWeight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStatWeight</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EnergyNLevels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EnergyNLevels</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSources</span><span class="p">()</span>
    <span class="n">atomicData</span><span class="o">.</span><span class="n">add2usedFiles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomFile</span><span class="p">)</span>
    <span class="n">atomicData</span><span class="o">.</span><span class="n">add2usedFiles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">collFile</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">ANN_n_temden</span><span class="o">=</span><span class="mi">30</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ANN_inst_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;RM_type&#39;</span> <span class="p">:</span> <span class="s1">&#39;SK_ANN&#39;</span><span class="p">,</span> 
                            <span class="s1">&#39;verbose&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">,</span> 
                            <span class="s1">&#39;scaling&#39;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                            <span class="s1">&#39;use_log&#39;</span> <span class="p">:</span> <span class="kc">True</span>
                            <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ANN_init_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;solver&#39;</span> <span class="p">:</span> <span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span> 
                            <span class="s1">&#39;activation&#39;</span> <span class="p">:</span> <span class="s1">&#39;tanh&#39;</span><span class="p">,</span> 
                            <span class="s1">&#39;hidden_layer_sizes&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> 
                            <span class="s1">&#39;tol&#39;</span> <span class="p">:</span> <span class="mf">1e-6</span><span class="p">,</span>
                            <span class="s1">&#39;max_iter&#39;</span> <span class="p">:</span> <span class="mi">20000</span>
                            <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ANN_Pop_inst_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;RM_type&#39;</span> <span class="p">:</span> <span class="s1">&#39;SK_ANN&#39;</span><span class="p">,</span> 
                            <span class="s1">&#39;verbose&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">,</span> 
                            <span class="s1">&#39;scaling&#39;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                            <span class="s1">&#39;use_log&#39;</span> <span class="p">:</span> <span class="kc">True</span>
                            <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ANN_Pop_init_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;solver&#39;</span> <span class="p">:</span> <span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span> 
                            <span class="s1">&#39;activation&#39;</span> <span class="p">:</span> <span class="s1">&#39;tanh&#39;</span><span class="p">,</span> 
                            <span class="s1">&#39;hidden_layer_sizes&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> 
                            <span class="s1">&#39;tol&#39;</span> <span class="p">:</span> <span class="mf">1e-6</span><span class="p">,</span>
                            <span class="s1">&#39;max_iter&#39;</span> <span class="p">:</span> <span class="mi">20000</span>
                            <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Atom.getA" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getA</span><span class="p">(</span><span class="n">lev_i</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return the transition probability data. 
If no arguments are given, the whole array of A is returned.
A specific A value can be obtained by giving either the upper and lower levels or 
    the wavelength of the transition (keyword wave).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>lev_i</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>upper level of transition (default= -1, returns complete array)</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_j</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>lower level of transition (default= -1, returns complete array)</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>wave</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>wavelength of transition. Takes precedence on lev_i and lev_j. Ignored if not set.</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong></p>
<pre><code>A_O3 = O3.getA()          # The whole A array is stored in A_O3

O3.getA(4, 2)      # A(4, 2) of the O3 atom is printed

O3.getA(2, 4)      # Returns 0

O3.getA(wave=4959)
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the transition probability data. </span>
<span class="sd">    If no arguments are given, the whole array of A is returned.</span>
<span class="sd">    A specific A value can be obtained by giving either the upper and lower levels or </span>
<span class="sd">        the wavelength of the transition (keyword wave).</span>

<span class="sd">    Parameters:</span>
<span class="sd">        lev_i:  upper level of transition (default= -1, returns complete array)</span>
<span class="sd">        lev_j:  lower level of transition (default= -1, returns complete array)</span>
<span class="sd">        wave:   wavelength of transition. Takes precedence on lev_i and lev_j. Ignored if not set.</span>

<span class="sd">    **Usage:**</span>

<span class="sd">        A_O3 = O3.getA()          # The whole A array is stored in A_O3</span>

<span class="sd">        O3.getA(4, 2)      # A(4, 2) of the O3 atom is printed</span>

<span class="sd">        O3.getA(2, 4)      # Returns 0</span>

<span class="sd">        O3.getA(wave=4959)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">wave</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">AtomData</span><span class="o">.</span><span class="n">getA</span><span class="p">(</span><span class="n">lev_i</span><span class="o">=</span> <span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span> <span class="n">lev_j</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Atom.getB" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getB</span><span class="p">(</span><span class="n">lev_1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_2</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return the value of B(i,j) or B(j,i)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>lev_1</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>first level</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_2</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>end level</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong></p>
<pre><code>O3.getB(5,2)
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lev_1</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_2</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the value of B(i,j) or B(j,i)</span>

<span class="sd">    Parameters:</span>
<span class="sd">        lev_1:  first level</span>
<span class="sd">        lev_2:  end level</span>

<span class="sd">    **Usage:**</span>

<span class="sd">        O3.getB(5,2)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_B</span><span class="p">[</span><span class="n">lev_1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_2</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Atom.getCollRates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getCollRates</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">NLevels</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return (n_levels x n_levels) array of collision rates at given temperature. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>tem</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>electronic temperature in K. May be an array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong></p>
<pre><code>O3.getCollRates(tem=10000)

O3.getCollRates([8e3, 1e4, 1.2e4])
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@profile</span>
<span class="k">def</span><span class="w"> </span><span class="nf">getCollRates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tem</span><span class="p">,</span> <span class="n">NLevels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return (n_levels x n_levels) array of collision rates at given temperature. </span>

<span class="sd">    Parameters:</span>
<span class="sd">        tem:     electronic temperature in K. May be an array.</span>

<span class="sd">    **Usage:**</span>

<span class="sd">        O3.getCollRates(tem=10000)</span>

<span class="sd">        O3.getCollRates([8e3, 1e4, 1.2e4])</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">NLevels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">NLevels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">collNLevels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">EnergyNLevels</span><span class="p">))</span>
    <span class="n">res_shape</span> <span class="o">=</span> <span class="p">[</span><span class="n">NLevels</span><span class="p">,</span> <span class="n">NLevels</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="n">tem</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="n">res_shape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span>
    <span class="n">resultArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">res_shape</span><span class="p">)</span>
    <span class="n">Omegas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getOmega</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NLevels</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">lev_i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">energy_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">stat_weight_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_StatWeight</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;</span> <span class="n">NLevels</span><span class="p">):</span>
            <span class="n">lev_j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span> 
            <span class="n">energy_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">stat_weight_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_StatWeight</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">resultArray</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">CST</span><span class="o">.</span><span class="n">KCOLLRATE</span> <span class="o">/</span> <span class="n">tem</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">stat_weight_j</span> <span class="o">*</span> <span class="n">Omegas</span><span class="p">[</span><span class="n">lev_j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">resultArray</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">stat_weight_j</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">stat_weight_i</span><span class="p">)</span> <span class="o">*</span> 
                                  <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">energy_i</span> <span class="o">-</span> <span class="n">energy_j</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">CST</span><span class="o">.</span><span class="n">BOLTZMANN_ANGK</span> <span class="o">*</span> <span class="n">tem</span><span class="p">))</span> <span class="o">*</span> 
                                  <span class="n">resultArray</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">resultArray</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Atom.getCritDensity" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getCritDensity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">level</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return the critical density of selected level at given temperature. 
If no transition is selected, return complete array.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>tem</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>electronic temperature in K. May be an array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>level</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>selected atomic level (default= -1)</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong></p>
<pre><code>O3.getCritDensity(12000)

O3.getCritDensity(12000, 4)
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@profile</span>
<span class="k">def</span><span class="w"> </span><span class="nf">getCritDensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tem</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the critical density of selected level at given temperature. </span>
<span class="sd">    If no transition is selected, return complete array.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        tem:    electronic temperature in K. May be an array.</span>
<span class="sd">        level:  selected atomic level (default= -1)</span>

<span class="sd">    **Usage:**</span>

<span class="sd">        O3.getCritDensity(12000)</span>

<span class="sd">        O3.getCritDensity(12000, 4)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">getPopulations</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="mf">100.</span><span class="p">)</span> <span class="c1"># Any density would do</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_critDensity</span><span class="p">[</span><span class="n">level</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_critDensity</span>        
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Atom.getDensityRange" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getDensityRange</span><span class="p">(</span><span class="n">lev_i1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="mf">10000.0</span><span class="p">,</span> <span class="n">lowden</span><span class="o">=</span><span class="mf">1e-20</span><span class="p">,</span> <span class="n">highden</span><span class="o">=</span><span class="mf">1e+20</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return the range of density where a given line ratio is between 10% and 90% of the low and high density limits</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>lev_i1</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_i2</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>wave1</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>wave2</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>to_eval</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>tol</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>0.1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>tem</code></td>
            <td>
                  <code>float) [1e4]</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>10000.0</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getDensityRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> 
                    <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="mf">1e4</span><span class="p">,</span> <span class="n">lowden</span><span class="o">=</span><span class="mf">1e-20</span><span class="p">,</span> <span class="n">highden</span><span class="o">=</span><span class="mf">1e20</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the range of density where a given line ratio is between 10% and 90% of the low and high density limits</span>

<span class="sd">    Parameters:</span>
<span class="sd">        lev_i1 (int):</span>
<span class="sd">        lev_i2 (int):</span>
<span class="sd">        wave1 (int):</span>
<span class="sd">        wave2 (int):</span>
<span class="sd">        to_eval (str):</span>
<span class="sd">        tol (float): </span>
<span class="sd">        tem (float) [1e4]:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">LowLim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLowDensRatio</span><span class="p">(</span><span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j1</span><span class="p">,</span> <span class="n">lev_j2</span><span class="p">,</span> <span class="n">wave1</span><span class="p">,</span> <span class="n">wave2</span><span class="p">,</span> <span class="n">to_eval</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="n">tem</span><span class="p">,</span> <span class="n">lowden</span><span class="o">=</span><span class="n">lowden</span><span class="p">)</span>
    <span class="n">HighLim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getHighDensRatio</span><span class="p">(</span><span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j1</span><span class="p">,</span> <span class="n">lev_j2</span><span class="p">,</span> <span class="n">wave1</span><span class="p">,</span> <span class="n">wave2</span><span class="p">,</span> <span class="n">to_eval</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="n">tem</span><span class="p">,</span> <span class="n">highden</span><span class="o">=</span><span class="n">highden</span><span class="p">)</span>

    <span class="n">delta</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">LowLim</span> <span class="o">-</span> <span class="n">HighLim</span><span class="p">)</span>
    <span class="n">minRatio</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="n">LowLim</span><span class="p">,</span> <span class="n">HighLim</span><span class="p">))</span> <span class="o">+</span> <span class="n">tol</span> <span class="o">*</span> <span class="n">delta</span>
    <span class="n">maxRatio</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="n">LowLim</span><span class="p">,</span> <span class="n">HighLim</span><span class="p">))</span> <span class="o">-</span> <span class="n">tol</span> <span class="o">*</span> <span class="n">delta</span>
    <span class="n">dens1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTemDen</span><span class="p">(</span><span class="n">minRatio</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="n">tem</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=</span> <span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=</span> <span class="n">lev_j1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=</span> <span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=</span> <span class="n">lev_j2</span><span class="p">,</span>
              <span class="n">wave1</span><span class="o">=</span> <span class="n">wave1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=</span> <span class="n">wave2</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="n">to_eval</span><span class="p">)</span>
    <span class="n">dens2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTemDen</span><span class="p">(</span><span class="n">maxRatio</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="n">tem</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=</span> <span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=</span> <span class="n">lev_j1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=</span> <span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=</span> <span class="n">lev_j2</span><span class="p">,</span>
              <span class="n">wave1</span><span class="o">=</span> <span class="n">wave1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=</span> <span class="n">wave2</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="n">to_eval</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">((</span><span class="n">dens1</span><span class="p">,</span> <span class="n">dens2</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Atom.getEmissivity" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_ANN</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return the line emissivity (in erg.s-1.cm3) of selected transition or complete array of emissivities
The transition is selected by the argument wave (if given); 
if wave is not supplied, it is selected by the upper and lower levels (lev_i and lev_j); 
if neither is given, the whole array is computed</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>tem</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>electronic temperature in K. May be an array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>den</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>electronic density in cm^-3. May be an array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_i</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>upper level (default= -1)</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_j</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>lower level (default= -1)</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>wave</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>wavelength of transition. Takes precedence on lev_i and lev_j if set, 
        ignored otherwise. It can also be a blend label.</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>product</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Boolean. If True (default), all the combination of (tem, den) are used. 
         If False, tem and den must have the same size and are joined.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong>      </p>
<pre><code>O3.getEmissivity(12000, 100, 4, 2)         # (4, 2) transition

O3.getEmissivity(10000, 10000, wave=5007)  # (4, 2) transition

O3.getEmissivity(12000, 100)               # all transitions

O3.getEmissivity([10000, 12000], [100, 500], 4, 2)

O3.getEmissivity([10000, 12000], [100, 500])
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@profile</span>
<span class="k">def</span><span class="w"> </span><span class="nf">getEmissivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_ANN</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the line emissivity (in erg.s-1.cm3) of selected transition or complete array of emissivities</span>
<span class="sd">    The transition is selected by the argument wave (if given); </span>
<span class="sd">    if wave is not supplied, it is selected by the upper and lower levels (lev_i and lev_j); </span>
<span class="sd">    if neither is given, the whole array is computed</span>

<span class="sd">    Parameters:</span>
<span class="sd">        tem:      electronic temperature in K. May be an array.</span>
<span class="sd">        den:      electronic density in cm^-3. May be an array.</span>
<span class="sd">        lev_i:    upper level (default= -1)</span>
<span class="sd">        lev_j:    lower level (default= -1)</span>
<span class="sd">        wave:     wavelength of transition. Takes precedence on lev_i and lev_j if set, </span>
<span class="sd">                    ignored otherwise. It can also be a blend label.</span>
<span class="sd">        product:  Boolean. If True (default), all the combination of (tem, den) are used. </span>
<span class="sd">                     If False, tem and den must have the same size and are joined.</span>

<span class="sd">    **Usage:**      </span>

<span class="sd">        O3.getEmissivity(12000, 100, 4, 2)         # (4, 2) transition</span>

<span class="sd">        O3.getEmissivity(10000, 10000, wave=5007)  # (4, 2) transition</span>

<span class="sd">        O3.getEmissivity(12000, 100)               # all transitions</span>

<span class="sd">        O3.getEmissivity([10000, 12000], [100, 500], 4, 2)</span>

<span class="sd">        O3.getEmissivity([10000, 12000], [100, 500])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">wave</span><span class="p">)</span> <span class="ow">in</span> <span class="n">BLEND_LIST</span><span class="p">:</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">L</span><span class="p">(</span><span class="n">wave</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span><span class="n">wave</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="n">product</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">I</span><span class="p">(</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">=</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span><span class="n">lev_j</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="n">product</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">BLEND_LIST</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">wave</span><span class="p">)])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> is not understood&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wave</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">+</span> <span class="s1">&#39;getEmissivity&#39;</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">res</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">lev_i</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">lev_j</span><span class="p">)</span>
    <span class="n">tem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span>
    <span class="n">den</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">den</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wave</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
    <span class="n">NLevels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span>
    <span class="k">if</span> <span class="n">lev_i</span> <span class="o">&gt;</span> <span class="n">NLevels</span> <span class="ow">or</span> <span class="n">lev_j</span> <span class="o">&gt;</span> <span class="n">NLevels</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;The number of levels </span><span class="si">{}</span><span class="s1"> does not allow getting this emissivity (</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">). Consider changing the atomic data&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">NLevels</span><span class="p">,</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="p">),</span>
                      <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span> 
    <span class="k">if</span> <span class="n">product</span><span class="p">:</span>
        <span class="n">n_tem</span> <span class="o">=</span> <span class="n">tem</span><span class="o">.</span><span class="n">size</span>
        <span class="n">n_den</span> <span class="o">=</span> <span class="n">den</span><span class="o">.</span><span class="n">size</span>
        <span class="n">tem_ones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_tem</span><span class="p">)</span>
        <span class="n">populations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPopulations</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">lev_i</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">lev_j</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
            <span class="n">resultArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">NLevels</span><span class="p">,</span> <span class="n">NLevels</span><span class="p">,</span> <span class="n">n_tem</span><span class="p">,</span> <span class="n">n_den</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NLevels</span><span class="p">):</span>
                <span class="n">lev_i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span> 
                <span class="k">while</span> <span class="p">(</span><span class="n">j</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">lev_j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">deltaE</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">HPLANCK</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">CLIGHT</span> <span class="o">*</span> <span class="mf">1.e8</span> 
                    <span class="n">resultArray</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">deltaE</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">populations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_tem</span><span class="p">,</span> <span class="n">n_den</span><span class="p">)</span> <span class="o">/</span> 
                                         <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">tem_ones</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_tem</span><span class="p">,</span> <span class="n">n_den</span><span class="p">))</span>
                    <span class="n">j</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">resultArray</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">lev_i</span> <span class="o">&lt;=</span> <span class="n">lev_j</span><span class="p">):</span>
                <span class="k">return</span> <span class="mf">0.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">lev_i</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">lev_j</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">deltaE</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">HPLANCK</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">CLIGHT</span> <span class="o">*</span> <span class="mf">1.e8</span> 
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">((</span><span class="n">populations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">deltaE</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_tem</span><span class="p">,</span> <span class="n">n_den</span><span class="p">)</span> <span class="o">/</span> 
                                  <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">tem_ones</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_tem</span><span class="p">,</span> <span class="n">n_den</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tem</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">den</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;tem and den must have the same shape&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">populations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPopulations</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lev_i</span> <span class="o">&lt;=</span> <span class="n">lev_j</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">lev_i</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">lev_j</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">deltaE</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">HPLANCK</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">CLIGHT</span> <span class="o">*</span> <span class="mf">1.e8</span> 
            <span class="k">return</span> <span class="n">populations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">deltaE</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">den</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Atom.getHighDensRatio" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getHighDensRatio</span><span class="p">(</span><span class="n">lev_i1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="mf">10000.0</span><span class="p">,</span> <span class="n">highden</span><span class="o">=</span><span class="mf">1e+20</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return the value of a diagostic ratio at the high density limit</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>tem</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>10000.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_i1</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_i2</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>wave1</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>wave2</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>to_eval</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>tem</code></td>
            <td>
                  <code>float) [1e4]</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>10000.0</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong></p>
<pre><code>S2.getHighDensRatio(lev_i1 = 3, lev_i2 = 2, lev_j1 = 1, lev_j2 = 1)

S2.getHighDensRatio(wave1 = 6716, wave2 = 6731)

S2.getHighDensRatio(to_eval = 'L(6716)/L(6731)', tem=1.5e4)
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getHighDensRatio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> 
                     <span class="n">wave1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="mf">1e4</span><span class="p">,</span> <span class="n">highden</span><span class="o">=</span><span class="mf">1e20</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the value of a diagostic ratio at the high density limit</span>

<span class="sd">    Parameters:</span>
<span class="sd">        tem (float):</span>
<span class="sd">        lev_i1 (int):</span>
<span class="sd">        lev_i2 (int):</span>
<span class="sd">        wave1 (int):</span>
<span class="sd">        wave2 (int):</span>
<span class="sd">        to_eval (str): </span>
<span class="sd">        tem (float) [1e4]:</span>
<span class="sd">        highden (float) [1e20]</span>

<span class="sd">    **Usage:**</span>

<span class="sd">        S2.getHighDensRatio(lev_i1 = 3, lev_i2 = 2, lev_j1 = 1, lev_j2 = 1)</span>

<span class="sd">        S2.getHighDensRatio(wave1 = 6716, wave2 = 6731)</span>

<span class="sd">        S2.getHighDensRatio(to_eval = &#39;L(6716)/L(6731)&#39;, tem=1.5e4)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">wave1</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_j1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wave2</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">to_eval</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">L</span><span class="p">(</span><span class="n">wave</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">highden</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="n">to_eval</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">highden</span><span class="p">,</span> <span class="n">lev_i</span> <span class="o">=</span> <span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_j</span> <span class="o">=</span> <span class="n">lev_j1</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">highden</span><span class="p">,</span> <span class="n">lev_i</span> <span class="o">=</span> <span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j</span> <span class="o">=</span> <span class="n">lev_j2</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>   
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Atom.getIonAbundance" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getIonAbundance</span><span class="p">(</span><span class="n">int_ratio</span><span class="p">,</span> <span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Hbeta</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">tem_HI</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">den_HI</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extrapHbeta</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_ANN</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Compute the ionic abundance relative to H+ given the intensity of a line or sum of lines, 
the temperature, and the density. 
The line can be specified as a transition (i.e., giving the two atomic level involved), 
as a wavelength, or as an algebraic expression. In the last case, a sum of lines 
can also be supplied.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>int_ratio</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>relative line intensity (default normalization: Hbeta = 100). 
            May be an array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>tem</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>electronic temperature in K. May be an array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>den</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>electronic density in cm^-3. May be an array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_i</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>upper level of transition</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_j</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>lower level of transition</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>wave</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>wavelength of transition. Takes precedence on lev_i and lev_j if set, 
            ignored otherwise </p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>to_eval</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>expression to be evaluated. Takes precedence on wave if set, 
            ignored otherwise.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>Hbeta</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>line intensity normalization at Hbeta (default Hbeta = 100)</p>
              </div>
            </td>
            <td>
                  <code>100.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>tem_HI</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HI temperature. If not set, tem is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>extrapHbeta</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>[False] if set to True, Hbeta is extrapolated at low Te using Aller 82 function</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>use_ANN</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>[False] if set to True, use Machine Learning to compute line emissivities</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong></p>
<pre><code>O3.getIonAbundance(100, 1.5e4, 100., wave=5007)

O3.getIonAbundance(130, 1.5e4, 100., to_eval='I(4,3) + I(4,2)')
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2751</span>
<span class="normal">2752</span>
<span class="normal">2753</span>
<span class="normal">2754</span>
<span class="normal">2755</span>
<span class="normal">2756</span>
<span class="normal">2757</span>
<span class="normal">2758</span>
<span class="normal">2759</span>
<span class="normal">2760</span>
<span class="normal">2761</span>
<span class="normal">2762</span>
<span class="normal">2763</span>
<span class="normal">2764</span>
<span class="normal">2765</span>
<span class="normal">2766</span>
<span class="normal">2767</span>
<span class="normal">2768</span>
<span class="normal">2769</span>
<span class="normal">2770</span>
<span class="normal">2771</span>
<span class="normal">2772</span>
<span class="normal">2773</span>
<span class="normal">2774</span>
<span class="normal">2775</span>
<span class="normal">2776</span>
<span class="normal">2777</span>
<span class="normal">2778</span>
<span class="normal">2779</span>
<span class="normal">2780</span>
<span class="normal">2781</span>
<span class="normal">2782</span>
<span class="normal">2783</span>
<span class="normal">2784</span>
<span class="normal">2785</span>
<span class="normal">2786</span>
<span class="normal">2787</span>
<span class="normal">2788</span>
<span class="normal">2789</span>
<span class="normal">2790</span>
<span class="normal">2791</span>
<span class="normal">2792</span>
<span class="normal">2793</span>
<span class="normal">2794</span>
<span class="normal">2795</span>
<span class="normal">2796</span>
<span class="normal">2797</span>
<span class="normal">2798</span>
<span class="normal">2799</span>
<span class="normal">2800</span>
<span class="normal">2801</span>
<span class="normal">2802</span>
<span class="normal">2803</span>
<span class="normal">2804</span>
<span class="normal">2805</span>
<span class="normal">2806</span>
<span class="normal">2807</span>
<span class="normal">2808</span>
<span class="normal">2809</span>
<span class="normal">2810</span>
<span class="normal">2811</span>
<span class="normal">2812</span>
<span class="normal">2813</span>
<span class="normal">2814</span>
<span class="normal">2815</span>
<span class="normal">2816</span>
<span class="normal">2817</span>
<span class="normal">2818</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getIonAbundance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">int_ratio</span><span class="p">,</span> <span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                    <span class="n">Hbeta</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span> <span class="n">tem_HI</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">den_HI</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extrapHbeta</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_ANN</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the ionic abundance relative to H+ given the intensity of a line or sum of lines, </span>
<span class="sd">    the temperature, and the density. </span>
<span class="sd">    The line can be specified as a transition (i.e., giving the two atomic level involved), </span>
<span class="sd">    as a wavelength, or as an algebraic expression. In the last case, a sum of lines </span>
<span class="sd">    can also be supplied.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        int_ratio:    relative line intensity (default normalization: Hbeta = 100). </span>
<span class="sd">                        May be an array.</span>
<span class="sd">        tem:          electronic temperature in K. May be an array.</span>
<span class="sd">        den:          electronic density in cm^-3. May be an array.</span>
<span class="sd">        lev_i:        upper level of transition</span>
<span class="sd">        lev_j:        lower level of transition</span>
<span class="sd">        wave:         wavelength of transition. Takes precedence on lev_i and lev_j if set, </span>
<span class="sd">                        ignored otherwise </span>
<span class="sd">        to_eval:      expression to be evaluated. Takes precedence on wave if set, </span>
<span class="sd">                        ignored otherwise.</span>
<span class="sd">        Hbeta:        line intensity normalization at Hbeta (default Hbeta = 100)</span>

<span class="sd">        tem_HI:       HI temperature. If not set, tem is used.</span>
<span class="sd">        extrapHbeta: [False] if set to True, Hbeta is extrapolated at low Te using Aller 82 function</span>
<span class="sd">        use_ANN: [False] if set to True, use Machine Learning to compute line emissivities</span>

<span class="sd">    **Usage:**</span>

<span class="sd">        O3.getIonAbundance(100, 1.5e4, 100., wave=5007)</span>

<span class="sd">        O3.getIonAbundance(130, 1.5e4, 100., to_eval=&#39;I(4,3) + I(4,2)&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">tem_HI</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tem_HI</span> <span class="o">=</span> <span class="n">tem</span>
    <span class="k">if</span> <span class="n">den_HI</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">den_HI</span> <span class="o">=</span> <span class="n">den</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">lev_i</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">lev_j</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">den</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;ten and den must have the same shape&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">int_ratio</span><span class="p">))</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">))</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">|</span> 
        <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">den</span><span class="p">))</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">))</span><span class="o">.</span><span class="n">shape</span><span class="p">)):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;int_ratio, tem and den must does not have the same shape&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lev_i</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lev_j</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wave</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">to_eval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;At least one of lev_i, lev_j, wave or to_eval must be supplied&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">to_eval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">wave</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>     
        <span class="n">to_eval</span> <span class="o">=</span> <span class="s1">&#39;I(&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lev_i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lev_j</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span> 
    <span class="k">def</span><span class="w"> </span><span class="nf">I</span><span class="p">(</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_ANN</span><span class="o">=</span><span class="n">use_ANN</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">L</span><span class="p">(</span><span class="n">wave</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span><span class="n">wave</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_ANN</span><span class="o">=</span><span class="n">use_ANN</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">emis</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">to_eval</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Unable to eval </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">to_eval</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="c1">#int_ratio is in units of Hb = Hbeta keyword</span>
    <span class="k">if</span> <span class="n">extrapHbeta</span><span class="p">:</span>
        <span class="n">HbEmis</span> <span class="o">=</span> <span class="n">getHbEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="o">=</span> <span class="n">tem_HI</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="n">den_HI</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">HbEmis</span> <span class="o">=</span> <span class="n">getRecEmissivity</span><span class="p">(</span><span class="n">tem_HI</span><span class="p">,</span> <span class="n">den_HI</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="s1">&#39;H1&#39;</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ionAbundance</span> <span class="o">=</span> <span class="p">((</span><span class="n">int_ratio</span> <span class="o">/</span> <span class="n">Hbeta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">HbEmis</span> <span class="o">/</span> <span class="n">emis</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ionAbundance</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Atom.getLowDensRatio" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getLowDensRatio</span><span class="p">(</span><span class="n">lev_i1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="mf">10000.0</span><span class="p">,</span> <span class="n">lowden</span><span class="o">=</span><span class="mf">1e-20</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return the value of a diagostic ratio at the low density limit</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>lev_i1</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_i2</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_j1</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_j2</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>wave1</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>wave2</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>to_eval</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>tem</code></td>
            <td>
                  <code>float) [1e4]</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>10000.0</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong></p>
<pre><code>S2.getLowDensRatio(1e4, lev_i1 = 3, lev_i2 = 2, lev_j1 = 1, lev_j2 = 1)

S2.getLowDensRatio(1e4, wave1 = 6716, wave2 = 6731)

S2.getLowDensRatio(1e4, to_eval = 'L(6716)/L(6731)', tem=1.5e4)
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getLowDensRatio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> 
                    <span class="n">wave1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="mf">1e4</span><span class="p">,</span> <span class="n">lowden</span> <span class="o">=</span> <span class="mf">1e-20</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the value of a diagostic ratio at the low density limit</span>

<span class="sd">    Parameters:</span>
<span class="sd">        lev_i1 (int):</span>
<span class="sd">        lev_i2 (int):</span>
<span class="sd">        lev_j1 (int):</span>
<span class="sd">        lev_j2 (int):</span>
<span class="sd">        wave1 (int):</span>
<span class="sd">        wave2 (int):</span>
<span class="sd">        to_eval (str): </span>
<span class="sd">        tem (float) [1e4]:</span>
<span class="sd">        lowden (float) [1e-20]</span>

<span class="sd">    **Usage:**</span>

<span class="sd">        S2.getLowDensRatio(1e4, lev_i1 = 3, lev_i2 = 2, lev_j1 = 1, lev_j2 = 1)</span>

<span class="sd">        S2.getLowDensRatio(1e4, wave1 = 6716, wave2 = 6731)</span>

<span class="sd">        S2.getLowDensRatio(1e4, to_eval = &#39;L(6716)/L(6731)&#39;, tem=1.5e4)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">wave1</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_j1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wave2</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">to_eval</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">L</span><span class="p">(</span><span class="n">wave</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">lowden</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="n">to_eval</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">lowden</span><span class="p">,</span> <span class="n">lev_i</span> <span class="o">=</span> <span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_j</span> <span class="o">=</span> <span class="n">lev_j1</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">lowden</span><span class="p">,</span> <span class="n">lev_i</span> <span class="o">=</span> <span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j</span> <span class="o">=</span> <span class="n">lev_j2</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>         
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Atom.getOmega" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getOmega</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return interpolated value of the collision strength value at the given temperature 
    for the complete array or a specified transition.
If kappa is not None (non-maxwellian distribution of e-velocities), the collision 
    strength is corrected as in Mendoza &amp; Bautista, 2014 ApJ 785, 91.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>tem</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>electronic temperature in K. May be an array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_i</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>upper level</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_j</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>lower level</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong></p>
<pre><code>O3.getOmega(15000.)

O3.getOmega([8e3, 1e4, 1.2e4])

O3.getOmega([8e3, 1e4, 1.2e4], 5, 4)
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getOmega</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tem</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return interpolated value of the collision strength value at the given temperature </span>
<span class="sd">        for the complete array or a specified transition.</span>
<span class="sd">    If kappa is not None (non-maxwellian distribution of e-velocities), the collision </span>
<span class="sd">        strength is corrected as in Mendoza &amp; Bautista, 2014 ApJ 785, 91.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        tem:    electronic temperature in K. May be an array.</span>
<span class="sd">        lev_i:  upper level</span>
<span class="sd">        lev_j:  lower level</span>

<span class="sd">    **Usage:**</span>

<span class="sd">        O3.getOmega(15000.)</span>

<span class="sd">        O3.getOmega([8e3, 1e4, 1.2e4])</span>

<span class="sd">        O3.getOmega([8e3, 1e4, 1.2e4], 5, 4)</span>
<span class="sd">    &quot;&quot;&quot;</span>



    <span class="k">if</span> <span class="n">wave</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
    <span class="n">kappa</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">kappa</span> 
    <span class="k">if</span> <span class="n">kappa</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">to_return</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">getOmega</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#ToDo The Kappa correction should come AFTER the transformation into CS unit</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lev_i</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">lev_j</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">tem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span>
            <span class="n">res_shape</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">collNLevels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">collNLevels</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="n">tem</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                <span class="n">res_shape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span>
            <span class="n">Omega</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">res_shape</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collNLevels</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">while</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">collNLevels</span><span class="p">):</span>
                    <span class="n">Omega</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getOmega</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">OmegaMB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">getOmega</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="p">)</span>
            <span class="n">delta_E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;eV&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">lev_j</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;eV&#39;</span><span class="p">)</span>
            <span class="n">correc</span> <span class="o">=</span> <span class="p">((</span><span class="n">kappa</span> <span class="o">-</span> <span class="mf">3.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">(</span><span class="n">kappa</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">(</span><span class="n">kappa</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> 
                      <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">delta_E</span><span class="o">/</span><span class="p">((</span><span class="n">kappa</span><span class="o">-</span><span class="mf">1.5</span><span class="p">)</span><span class="o">*</span><span class="n">CST</span><span class="o">.</span><span class="n">BOLTZMANN_eVK</span><span class="o">*</span><span class="n">tem</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">kappa</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">delta_E</span><span class="o">/</span><span class="n">CST</span><span class="o">.</span><span class="n">BOLTZMANN_eVK</span><span class="o">/</span><span class="n">tem</span><span class="p">)</span>

            <span class="n">Omega</span> <span class="o">=</span> <span class="n">correc</span> <span class="o">*</span> <span class="n">OmegaMB</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;Correcting for Kappa=</span><span class="si">{0}</span><span class="s1"> by </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">correc</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>

        <span class="n">to_return</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">Omega</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;COEFF&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">comments</span><span class="p">:</span>
        <span class="n">to_return</span> <span class="o">*=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">comments</span><span class="p">[</span><span class="s1">&#39;COEFF&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s1">&#39;O_UNIT&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">comments</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">comments</span><span class="p">[</span><span class="s1">&#39;O_UNIT&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;DEEX RATE COEFF&#39;</span><span class="p">:</span>
            <span class="n">to_return</span> <span class="o">/=</span> <span class="n">CST</span><span class="o">.</span><span class="n">KCOLLRATE</span> <span class="o">/</span> <span class="n">tem</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStatWeight</span><span class="p">(</span><span class="n">lev_i</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">comments</span><span class="p">[</span><span class="s1">&#39;O_UNIT&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;RATE COEFF&#39;</span><span class="p">:</span>
            <span class="n">deltaE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;erg&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">lev_j</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;erg&#39;</span><span class="p">)</span>
            <span class="n">to_return</span> <span class="o">*=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getStatWeight</span><span class="p">(</span><span class="n">lev_j</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStatWeight</span><span class="p">(</span><span class="n">lev_i</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">deltaE</span> <span class="o">/</span><span class="p">(</span><span class="n">CST</span><span class="o">.</span><span class="n">BOLTZMANN</span> <span class="o">*</span> <span class="n">tem</span><span class="p">)))</span> <span class="c1">#q21</span>
            <span class="n">to_return</span> <span class="o">/=</span> <span class="n">CST</span><span class="o">.</span><span class="n">KCOLLRATE</span> <span class="o">/</span> <span class="n">tem</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStatWeight</span><span class="p">(</span><span class="n">lev_i</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">CollData</span><span class="o">.</span><span class="n">comments</span><span class="p">[</span><span class="s1">&#39;O_UNIT&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;COOLING&#39;</span><span class="p">:</span>
            <span class="n">deltaE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;erg&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">lev_j</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;erg&#39;</span><span class="p">)</span>
            <span class="n">to_return</span> <span class="o">/=</span> <span class="n">deltaE</span> <span class="c1"># Loss to q12                </span>
            <span class="n">to_return</span> <span class="o">*=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getStatWeight</span><span class="p">(</span><span class="n">lev_j</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStatWeight</span><span class="p">(</span><span class="n">lev_i</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">deltaE</span> <span class="o">/</span><span class="p">(</span><span class="n">CST</span><span class="o">.</span><span class="n">BOLTZMANN</span> <span class="o">*</span> <span class="n">tem</span><span class="p">)))</span> <span class="c1">#q21</span>
            <span class="n">to_return</span> <span class="o">/=</span> <span class="p">(</span><span class="n">CST</span><span class="o">.</span><span class="n">KCOLLRATE</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStatWeight</span><span class="p">(</span><span class="n">lev_i</span><span class="p">))</span> <span class="c1"># Omega</span>

    <span class="k">return</span> <span class="n">to_return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Atom.getPopulations" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getPopulations</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">NLevels</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return array of populations at given temperature and density.
The method returns a 1-, 2- or 3-D array containing the population of each level 
    for all temperatures and densities specified in the input vectors tem and den 
    (which can be n-element or 1-element vectors).
If either quantity (tem or den) is a 1-element vector -that is, a single value-, 
    the resulting population array is collapsed along that dimension; 
    as a result, the result population array can be a 1-D, 2-D or 3-D array 
    (the three cases corresponding to situations in which both tem and den are single values; 
    one of them is a single value and the other an n-element vector; or both are multielement 
    vectors, respectively). In the general case, the level index is the first 
    [WARNING! It is not in physical unit, i.e. ground level = 0; to be normalized], 
    followed by the temperature index (if it exists) and the density index. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>tem</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>electronic temperature in K</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>den</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>electronic density in cm^-3</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>product</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>operate on all possible combinations of temperature and density 
      (product = True, default case) or on those resulting from combining 
      the i-th value of tem with the i-th value of den (product = False).
      If product = False, then tem and den must be the same size.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong></p>
<pre><code>O3.getPopulations(1e4, 1e2)

tem=np.array([10000., 12000., 15000., 20000]) # An array of four temperatures

den=np.array([600., 800., 1000])      # An array of three densities

O3.getPopulations(tem, den)           # is a (6, 4, 3) array

O3.getPopulations(tem, den)[0,2,1]    # Returns the population of level 1 for T = 15000 
                                        and Ne = 800

tem = 20000                           # tem is no longer an array

O3.getPopulations(tem, den)[0,2,1]  # Crashes: one index too much

O3.getPopulations(tem, den)[0,1]    # Returns the population of level 1 for T = 20000 
                                        and Ne = 800 [see warning]

tem=np.array([10000., 15000., 20000]) # An array of three temperatures

O3.getPopulations(tem, den, product = False)# is a (6, 3) array, tem and den beeing 
                                                taken 2 by 2.
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@profile</span>
<span class="k">def</span><span class="w"> </span><span class="nf">getPopulations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">NLevels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return array of populations at given temperature and density.</span>
<span class="sd">    The method returns a 1-, 2- or 3-D array containing the population of each level </span>
<span class="sd">        for all temperatures and densities specified in the input vectors tem and den </span>
<span class="sd">        (which can be n-element or 1-element vectors).</span>
<span class="sd">    If either quantity (tem or den) is a 1-element vector -that is, a single value-, </span>
<span class="sd">        the resulting population array is collapsed along that dimension; </span>
<span class="sd">        as a result, the result population array can be a 1-D, 2-D or 3-D array </span>
<span class="sd">        (the three cases corresponding to situations in which both tem and den are single values; </span>
<span class="sd">        one of them is a single value and the other an n-element vector; or both are multielement </span>
<span class="sd">        vectors, respectively). In the general case, the level index is the first </span>
<span class="sd">        [WARNING! It is not in physical unit, i.e. ground level = 0; to be normalized], </span>
<span class="sd">        followed by the temperature index (if it exists) and the density index. </span>

<span class="sd">    Parameters:</span>
<span class="sd">        tem:       electronic temperature in K</span>
<span class="sd">        den:       electronic density in cm^-3</span>
<span class="sd">        product:   operate on all possible combinations of temperature and density </span>
<span class="sd">                  (product = True, default case) or on those resulting from combining </span>
<span class="sd">                  the i-th value of tem with the i-th value of den (product = False).</span>
<span class="sd">                  If product = False, then tem and den must be the same size.</span>

<span class="sd">    **Usage:**</span>

<span class="sd">        O3.getPopulations(1e4, 1e2)</span>

<span class="sd">        tem=np.array([10000., 12000., 15000., 20000]) # An array of four temperatures</span>

<span class="sd">        den=np.array([600., 800., 1000])      # An array of three densities</span>

<span class="sd">        O3.getPopulations(tem, den)           # is a (6, 4, 3) array</span>

<span class="sd">        O3.getPopulations(tem, den)[0,2,1]    # Returns the population of level 1 for T = 15000 </span>
<span class="sd">                                                and Ne = 800</span>

<span class="sd">        tem = 20000                           # tem is no longer an array</span>

<span class="sd">        O3.getPopulations(tem, den)[0,2,1]  # Crashes: one index too much</span>

<span class="sd">        O3.getPopulations(tem, den)[0,1]    # Returns the population of level 1 for T = 20000 </span>
<span class="sd">                                                and Ne = 800 [see warning]</span>

<span class="sd">        tem=np.array([10000., 15000., 20000]) # An array of three temperatures</span>

<span class="sd">        O3.getPopulations(tem, den, product = False)# is a (6, 3) array, tem and den beeing </span>
<span class="sd">                                                        taken 2 by 2.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span>
    <span class="n">den</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">den</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">NLevels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">n_level</span> <span class="o">=</span> <span class="n">NLevels</span>
    <span class="k">if</span> <span class="n">product</span><span class="p">:</span>
        <span class="n">n_tem</span> <span class="o">=</span> <span class="n">tem</span><span class="o">.</span><span class="n">size</span>
        <span class="n">n_den</span> <span class="o">=</span> <span class="n">den</span><span class="o">.</span><span class="n">size</span>
        <span class="n">tem_ones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_tem</span><span class="p">)</span>
        <span class="n">den_ones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_den</span><span class="p">)</span>
        <span class="c1"># q is vector-indexed (q(0, 1) = rate between levels 1 and 2)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCollRates</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">n_level</span><span class="p">)</span>
        <span class="n">Atem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">[:</span><span class="n">n_level</span><span class="p">,</span> <span class="p">:</span><span class="n">n_level</span><span class="p">],</span> <span class="n">tem_ones</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_level</span><span class="p">,</span> <span class="n">n_level</span><span class="p">,</span> <span class="n">n_tem</span><span class="p">)</span>
        <span class="n">pop_result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_level</span><span class="p">,</span> <span class="n">n_tem</span><span class="p">,</span> <span class="n">n_den</span><span class="p">))</span>
        <span class="n">sum_q_up</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_level</span><span class="p">,</span> <span class="n">n_tem</span><span class="p">))</span>
        <span class="n">sum_q_down</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_level</span><span class="p">,</span> <span class="n">n_tem</span><span class="p">))</span>
        <span class="n">sum_A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">Atem</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_critDensity</span> <span class="o">=</span> <span class="n">sum_A</span> <span class="o">/</span> <span class="n">q</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_level</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_level</span><span class="p">):</span>
                <span class="n">sum_q_up</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_q_up</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">sum_q_down</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_q_down</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
        <span class="n">coeff_matrix</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">den</span><span class="p">)</span> <span class="o">+</span> 
                         <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">Atem</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">den_ones</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_level</span><span class="p">,</span> <span class="n">n_level</span><span class="p">,</span> <span class="n">n_tem</span><span class="p">,</span> <span class="n">n_den</span><span class="p">))</span>
        <span class="n">coeff_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_level</span><span class="p">):</span>
            <span class="n">coeff_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">((</span><span class="n">sum_q_up</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">sum_q_down</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">den</span><span class="p">)</span> <span class="o">+</span> 
                                    <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">sum_A</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">den_ones</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_tem</span><span class="p">,</span> <span class="n">n_den</span><span class="p">))</span>
        <span class="n">vect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_level</span><span class="p">)</span>
        <span class="n">vect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>

        <span class="k">for</span> <span class="n">i_tem</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_tem</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i_den</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_den</span><span class="p">):</span>
                <span class="n">pop_result</span><span class="p">[:,</span> <span class="n">i_tem</span><span class="p">,</span> <span class="n">i_den</span><span class="p">]</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">coeff_matrix</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i_tem</span><span class="p">,</span> <span class="n">i_den</span><span class="p">]),</span> <span class="n">vect</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">pop_result</span><span class="p">[:,</span> <span class="n">i_tem</span><span class="p">,</span> <span class="n">i_den</span><span class="p">]</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">coeff_matrix</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i_tem</span><span class="p">,</span> <span class="n">i_den</span><span class="p">]),</span> <span class="n">vect</span><span class="p">)</span>
                <span class="c1">#except np.linalg.LinAlgError:</span>
                <span class="c1">#    pop_result[:, i_tem, i_den] = np.nan</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error solving population matrix&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="n">pop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">pop_result</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tem</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">den</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;tem and den must have the same shape&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">res_shape1</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_level</span><span class="p">]</span>
        <span class="n">res_shape_rav1</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_level</span><span class="p">,</span> <span class="n">tem</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>
        <span class="n">res_shape_rav2</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_level</span><span class="p">,</span> <span class="n">n_level</span><span class="p">,</span> <span class="n">tem</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="n">tem</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="n">res_shape1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span>
        <span class="n">tem_rav</span> <span class="o">=</span> <span class="n">tem</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">den_rav</span> <span class="o">=</span> <span class="n">den</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCollRates</span><span class="p">(</span><span class="n">tem_rav</span><span class="p">,</span> <span class="n">n_level</span><span class="p">)</span>
        <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">[:</span><span class="n">n_level</span><span class="p">,</span> <span class="p">:</span><span class="n">n_level</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pumpingSED</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">FB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_B</span><span class="p">[:</span><span class="n">n_level</span><span class="p">,</span> <span class="p">:</span><span class="n">n_level</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">FB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_B</span><span class="p">[:</span><span class="n">n_level</span><span class="p">,</span> <span class="p">:</span><span class="n">n_level</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pumpingSED</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="p">[:</span><span class="n">n_level</span><span class="p">,</span> <span class="p">:</span><span class="n">n_level</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_level</span><span class="p">):</span>
                <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">pop_result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">res_shape_rav1</span><span class="p">)</span>
        <span class="n">coeff_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">res_shape_rav2</span><span class="p">)</span>
        <span class="n">sum_q_up</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">res_shape_rav1</span><span class="p">)</span>
        <span class="n">sum_q_down</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">res_shape_rav1</span><span class="p">)</span>
        <span class="n">sum_A</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">sum_FB</span> <span class="o">=</span> <span class="n">FB</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">n_tem</span> <span class="o">=</span> <span class="n">tem_rav</span><span class="o">.</span><span class="n">size</span>
        <span class="c1"># Following line changed 29/11/2012. It made the code crash when atom_nlevels diff coll_nlevels</span>
        <span class="c1">#Atem = np.outer(self._A, np.ones(n_tem)).reshape(n_level, n_level, n_tem)</span>
        <span class="n">Atem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">[:</span><span class="n">n_level</span><span class="p">,</span> <span class="p">:</span><span class="n">n_level</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_tem</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_level</span><span class="p">,</span> <span class="n">n_level</span><span class="p">,</span> <span class="n">n_tem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_critDensity</span> <span class="o">=</span> <span class="n">Atem</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">q</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_level</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_level</span><span class="p">):</span>
                <span class="n">sum_q_up</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_q_up</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">sum_q_down</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_q_down</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_level</span><span class="p">):</span>
            <span class="c1"># upper right half            </span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_level</span><span class="p">):</span>
                <span class="n">coeff_matrix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">den_rav</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">]</span> <span class="o">+</span> <span class="n">A</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">]</span> <span class="o">+</span> <span class="n">FB</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">]</span>
            <span class="c1"># lower left half</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">coeff_matrix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">den_rav</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">]</span> <span class="o">+</span> <span class="n">FB</span><span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">]</span>
            <span class="c1"># diagonal</span>
            <span class="n">coeff_matrix</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">den_rav</span> <span class="o">*</span> <span class="p">(</span><span class="n">sum_q_up</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">+</span> <span class="n">sum_q_down</span><span class="p">[</span><span class="n">row</span><span class="p">])</span> <span class="o">+</span> <span class="n">sum_A</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">+</span> <span class="n">sum_FB</span><span class="p">[</span><span class="n">row</span><span class="p">])</span>

        <span class="n">vect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_level</span><span class="p">)</span>
        <span class="n">vect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tem</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">pop_result</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">coeff_matrix</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]),</span> <span class="n">vect</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">:</span>
                <span class="n">pop_result</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error solving population matrix&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>

        <span class="n">pop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">pop_result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">res_shape1</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">pop</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Atom.getTemDen" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getTemDen</span><span class="p">(</span><span class="n">int_ratio</span><span class="p">,</span> <span class="n">tem</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">den</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxError</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nsect_recur&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">start_x</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">end_x</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nCut</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">maxIter</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return either the temperature or the density given the other variable for a selected line ratio 
    of known intensity.
The line ratio can involve two or more than two lines. 
In the first case (only two lines), it can be specified giving either two transitions 
    (four atomic levels, i.e. two for each transition), or two wavelengths.
In the general case (any number of lines), it can be specified as an algebraic expression 
    to be evaluated, involving either atomic levels or wavelengths.
An array of values, rather than a single value, can also be given, in which case the result 
    will also be an array.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>int_ratio</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>intensity ratio of the selected transition</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>tem</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>electronic temperature</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>den</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>electronic density</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_i1</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>upper level of 1st transition</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_j1</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>lower level of 1st transition</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_i2</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>upper level of 2nd transition</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_j2</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>lower level of 2nd transition</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>wave1</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>wavelength of 1st transition</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>wave2</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>wavelength of 2nd transition</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>maxError</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tolerance on difference between input and computed ratio </p>
              </div>
            </td>
            <td>
                  <code>0.001</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>method</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>numerical method for finding the root (nsect_recur, nsect_iter)</p>
              </div>
            </td>
            <td>
                  <code>&#39;nsect_recur&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>log</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>switch of log (default = True). start_x and end_x are using this parameter.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>start_x</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>lower end of the interval to explore. (default: lower end of collision 
              strength temperature array for temperature, 1 if density)</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>end_x</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>higher end of the interval to explore. (default: higher end of collision 
              strength temperature array for temperature, 1e8 if density)</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>to_eval</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>expression to be evaluated, using either I (for transitions identified 
              through atomic levels) or L (for transitions identified through wavelengths)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>nCut</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of sections in which each step is cut. 2 would be dichotomy.</p>
              </div>
            </td>
            <td>
                  <code>30</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>maxIter</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>maximum number of iterations</p>
              </div>
            </td>
            <td>
                  <code>20</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong> </p>
<pre><code>O3.getTemDen(150., den=100., wave1=5007, wave2=4363, maxError=1.e-2)

O3.getTemDen(150., den=100., to_eval = '(I(4,3) + I(4,2) + I(4,1)) / I(5,4)')

N2.getTemDen(150., den=100., to_eval = '(L(6584) + L(6548)) / L(5755)')

O3.getTemDen([0.02, 0.04], den=[1.e4, 1.1e4], to_eval="I(5, 4) / (I(4, 3) + I(4, 2))")
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2692</span>
<span class="normal">2693</span>
<span class="normal">2694</span>
<span class="normal">2695</span>
<span class="normal">2696</span>
<span class="normal">2697</span>
<span class="normal">2698</span>
<span class="normal">2699</span>
<span class="normal">2700</span>
<span class="normal">2701</span>
<span class="normal">2702</span>
<span class="normal">2703</span>
<span class="normal">2704</span>
<span class="normal">2705</span>
<span class="normal">2706</span>
<span class="normal">2707</span>
<span class="normal">2708</span>
<span class="normal">2709</span>
<span class="normal">2710</span>
<span class="normal">2711</span>
<span class="normal">2712</span>
<span class="normal">2713</span>
<span class="normal">2714</span>
<span class="normal">2715</span>
<span class="normal">2716</span>
<span class="normal">2717</span>
<span class="normal">2718</span>
<span class="normal">2719</span>
<span class="normal">2720</span>
<span class="normal">2721</span>
<span class="normal">2722</span>
<span class="normal">2723</span>
<span class="normal">2724</span>
<span class="normal">2725</span>
<span class="normal">2726</span>
<span class="normal">2727</span>
<span class="normal">2728</span>
<span class="normal">2729</span>
<span class="normal">2730</span>
<span class="normal">2731</span>
<span class="normal">2732</span>
<span class="normal">2733</span>
<span class="normal">2734</span>
<span class="normal">2735</span>
<span class="normal">2736</span>
<span class="normal">2737</span>
<span class="normal">2738</span>
<span class="normal">2739</span>
<span class="normal">2740</span>
<span class="normal">2741</span>
<span class="normal">2742</span>
<span class="normal">2743</span>
<span class="normal">2744</span>
<span class="normal">2745</span>
<span class="normal">2746</span>
<span class="normal">2747</span>
<span class="normal">2748</span>
<span class="normal">2749</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@profile</span>
<span class="k">def</span><span class="w"> </span><span class="nf">getTemDen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">int_ratio</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
              <span class="n">wave1</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxError</span><span class="o">=</span><span class="mf">1.e-3</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nsect_recur&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">start_x</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">end_x</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
              <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nCut</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">maxIter</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return either the temperature or the density given the other variable for a selected line ratio </span>
<span class="sd">        of known intensity.</span>
<span class="sd">    The line ratio can involve two or more than two lines. </span>
<span class="sd">    In the first case (only two lines), it can be specified giving either two transitions </span>
<span class="sd">        (four atomic levels, i.e. two for each transition), or two wavelengths.</span>
<span class="sd">    In the general case (any number of lines), it can be specified as an algebraic expression </span>
<span class="sd">        to be evaluated, involving either atomic levels or wavelengths.</span>
<span class="sd">    An array of values, rather than a single value, can also be given, in which case the result </span>
<span class="sd">        will also be an array.</span>

<span class="sd">    Parameters:</span>
<span class="sd">       int_ratio:    intensity ratio of the selected transition</span>
<span class="sd">       tem:          electronic temperature</span>
<span class="sd">       den:          electronic density</span>
<span class="sd">       lev_i1:       upper level of 1st transition</span>
<span class="sd">       lev_j1:       lower level of 1st transition</span>
<span class="sd">       lev_i2:       upper level of 2nd transition</span>
<span class="sd">       lev_j2:       lower level of 2nd transition</span>
<span class="sd">       wave1:        wavelength of 1st transition</span>
<span class="sd">       wave2:        wavelength of 2nd transition</span>
<span class="sd">       maxError:     tolerance on difference between input and computed ratio </span>
<span class="sd">       method:       numerical method for finding the root (nsect_recur, nsect_iter)</span>
<span class="sd">       log:          switch of log (default = True). start_x and end_x are using this parameter.</span>
<span class="sd">       start_x:      lower end of the interval to explore. (default: lower end of collision </span>
<span class="sd">                        strength temperature array for temperature, 1 if density)</span>
<span class="sd">       end_x:        higher end of the interval to explore. (default: higher end of collision </span>
<span class="sd">                        strength temperature array for temperature, 1e8 if density)</span>
<span class="sd">       to_eval:      expression to be evaluated, using either I (for transitions identified </span>
<span class="sd">                        through atomic levels) or L (for transitions identified through wavelengths)</span>
<span class="sd">       nCut:        number of sections in which each step is cut. 2 would be dichotomy.</span>
<span class="sd">       maxIter:     maximum number of iterations</span>

<span class="sd">    **Usage:** </span>

<span class="sd">        O3.getTemDen(150., den=100., wave1=5007, wave2=4363, maxError=1.e-2)</span>

<span class="sd">        O3.getTemDen(150., den=100., to_eval = &#39;(I(4,3) + I(4,2) + I(4,1)) / I(5,4)&#39;)</span>

<span class="sd">        N2.getTemDen(150., den=100., to_eval = &#39;(L(6584) + L(6548)) / L(5755)&#39;)</span>

<span class="sd">        O3.getTemDen([0.02, 0.04], den=[1.e4, 1.1e4], to_eval=&quot;I(5, 4) / (I(4, 3) + I(4, 2))&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;ANN&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getTemDen_ANN</span><span class="p">(</span><span class="n">int_ratio</span><span class="o">=</span><span class="n">int_ratio</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="n">den</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=</span><span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=</span><span class="n">lev_j1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=</span><span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=</span><span class="n">lev_j2</span><span class="p">,</span>
              <span class="n">wave1</span><span class="o">=</span><span class="n">wave1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=</span><span class="n">wave2</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span> <span class="n">start_x</span><span class="o">=</span><span class="n">start_x</span><span class="p">,</span> <span class="n">end_x</span><span class="o">=</span><span class="n">end_x</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="n">to_eval</span><span class="p">)</span>       
    <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">_use_mp</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getTemDen_MP</span><span class="p">(</span><span class="n">int_ratio</span><span class="o">=</span><span class="n">int_ratio</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="n">den</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=</span><span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=</span><span class="n">lev_j1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=</span><span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=</span><span class="n">lev_j2</span><span class="p">,</span>
              <span class="n">wave1</span><span class="o">=</span><span class="n">wave1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=</span><span class="n">wave2</span><span class="p">,</span> <span class="n">maxError</span><span class="o">=</span><span class="n">maxError</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span> <span class="n">start_x</span><span class="o">=</span><span class="n">start_x</span><span class="p">,</span>
              <span class="n">end_x</span><span class="o">=</span><span class="n">end_x</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="n">to_eval</span><span class="p">,</span> <span class="n">nCut</span><span class="o">=</span><span class="n">nCut</span><span class="p">,</span> <span class="n">maxIter</span><span class="o">=</span><span class="n">maxIter</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getTemDen_1</span><span class="p">(</span><span class="n">int_ratio</span><span class="o">=</span><span class="n">int_ratio</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="n">den</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=</span><span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=</span><span class="n">lev_j1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=</span><span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=</span><span class="n">lev_j2</span><span class="p">,</span>
              <span class="n">wave1</span><span class="o">=</span><span class="n">wave1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=</span><span class="n">wave2</span><span class="p">,</span> <span class="n">maxError</span><span class="o">=</span><span class="n">maxError</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span> <span class="n">start_x</span><span class="o">=</span><span class="n">start_x</span><span class="p">,</span>
              <span class="n">end_x</span><span class="o">=</span><span class="n">end_x</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="n">to_eval</span><span class="p">,</span> <span class="n">nCut</span><span class="o">=</span><span class="n">nCut</span><span class="p">,</span> <span class="n">maxIter</span><span class="o">=</span><span class="n">maxIter</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Atom.getTransition" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">maxErrorA</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">maxErrorm</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return the indexes (upper level, lower level) of a transition for a given atom 
    from the wavelength.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>wave</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>wavelength in Angstrom (a float or a label: e.g., 5007, '5007A') 
or in micron (a label: '51.5m')</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>maxErrorA</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tolerance if the input wavelength is in Angstrom</p>
              </div>
            </td>
            <td>
                  <code>0.005</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>maxErrorm</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tolerance if the input wavelength is in micron</p>
              </div>
            </td>
            <td>
                  <code>0.05</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong></p>
<pre><code>O3.getTransition(4959)
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getTransition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="n">maxErrorA</span> <span class="o">=</span> <span class="mf">5.e-3</span><span class="p">,</span> <span class="n">maxErrorm</span> <span class="o">=</span> <span class="mf">5.e-2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the indexes (upper level, lower level) of a transition for a given atom </span>
<span class="sd">        from the wavelength.</span>



<span class="sd">    Parameters:</span>
<span class="sd">        wave:      wavelength in Angstrom (a float or a label: e.g., 5007, &#39;5007A&#39;) </span>
<span class="sd">            or in micron (a label: &#39;51.5m&#39;)</span>
<span class="sd">        maxErrorA: tolerance if the input wavelength is in Angstrom</span>
<span class="sd">        maxErrorm: tolerance if the input wavelength is in micron</span>

<span class="sd">    **Usage:**</span>

<span class="sd">        O3.getTransition(4959)   </span>
<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Transition</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">maxErrorA</span> <span class="o">=</span> <span class="n">maxErrorA</span><span class="p">,</span> <span class="n">maxErrorm</span> <span class="o">=</span> <span class="n">maxErrorm</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Atom.plotEmiss" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plotEmiss</span><span class="p">(</span><span class="n">tem_min</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">tem_max</span><span class="o">=</span><span class="mi">30000</span><span class="p">,</span> <span class="n">ionic_abund</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">legend_loc</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">temLog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_total</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_only_total</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">total_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">total_label</span><span class="o">=</span><span class="s1">&#39;TOTAL&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot the emissivity as a function of temperature of all the lines of the selected atom.  </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>tem_min</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>minimum value of the temperature range to span (default=1000)</p>
              </div>
            </td>
            <td>
                  <code>1000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>tem_max</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>maximum value of the temperature range to span (default=30000)</p>
              </div>
            </td>
            <td>
                  <code>30000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ionic_abund</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>relative ionic abundance (default = 1.0)</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>den</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>electron density</p>
              </div>
            </td>
            <td>
                  <code>1000.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>style</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>line style of the plot (default: '-' [solid line])</p>
              </div>
            </td>
            <td>
                  <code>&#39;-&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>legend_loc</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>localization of the legend (default: 4 = lower right; see plt.legend 
                for more details)</p>
              </div>
            </td>
            <td>
                  <code>4</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>temLog</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>linear (False) or logarithmic temperature axis (default = False)</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>plot_total</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>flag to also plot total emissivity (default = False)</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>plot_only_total</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>flag to only plot total emissivity (default = False)</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>legend</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>flag to place legend (default = True)</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>total_color</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>color of the total emissivity (default = 'black')</p>
              </div>
            </td>
            <td>
                  <code>&#39;black&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>total_label</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>label of the total emissivity (default = 'TOTAL')</p>
              </div>
            </td>
            <td>
                  <code>&#39;TOTAL&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ax</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>axis where to send the plot. If None, a new axis is done</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong></p>
<pre><code>O3.plotEmiss(tem_min=10000, tem_max=20000)
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2977</span>
<span class="normal">2978</span>
<span class="normal">2979</span>
<span class="normal">2980</span>
<span class="normal">2981</span>
<span class="normal">2982</span>
<span class="normal">2983</span>
<span class="normal">2984</span>
<span class="normal">2985</span>
<span class="normal">2986</span>
<span class="normal">2987</span>
<span class="normal">2988</span>
<span class="normal">2989</span>
<span class="normal">2990</span>
<span class="normal">2991</span>
<span class="normal">2992</span>
<span class="normal">2993</span>
<span class="normal">2994</span>
<span class="normal">2995</span>
<span class="normal">2996</span>
<span class="normal">2997</span>
<span class="normal">2998</span>
<span class="normal">2999</span>
<span class="normal">3000</span>
<span class="normal">3001</span>
<span class="normal">3002</span>
<span class="normal">3003</span>
<span class="normal">3004</span>
<span class="normal">3005</span>
<span class="normal">3006</span>
<span class="normal">3007</span>
<span class="normal">3008</span>
<span class="normal">3009</span>
<span class="normal">3010</span>
<span class="normal">3011</span>
<span class="normal">3012</span>
<span class="normal">3013</span>
<span class="normal">3014</span>
<span class="normal">3015</span>
<span class="normal">3016</span>
<span class="normal">3017</span>
<span class="normal">3018</span>
<span class="normal">3019</span>
<span class="normal">3020</span>
<span class="normal">3021</span>
<span class="normal">3022</span>
<span class="normal">3023</span>
<span class="normal">3024</span>
<span class="normal">3025</span>
<span class="normal">3026</span>
<span class="normal">3027</span>
<span class="normal">3028</span>
<span class="normal">3029</span>
<span class="normal">3030</span>
<span class="normal">3031</span>
<span class="normal">3032</span>
<span class="normal">3033</span>
<span class="normal">3034</span>
<span class="normal">3035</span>
<span class="normal">3036</span>
<span class="normal">3037</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plotEmiss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tem_min</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">tem_max</span><span class="o">=</span><span class="mi">30000</span><span class="p">,</span> <span class="n">ionic_abund</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
              <span class="n">legend_loc</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">temLog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_total</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_only_total</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
              <span class="n">total_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">total_label</span><span class="o">=</span><span class="s1">&#39;TOTAL&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Plot the emissivity as a function of temperature of all the lines of the selected atom.  </span>

<span class="sd">    Parameters:</span>
<span class="sd">        tem_min:         minimum value of the temperature range to span (default=1000)</span>
<span class="sd">        tem_max:         maximum value of the temperature range to span (default=30000)</span>
<span class="sd">        ionic_abund:     relative ionic abundance (default = 1.0)</span>
<span class="sd">        den:             electron density</span>
<span class="sd">        style:           line style of the plot (default: &#39;-&#39; [solid line])</span>
<span class="sd">        legend_loc:      localization of the legend (default: 4 = lower right; see plt.legend </span>
<span class="sd">                            for more details)</span>
<span class="sd">        temLog:          linear (False) or logarithmic temperature axis (default = False)</span>
<span class="sd">        plot_total:      flag to also plot total emissivity (default = False)</span>
<span class="sd">        plot_only_total: flag to only plot total emissivity (default = False)</span>
<span class="sd">        legend:          flag to place legend (default = True)</span>
<span class="sd">        total_color:     color of the total emissivity (default = &#39;black&#39;)</span>
<span class="sd">        total_label:     label of the total emissivity (default = &#39;TOTAL&#39;)</span>
<span class="sd">        ax:              axis where to send the plot. If None, a new axis is done</span>

<span class="sd">    **Usage:**</span>

<span class="sd">        O3.plotEmiss(tem_min=10000, tem_max=20000)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">INSTALLED</span><span class="p">[</span><span class="s1">&#39;plt&#39;</span><span class="p">]:</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Matplotlib not available, no plot&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">+</span> <span class="s1">&#39;.plot&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">tem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tem_min</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tem_max</span><span class="p">),</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">total_emis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">wave</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineList</span><span class="p">:</span>
        <span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lev_i</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">lev_j</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">):</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineList</span><span class="p">)))</span> <span class="o">/</span> 
                     <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineList</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineList</span><span class="p">))))</span> <span class="o">**</span> <span class="mf">0.4</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">temLog</span><span class="p">:</span>
                <span class="n">x_to_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x_to_plot</span> <span class="o">=</span> <span class="n">tem</span>
            <span class="n">y_to_plot</span> <span class="o">=</span> <span class="n">ionic_abund</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span><span class="n">wave</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">plot_only_total</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">y_to_plot</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_to_plot</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">y_to_plot</span><span class="p">),</span>
                         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{0:.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wave</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>
            <span class="n">total_emis</span> <span class="o">+=</span> <span class="n">y_to_plot</span>
    <span class="k">if</span> <span class="n">plot_total</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_to_plot</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">total_emis</span><span class="p">),</span>
                 <span class="n">label</span><span class="o">=</span><span class="n">total_label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">total_color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">legend_loc</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">temLog</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;log(T[K])&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;T[K]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;log [erg.cm3/s]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Line emissivities&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Atom.plotGrotrian" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plotGrotrian</span><span class="p">(</span><span class="n">tem</span><span class="o">=</span><span class="mf">10000.0</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">thresh_int</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;eV&#39;</span><span class="p">,</span> <span class="n">detailed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Draw a Grotrian plot of the selected atom, labelling only lines above a
pecified intensity threshold (relative to the most intense line). 
For ground state levels, the Russell-Saunders term symbol is also given.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>tem</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>temperature at which the intensity threshold is to be computed </p>
              </div>
            </td>
            <td>
                  <code>10000.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>den</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>density at which the intensity threshold is to be computed </p>
              </div>
            </td>
            <td>
                  <code>100.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>thresh_int</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>intensity threshold (relative to the most intense line, default: 1.e-3)</p>
              </div>
            </td>
            <td>
                  <code>0.001</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>unit</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>one of 'eV' (default), '1/Ang' or 'Ryd'</p>
              </div>
            </td>
            <td>
                  <code>&#39;eV&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ax</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>axis where to plot the result</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Usage:</p>
<pre><code>**O3.plotGrotrian()**
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3039</span>
<span class="normal">3040</span>
<span class="normal">3041</span>
<span class="normal">3042</span>
<span class="normal">3043</span>
<span class="normal">3044</span>
<span class="normal">3045</span>
<span class="normal">3046</span>
<span class="normal">3047</span>
<span class="normal">3048</span>
<span class="normal">3049</span>
<span class="normal">3050</span>
<span class="normal">3051</span>
<span class="normal">3052</span>
<span class="normal">3053</span>
<span class="normal">3054</span>
<span class="normal">3055</span>
<span class="normal">3056</span>
<span class="normal">3057</span>
<span class="normal">3058</span>
<span class="normal">3059</span>
<span class="normal">3060</span>
<span class="normal">3061</span>
<span class="normal">3062</span>
<span class="normal">3063</span>
<span class="normal">3064</span>
<span class="normal">3065</span>
<span class="normal">3066</span>
<span class="normal">3067</span>
<span class="normal">3068</span>
<span class="normal">3069</span>
<span class="normal">3070</span>
<span class="normal">3071</span>
<span class="normal">3072</span>
<span class="normal">3073</span>
<span class="normal">3074</span>
<span class="normal">3075</span>
<span class="normal">3076</span>
<span class="normal">3077</span>
<span class="normal">3078</span>
<span class="normal">3079</span>
<span class="normal">3080</span>
<span class="normal">3081</span>
<span class="normal">3082</span>
<span class="normal">3083</span>
<span class="normal">3084</span>
<span class="normal">3085</span>
<span class="normal">3086</span>
<span class="normal">3087</span>
<span class="normal">3088</span>
<span class="normal">3089</span>
<span class="normal">3090</span>
<span class="normal">3091</span>
<span class="normal">3092</span>
<span class="normal">3093</span>
<span class="normal">3094</span>
<span class="normal">3095</span>
<span class="normal">3096</span>
<span class="normal">3097</span>
<span class="normal">3098</span>
<span class="normal">3099</span>
<span class="normal">3100</span>
<span class="normal">3101</span>
<span class="normal">3102</span>
<span class="normal">3103</span>
<span class="normal">3104</span>
<span class="normal">3105</span>
<span class="normal">3106</span>
<span class="normal">3107</span>
<span class="normal">3108</span>
<span class="normal">3109</span>
<span class="normal">3110</span>
<span class="normal">3111</span>
<span class="normal">3112</span>
<span class="normal">3113</span>
<span class="normal">3114</span>
<span class="normal">3115</span>
<span class="normal">3116</span>
<span class="normal">3117</span>
<span class="normal">3118</span>
<span class="normal">3119</span>
<span class="normal">3120</span>
<span class="normal">3121</span>
<span class="normal">3122</span>
<span class="normal">3123</span>
<span class="normal">3124</span>
<span class="normal">3125</span>
<span class="normal">3126</span>
<span class="normal">3127</span>
<span class="normal">3128</span>
<span class="normal">3129</span>
<span class="normal">3130</span>
<span class="normal">3131</span>
<span class="normal">3132</span>
<span class="normal">3133</span>
<span class="normal">3134</span>
<span class="normal">3135</span>
<span class="normal">3136</span>
<span class="normal">3137</span>
<span class="normal">3138</span>
<span class="normal">3139</span>
<span class="normal">3140</span>
<span class="normal">3141</span>
<span class="normal">3142</span>
<span class="normal">3143</span>
<span class="normal">3144</span>
<span class="normal">3145</span>
<span class="normal">3146</span>
<span class="normal">3147</span>
<span class="normal">3148</span>
<span class="normal">3149</span>
<span class="normal">3150</span>
<span class="normal">3151</span>
<span class="normal">3152</span>
<span class="normal">3153</span>
<span class="normal">3154</span>
<span class="normal">3155</span>
<span class="normal">3156</span>
<span class="normal">3157</span>
<span class="normal">3158</span>
<span class="normal">3159</span>
<span class="normal">3160</span>
<span class="normal">3161</span>
<span class="normal">3162</span>
<span class="normal">3163</span>
<span class="normal">3164</span>
<span class="normal">3165</span>
<span class="normal">3166</span>
<span class="normal">3167</span>
<span class="normal">3168</span>
<span class="normal">3169</span>
<span class="normal">3170</span>
<span class="normal">3171</span>
<span class="normal">3172</span>
<span class="normal">3173</span>
<span class="normal">3174</span>
<span class="normal">3175</span>
<span class="normal">3176</span>
<span class="normal">3177</span>
<span class="normal">3178</span>
<span class="normal">3179</span>
<span class="normal">3180</span>
<span class="normal">3181</span>
<span class="normal">3182</span>
<span class="normal">3183</span>
<span class="normal">3184</span>
<span class="normal">3185</span>
<span class="normal">3186</span>
<span class="normal">3187</span>
<span class="normal">3188</span>
<span class="normal">3189</span>
<span class="normal">3190</span>
<span class="normal">3191</span>
<span class="normal">3192</span>
<span class="normal">3193</span>
<span class="normal">3194</span>
<span class="normal">3195</span>
<span class="normal">3196</span>
<span class="normal">3197</span>
<span class="normal">3198</span>
<span class="normal">3199</span>
<span class="normal">3200</span>
<span class="normal">3201</span>
<span class="normal">3202</span>
<span class="normal">3203</span>
<span class="normal">3204</span>
<span class="normal">3205</span>
<span class="normal">3206</span>
<span class="normal">3207</span>
<span class="normal">3208</span>
<span class="normal">3209</span>
<span class="normal">3210</span>
<span class="normal">3211</span>
<span class="normal">3212</span>
<span class="normal">3213</span>
<span class="normal">3214</span>
<span class="normal">3215</span>
<span class="normal">3216</span></pre></div></td><td class="code"><div><pre><span></span><code>    <span class="k">def</span><span class="w"> </span><span class="nf">plotGrotrian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="mf">1e4</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="mf">1e2</span><span class="p">,</span> <span class="n">thresh_int</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;eV&#39;</span><span class="p">,</span> <span class="n">detailed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a Grotrian plot of the selected atom, labelling only lines above a</span>
<span class="sd">        pecified intensity threshold (relative to the most intense line). </span>
<span class="sd">        For ground state levels, the Russell-Saunders term symbol is also given.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            tem:          temperature at which the intensity threshold is to be computed </span>
<span class="sd">            den:          density at which the intensity threshold is to be computed </span>
<span class="sd">            thresh_int:   intensity threshold (relative to the most intense line, default: 1.e-3)</span>
<span class="sd">            unit:         one of &#39;eV&#39; (default), &#39;1/Ang&#39; or &#39;Ryd&#39;</span>
<span class="sd">            ax:           axis where to plot the result</span>

<span class="sd">        Usage:</span>

<span class="sd">            **O3.plotGrotrian()**</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;eV&#39;</span><span class="p">,</span> <span class="s1">&#39;Ryd&#39;</span><span class="p">,</span> <span class="s1">&#39;1/Ang&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Unit </span><span class="si">{0}</span><span class="s1"> not available&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unit</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">INSTALLED</span><span class="p">[</span><span class="s1">&#39;plt&#39;</span><span class="p">]:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Matplotlib not available, no plot&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">+</span> <span class="s1">&#39;.plot&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">color_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">]</span>
        <span class="n">energies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>

        <span class="c1"># VL 16 Jul 2013 - Detect level inversion, just for warning        </span>
        <span class="n">level_multiplet</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">multiplets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NIST</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">term</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">j</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">en</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NIST</span><span class="p">:</span>
                <span class="n">term</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">j</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">en</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">sorted_indx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">en</span><span class="p">)</span> 
            <span class="n">term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">term</span><span class="p">)[</span><span class="n">sorted_indx</span><span class="p">]</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">j</span><span class="p">)[</span><span class="n">sorted_indx</span><span class="p">]</span>
            <span class="n">en</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">en</span><span class="p">)[</span><span class="n">sorted_indx</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">en</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">term</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">term</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">level_multiplet</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">multiplets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level_multiplet</span><span class="p">)</span> 
                    <span class="n">level_multiplet</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">multiplets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level_multiplet</span><span class="p">)</span> <span class="c1"># append last multiplet</span>
<span class="c1"># Mistakenly rounds off fractional J values. Corrected 26/12/2014            </span>
<span class="c1">#            levelLabels = [&#39;$^{{{0}}}${1}$_{{{2:.0f}}}$&#39;.format(l[&#39;term&#39;][0],l[&#39;term&#39;][1],l[&#39;J&#39;]) for l in self.NIST]</span>
            <span class="n">levelLabels</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NIST</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">denominator</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">levelLabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;$^{{</span><span class="si">{0}</span><span class="s1">}}$</span><span class="si">{1}</span><span class="s1">$_{{</span><span class="si">{2}</span><span class="s1">}}$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="s1">&#39;term&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="s1">&#39;term&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">numerator</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">levelLabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;$^{{</span><span class="si">{0}</span><span class="s1">}}$</span><span class="si">{1}</span><span class="s1">$_{{</span><span class="si">{2}</span><span class="s1">/</span><span class="si">{3}</span><span class="s1">}}$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="s1">&#39;term&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="s1">&#39;term&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">numerator</span><span class="p">,</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">denominator</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delta_e_max</span> <span class="o">=</span> <span class="mf">1.e-5</span>  <span class="c1"># Arbitrary limit to define hyperfine structure and identify multiplets </span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">energies</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">()[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">delta_e_max</span><span class="p">):</span>
                    <span class="c1"># if levels close, append level to multiplet</span>
                    <span class="n">level_multiplet</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> 
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># if levels separated, add current multiplet to array and start a new multiplet</span>
                    <span class="n">multiplets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level_multiplet</span><span class="p">)</span> 
                    <span class="n">level_multiplet</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">multiplets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level_multiplet</span><span class="p">)</span> <span class="c1"># append last multiplet</span>
            <span class="n">warn_label</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">levelLabels</span> <span class="o">=</span> <span class="n">gsLevelDict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gs</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i_multi</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">multiplets</span><span class="p">)):</span>
                <span class="n">stat_weights</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="c1"># check each multiplet for inversion separately</span>
                <span class="k">for</span> <span class="n">i_level</span> <span class="ow">in</span> <span class="n">multiplets</span><span class="p">[</span><span class="n">i_multi</span><span class="p">]:</span>
                    <span class="n">latex_sw</span> <span class="o">=</span> <span class="n">levelLabels</span><span class="p">[</span><span class="n">i_level</span><span class="p">]</span>
                    <span class="n">sw</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">latex_sw</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;{&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;*2.+1.&#39;</span><span class="p">)</span>
                    <span class="n">stat_weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sw</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">stat_weights</span> <span class="o">!=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getStatWeight</span><span class="p">()[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">multiplets</span><span class="p">[</span><span class="n">i_multi</span><span class="p">]]):</span>
                    <span class="n">warn_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i_multi</span><span class="p">)</span>
                    <span class="n">to_print</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Level inversion in multiplet </span><span class="si">{0}</span><span class="s1"> of </span><span class="si">{1}</span><span class="s1">&#39;</span>\
                             <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">The labels of levels </span><span class="si">{2}</span><span class="s1"> are displayed in the wrong order&#39;</span> <span class="o">+</span> \
                             <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Assumed statistical weights: </span><span class="si">{3}</span><span class="s1">&#39;</span> <span class="o">+</span> \
                             <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Statistical weights of data: </span><span class="si">{4}</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">to_print</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i_multi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">multiplets</span><span class="p">[</span><span class="n">i_multi</span><span class="p">],</span> 
                                                 <span class="n">stat_weights</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getStatWeight</span><span class="p">()[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">multiplets</span><span class="p">[</span><span class="n">i_multi</span><span class="p">]]),</span> 
                                 <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">+</span> <span class="s1">&#39;.plot&#39;</span><span class="p">)</span>

        <span class="c1"># where level starts in the plot</span>

        <span class="n">x_span</span> <span class="o">=</span> <span class="mf">0.75</span>
        <span class="n">x_0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x_span</span><span class="p">)</span> <span class="o">/</span> <span class="mf">4.</span>    
        <span class="n">dx</span> <span class="o">=</span> <span class="mf">0.005</span>
        <span class="n">max_en</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>
        <span class="n">blow</span> <span class="o">=</span> <span class="mf">0.02</span> <span class="o">*</span> <span class="n">max_en</span> <span class="c1"># blowup scale for multiplets</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">max_en</span> <span class="o">*</span> <span class="mf">1.05</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;[</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">,</span> <span class="n">int_to_roman</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">)))</span>

        <span class="c1"># Blow up of multiplets in the plot</span>
        <span class="n">i_tot</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i_multi</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">multiplets</span><span class="p">)):</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">multiplets</span><span class="p">[</span><span class="n">i_multi</span><span class="p">]))</span> <span class="o">/</span> <span class="mf">2.</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">multiplets</span><span class="p">[</span><span class="n">i_multi</span><span class="p">])):</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">energies</span><span class="p">[</span><span class="n">multiplets</span><span class="p">[</span><span class="n">i_multi</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="n">shift</span> <span class="o">*</span> <span class="n">blow</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x_0</span><span class="p">,</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">x_0</span><span class="p">,</span> <span class="mf">1.6</span> <span class="o">*</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">x_0</span> <span class="o">+</span> <span class="n">x_span</span><span class="p">],</span> 
                         <span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">energies</span><span class="p">[</span><span class="n">multiplets</span><span class="p">[</span><span class="n">i_multi</span><span class="p">][</span><span class="n">i</span><span class="p">]],</span> 
                          <span class="n">energies</span><span class="p">[</span><span class="n">multiplets</span><span class="p">[</span><span class="n">i_multi</span><span class="p">][</span><span class="n">i</span><span class="p">]]],</span> <span class="n">lw</span> <span class="o">=</span> <span class="mf">1.2</span><span class="p">,</span> 
                         <span class="n">color</span> <span class="o">=</span> <span class="n">color_list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">multiplets</span><span class="p">[</span><span class="n">i_multi</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_list</span><span class="p">))])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_span</span> <span class="o">+</span> <span class="n">x_0</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{0:7.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">energies</span><span class="p">[</span><span class="n">multiplets</span><span class="p">[</span><span class="n">i_multi</span><span class="p">][</span><span class="n">i</span><span class="p">]]),</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">,</span> 
                         <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">detailed</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">):</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">levelLabels</span><span class="p">[</span><span class="n">i_tot</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i_tot</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="n">levelLabels</span><span class="p">[</span><span class="n">i_tot</span><span class="p">]</span> <span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> 
                                <span class="n">color</span> <span class="o">=</span> <span class="n">color_list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">multiplets</span><span class="p">[</span><span class="n">i_multi</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_list</span><span class="p">))])</span>
                    <span class="n">i_tot</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="n">shift</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">dx</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;E [</span><span class="si">{0:s}</span><span class="s1">] &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unit</span><span class="p">),</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Ground-state configuration: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gs</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#004400&quot;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>

        <span class="n">all_emis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span>
        <span class="n">emis_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">all_emis</span><span class="p">)</span>
        <span class="n">N_lines</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="mf">1e4</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">)</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">emis_max</span> <span class="o">*</span> <span class="n">thresh_int</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="c1"># number of lines plotted</span>
        <span class="n">x_pad</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="p">(</span><span class="n">x_span</span> <span class="o">-</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="n">x_0</span><span class="p">)</span>     
        <span class="k">if</span> <span class="n">N_lines</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">delta_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_span</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x_pad</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N_lines</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="mf">1.6</span> <span class="o">*</span> <span class="n">x_0</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">x_pad</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delta_x</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.6</span> <span class="o">*</span> <span class="n">x_0</span> <span class="o">+</span> <span class="n">x_span</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
        <span class="n">cc</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">ColorConverter</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">emis</span> <span class="o">=</span> <span class="n">all_emis</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">emis</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">emis_max</span> <span class="o">*</span> <span class="n">thresh_int</span><span class="p">):</span>
                    <span class="n">N_seg</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c1">#number of segments to draw emission line, to make it look smooth</span>
                    <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N_seg</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span>  <span class="c1"># x coord of segmente making up one line</span>
                    <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">),</span> <span class="n">N_seg</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N_seg</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">alpha</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">scale</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># to make alpha vary as a smooth step function</span>
                    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> 
                    <span class="n">segments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">points</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">:]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
                    <span class="n">cmap1</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">cmap2</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="n">segments</span><span class="p">:</span>
                            <span class="n">yy0</span> <span class="o">=</span> <span class="n">seg</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> 
                            <span class="n">alpha0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">yy0</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
                            <span class="n">rgb1</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">to_rgb</span><span class="p">(</span><span class="n">color_list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_list</span><span class="p">))])</span> 
                            <span class="n">rgb2</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">to_rgb</span><span class="p">(</span><span class="n">color_list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_list</span><span class="p">))])</span> 
                            <span class="n">cmap1</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">rgb1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rgb1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rgb1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">alpha0</span><span class="p">])</span> 
                            <span class="n">cmap2</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">rgb2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rgb2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rgb2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="o">-</span><span class="n">alpha0</span><span class="p">])</span>
                    <span class="n">lc1</span> <span class="o">=</span> <span class="n">LineCollection</span><span class="p">(</span><span class="n">segments</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">3.5</span><span class="p">)</span>
                    <span class="n">lc1</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">cmap1</span><span class="p">)</span> 
                    <span class="n">lc2</span> <span class="o">=</span> <span class="n">LineCollection</span><span class="p">(</span><span class="n">segments</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">3.5</span><span class="p">)</span>
                    <span class="n">lc2</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">cmap2</span><span class="p">)</span> 
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">lc1</span><span class="p">)</span> 
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">lc2</span><span class="p">)</span> 
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1e4</span><span class="p">:</span>
                        <span class="n">to_print</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.1f}</span><span class="s1">m&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1e4</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">to_print</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.1f}</span><span class="s1">A&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">delta_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span><span class="o">-</span><span class="n">blow</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">to_print</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">delta_x</span>

        <span class="c1"># issue warning on plot if level inversion </span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">warn_label</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergy</span><span class="p">(</span><span class="n">multiplets</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">),</span> <span class="s1">&#39;Warning &#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Atom.printIonic" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">printIonic</span><span class="p">(</span><span class="n">tem</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">printA</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">printPop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">printCrit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Print miscellaneous information (wavelengths, level populations, emissivities, 
    critical densities) for given physical conditions.
If an electron temperature is given, level critical densities can be printed 
    (using printCrit=True)
If an electron density is also given, line emissivities (also for Hbeta) are printed and level 
    populations can be printed (using printPop=True)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>tem</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>temperature</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>den</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>density</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>printA</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>also print transition probabilities (default=False)</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>printPop</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>also print level populations (needs tem and den)</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>printCrit</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>also print critical densities (needs tem)</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong></p>
<pre><code>O3.printIonic()

O3.printIonic(printA=True)

O3.printIonic(tem=10000., printCrit=True)

O3.printIonic(tem=10000., den=1e3, printA=True, printPop=True, printCrit=True)
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2821</span>
<span class="normal">2822</span>
<span class="normal">2823</span>
<span class="normal">2824</span>
<span class="normal">2825</span>
<span class="normal">2826</span>
<span class="normal">2827</span>
<span class="normal">2828</span>
<span class="normal">2829</span>
<span class="normal">2830</span>
<span class="normal">2831</span>
<span class="normal">2832</span>
<span class="normal">2833</span>
<span class="normal">2834</span>
<span class="normal">2835</span>
<span class="normal">2836</span>
<span class="normal">2837</span>
<span class="normal">2838</span>
<span class="normal">2839</span>
<span class="normal">2840</span>
<span class="normal">2841</span>
<span class="normal">2842</span>
<span class="normal">2843</span>
<span class="normal">2844</span>
<span class="normal">2845</span>
<span class="normal">2846</span>
<span class="normal">2847</span>
<span class="normal">2848</span>
<span class="normal">2849</span>
<span class="normal">2850</span>
<span class="normal">2851</span>
<span class="normal">2852</span>
<span class="normal">2853</span>
<span class="normal">2854</span>
<span class="normal">2855</span>
<span class="normal">2856</span>
<span class="normal">2857</span>
<span class="normal">2858</span>
<span class="normal">2859</span>
<span class="normal">2860</span>
<span class="normal">2861</span>
<span class="normal">2862</span>
<span class="normal">2863</span>
<span class="normal">2864</span>
<span class="normal">2865</span>
<span class="normal">2866</span>
<span class="normal">2867</span>
<span class="normal">2868</span>
<span class="normal">2869</span>
<span class="normal">2870</span>
<span class="normal">2871</span>
<span class="normal">2872</span>
<span class="normal">2873</span>
<span class="normal">2874</span>
<span class="normal">2875</span>
<span class="normal">2876</span>
<span class="normal">2877</span>
<span class="normal">2878</span>
<span class="normal">2879</span>
<span class="normal">2880</span>
<span class="normal">2881</span>
<span class="normal">2882</span>
<span class="normal">2883</span>
<span class="normal">2884</span>
<span class="normal">2885</span>
<span class="normal">2886</span>
<span class="normal">2887</span>
<span class="normal">2888</span>
<span class="normal">2889</span>
<span class="normal">2890</span>
<span class="normal">2891</span>
<span class="normal">2892</span>
<span class="normal">2893</span>
<span class="normal">2894</span>
<span class="normal">2895</span>
<span class="normal">2896</span>
<span class="normal">2897</span>
<span class="normal">2898</span>
<span class="normal">2899</span>
<span class="normal">2900</span>
<span class="normal">2901</span>
<span class="normal">2902</span>
<span class="normal">2903</span>
<span class="normal">2904</span>
<span class="normal">2905</span>
<span class="normal">2906</span>
<span class="normal">2907</span>
<span class="normal">2908</span>
<span class="normal">2909</span>
<span class="normal">2910</span>
<span class="normal">2911</span>
<span class="normal">2912</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">printIonic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">printA</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">printPop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">printCrit</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Print miscellaneous information (wavelengths, level populations, emissivities, </span>
<span class="sd">        critical densities) for given physical conditions.</span>
<span class="sd">    If an electron temperature is given, level critical densities can be printed </span>
<span class="sd">        (using printCrit=True)</span>
<span class="sd">    If an electron density is also given, line emissivities (also for Hbeta) are printed and level </span>
<span class="sd">        populations can be printed (using printPop=True)</span>

<span class="sd">    Parameters:</span>
<span class="sd">        tem:          temperature</span>
<span class="sd">        den:          density</span>
<span class="sd">        printA:       also print transition probabilities (default=False)</span>
<span class="sd">        printPop:     also print level populations (needs tem and den)</span>
<span class="sd">        printCrit:    also print critical densities (needs tem)</span>

<span class="sd">    **Usage:**</span>

<span class="sd">        O3.printIonic()</span>

<span class="sd">        O3.printIonic(printA=True)</span>

<span class="sd">        O3.printIonic(tem=10000., printCrit=True)</span>

<span class="sd">        O3.printIonic(tem=10000., den=1e3, printA=True, printPop=True, printCrit=True)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;elem = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;spec = </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;temperature = </span><span class="si">%6.1f</span><span class="s1"> K&#39;</span> <span class="o">%</span> <span class="n">tem</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">den</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;density = </span><span class="si">%6.1f</span><span class="s1"> cm-3&#39;</span> <span class="o">%</span> <span class="n">den</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">printPop</span> <span class="ow">and</span> <span class="p">((</span><span class="n">tem</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">den</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Cannot print populations as tem or den is missing&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="n">printPop</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">printCrit</span> <span class="ow">and</span> <span class="p">(</span><span class="n">tem</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Cannot print critical densities as tem is missing&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="n">printCrit</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">to_print</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">printPop</span><span class="p">:</span>
        <span class="n">to_print</span> <span class="o">+=</span> <span class="s1">&#39;Level   Populations  &#39;</span>
    <span class="k">if</span> <span class="n">printCrit</span><span class="p">:</span>
        <span class="n">to_print</span> <span class="o">+=</span> <span class="s1">&#39;Critical densities&#39;</span>
    <span class="k">if</span> <span class="n">to_print</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">to_print</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">printCrit</span><span class="p">:</span>
        <span class="n">critdens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCritDensity</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">printPop</span><span class="p">:</span>
        <span class="n">pop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPopulations</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">):</span>
        <span class="n">lev_i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">to_print</span> <span class="o">=</span> <span class="s1">&#39;Level </span><span class="si">%1i</span><span class="s1">:  &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lev_i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">printPop</span><span class="p">:</span>
            <span class="n">to_print</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%.3E</span><span class="s2">  &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pop</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">printCrit</span><span class="p">:</span>
            <span class="n">to_print</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%.3E</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">critdens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">printPop</span> <span class="ow">or</span> <span class="n">printCrit</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">to_print</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">printPop</span> <span class="ow">or</span> <span class="n">printCrit</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">tem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">den</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">emis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">printA</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">to_print</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:.3E}</span><span class="s2">   &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getA</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">to_print</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">10000.</span><span class="p">:</span>
                <span class="n">to_print</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%10.2f</span><span class="s2">m &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1e4</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">to_print</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%10.2f</span><span class="s2">A &quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">to_print</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    (</span><span class="si">%1i</span><span class="s2">--&gt;</span><span class="si">%1i</span><span class="s2">) &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">den</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">%.3E</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">emis</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">den</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">H1</span> <span class="o">=</span> <span class="n">RecAtom</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# H-beta volume emissivity:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.3E</span><span class="s2"> N(H+) * N(e-)  (erg/s)&quot;</span> <span class="o">%</span> <span class="n">H1</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Atom.printTemDen" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">printTemDen</span><span class="p">(</span><span class="n">int_ratio</span><span class="p">,</span> <span class="n">tem</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">den</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave1</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxError</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nsect_recur&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">start_x</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">end_x</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nCut</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">maxIter</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Print result of getTemDen function. See getTemDen for more details.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>int_ratio</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>intensity ratio of the selected transition</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>tem</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>electronic temperature</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>den</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>electronic density</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_i1</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>upper level of 1st transition</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_j1</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>lower level of 1st transition</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_i2</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>upper level of 2nd transition</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_j2</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>lower level of 2nd transition</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>wave1</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>wavelength of 1st transition</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>wave2</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>wavelength of 2nd transition</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>maxError</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tolerance on difference between input and computed ratio </p>
              </div>
            </td>
            <td>
                  <code>0.001</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>method</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>numerical method for finding the root (nsect_recur, nsect_iter)</p>
              </div>
            </td>
            <td>
                  <code>&#39;nsect_recur&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>log</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>log switch (default = True)</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>start_x</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>lower end of the interval to explore (default: lower end of collision 
            strength temperature array)</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>end_x</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>higher end of the interval to explore (default: higher end of collision 
            strength temperature array)</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>to_eval</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>expression to be evaluated, using either I (for transitions identified through 
            atomic levels) or L (for transitions identified through wavelengths)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>nCut</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of sections in which each step is cut. 2 would be dichotomy.</p>
              </div>
            </td>
            <td>
                  <code>30</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>maxIter</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>maximum number of iterations</p>
              </div>
            </td>
            <td>
                  <code>20</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong></p>
<pre><code>O3.printTemDen(100, tem=10000, wave1=5007, wave2=4363)
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2914</span>
<span class="normal">2915</span>
<span class="normal">2916</span>
<span class="normal">2917</span>
<span class="normal">2918</span>
<span class="normal">2919</span>
<span class="normal">2920</span>
<span class="normal">2921</span>
<span class="normal">2922</span>
<span class="normal">2923</span>
<span class="normal">2924</span>
<span class="normal">2925</span>
<span class="normal">2926</span>
<span class="normal">2927</span>
<span class="normal">2928</span>
<span class="normal">2929</span>
<span class="normal">2930</span>
<span class="normal">2931</span>
<span class="normal">2932</span>
<span class="normal">2933</span>
<span class="normal">2934</span>
<span class="normal">2935</span>
<span class="normal">2936</span>
<span class="normal">2937</span>
<span class="normal">2938</span>
<span class="normal">2939</span>
<span class="normal">2940</span>
<span class="normal">2941</span>
<span class="normal">2942</span>
<span class="normal">2943</span>
<span class="normal">2944</span>
<span class="normal">2945</span>
<span class="normal">2946</span>
<span class="normal">2947</span>
<span class="normal">2948</span>
<span class="normal">2949</span>
<span class="normal">2950</span>
<span class="normal">2951</span>
<span class="normal">2952</span>
<span class="normal">2953</span>
<span class="normal">2954</span>
<span class="normal">2955</span>
<span class="normal">2956</span>
<span class="normal">2957</span>
<span class="normal">2958</span>
<span class="normal">2959</span>
<span class="normal">2960</span>
<span class="normal">2961</span>
<span class="normal">2962</span>
<span class="normal">2963</span>
<span class="normal">2964</span>
<span class="normal">2965</span>
<span class="normal">2966</span>
<span class="normal">2967</span>
<span class="normal">2968</span>
<span class="normal">2969</span>
<span class="normal">2970</span>
<span class="normal">2971</span>
<span class="normal">2972</span>
<span class="normal">2973</span>
<span class="normal">2974</span></pre></div></td><td class="code"><div><pre><span></span><code>    <span class="k">def</span><span class="w"> </span><span class="nf">printTemDen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">int_ratio</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave1</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">maxError</span><span class="o">=</span><span class="mf">1.e-3</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nsect_recur&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">start_x</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">end_x</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">nCut</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">maxIter</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Print result of getTemDen function. See getTemDen for more details.</span>



<span class="sd">        Parameters:</span>
<span class="sd">            int_ratio:    intensity ratio of the selected transition</span>
<span class="sd">            tem:          electronic temperature</span>
<span class="sd">            den:          electronic density</span>
<span class="sd">            lev_i1:       upper level of 1st transition</span>
<span class="sd">            lev_j1:       lower level of 1st transition</span>
<span class="sd">            lev_i2:       upper level of 2nd transition</span>
<span class="sd">            lev_j2:       lower level of 2nd transition</span>
<span class="sd">            wave1:        wavelength of 1st transition</span>
<span class="sd">            wave2:        wavelength of 2nd transition</span>
<span class="sd">            maxError:     tolerance on difference between input and computed ratio </span>
<span class="sd">            method:       numerical method for finding the root (nsect_recur, nsect_iter)</span>
<span class="sd">            log:          log switch (default = True)</span>
<span class="sd">            start_x:      lower end of the interval to explore (default: lower end of collision </span>
<span class="sd">                            strength temperature array)</span>
<span class="sd">            end_x:        higher end of the interval to explore (default: higher end of collision </span>
<span class="sd">                            strength temperature array)</span>
<span class="sd">            to_eval:      expression to be evaluated, using either I (for transitions identified through </span>
<span class="sd">                            atomic levels) or L (for transitions identified through wavelengths)</span>
<span class="sd">            nCut:        number of sections in which each step is cut. 2 would be dichotomy.</span>
<span class="sd">            maxIter:     maximum number of iterations</span>

<span class="sd">        **Usage:**</span>

<span class="sd">            O3.printTemDen(100, tem=10000, wave1=5007, wave2=4363)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tem</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">option</span> <span class="o">=</span> <span class="s1">&#39;temperature&#39;</span>
            <span class="n">assume</span> <span class="o">=</span> <span class="n">den</span>
            <span class="n">assume_str</span> <span class="o">=</span> <span class="s1">&#39;density&#39;</span>
            <span class="n">assume_unit</span> <span class="o">=</span> <span class="s1">&#39;cm-3&#39;</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;K&#39;</span>
        <span class="k">if</span> <span class="n">den</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">option</span> <span class="o">=</span> <span class="s1">&#39;density&#39;</span>
            <span class="n">assume</span> <span class="o">=</span> <span class="n">tem</span>
            <span class="n">assume_str</span> <span class="o">=</span> <span class="s1">&#39;temperature&#39;</span>
            <span class="n">assume_unit</span> <span class="o">=</span> <span class="s1">&#39;K&#39;</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;cm-3&#39;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTemDen</span><span class="p">(</span><span class="n">int_ratio</span><span class="p">,</span> <span class="n">tem</span><span class="o">=</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="n">den</span><span class="p">,</span> <span class="n">lev_i1</span><span class="o">=</span><span class="n">lev_i1</span><span class="p">,</span> <span class="n">lev_j1</span><span class="o">=</span><span class="n">lev_j1</span><span class="p">,</span> <span class="n">lev_i2</span><span class="o">=</span><span class="n">lev_i2</span><span class="p">,</span> <span class="n">lev_j2</span><span class="o">=</span><span class="n">lev_j2</span><span class="p">,</span>
                                <span class="n">wave1</span><span class="o">=</span><span class="n">wave1</span><span class="p">,</span> <span class="n">wave2</span><span class="o">=</span><span class="n">wave2</span><span class="p">,</span> <span class="n">maxError</span><span class="o">=</span><span class="n">maxError</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span> <span class="n">start_x</span><span class="o">=</span><span class="n">start_x</span><span class="p">,</span>
                                <span class="n">end_x</span><span class="o">=</span><span class="n">end_x</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="n">to_eval</span><span class="p">,</span> <span class="n">nCut</span><span class="o">=</span><span class="n">nCut</span><span class="p">,</span> <span class="n">maxIter</span><span class="o">=</span><span class="n">maxIter</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ion = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">elem</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">int_to_roman</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Option = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">option</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Assumed </span><span class="si">%s</span><span class="s1"> = </span><span class="si">%.0f</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">assume_str</span><span class="p">,</span> <span class="n">assume</span><span class="p">,</span> <span class="n">assume_unit</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">to_eval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Assumed I(</span><span class="si">%i</span><span class="s1">)/I(</span><span class="si">%i</span><span class="s1">) ratio = </span><span class="si">%.0f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wave1</span><span class="p">,</span> <span class="n">wave2</span><span class="p">,</span> <span class="n">int_ratio</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Assumed </span><span class="si">%s</span><span class="s1"> = </span><span class="si">%.0f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">to_eval</span><span class="p">,</span> <span class="n">int_ratio</span><span class="p">))</span>
<span class="c1">#        print &#39;method = %s&#39; % method</span>
<span class="c1">#        print &#39;maxError on ratio %f&#39; % maxError</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Calculated </span><span class="si">%s</span><span class="s1"> = </span><span class="si">%.0f</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">unit</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Atom.printTransition" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">printTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Print info on transition associated to input wavelength.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>wave</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>wavelength in Angstrom (a float or a label: e.g., 5007, '5007A') 
or in micron (a label: '51.5m')</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong></p>
<pre><code>O3.printTransition(4959)
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">printTransition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wave</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print info on transition associated to input wavelength.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        wave:      wavelength in Angstrom (a float or a label: e.g., 5007, &#39;5007A&#39;) </span>
<span class="sd">            or in micron (a label: &#39;51.5m&#39;)</span>

<span class="sd">    **Usage:**</span>

<span class="sd">        O3.printTransition(4959)        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">closestTransition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Transition</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
    <span class="n">relativeError</span> <span class="o">=</span> <span class="n">closestTransition</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">closestTransition</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Input wave: </span><span class="si">{0:.1F}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">closestTransition</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Closest wave found: </span><span class="si">{0:.1F}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">closestTransition</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Relative error: </span><span class="si">{0:.0E}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">relativeError</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Transition: </span><span class="si">{0[0]}</span><span class="s1"> -&gt; </span><span class="si">{0[1]}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">closestTransition</span><span class="p">))</span>
    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pyneb.core.pynebcore.EmissionLine" class="doc doc-heading">
            <code>EmissionLine</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


        <p>Define the emission line object, which is defined by the line parameters and the intensity 
    parameters.
The line parameters define the emitting ion, the wavelength or the transition, the label 
    in PyNeb format, and a flag defining whether the line is a blend or a single transition. 
The intensity parameters describe the observed intensity, the observed uncertainty and 
    the corrected uncertainty</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>elem</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>symbol of the selected element</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>spec</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ionization stage in spectroscopic notation (I = 1, II = 2, etc.)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>wave</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>wavelength of the line</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>blend</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>blend flag (boolean)</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>to_eval</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>algebraic expression describing the emission line in terms of single transitions</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>label</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>line label in the standard PyNeb format</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>obsIntens</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>observed intensity</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>obsError</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>uncertainty on the observed intensity</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>errIsRelative</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Boolean. True if the errors are relative to the intensities, False if they
          are in the same unit as the intensity (default: True)</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong></p>
<pre><code>line = pn.EmissionLine('O', 3, 5007, obsIntens=[1.4, 1.3])

line = pn.EmissionLine(label = 'O3_5007A', obsIntens=320, corrected = True)
</code></pre>

              <details class="quote">
                <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4387</span>
<span class="normal">4388</span>
<span class="normal">4389</span>
<span class="normal">4390</span>
<span class="normal">4391</span>
<span class="normal">4392</span>
<span class="normal">4393</span>
<span class="normal">4394</span>
<span class="normal">4395</span>
<span class="normal">4396</span>
<span class="normal">4397</span>
<span class="normal">4398</span>
<span class="normal">4399</span>
<span class="normal">4400</span>
<span class="normal">4401</span>
<span class="normal">4402</span>
<span class="normal">4403</span>
<span class="normal">4404</span>
<span class="normal">4405</span>
<span class="normal">4406</span>
<span class="normal">4407</span>
<span class="normal">4408</span>
<span class="normal">4409</span>
<span class="normal">4410</span>
<span class="normal">4411</span>
<span class="normal">4412</span>
<span class="normal">4413</span>
<span class="normal">4414</span>
<span class="normal">4415</span>
<span class="normal">4416</span>
<span class="normal">4417</span>
<span class="normal">4418</span>
<span class="normal">4419</span>
<span class="normal">4420</span>
<span class="normal">4421</span>
<span class="normal">4422</span>
<span class="normal">4423</span>
<span class="normal">4424</span>
<span class="normal">4425</span>
<span class="normal">4426</span>
<span class="normal">4427</span>
<span class="normal">4428</span>
<span class="normal">4429</span>
<span class="normal">4430</span>
<span class="normal">4431</span>
<span class="normal">4432</span>
<span class="normal">4433</span>
<span class="normal">4434</span>
<span class="normal">4435</span>
<span class="normal">4436</span>
<span class="normal">4437</span>
<span class="normal">4438</span>
<span class="normal">4439</span>
<span class="normal">4440</span>
<span class="normal">4441</span>
<span class="normal">4442</span>
<span class="normal">4443</span>
<span class="normal">4444</span>
<span class="normal">4445</span>
<span class="normal">4446</span>
<span class="normal">4447</span>
<span class="normal">4448</span>
<span class="normal">4449</span>
<span class="normal">4450</span>
<span class="normal">4451</span>
<span class="normal">4452</span>
<span class="normal">4453</span>
<span class="normal">4454</span>
<span class="normal">4455</span>
<span class="normal">4456</span>
<span class="normal">4457</span>
<span class="normal">4458</span>
<span class="normal">4459</span>
<span class="normal">4460</span>
<span class="normal">4461</span>
<span class="normal">4462</span>
<span class="normal">4463</span>
<span class="normal">4464</span>
<span class="normal">4465</span>
<span class="normal">4466</span>
<span class="normal">4467</span>
<span class="normal">4468</span>
<span class="normal">4469</span>
<span class="normal">4470</span>
<span class="normal">4471</span>
<span class="normal">4472</span>
<span class="normal">4473</span>
<span class="normal">4474</span>
<span class="normal">4475</span>
<span class="normal">4476</span>
<span class="normal">4477</span>
<span class="normal">4478</span>
<span class="normal">4479</span>
<span class="normal">4480</span>
<span class="normal">4481</span>
<span class="normal">4482</span>
<span class="normal">4483</span>
<span class="normal">4484</span>
<span class="normal">4485</span>
<span class="normal">4486</span>
<span class="normal">4487</span>
<span class="normal">4488</span>
<span class="normal">4489</span>
<span class="normal">4490</span>
<span class="normal">4491</span>
<span class="normal">4492</span>
<span class="normal">4493</span>
<span class="normal">4494</span>
<span class="normal">4495</span>
<span class="normal">4496</span>
<span class="normal">4497</span>
<span class="normal">4498</span>
<span class="normal">4499</span>
<span class="normal">4500</span>
<span class="normal">4501</span>
<span class="normal">4502</span>
<span class="normal">4503</span>
<span class="normal">4504</span>
<span class="normal">4505</span>
<span class="normal">4506</span>
<span class="normal">4507</span>
<span class="normal">4508</span>
<span class="normal">4509</span>
<span class="normal">4510</span>
<span class="normal">4511</span>
<span class="normal">4512</span>
<span class="normal">4513</span>
<span class="normal">4514</span>
<span class="normal">4515</span>
<span class="normal">4516</span>
<span class="normal">4517</span>
<span class="normal">4518</span>
<span class="normal">4519</span>
<span class="normal">4520</span>
<span class="normal">4521</span>
<span class="normal">4522</span>
<span class="normal">4523</span>
<span class="normal">4524</span>
<span class="normal">4525</span>
<span class="normal">4526</span>
<span class="normal">4527</span>
<span class="normal">4528</span>
<span class="normal">4529</span>
<span class="normal">4530</span>
<span class="normal">4531</span>
<span class="normal">4532</span>
<span class="normal">4533</span>
<span class="normal">4534</span>
<span class="normal">4535</span>
<span class="normal">4536</span>
<span class="normal">4537</span>
<span class="normal">4538</span>
<span class="normal">4539</span>
<span class="normal">4540</span>
<span class="normal">4541</span>
<span class="normal">4542</span>
<span class="normal">4543</span>
<span class="normal">4544</span>
<span class="normal">4545</span>
<span class="normal">4546</span>
<span class="normal">4547</span>
<span class="normal">4548</span>
<span class="normal">4549</span>
<span class="normal">4550</span>
<span class="normal">4551</span>
<span class="normal">4552</span>
<span class="normal">4553</span>
<span class="normal">4554</span>
<span class="normal">4555</span>
<span class="normal">4556</span>
<span class="normal">4557</span>
<span class="normal">4558</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EmissionLine</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define the emission line object, which is defined by the line parameters and the intensity </span>
<span class="sd">        parameters.</span>
<span class="sd">    The line parameters define the emitting ion, the wavelength or the transition, the label </span>
<span class="sd">        in PyNeb format, and a flag defining whether the line is a blend or a single transition. </span>
<span class="sd">    The intensity parameters describe the observed intensity, the observed uncertainty and </span>
<span class="sd">        the corrected uncertainty</span>

<span class="sd">    Parameters:</span>
<span class="sd">        elem:        symbol of the selected element</span>
<span class="sd">        spec:        ionization stage in spectroscopic notation (I = 1, II = 2, etc.)</span>
<span class="sd">        wave:        wavelength of the line</span>
<span class="sd">        blend:       blend flag (boolean)</span>
<span class="sd">        to_eval:     algebraic expression describing the emission line in terms of single transitions</span>
<span class="sd">        label:       line label in the standard PyNeb format</span>
<span class="sd">        obsIntens:   observed intensity</span>
<span class="sd">        obsError:    uncertainty on the observed intensity</span>
<span class="sd">        errIsRelative: Boolean. True if the errors are relative to the intensities, False if they</span>
<span class="sd">                      are in the same unit as the intensity (default: True)</span>

<span class="sd">    **Usage:**</span>

<span class="sd">        line = pn.EmissionLine(&#39;O&#39;, 3, 5007, obsIntens=[1.4, 1.3])</span>

<span class="sd">        line = pn.EmissionLine(label = &#39;O3_5007A&#39;, obsIntens=320, corrected = True)</span>


<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">obsIntens</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">obsError</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">corrected</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">errIsRelative</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span> <span class="o">=</span> <span class="n">log_</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">=</span> <span class="s1">&#39;EmissionLine&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corrected</span> <span class="o">=</span> <span class="n">corrected</span>

        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elem</span> <span class="o">=</span> <span class="n">elem</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elem</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wave</span> <span class="o">=</span> <span class="n">wave</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blend</span> <span class="o">=</span> <span class="n">blend</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveLabel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">getLineLabel</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="n">blend</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveLabel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">blend</span> <span class="o">=</span> <span class="n">parseLineLabel</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">wave</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wave</span> <span class="o">=</span> <span class="n">wave</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="ow">in</span> <span class="n">LINE_LABEL_LIST</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waveLabel</span> <span class="ow">in</span> <span class="n">LINE_LABEL_LIST</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="ow">in</span> <span class="n">BLEND_LIST</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_valid</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">to_eval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">blend</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveLabel</span> <span class="ow">in</span> <span class="n">LINE_LABEL_LIST</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">to_eval</span> <span class="o">=</span> <span class="s1">&#39;S(&quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waveLabel</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;)&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">to_eval</span> <span class="o">=</span> <span class="n">BLEND_LIST</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">to_eval</span> <span class="o">=</span> <span class="s1">&#39;L(&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">to_eval</span> <span class="o">=</span> <span class="n">to_eval</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_valid</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">to_eval</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;line </span><span class="si">{0}</span><span class="s1"> for atom </span><span class="si">{1}</span><span class="s1"> not valid&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waveLabel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waveLabel</span><span class="p">,</span> <span class="n">LINE_LABEL_LIST</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_valid</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">to_eval</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Atom </span><span class="si">{0}</span><span class="s1"> not valid&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">obsIntens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obsIntens</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">corrected</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">corrIntens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obsIntens</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">corrIntens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">obsIntens</span><span class="p">)</span>

        <span class="c1"># the following is not public, as we still have to think about it. </span>
        <span class="c1"># Don&#39;t une it...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_obsIntens_n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">obsIntens</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_corrIntens_n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">obsIntens</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span> <span class="o">=</span> <span class="n">_unit</span>

        <span class="k">if</span> <span class="n">obsError</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obsError</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obsIntens</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">errIsRelative</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">obsError</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obsError</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">obsError</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obsError</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">obsIntens</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">corrected</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">errIsRelative</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">corrError</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obsError</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">corrError</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obsError</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">corrIntens</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">corrError</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obsError</span><span class="p">)</span>
    <span class="c1">##            </span>
    <span class="c1"># @var elem</span>
    <span class="c1"># Symbol of the element</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">correctIntens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RC</span><span class="p">,</span> <span class="n">normWave</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Correct from extinction. The corrIntens and corrError values of the line </span>
<span class="sd">        are updated according to the RedCorr object</span>


<span class="sd">        Parameters:</span>
<span class="sd">            RC:        an instantiation of the pn.RedCorr class </span>
<span class="sd">            normWave:  a wavelength for the normalisation of the correction, e.g. 4861.  </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">RC</span><span class="p">,</span> <span class="n">RedCorr</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Trying to correct with something that is not a RedCor object&#39;</span><span class="p">,</span>
                          <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">corrIntens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obsIntens</span> <span class="o">*</span> <span class="n">RC</span><span class="o">.</span><span class="n">getCorr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="p">,</span> <span class="n">normWave</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Correcting </span><span class="si">{}</span><span class="s1"> with wave = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="p">),</span>
                                <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;EmissionLine.correctIntens&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">corrIntens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obsIntens</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corrError</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obsError</span> <span class="c1"># error is supposed to be relative.</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">addObs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newObsIntens</span><span class="p">,</span> <span class="n">newObsError</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add observed values to an existing line. </span>

<span class="sd">        Parameters:</span>
<span class="sd">            newObsIntens:    observed intensity of the line</span>
<span class="sd">            newObsError:     error on the observed intensity (optional)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obsIntens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obsIntens</span><span class="p">,</span> <span class="n">newObsIntens</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">newObsError</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obsError</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obsError</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newObsIntens</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obsError</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obsError</span><span class="p">,</span> <span class="n">newObsError</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">corrected</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">corrIntens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corrIntens</span><span class="p">,</span> <span class="n">newObsIntens</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">newObsError</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">corrError</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corrError</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newObsIntens</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">corrError</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corrError</span><span class="p">,</span> <span class="n">newObsError</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">corrIntens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corrIntens</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newObsIntens</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">corrError</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corrError</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newObsIntens</span><span class="p">))</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">printLine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provide information on the line: atom, label, to_eval, as well as the intensities and errors</span>

<span class="sd">        **Usage:**</span>

<span class="sd">            line.printLine()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Line </span><span class="si">{0.atom}</span><span class="s2"> </span><span class="si">{0.label}</span><span class="s2"> evaluated as </span><span class="si">{0.to_eval}</span>
<span class="s2">Observed intensity: </span><span class="si">{0.obsIntens}</span>
<span class="s2">Observed error: </span><span class="si">{0.obsError}</span>
<span class="s2">Corrected intensity: </span><span class="si">{0.corrIntens}</span>
<span class="s2">Corrected error: </span><span class="si">{0.corrError}</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>


    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;Line </span><span class="si">{0.atom}</span><span class="s1"> </span><span class="si">{0.label}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.EmissionLine.addObs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">addObs</span><span class="p">(</span><span class="n">newObsIntens</span><span class="p">,</span> <span class="n">newObsError</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Add observed values to an existing line. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>newObsIntens</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>observed intensity of the line</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>newObsError</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>error on the observed intensity (optional)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4516</span>
<span class="normal">4517</span>
<span class="normal">4518</span>
<span class="normal">4519</span>
<span class="normal">4520</span>
<span class="normal">4521</span>
<span class="normal">4522</span>
<span class="normal">4523</span>
<span class="normal">4524</span>
<span class="normal">4525</span>
<span class="normal">4526</span>
<span class="normal">4527</span>
<span class="normal">4528</span>
<span class="normal">4529</span>
<span class="normal">4530</span>
<span class="normal">4531</span>
<span class="normal">4532</span>
<span class="normal">4533</span>
<span class="normal">4534</span>
<span class="normal">4535</span>
<span class="normal">4536</span>
<span class="normal">4537</span>
<span class="normal">4538</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">addObs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newObsIntens</span><span class="p">,</span> <span class="n">newObsError</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add observed values to an existing line. </span>

<span class="sd">    Parameters:</span>
<span class="sd">        newObsIntens:    observed intensity of the line</span>
<span class="sd">        newObsError:     error on the observed intensity (optional)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">obsIntens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obsIntens</span><span class="p">,</span> <span class="n">newObsIntens</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">newObsError</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obsError</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obsError</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newObsIntens</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obsError</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obsError</span><span class="p">,</span> <span class="n">newObsError</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">corrected</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corrIntens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corrIntens</span><span class="p">,</span> <span class="n">newObsIntens</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">newObsError</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">corrError</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corrError</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newObsIntens</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">corrError</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corrError</span><span class="p">,</span> <span class="n">newObsError</span><span class="p">)</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corrIntens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corrIntens</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newObsIntens</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corrError</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corrError</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newObsIntens</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.EmissionLine.correctIntens" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">correctIntens</span><span class="p">(</span><span class="n">RC</span><span class="p">,</span> <span class="n">normWave</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Correct from extinction. The corrIntens and corrError values of the line 
are updated according to the RedCorr object</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>RC</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an instantiation of the pn.RedCorr class </p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>normWave</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a wavelength for the normalisation of the correction, e.g. 4861.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4491</span>
<span class="normal">4492</span>
<span class="normal">4493</span>
<span class="normal">4494</span>
<span class="normal">4495</span>
<span class="normal">4496</span>
<span class="normal">4497</span>
<span class="normal">4498</span>
<span class="normal">4499</span>
<span class="normal">4500</span>
<span class="normal">4501</span>
<span class="normal">4502</span>
<span class="normal">4503</span>
<span class="normal">4504</span>
<span class="normal">4505</span>
<span class="normal">4506</span>
<span class="normal">4507</span>
<span class="normal">4508</span>
<span class="normal">4509</span>
<span class="normal">4510</span>
<span class="normal">4511</span>
<span class="normal">4512</span>
<span class="normal">4513</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">correctIntens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RC</span><span class="p">,</span> <span class="n">normWave</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Correct from extinction. The corrIntens and corrError values of the line </span>
<span class="sd">    are updated according to the RedCorr object</span>


<span class="sd">    Parameters:</span>
<span class="sd">        RC:        an instantiation of the pn.RedCorr class </span>
<span class="sd">        normWave:  a wavelength for the normalisation of the correction, e.g. 4861.  </span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">RC</span><span class="p">,</span> <span class="n">RedCorr</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Trying to correct with something that is not a RedCor object&#39;</span><span class="p">,</span>
                      <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">corrIntens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obsIntens</span> <span class="o">*</span> <span class="n">RC</span><span class="o">.</span><span class="n">getCorr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="p">,</span> <span class="n">normWave</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Correcting </span><span class="si">{}</span><span class="s1"> with wave = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave</span><span class="p">),</span>
                            <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;EmissionLine.correctIntens&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corrIntens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obsIntens</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">corrError</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obsError</span> <span class="c1"># error is supposed to be relative.</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.EmissionLine.printLine" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">printLine</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Provide information on the line: atom, label, to_eval, as well as the intensities and errors</p>
<p><strong>Usage:</strong></p>
<pre><code>line.printLine()
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4541</span>
<span class="normal">4542</span>
<span class="normal">4543</span>
<span class="normal">4544</span>
<span class="normal">4545</span>
<span class="normal">4546</span>
<span class="normal">4547</span>
<span class="normal">4548</span>
<span class="normal">4549</span>
<span class="normal">4550</span>
<span class="normal">4551</span>
<span class="normal">4552</span>
<span class="normal">4553</span>
<span class="normal">4554</span></pre></div></td><td class="code"><div><pre><span></span><code>    <span class="k">def</span><span class="w"> </span><span class="nf">printLine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provide information on the line: atom, label, to_eval, as well as the intensities and errors</span>

<span class="sd">        **Usage:**</span>

<span class="sd">            line.printLine()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Line </span><span class="si">{0.atom}</span><span class="s2"> </span><span class="si">{0.label}</span><span class="s2"> evaluated as </span><span class="si">{0.to_eval}</span>
<span class="s2">Observed intensity: </span><span class="si">{0.obsIntens}</span>
<span class="s2">Observed error: </span><span class="si">{0.obsError}</span>
<span class="s2">Corrected intensity: </span><span class="si">{0.corrIntens}</span>
<span class="s2">Corrected error: </span><span class="si">{0.corrError}</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pyneb.core.pynebcore.Observation" class="doc doc-heading">
            <code>Observation</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


              <details class="quote">
                <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4561</span>
<span class="normal">4562</span>
<span class="normal">4563</span>
<span class="normal">4564</span>
<span class="normal">4565</span>
<span class="normal">4566</span>
<span class="normal">4567</span>
<span class="normal">4568</span>
<span class="normal">4569</span>
<span class="normal">4570</span>
<span class="normal">4571</span>
<span class="normal">4572</span>
<span class="normal">4573</span>
<span class="normal">4574</span>
<span class="normal">4575</span>
<span class="normal">4576</span>
<span class="normal">4577</span>
<span class="normal">4578</span>
<span class="normal">4579</span>
<span class="normal">4580</span>
<span class="normal">4581</span>
<span class="normal">4582</span>
<span class="normal">4583</span>
<span class="normal">4584</span>
<span class="normal">4585</span>
<span class="normal">4586</span>
<span class="normal">4587</span>
<span class="normal">4588</span>
<span class="normal">4589</span>
<span class="normal">4590</span>
<span class="normal">4591</span>
<span class="normal">4592</span>
<span class="normal">4593</span>
<span class="normal">4594</span>
<span class="normal">4595</span>
<span class="normal">4596</span>
<span class="normal">4597</span>
<span class="normal">4598</span>
<span class="normal">4599</span>
<span class="normal">4600</span>
<span class="normal">4601</span>
<span class="normal">4602</span>
<span class="normal">4603</span>
<span class="normal">4604</span>
<span class="normal">4605</span>
<span class="normal">4606</span>
<span class="normal">4607</span>
<span class="normal">4608</span>
<span class="normal">4609</span>
<span class="normal">4610</span>
<span class="normal">4611</span>
<span class="normal">4612</span>
<span class="normal">4613</span>
<span class="normal">4614</span>
<span class="normal">4615</span>
<span class="normal">4616</span>
<span class="normal">4617</span>
<span class="normal">4618</span>
<span class="normal">4619</span>
<span class="normal">4620</span>
<span class="normal">4621</span>
<span class="normal">4622</span>
<span class="normal">4623</span>
<span class="normal">4624</span>
<span class="normal">4625</span>
<span class="normal">4626</span>
<span class="normal">4627</span>
<span class="normal">4628</span>
<span class="normal">4629</span>
<span class="normal">4630</span>
<span class="normal">4631</span>
<span class="normal">4632</span>
<span class="normal">4633</span>
<span class="normal">4634</span>
<span class="normal">4635</span>
<span class="normal">4636</span>
<span class="normal">4637</span>
<span class="normal">4638</span>
<span class="normal">4639</span>
<span class="normal">4640</span>
<span class="normal">4641</span>
<span class="normal">4642</span>
<span class="normal">4643</span>
<span class="normal">4644</span>
<span class="normal">4645</span>
<span class="normal">4646</span>
<span class="normal">4647</span>
<span class="normal">4648</span>
<span class="normal">4649</span>
<span class="normal">4650</span>
<span class="normal">4651</span>
<span class="normal">4652</span>
<span class="normal">4653</span>
<span class="normal">4654</span>
<span class="normal">4655</span>
<span class="normal">4656</span>
<span class="normal">4657</span>
<span class="normal">4658</span>
<span class="normal">4659</span>
<span class="normal">4660</span>
<span class="normal">4661</span>
<span class="normal">4662</span>
<span class="normal">4663</span>
<span class="normal">4664</span>
<span class="normal">4665</span>
<span class="normal">4666</span>
<span class="normal">4667</span>
<span class="normal">4668</span>
<span class="normal">4669</span>
<span class="normal">4670</span>
<span class="normal">4671</span>
<span class="normal">4672</span>
<span class="normal">4673</span>
<span class="normal">4674</span>
<span class="normal">4675</span>
<span class="normal">4676</span>
<span class="normal">4677</span>
<span class="normal">4678</span>
<span class="normal">4679</span>
<span class="normal">4680</span>
<span class="normal">4681</span>
<span class="normal">4682</span>
<span class="normal">4683</span>
<span class="normal">4684</span>
<span class="normal">4685</span>
<span class="normal">4686</span>
<span class="normal">4687</span>
<span class="normal">4688</span>
<span class="normal">4689</span>
<span class="normal">4690</span>
<span class="normal">4691</span>
<span class="normal">4692</span>
<span class="normal">4693</span>
<span class="normal">4694</span>
<span class="normal">4695</span>
<span class="normal">4696</span>
<span class="normal">4697</span>
<span class="normal">4698</span>
<span class="normal">4699</span>
<span class="normal">4700</span>
<span class="normal">4701</span>
<span class="normal">4702</span>
<span class="normal">4703</span>
<span class="normal">4704</span>
<span class="normal">4705</span>
<span class="normal">4706</span>
<span class="normal">4707</span>
<span class="normal">4708</span>
<span class="normal">4709</span>
<span class="normal">4710</span>
<span class="normal">4711</span>
<span class="normal">4712</span>
<span class="normal">4713</span>
<span class="normal">4714</span>
<span class="normal">4715</span>
<span class="normal">4716</span>
<span class="normal">4717</span>
<span class="normal">4718</span>
<span class="normal">4719</span>
<span class="normal">4720</span>
<span class="normal">4721</span>
<span class="normal">4722</span>
<span class="normal">4723</span>
<span class="normal">4724</span>
<span class="normal">4725</span>
<span class="normal">4726</span>
<span class="normal">4727</span>
<span class="normal">4728</span>
<span class="normal">4729</span>
<span class="normal">4730</span>
<span class="normal">4731</span>
<span class="normal">4732</span>
<span class="normal">4733</span>
<span class="normal">4734</span>
<span class="normal">4735</span>
<span class="normal">4736</span>
<span class="normal">4737</span>
<span class="normal">4738</span>
<span class="normal">4739</span>
<span class="normal">4740</span>
<span class="normal">4741</span>
<span class="normal">4742</span>
<span class="normal">4743</span>
<span class="normal">4744</span>
<span class="normal">4745</span>
<span class="normal">4746</span>
<span class="normal">4747</span>
<span class="normal">4748</span>
<span class="normal">4749</span>
<span class="normal">4750</span>
<span class="normal">4751</span>
<span class="normal">4752</span>
<span class="normal">4753</span>
<span class="normal">4754</span>
<span class="normal">4755</span>
<span class="normal">4756</span>
<span class="normal">4757</span>
<span class="normal">4758</span>
<span class="normal">4759</span>
<span class="normal">4760</span>
<span class="normal">4761</span>
<span class="normal">4762</span>
<span class="normal">4763</span>
<span class="normal">4764</span>
<span class="normal">4765</span>
<span class="normal">4766</span>
<span class="normal">4767</span>
<span class="normal">4768</span>
<span class="normal">4769</span>
<span class="normal">4770</span>
<span class="normal">4771</span>
<span class="normal">4772</span>
<span class="normal">4773</span>
<span class="normal">4774</span>
<span class="normal">4775</span>
<span class="normal">4776</span>
<span class="normal">4777</span>
<span class="normal">4778</span>
<span class="normal">4779</span>
<span class="normal">4780</span>
<span class="normal">4781</span>
<span class="normal">4782</span>
<span class="normal">4783</span>
<span class="normal">4784</span>
<span class="normal">4785</span>
<span class="normal">4786</span>
<span class="normal">4787</span>
<span class="normal">4788</span>
<span class="normal">4789</span>
<span class="normal">4790</span>
<span class="normal">4791</span>
<span class="normal">4792</span>
<span class="normal">4793</span>
<span class="normal">4794</span>
<span class="normal">4795</span>
<span class="normal">4796</span>
<span class="normal">4797</span>
<span class="normal">4798</span>
<span class="normal">4799</span>
<span class="normal">4800</span>
<span class="normal">4801</span>
<span class="normal">4802</span>
<span class="normal">4803</span>
<span class="normal">4804</span>
<span class="normal">4805</span>
<span class="normal">4806</span>
<span class="normal">4807</span>
<span class="normal">4808</span>
<span class="normal">4809</span>
<span class="normal">4810</span>
<span class="normal">4811</span>
<span class="normal">4812</span>
<span class="normal">4813</span>
<span class="normal">4814</span>
<span class="normal">4815</span>
<span class="normal">4816</span>
<span class="normal">4817</span>
<span class="normal">4818</span>
<span class="normal">4819</span>
<span class="normal">4820</span>
<span class="normal">4821</span>
<span class="normal">4822</span>
<span class="normal">4823</span>
<span class="normal">4824</span>
<span class="normal">4825</span>
<span class="normal">4826</span>
<span class="normal">4827</span>
<span class="normal">4828</span>
<span class="normal">4829</span>
<span class="normal">4830</span>
<span class="normal">4831</span>
<span class="normal">4832</span>
<span class="normal">4833</span>
<span class="normal">4834</span>
<span class="normal">4835</span>
<span class="normal">4836</span>
<span class="normal">4837</span>
<span class="normal">4838</span>
<span class="normal">4839</span>
<span class="normal">4840</span>
<span class="normal">4841</span>
<span class="normal">4842</span>
<span class="normal">4843</span>
<span class="normal">4844</span>
<span class="normal">4845</span>
<span class="normal">4846</span>
<span class="normal">4847</span>
<span class="normal">4848</span>
<span class="normal">4849</span>
<span class="normal">4850</span>
<span class="normal">4851</span>
<span class="normal">4852</span>
<span class="normal">4853</span>
<span class="normal">4854</span>
<span class="normal">4855</span>
<span class="normal">4856</span>
<span class="normal">4857</span>
<span class="normal">4858</span>
<span class="normal">4859</span>
<span class="normal">4860</span>
<span class="normal">4861</span>
<span class="normal">4862</span>
<span class="normal">4863</span>
<span class="normal">4864</span>
<span class="normal">4865</span>
<span class="normal">4866</span>
<span class="normal">4867</span>
<span class="normal">4868</span>
<span class="normal">4869</span>
<span class="normal">4870</span>
<span class="normal">4871</span>
<span class="normal">4872</span>
<span class="normal">4873</span>
<span class="normal">4874</span>
<span class="normal">4875</span>
<span class="normal">4876</span>
<span class="normal">4877</span>
<span class="normal">4878</span>
<span class="normal">4879</span>
<span class="normal">4880</span>
<span class="normal">4881</span>
<span class="normal">4882</span>
<span class="normal">4883</span>
<span class="normal">4884</span>
<span class="normal">4885</span>
<span class="normal">4886</span>
<span class="normal">4887</span>
<span class="normal">4888</span>
<span class="normal">4889</span>
<span class="normal">4890</span>
<span class="normal">4891</span>
<span class="normal">4892</span>
<span class="normal">4893</span>
<span class="normal">4894</span>
<span class="normal">4895</span>
<span class="normal">4896</span>
<span class="normal">4897</span>
<span class="normal">4898</span>
<span class="normal">4899</span>
<span class="normal">4900</span>
<span class="normal">4901</span>
<span class="normal">4902</span>
<span class="normal">4903</span>
<span class="normal">4904</span>
<span class="normal">4905</span>
<span class="normal">4906</span>
<span class="normal">4907</span>
<span class="normal">4908</span>
<span class="normal">4909</span>
<span class="normal">4910</span>
<span class="normal">4911</span>
<span class="normal">4912</span>
<span class="normal">4913</span>
<span class="normal">4914</span>
<span class="normal">4915</span>
<span class="normal">4916</span>
<span class="normal">4917</span>
<span class="normal">4918</span>
<span class="normal">4919</span>
<span class="normal">4920</span>
<span class="normal">4921</span>
<span class="normal">4922</span>
<span class="normal">4923</span>
<span class="normal">4924</span>
<span class="normal">4925</span>
<span class="normal">4926</span>
<span class="normal">4927</span>
<span class="normal">4928</span>
<span class="normal">4929</span>
<span class="normal">4930</span>
<span class="normal">4931</span>
<span class="normal">4932</span>
<span class="normal">4933</span>
<span class="normal">4934</span>
<span class="normal">4935</span>
<span class="normal">4936</span>
<span class="normal">4937</span>
<span class="normal">4938</span>
<span class="normal">4939</span>
<span class="normal">4940</span>
<span class="normal">4941</span>
<span class="normal">4942</span>
<span class="normal">4943</span>
<span class="normal">4944</span>
<span class="normal">4945</span>
<span class="normal">4946</span>
<span class="normal">4947</span>
<span class="normal">4948</span>
<span class="normal">4949</span>
<span class="normal">4950</span>
<span class="normal">4951</span>
<span class="normal">4952</span>
<span class="normal">4953</span>
<span class="normal">4954</span>
<span class="normal">4955</span>
<span class="normal">4956</span>
<span class="normal">4957</span>
<span class="normal">4958</span>
<span class="normal">4959</span>
<span class="normal">4960</span>
<span class="normal">4961</span>
<span class="normal">4962</span>
<span class="normal">4963</span>
<span class="normal">4964</span>
<span class="normal">4965</span>
<span class="normal">4966</span>
<span class="normal">4967</span>
<span class="normal">4968</span>
<span class="normal">4969</span>
<span class="normal">4970</span>
<span class="normal">4971</span>
<span class="normal">4972</span>
<span class="normal">4973</span>
<span class="normal">4974</span>
<span class="normal">4975</span>
<span class="normal">4976</span>
<span class="normal">4977</span>
<span class="normal">4978</span>
<span class="normal">4979</span>
<span class="normal">4980</span>
<span class="normal">4981</span>
<span class="normal">4982</span>
<span class="normal">4983</span>
<span class="normal">4984</span>
<span class="normal">4985</span>
<span class="normal">4986</span>
<span class="normal">4987</span>
<span class="normal">4988</span>
<span class="normal">4989</span>
<span class="normal">4990</span>
<span class="normal">4991</span>
<span class="normal">4992</span>
<span class="normal">4993</span>
<span class="normal">4994</span>
<span class="normal">4995</span>
<span class="normal">4996</span>
<span class="normal">4997</span>
<span class="normal">4998</span>
<span class="normal">4999</span>
<span class="normal">5000</span>
<span class="normal">5001</span>
<span class="normal">5002</span>
<span class="normal">5003</span>
<span class="normal">5004</span>
<span class="normal">5005</span>
<span class="normal">5006</span>
<span class="normal">5007</span>
<span class="normal">5008</span>
<span class="normal">5009</span>
<span class="normal">5010</span>
<span class="normal">5011</span>
<span class="normal">5012</span>
<span class="normal">5013</span>
<span class="normal">5014</span>
<span class="normal">5015</span>
<span class="normal">5016</span>
<span class="normal">5017</span>
<span class="normal">5018</span>
<span class="normal">5019</span>
<span class="normal">5020</span>
<span class="normal">5021</span>
<span class="normal">5022</span>
<span class="normal">5023</span>
<span class="normal">5024</span>
<span class="normal">5025</span>
<span class="normal">5026</span>
<span class="normal">5027</span>
<span class="normal">5028</span>
<span class="normal">5029</span>
<span class="normal">5030</span>
<span class="normal">5031</span>
<span class="normal">5032</span>
<span class="normal">5033</span>
<span class="normal">5034</span>
<span class="normal">5035</span>
<span class="normal">5036</span>
<span class="normal">5037</span>
<span class="normal">5038</span>
<span class="normal">5039</span>
<span class="normal">5040</span>
<span class="normal">5041</span>
<span class="normal">5042</span>
<span class="normal">5043</span>
<span class="normal">5044</span>
<span class="normal">5045</span>
<span class="normal">5046</span>
<span class="normal">5047</span>
<span class="normal">5048</span>
<span class="normal">5049</span>
<span class="normal">5050</span>
<span class="normal">5051</span>
<span class="normal">5052</span>
<span class="normal">5053</span>
<span class="normal">5054</span>
<span class="normal">5055</span>
<span class="normal">5056</span>
<span class="normal">5057</span>
<span class="normal">5058</span>
<span class="normal">5059</span>
<span class="normal">5060</span>
<span class="normal">5061</span>
<span class="normal">5062</span>
<span class="normal">5063</span>
<span class="normal">5064</span>
<span class="normal">5065</span>
<span class="normal">5066</span>
<span class="normal">5067</span>
<span class="normal">5068</span>
<span class="normal">5069</span>
<span class="normal">5070</span>
<span class="normal">5071</span>
<span class="normal">5072</span>
<span class="normal">5073</span>
<span class="normal">5074</span>
<span class="normal">5075</span>
<span class="normal">5076</span>
<span class="normal">5077</span>
<span class="normal">5078</span>
<span class="normal">5079</span>
<span class="normal">5080</span>
<span class="normal">5081</span>
<span class="normal">5082</span>
<span class="normal">5083</span>
<span class="normal">5084</span>
<span class="normal">5085</span>
<span class="normal">5086</span>
<span class="normal">5087</span>
<span class="normal">5088</span>
<span class="normal">5089</span>
<span class="normal">5090</span>
<span class="normal">5091</span>
<span class="normal">5092</span>
<span class="normal">5093</span>
<span class="normal">5094</span>
<span class="normal">5095</span>
<span class="normal">5096</span>
<span class="normal">5097</span>
<span class="normal">5098</span>
<span class="normal">5099</span>
<span class="normal">5100</span>
<span class="normal">5101</span>
<span class="normal">5102</span>
<span class="normal">5103</span>
<span class="normal">5104</span>
<span class="normal">5105</span>
<span class="normal">5106</span>
<span class="normal">5107</span>
<span class="normal">5108</span>
<span class="normal">5109</span>
<span class="normal">5110</span>
<span class="normal">5111</span>
<span class="normal">5112</span>
<span class="normal">5113</span>
<span class="normal">5114</span>
<span class="normal">5115</span>
<span class="normal">5116</span>
<span class="normal">5117</span>
<span class="normal">5118</span>
<span class="normal">5119</span>
<span class="normal">5120</span>
<span class="normal">5121</span>
<span class="normal">5122</span>
<span class="normal">5123</span>
<span class="normal">5124</span>
<span class="normal">5125</span>
<span class="normal">5126</span>
<span class="normal">5127</span>
<span class="normal">5128</span>
<span class="normal">5129</span>
<span class="normal">5130</span>
<span class="normal">5131</span>
<span class="normal">5132</span>
<span class="normal">5133</span>
<span class="normal">5134</span>
<span class="normal">5135</span>
<span class="normal">5136</span>
<span class="normal">5137</span>
<span class="normal">5138</span>
<span class="normal">5139</span>
<span class="normal">5140</span>
<span class="normal">5141</span>
<span class="normal">5142</span>
<span class="normal">5143</span>
<span class="normal">5144</span>
<span class="normal">5145</span>
<span class="normal">5146</span>
<span class="normal">5147</span>
<span class="normal">5148</span>
<span class="normal">5149</span>
<span class="normal">5150</span>
<span class="normal">5151</span>
<span class="normal">5152</span>
<span class="normal">5153</span>
<span class="normal">5154</span>
<span class="normal">5155</span>
<span class="normal">5156</span>
<span class="normal">5157</span>
<span class="normal">5158</span>
<span class="normal">5159</span>
<span class="normal">5160</span>
<span class="normal">5161</span>
<span class="normal">5162</span>
<span class="normal">5163</span>
<span class="normal">5164</span>
<span class="normal">5165</span>
<span class="normal">5166</span>
<span class="normal">5167</span>
<span class="normal">5168</span>
<span class="normal">5169</span>
<span class="normal">5170</span>
<span class="normal">5171</span>
<span class="normal">5172</span>
<span class="normal">5173</span>
<span class="normal">5174</span>
<span class="normal">5175</span>
<span class="normal">5176</span>
<span class="normal">5177</span>
<span class="normal">5178</span>
<span class="normal">5179</span>
<span class="normal">5180</span>
<span class="normal">5181</span>
<span class="normal">5182</span>
<span class="normal">5183</span>
<span class="normal">5184</span>
<span class="normal">5185</span>
<span class="normal">5186</span>
<span class="normal">5187</span>
<span class="normal">5188</span>
<span class="normal">5189</span>
<span class="normal">5190</span>
<span class="normal">5191</span>
<span class="normal">5192</span>
<span class="normal">5193</span>
<span class="normal">5194</span>
<span class="normal">5195</span>
<span class="normal">5196</span>
<span class="normal">5197</span>
<span class="normal">5198</span>
<span class="normal">5199</span>
<span class="normal">5200</span>
<span class="normal">5201</span>
<span class="normal">5202</span>
<span class="normal">5203</span>
<span class="normal">5204</span>
<span class="normal">5205</span>
<span class="normal">5206</span>
<span class="normal">5207</span>
<span class="normal">5208</span>
<span class="normal">5209</span>
<span class="normal">5210</span>
<span class="normal">5211</span>
<span class="normal">5212</span>
<span class="normal">5213</span>
<span class="normal">5214</span>
<span class="normal">5215</span>
<span class="normal">5216</span>
<span class="normal">5217</span>
<span class="normal">5218</span>
<span class="normal">5219</span>
<span class="normal">5220</span>
<span class="normal">5221</span>
<span class="normal">5222</span>
<span class="normal">5223</span>
<span class="normal">5224</span>
<span class="normal">5225</span>
<span class="normal">5226</span>
<span class="normal">5227</span>
<span class="normal">5228</span>
<span class="normal">5229</span>
<span class="normal">5230</span>
<span class="normal">5231</span>
<span class="normal">5232</span>
<span class="normal">5233</span>
<span class="normal">5234</span>
<span class="normal">5235</span>
<span class="normal">5236</span>
<span class="normal">5237</span>
<span class="normal">5238</span>
<span class="normal">5239</span>
<span class="normal">5240</span>
<span class="normal">5241</span>
<span class="normal">5242</span>
<span class="normal">5243</span>
<span class="normal">5244</span>
<span class="normal">5245</span>
<span class="normal">5246</span>
<span class="normal">5247</span>
<span class="normal">5248</span>
<span class="normal">5249</span>
<span class="normal">5250</span>
<span class="normal">5251</span>
<span class="normal">5252</span>
<span class="normal">5253</span>
<span class="normal">5254</span>
<span class="normal">5255</span>
<span class="normal">5256</span>
<span class="normal">5257</span>
<span class="normal">5258</span>
<span class="normal">5259</span>
<span class="normal">5260</span>
<span class="normal">5261</span>
<span class="normal">5262</span>
<span class="normal">5263</span>
<span class="normal">5264</span>
<span class="normal">5265</span>
<span class="normal">5266</span>
<span class="normal">5267</span>
<span class="normal">5268</span>
<span class="normal">5269</span>
<span class="normal">5270</span>
<span class="normal">5271</span>
<span class="normal">5272</span>
<span class="normal">5273</span>
<span class="normal">5274</span>
<span class="normal">5275</span>
<span class="normal">5276</span>
<span class="normal">5277</span>
<span class="normal">5278</span>
<span class="normal">5279</span>
<span class="normal">5280</span>
<span class="normal">5281</span>
<span class="normal">5282</span>
<span class="normal">5283</span>
<span class="normal">5284</span>
<span class="normal">5285</span>
<span class="normal">5286</span>
<span class="normal">5287</span>
<span class="normal">5288</span>
<span class="normal">5289</span>
<span class="normal">5290</span>
<span class="normal">5291</span>
<span class="normal">5292</span>
<span class="normal">5293</span>
<span class="normal">5294</span>
<span class="normal">5295</span>
<span class="normal">5296</span>
<span class="normal">5297</span>
<span class="normal">5298</span>
<span class="normal">5299</span>
<span class="normal">5300</span>
<span class="normal">5301</span>
<span class="normal">5302</span>
<span class="normal">5303</span>
<span class="normal">5304</span>
<span class="normal">5305</span>
<span class="normal">5306</span>
<span class="normal">5307</span>
<span class="normal">5308</span>
<span class="normal">5309</span>
<span class="normal">5310</span>
<span class="normal">5311</span>
<span class="normal">5312</span>
<span class="normal">5313</span>
<span class="normal">5314</span>
<span class="normal">5315</span>
<span class="normal">5316</span>
<span class="normal">5317</span>
<span class="normal">5318</span>
<span class="normal">5319</span>
<span class="normal">5320</span>
<span class="normal">5321</span>
<span class="normal">5322</span>
<span class="normal">5323</span>
<span class="normal">5324</span>
<span class="normal">5325</span>
<span class="normal">5326</span>
<span class="normal">5327</span>
<span class="normal">5328</span>
<span class="normal">5329</span>
<span class="normal">5330</span>
<span class="normal">5331</span>
<span class="normal">5332</span>
<span class="normal">5333</span>
<span class="normal">5334</span>
<span class="normal">5335</span>
<span class="normal">5336</span>
<span class="normal">5337</span>
<span class="normal">5338</span>
<span class="normal">5339</span>
<span class="normal">5340</span>
<span class="normal">5341</span>
<span class="normal">5342</span>
<span class="normal">5343</span>
<span class="normal">5344</span>
<span class="normal">5345</span>
<span class="normal">5346</span>
<span class="normal">5347</span>
<span class="normal">5348</span>
<span class="normal">5349</span>
<span class="normal">5350</span>
<span class="normal">5351</span>
<span class="normal">5352</span>
<span class="normal">5353</span>
<span class="normal">5354</span>
<span class="normal">5355</span>
<span class="normal">5356</span>
<span class="normal">5357</span>
<span class="normal">5358</span>
<span class="normal">5359</span>
<span class="normal">5360</span>
<span class="normal">5361</span>
<span class="normal">5362</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Observation</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obsFile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fileFormat</span><span class="o">=</span><span class="s1">&#39;lines_in_cols&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">err_default</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span>
                 <span class="n">corrected</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errIsRelative</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">correcLaw</span><span class="o">=</span><span class="s1">&#39;F99&#39;</span><span class="p">,</span> <span class="n">errStr</span><span class="o">=</span><span class="s1">&#39;err&#39;</span><span class="p">,</span>
                 <span class="n">addErrDefault</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">Cutout2D_position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Cutout2D_size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define the observation object, which is a collection of observated intensities of one or more</span>
<span class="sd">        emission lines for one or more objects, with the corresponding errors.</span>
<span class="sd">        The observed intensities are read from a file or filled in by the addLine method.</span>
<span class="sd">        Includes an extinction correction object (pyneb.RedCorr) as Observation.extinction.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            obsFile:       name of the file containing the observations. May be a file object or a file name </span>
<span class="sd">                             If the fileFormat is &#39;fits_IFU&#39;, the obsFile keyword is of the form e.g.:</span>
<span class="sd">                             &#39;dir/ngc6778_MUSE_*.fits&#39; where * is of the form O3_5007A.</span>
<span class="sd">                             The associated error file must be named the same way, using errStr keyword value </span>
<span class="sd">                             e.g. dir/ngc6778_MUSE_O3_5007A_err.fits</span>
<span class="sd">            fileFormat:    format of the data file, depending on how the wavelengths are ordered.</span>
<span class="sd">                            Available formats are :</span>
<span class="sd">                            - &#39;lines_in_cols&#39; : Each object is on a different row. Each column corresponds to a given emission line. </span>
<span class="sd">                               Line labels with tailing &quot;e&quot; are for errors on line intensities.</span>
<span class="sd">                            - &#39;lines_in_cols2&#39; : Each object is on a different row. Same as &#39;lines_in_cols&#39; but using genfromtxt to read the file.</span>
<span class="sd">                               Allows undefined values.</span>
<span class="sd">                            - &#39;lines_in_rows&#39; : Each object is on a different column. Each row corresponds to a given emission line.</span>
<span class="sd">                            - &#39;lines_in_rows_err_cols&#39; : Each object is on a different column. Each row corresponds to a given emission line. </span>
<span class="sd">                               For each object (eg. &quot;IC418&quot;), an additional column (named eg &quot;errIC418&quot;) contains the errors on the line intensities.</span>
<span class="sd">                            - &#39;fits_IFU&#39;: each emission line is stored into a fits file</span>
<span class="sd">            delimiter:     character separating entries </span>
<span class="sd">            err_default:   [0.10] default uncertainty assumed on intensities. Will overwrite the error from the file.</span>
<span class="sd">            corrected:     Boolean. True if the observed intensities are already corrected from extinction</span>
<span class="sd">                                (default: False)</span>
<span class="sd">            errIsRelative: Boolean. True if the errors are relative to the intensities, False if they</span>
<span class="sd">                                are in the same unit as the intensity (default: True)</span>
<span class="sd">            correcLaw:   [&#39;F99&#39;] extinction law used to correct the observed lines.</span>
<span class="sd">            errStr (str):        String used to identify error file when fileFormat is fits_IFU</span>
<span class="sd">            addErrDefault: if True, the default error is always quadratically added to the read error.</span>
<span class="sd">            Cutout2D_position:</span>
<span class="sd">            Cutout2D_size: In case of reading fits images, crop the image to those pixel limits</span>

<span class="sd">        **Example:**</span>

<span class="sd">        Read a file containing corrected intensities:</span>

<span class="sd">            obs = pn.Observation(&#39;obs.dat&#39;, corrected = True)</span>

<span class="sd">        To obtain a dictionary with the observed  corrected intensities:</span>

<span class="sd">            i_cor = {label: obs.getLine(label = label).corrIntens for label in obs.lineLabels}</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span> <span class="o">=</span> <span class="n">log_</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">=</span> <span class="s1">&#39;Observation&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extinction</span> <span class="o">=</span> <span class="n">RedCorr</span><span class="p">(</span><span class="n">law</span><span class="o">=</span><span class="n">correcLaw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corrected</span> <span class="o">=</span> <span class="n">corrected</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addErrDefault</span> <span class="o">=</span> <span class="n">addErrDefault</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MC_added</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N_MC</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fits_shape</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">corrected</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extinction</span><span class="o">.</span><span class="n">law</span> <span class="o">=</span> <span class="s1">&#39;No correction&#39;</span>
        <span class="k">if</span> <span class="n">obsFile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">readData</span><span class="p">(</span><span class="n">obsFile</span><span class="o">=</span><span class="n">obsFile</span><span class="p">,</span> <span class="n">fileFormat</span><span class="o">=</span><span class="n">fileFormat</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span>
                          <span class="n">err_default</span><span class="o">=</span><span class="n">err_default</span><span class="p">,</span> <span class="n">corrected</span><span class="o">=</span><span class="n">corrected</span><span class="p">,</span> <span class="n">errIsRelative</span><span class="o">=</span><span class="n">errIsRelative</span><span class="p">,</span>
                          <span class="n">errStr</span><span class="o">=</span><span class="n">errStr</span><span class="p">,</span> 
                          <span class="n">Cutout2D_position</span><span class="o">=</span><span class="n">Cutout2D_position</span><span class="p">,</span> <span class="n">Cutout2D_size</span><span class="o">=</span><span class="n">Cutout2D_size</span><span class="p">)</span>
    <span class="c1">##            </span>
    <span class="c1"># @var log_</span>
    <span class="c1"># myloggin object</span>
    <span class="c1"># @var extinction</span>
    <span class="c1"># RedCor object</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">addLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a line to an existing observation</span>

<span class="sd">        Parameters:</span>
<span class="sd">            line:    the selected emission line (an instance of EmissionLine)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">EmissionLine</span><span class="p">):</span>            
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Trying to add an inappropriate record to observations&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">corrected</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">corrected</span><span class="p">:</span>
            <span class="n">line</span><span class="o">.</span><span class="n">corrected</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">correctData</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">removeLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lineLabel</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="n">lineLabel</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fillObs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lineLabel</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a fake observation of a given line, filled with a given value.</span>
<span class="sd">        Parameters:</span>
<span class="sd">            lineLabel: the label of the new line. If the label corresponds to an already </span>
<span class="sd">                defined observation, nothing is done and a warning is issued.</span>
<span class="sd">            default: the value of the fake observations. Default is np.nan</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">lineLabel</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineLabels</span><span class="p">:</span>
            <span class="n">newLine</span> <span class="o">=</span> <span class="n">EmissionLine</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">lineLabel</span><span class="p">,</span> <span class="n">obsIntens</span><span class="o">=</span><span class="n">default</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_obs</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">newLine</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Line </span><span class="si">{0}</span><span class="s1"> already in obs&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lineLabel</span><span class="p">),</span> <span class="n">calling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">addObs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">newObsIntens</span><span class="p">,</span> <span class="n">newObsError</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an observation (i.e. a list of intensities corresponding to a new object) to the existing set.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            name:            name of the new observation/object</span>
<span class="sd">            newObsIntens:    value(s) of the line intensities. Length must match Observation.n_lines</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">newObsIntens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">newObsIntens</span> <span class="o">=</span> <span class="p">[</span><span class="n">newObsIntens</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">newObsIntens</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_lines</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Length of observations to be added does not match n_lines = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_lines</span><span class="p">),</span>
                            <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Name </span><span class="si">{0}</span><span class="s1"> already exists&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">newObsError</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">line</span><span class="o">.</span><span class="n">addObs</span><span class="p">(</span><span class="n">newObsIntens</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">line</span><span class="o">.</span><span class="n">addObs</span><span class="p">(</span><span class="n">newObsIntens</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">newObsError</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">addSum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labelsToAdd</span><span class="p">,</span> <span class="n">newLabel</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a new observation. The intensity is the sum of the intensities of </span>
<span class="sd">        the lines defined by the tupple labelsToAdd. The error is the quadratic sum of the absolute errors.</span>


<span class="sd">        **Example:**</span>

<span class="sd">            addSum((&#39;O1r_7771A&#39;, &#39;O1r_7773A&#39;, &#39;O1r_7775A&#39;), &#39;O1r_7773A+&#39;, to_eval = &#39;S(&quot;7773+&quot;)&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">intenses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIntens</span><span class="p">(</span><span class="n">returnObs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getError</span><span class="p">(</span><span class="n">returnObs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">intenses</span><span class="p">[</span><span class="n">labelsToAdd</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">errors</span><span class="p">[</span><span class="n">labelsToAdd</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="n">I</span>


        <span class="n">atom</span> <span class="o">=</span> <span class="n">labelsToAdd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labelsToAdd</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="n">label</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">atom</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Can not add lines from different atoms </span><span class="si">{}</span><span class="s1"> and </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">label</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">atom</span><span class="p">))</span>
            <span class="n">I</span> <span class="o">+=</span> <span class="n">intenses</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
            <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">E</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">*</span><span class="n">I</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">to_eval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">to_eval</span> <span class="o">=</span> <span class="s1">&#39;S(&quot;</span><span class="si">{}</span><span class="s1">&quot;)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">newLabel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">E</span> <span class="o">/</span> <span class="n">I</span>
        <span class="n">newLine</span> <span class="o">=</span> <span class="n">EmissionLine</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">newLabel</span><span class="p">,</span> <span class="n">obsIntens</span><span class="o">=</span><span class="n">I</span><span class="p">,</span> <span class="n">obsError</span><span class="o">=</span><span class="n">E</span><span class="p">,</span> 
                                  <span class="n">corrected</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errIsRelative</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                  <span class="n">to_eval</span><span class="o">=</span><span class="n">to_eval</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">newLine</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">lineLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Property</span>
<span class="sd">        Array of labels of the lines </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">line</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">])</span>   

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">n_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Property</span>
<span class="sd">        Number of lines</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">n_valid_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Property</span>
<span class="sd">        Number of valid lines (i.e., lines with labels recognized by PyNeb)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">([</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">is_valid</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">n_obs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Property</span>
<span class="sd">        Number of observations. If the number of observations varies from one line to the other,</span>
<span class="sd">            returns the number of observations for each line as an array.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">l</span><span class="o">.</span><span class="n">obsIntens</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">n_obs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="n">n_obs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">n_obs</span>

        <span class="k">return</span> <span class="n">n_obs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">n_obs_origin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Property</span>
<span class="sd">        Number of observations which are not from MonteCarlo (i.e. without -MC- in the name)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">([</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="k">if</span> <span class="s1">&#39;-MC-&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">n</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the lines corresponding to elem-spec-wave or to the label.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">getLineLabel</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="n">blend</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="n">label</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
        <span class="n">n_lines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n_lines</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;No line for </span><span class="si">{0}</span><span class="s1"> from </span><span class="si">{1}{2}</span><span class="s1"> at wavelength </span><span class="si">{3}</span><span class="s1"> (blend=</span><span class="si">{4}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="n">blend</span><span class="p">),</span>
                           <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">n_lines</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">getSortedLines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crit</span><span class="o">=</span><span class="s1">&#39;atom&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of lines sorted by atoms or wavelengths.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            crit:   criterion to sort the line list (&#39;atom&#39; [default] or &#39;wave&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">crit</span> <span class="o">==</span> <span class="s1">&#39;atom&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">atom</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">wave</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">crit</span> <span class="o">==</span> <span class="s1">&#39;wave&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">wave</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">crit</span> <span class="o">==</span> <span class="s1">&#39;mass&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">elem</span><span class="p">],</span> <span class="n">line</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">wave</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;crit = </span><span class="si">{0}</span><span class="s1"> is not valid&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">crit</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">+</span> <span class="s1">&#39;.getSortedLines&#39;</span><span class="p">)</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">getUniqueAtoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a numpy.ndarray of the atoms of the observed lines. If an atom emits </span>
<span class="sd">        more than one line, it is returned only once (numpy.unique is applied </span>
<span class="sd">        to the list before returning).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">([</span><span class="n">l</span><span class="o">.</span><span class="n">atom</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">])</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">readData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obsFile</span><span class="p">,</span> <span class="n">fileFormat</span><span class="o">=</span><span class="s1">&#39;lines_in_cols&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">err_default</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> <span class="n">corrected</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">errIsRelative</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">errStr</span><span class="o">=</span><span class="s1">&#39;err&#39;</span><span class="p">,</span> <span class="n">Cutout2D_position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Cutout2D_size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read observational data from an ascii file. The lines can be listed either in columns or in rows</span>
<span class="sd">        and the observed objects vary in the other direction. The uncertainty on the line intensities</span>
<span class="sd">        can be read from the file, or a constant relative value can be assumed.</span>
<span class="sd">        The lines must be identified by a label in PyNeb&#39;s format ion_wave (e.g., &#39;O3_5007&#39;); the list of ions and</span>
<span class="sd">        corresponding wavelengths can also be found in pn.LINE_LABEL_LIST.</span>
<span class="sd">        The following optional fields may also be included (without quotes): &#39;NAME&#39; (object&#39;s name, in one string), </span>
<span class="sd">        &#39;E(B-V)&#39;, &#39;cHbeta&#39;, and &#39;e&#39; (observational error).</span>


<span class="sd">        Parameters:</span>
<span class="sd">            obsFile:        file containing the observations. May be a file object or a string.</span>
<span class="sd">                             If the fileFormat is &#39;fits_IFU&#39;, the obsFile keyword is of the form e.g.:</span>
<span class="sd">                             &#39;dir/ngc6778_MUSE_*.fits&#39; where * is of the form O3_5007A.</span>
<span class="sd">                             The associated error file must be named the same way, using errStr keyword value </span>
<span class="sd">                             e.g. dir/ngc6778_MUSE_O3_5007A_err.fits</span>
<span class="sd">            fileFormat:     emission lines vary across columns (&#39;lines_in_cols&#39;, default) or </span>
<span class="sd">                                across rows (&#39;lines_in_rows&#39;), or across rows with errors in columns </span>
<span class="sd">                                (&#39;lines_in_rows_err_cols&#39;) in which case the column label must start with &quot;err&quot;</span>

<span class="sd">                                The format may also be &#39;fits_IFU&#39;, in which case each emission line comes</span>
<span class="sd">                                from a different fits file</span>

<span class="sd">            delimiter:      field delimiter (default: None)  </span>
<span class="sd">            err_default:    default uncertainty on the line intensities</span>
<span class="sd">            corrected:      Boolean. True if the observed intensities are already corrected from extinction</span>
<span class="sd">                                 (default: False)</span>
<span class="sd">            errIsRelative:  Boolean. True if the errors are relative to the intensities, False if they</span>
<span class="sd">                                 are in the same unit as the intensity (default: False)</span>
<span class="sd">            errStr:         string to identify the error file in case the fileFormat is fits_IFU.</span>
<span class="sd">            Cutout2D_position: In case of reading fits images, crop the image to those pixel limits</span>
<span class="sd">            Cutout2D_size: In case of reading fits images, crop the image to those pixel limits</span>

<span class="sd">        &quot;&quot;&quot;</span>    
        <span class="n">format_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lines_in_cols&#39;</span><span class="p">,</span> <span class="s1">&#39;lines_in_cols2&#39;</span><span class="p">,</span> <span class="s1">&#39;lines_in_rows&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39;lines_in_rows_err_cols&#39;</span><span class="p">,</span> <span class="s1">&#39;fits_IFU&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">fileFormat</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">format_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;unknown format </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fileFormat</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;Observation.readData&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obsFile</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">and</span> <span class="n">fileFormat</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;fits_IFU&#39;</span><span class="p">,):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">obsFile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">closeAfterUse</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">obsFile</span>
            <span class="n">closeAfterUse</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">fileFormat</span> <span class="o">==</span> <span class="s1">&#39;lines_in_cols&#39;</span><span class="p">:</span>
            <span class="n">hdr</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">closeAfterUse</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
            <span class="n">data_tab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="n">dd</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">))])</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;NAME&#39;</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;cHbeta&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">extinction</span><span class="o">.</span><span class="n">cHbeta</span> <span class="o">=</span> <span class="n">data_tab</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;E(B-V)&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">extinction</span><span class="o">.</span><span class="n">E_BV</span> <span class="o">=</span> <span class="n">data_tab</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>         
                <span class="k">elif</span> <span class="n">label</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span>
                    <span class="n">intens</span> <span class="o">=</span> <span class="n">data_tab</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">i_error</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">label</span> <span class="o">+</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span>
                        <span class="n">error</span> <span class="o">=</span> <span class="n">data_tab</span><span class="p">[</span><span class="n">i_error</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">errIsRelative</span><span class="p">:</span>
                            <span class="n">error</span> <span class="o">=</span> <span class="n">quiet_divide</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">intens</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">addErrDefault</span><span class="p">:</span>
                            <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">err_default</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;No error found for line </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                        <span class="n">error</span> <span class="o">=</span> <span class="n">data_tab</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.</span> <span class="o">+</span> <span class="n">err_default</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">line2add</span> <span class="o">=</span> <span class="n">EmissionLine</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">obsIntens</span><span class="o">=</span><span class="n">intens</span><span class="p">,</span> <span class="n">obsError</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Unknown line label </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">line2add</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;adding line </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Impossible to add line&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fileFormat</span> <span class="o">==</span> <span class="s1">&#39;lines_in_cols2&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">closeAfterUse</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">data_tab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">obsFile</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">deletechars</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">data_tab</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;cHbeta&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">extinction</span><span class="o">.</span><span class="n">cHbeta</span> <span class="o">=</span> <span class="n">data_tab</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;E(B-V)&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">extinction</span><span class="o">.</span><span class="n">E_BV</span> <span class="o">=</span> <span class="n">data_tab</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;NAME&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_tab</span><span class="p">[</span><span class="n">label</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;NAME2&#39;</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">names2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_tab</span><span class="p">[</span><span class="n">label</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">n1</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">n2</span> <span class="k">for</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">,</span> <span class="n">names2</span><span class="p">)]</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">elif</span> <span class="n">label</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">data_tab</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">:</span>
                        <span class="n">intens</span> <span class="o">=</span> <span class="n">data_tab</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">error</span> <span class="o">=</span> <span class="n">data_tab</span><span class="p">[</span><span class="n">label</span> <span class="o">+</span> <span class="s1">&#39;e&#39;</span><span class="p">]</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">errIsRelative</span><span class="p">:</span>
                                <span class="n">error</span> <span class="o">=</span> <span class="n">error</span> <span class="o">/</span> <span class="n">intens</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">addErrDefault</span><span class="p">:</span>
                                <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">err_default</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;No error found for line </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                            <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">data_tab</span><span class="p">[</span><span class="n">label</span><span class="p">])</span> <span class="o">*</span> <span class="n">err_default</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">line2add</span> <span class="o">=</span> <span class="n">EmissionLine</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">obsIntens</span><span class="o">=</span><span class="n">intens</span><span class="p">,</span> <span class="n">obsError</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;unkown line label </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">intens</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">line2add</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;adding line </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Impossible to add line&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">intens</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Skipped </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">fileFormat</span> <span class="o">==</span> <span class="s1">&#39;lines_in_rows&#39;</span><span class="p">:</span>
            <span class="n">hdr</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span>  <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">closeAfterUse</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">data_tab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="n">dd</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">))])</span>
            <span class="n">data_tab</span> <span class="o">=</span> <span class="n">data_tab</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;cHbeta&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">extinction</span><span class="o">.</span><span class="n">cHbeta</span> <span class="o">=</span> <span class="n">data_tab</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;E(B-V)&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">extinction</span><span class="o">.</span><span class="n">E_BV</span> <span class="o">=</span> <span class="n">data_tab</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">label</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span>
                    <span class="n">intens</span> <span class="o">=</span> <span class="n">data_tab</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">i_error</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">label</span> <span class="o">+</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span>
                        <span class="n">error</span> <span class="o">=</span> <span class="n">data_tab</span><span class="p">[:,</span> <span class="n">i_error</span><span class="p">]</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">errIsRelative</span><span class="p">:</span>
                            <span class="n">error</span> <span class="o">=</span> <span class="n">error</span> <span class="o">/</span> <span class="n">intens</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">addErrDefault</span><span class="p">:</span>
                            <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">err_default</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;No error found for line </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                        <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">data_tab</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">err_default</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">line2add</span> <span class="o">=</span> <span class="n">EmissionLine</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">obsIntens</span><span class="o">=</span><span class="n">intens</span><span class="p">,</span> <span class="n">obsError</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;unkown line label </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">intens</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">line2add</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;adding line </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Impossible to add line&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">intens</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">fileFormat</span> <span class="o">==</span> <span class="s1">&#39;lines_in_rows_err_cols&#39;</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">closeAfterUse</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="n">data_tab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">obsFile</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data_tab</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">::]</span> <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;err&#39;</span><span class="p">]</span>
            <span class="n">error_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data_tab</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;err&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">error_names</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Number of columns for intensities &lt;&gt; number of columns for errors </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">,</span>
                                                                                                                 <span class="n">error_names</span><span class="p">),</span>
                              <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="c1">#names_locations = [name in self.names for name in data_tab.dtype.names]</span>
            <span class="c1">#errors_locations = [name[0:3] == &#39;err&#39; for name in data_tab.dtype.names]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_tab</span><span class="p">[</span><span class="s1">&#39;LINE&#39;</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;cHbeta&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">extinction</span><span class="o">.</span><span class="n">cHbeta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">data_tab</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;E(B-V)&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">extinction</span><span class="o">.</span><span class="n">E_BV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">data_tab</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">intens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">data_tab</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">])</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">data_tab</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">error_names</span><span class="p">])</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">errIsRelative</span><span class="p">:</span>
                        <span class="n">error</span> <span class="o">=</span> <span class="n">error</span> <span class="o">/</span> <span class="n">intens</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">addErrDefault</span><span class="p">:</span>
                        <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">err_default</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">line2add</span> <span class="o">=</span> <span class="n">EmissionLine</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">obsIntens</span><span class="o">=</span><span class="n">intens</span><span class="p">,</span> <span class="n">obsError</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;unkown line label </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">intens</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">line2add</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;adding line </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Impossible to add line&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">intens</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">fileFormat</span> <span class="o">==</span> <span class="s1">&#39;fits_IFU&#39;</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">obsFile</span><span class="p">)</span>
            <span class="n">dir_</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">parent</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">name</span>
            <span class="n">files</span> <span class="o">=</span> <span class="n">dir_</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;path: </span><span class="si">{}</span><span class="s1">, dir_: </span><span class="si">{}</span><span class="s1">, pattern: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">dir_</span><span class="p">,</span> <span class="n">pattern</span><span class="p">),</span>
                            <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;Observation.readData&#39;</span><span class="p">)</span>
            <span class="n">str1</span><span class="p">,</span> <span class="n">str2</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">obs_file</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s1">&#39;.fits&#39;</span> <span class="ow">and</span> <span class="n">errStr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">obs_file</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;analysing </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;Observation.readData&#39;</span><span class="p">)</span>
                    <span class="n">lineID</span> <span class="o">=</span> <span class="n">strExtract</span><span class="p">(</span><span class="n">obs_file</span><span class="p">,</span> <span class="n">str1</span><span class="p">,</span> <span class="n">str2</span><span class="p">)</span>
                    <span class="n">spl</span> <span class="o">=</span> <span class="n">lineID</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spl</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">atom</span> <span class="o">=</span> <span class="n">spl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">spl</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">LINE_LABEL_LIST</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;Reading </span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1"> from </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">atom</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                                              <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;Observation.readData&#39;</span><span class="p">)</span>
                            <span class="n">fits_hdu</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">f</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">fits_data</span> <span class="o">=</span> <span class="n">fits_hdu</span><span class="o">.</span><span class="n">data</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">origin_fits_shape</span> <span class="o">=</span> <span class="n">fits_data</span><span class="o">.</span><span class="n">shape</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">fits_header</span> <span class="o">=</span> <span class="n">fits_hdu</span><span class="o">.</span><span class="n">header</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">wcs</span> <span class="o">=</span> <span class="n">WCS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fits_header</span><span class="p">)</span><span class="o">.</span><span class="n">celestial</span>
                            <span class="k">if</span> <span class="n">Cutout2D_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Cutout2D applied to data shape </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fits_data</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
                                                <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;Observation.readData&#39;</span><span class="p">)</span>
                                <span class="n">C2D</span> <span class="o">=</span> <span class="n">Cutout2D</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">fits_data</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">Cutout2D_position</span><span class="p">,</span> 
                                               <span class="n">size</span><span class="o">=</span><span class="n">Cutout2D_size</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="n">WCS</span><span class="p">(</span><span class="n">fits_hdu</span><span class="o">.</span><span class="n">header</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;trim&#39;</span><span class="p">,</span>
                                               <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                                <span class="n">fits_data</span> <span class="o">=</span> <span class="n">C2D</span><span class="o">.</span><span class="n">data</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">wcs</span> <span class="o">=</span> <span class="n">C2D</span><span class="o">.</span><span class="n">wcs</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fits_shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">fits_shape</span> <span class="o">=</span> <span class="n">fits_data</span><span class="o">.</span><span class="n">shape</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">fits_data</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fits_shape</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;data shape in file </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">. Previous shape was </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                                    <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">fits_data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fits_shape</span><span class="p">))</span>
                            <span class="n">fits_data</span> <span class="o">=</span> <span class="n">fits_data</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                            <span class="n">err_file</span> <span class="o">=</span> <span class="n">dir_</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">stem</span><span class="o">+</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">errStr</span> <span class="o">+</span> <span class="s1">&#39;.fits&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">err_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;Reading error </span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1"> from </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">atom</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">err_file</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                                                  <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;Observation.readData&#39;</span><span class="p">)</span>
                                <span class="n">err_fits_hdu</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">err_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                                <span class="k">if</span> <span class="n">err_fits_hdu</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_fits_shape</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;error shape in file </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">. data shape is </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                                    <span class="n">err_file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">err_fits_hdu</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fits_shape</span><span class="p">))</span>
                                <span class="n">err_fits_data</span> <span class="o">=</span> <span class="n">err_fits_hdu</span><span class="o">.</span><span class="n">data</span>
                                <span class="k">if</span> <span class="n">Cutout2D_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="n">C2D</span> <span class="o">=</span> <span class="n">Cutout2D</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">err_fits_data</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">Cutout2D_position</span><span class="p">,</span> 
                                                   <span class="n">size</span><span class="o">=</span><span class="n">Cutout2D_size</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;trim&#39;</span><span class="p">,</span>
                                                   <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                                    <span class="n">err_fits_data</span> <span class="o">=</span> <span class="n">C2D</span><span class="o">.</span><span class="n">data</span>
                                <span class="n">err_fits_data</span> <span class="o">=</span> <span class="n">err_fits_data</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="n">errIsRelative</span><span class="p">:</span>
                                    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
                                        <span class="n">err_fits_data</span> <span class="o">=</span> <span class="n">err_fits_data</span> <span class="o">/</span> <span class="n">fits_data</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">addErrDefault</span><span class="p">:</span>
                                    <span class="n">err_fits_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">err_fits_data</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">err_default</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;No error file found for </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                                                  <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;Observation.readData&#39;</span><span class="p">)</span>                                
                                <span class="n">err_fits_data</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">fits_data</span><span class="p">)</span> <span class="o">*</span> <span class="n">err_default</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">EmissionLine</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">lineID</span><span class="p">,</span>
                                                      <span class="n">obsIntens</span><span class="o">=</span><span class="n">fits_data</span><span class="p">,</span> 
                                                      <span class="n">obsError</span><span class="o">=</span><span class="n">err_fits_data</span><span class="p">,</span> 
                                                      <span class="n">corrected</span><span class="o">=</span><span class="n">corrected</span><span class="p">,</span> <span class="n">errIsRelative</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;atom </span><span class="si">{}</span><span class="s1"> not in LINE_LABEL_LIST&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">atom</span><span class="p">),</span> 
                                            <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;Observation.readData&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">str1</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_obs</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fits_shape</span>

        <span class="k">if</span> <span class="n">corrected</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">correctData</span><span class="p">()</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">getIntens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">returnObs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">obsName</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the line intensities in form of a dictionary with line labels as keys.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            returnObs (bool):  If False (default), prints the corrected values. </span>
<span class="sd">                            If True, prints the observed value. </span>
<span class="sd">            obsName:    name of an observation. If not set or None, all the observations are printed</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">obsName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obsName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                <span class="n">obsIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">obsName</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Name </span><span class="si">{}</span><span class="s1"> is not an Observation name&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obsName</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obsIndex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_obs</span><span class="p">)</span>
        <span class="n">to_return</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">returnObs</span><span class="p">:</span>
                <span class="n">to_return</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">obsIntens</span><span class="p">[</span><span class="n">obsIndex</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">to_return</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">corrIntens</span><span class="p">[</span><span class="n">obsIndex</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">to_return</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">getError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">returnObs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">obsName</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the line intensity error in form of a dictionary with line labels as keys.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            returnObs:  if False (default), prints the corrected values. </span>
<span class="sd">                            If True, prints the observed value. </span>
<span class="sd">            obsName:    name of an observation. If not set or None, all the observations are printed</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">obsName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obsName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                <span class="n">obsIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">obsName</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Name </span><span class="si">{}</span><span class="s1"> is not an Observation name&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obsName</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obsIndex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_obs</span><span class="p">)</span>
        <span class="n">to_return</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">returnObs</span><span class="p">:</span>
                <span class="n">to_return</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">obsError</span><span class="p">[</span><span class="n">obsIndex</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">to_return</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">corrError</span><span class="p">[</span><span class="n">obsIndex</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">to_return</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">printIntens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">returnObs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">obsName</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print the line intensities.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            returnObs:   if False (default), prints the corrected values. </span>
<span class="sd">                            If True, prints the observed value. </span>
<span class="sd">            obsName:     name of an observation. Is unset or None, all the observations are printed</span>

<span class="sd">        &quot;&quot;&quot;</span>    
        <span class="k">if</span> <span class="n">obsName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obsName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                <span class="n">obsIndex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">obsName</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Name </span><span class="si">{}</span><span class="s1"> is not an Observation name&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obsName</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obsIndex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_obs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">corrIntens</span><span class="p">[</span><span class="n">obsIndex</span><span class="p">],</span> <span class="nb">float</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">returnObs</span><span class="p">:</span>
                    <span class="n">to_print</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">line</span><span class="o">.</span><span class="n">obsIntens</span><span class="p">[</span><span class="n">obsIndex</span><span class="p">],))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">to_print</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">line</span><span class="o">.</span><span class="n">corrIntens</span><span class="p">[</span><span class="n">obsIndex</span><span class="p">],))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">returnObs</span><span class="p">:</span>
                    <span class="n">to_print</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">obsIntens</span><span class="p">[</span><span class="n">obsIndex</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">to_print</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">corrIntens</span><span class="p">[</span><span class="n">obsIndex</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">returnObs</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">label</span><span class="p">),</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;</span><span class="si">{:8.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">to_print</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">label</span><span class="p">),</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;</span><span class="si">{:8.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">to_print</span><span class="p">)))</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">def_EBV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label1</span><span class="o">=</span><span class="s2">&quot;H1r_6563A&quot;</span><span class="p">,</span> <span class="n">label2</span><span class="o">=</span><span class="s2">&quot;H1r_4861A&quot;</span><span class="p">,</span> <span class="n">r_theo</span><span class="o">=</span><span class="mf">2.85</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define the extinction parameter using the ratio of 2 lines.</span>
<span class="sd">        Calls extinction.setCorr to set the EBV and cHbeta according to the parameters.</span>
<span class="sd">        Once this is done, one may call correctData to compute the EmissionLine.corrIntens</span>

<span class="sd">        Parameters:</span>
<span class="sd">            label1: [EmissionLine.label] observed line whose intensities are used </span>
<span class="sd">            label2: [EmissionLine.label] observed line whose intensities are used</span>
<span class="sd">            r_theo [float] theoretical line ratio</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">line1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLine</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label1</span><span class="p">)</span>
        <span class="n">line2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLine</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">line1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> is not a valid label or is not observed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line1</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">line2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> is not a valid label or is not observed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line2</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
            <span class="n">obs_over_theo</span> <span class="o">=</span> <span class="p">(</span><span class="n">line1</span><span class="o">.</span><span class="n">obsIntens</span> <span class="o">/</span> <span class="n">line2</span><span class="o">.</span><span class="n">obsIntens</span><span class="p">)</span> <span class="o">/</span> <span class="n">r_theo</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">extinction</span><span class="o">.</span><span class="n">setCorr</span><span class="p">(</span><span class="n">obs_over_theo</span><span class="p">,</span> <span class="n">line1</span><span class="o">.</span><span class="n">wave</span><span class="p">,</span> <span class="n">line2</span><span class="o">.</span><span class="n">wave</span><span class="p">)</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">__normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;H1_4861A&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Normalize the line intensities to a reference line (Hbeta by default).</span>
<span class="sd">        Not yet implemented</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;=&quot;</span> <span class="ow">in</span> <span class="n">label</span><span class="p">:</span>
            <span class="n">line_label</span><span class="p">,</span> <span class="n">factor</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">line_label</span> <span class="o">=</span> <span class="n">label</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="n">line_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLine</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">line_label</span><span class="p">)</span> 
        <span class="k">if</span> <span class="n">line_norm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;No normalization possible as </span><span class="si">{0}</span><span class="s1"> not found&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line_label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="n">line</span><span class="o">.</span><span class="n">_obsIntens_n</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">obsIntens</span> <span class="o">/</span> <span class="p">(</span><span class="n">line_norm</span><span class="o">.</span><span class="n">obsIntens</span> <span class="o">*</span> <span class="n">factor</span><span class="p">)</span>
            <span class="n">line</span><span class="o">.</span><span class="n">_unit</span> <span class="o">=</span> <span class="n">line_label</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">correctData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normWave</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Correct the line intensities with the correction computed with the RedCorr class (extinction.py)</span>
<span class="sd">        The result is stored in line.corrIntens (corrected intensity in absolute units).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">correctData</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">normWave</span><span class="o">=</span><span class="n">normWave</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">EmissionLine</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Trying to correct something that is not a line&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>  
            <span class="n">line</span><span class="o">.</span><span class="n">correctIntens</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extinction</span><span class="p">,</span> <span class="n">normWave</span><span class="o">=</span><span class="n">normWave</span><span class="p">)</span>

<span class="w">            </span><span class="sd">&quot;&quot;&quot;            </span>
<span class="sd">            # the following is commented for now, we&#39;ll see latter how to implement normalized intensities.</span>
<span class="sd">            if line._unit is not None:</span>
<span class="sd">                try:</span>
<span class="sd">                    line_norm = self.getLine(label=line._unit)</span>
<span class="sd">                    line._corrIntens_n = line.obsIntens_n * self.extinction.getCorr(line.wave, line_norm.wave)</span>
<span class="sd">                except:</span>
<span class="sd">                    log_.warn(&#39;No normalized correction for {0}&#39;.format(line), calling=&#39;Observation.correctData&#39;)</span>
<span class="sd">                    line._corrIntens_n = None</span>
<span class="sd">            &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">setAllErrors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">err_default</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the relative uncertainty of all emission lines to a common constant value</span>

<span class="sd">        Parameters:</span>
<span class="sd">            err_default:     default value of the relative uncertainty</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="n">line</span><span class="o">.</span><span class="n">obs_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">obs_err</span><span class="p">)</span> <span class="o">*</span> <span class="n">err_default</span>



    <span class="k">def</span><span class="w"> </span><span class="nf">addMonteCarloObs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">i_obs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adding MonteCarlo random-gauss values of fake observations to an obs object.</span>
<span class="sd">        The names of the fake observations will be OriginalName-MC-n, n ranging from 0 to N-1</span>

<span class="sd">        Parameters:</span>
<span class="sd">            N: number of new observations to be added for each original observation.</span>
<span class="sd">            i_obs: used in case only a given observations needs to be treated</span>
<span class="sd">            random_seed: [default] used to initialize the numpy random generator</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">MC_added</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Monte Carlo already applied to this observation&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;addMonteCarloObs&#39;</span><span class="p">)</span>
        <span class="n">n_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_lines</span>
        <span class="n">n_obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_obs</span>
        <span class="k">if</span> <span class="n">i_obs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;Entering&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;addMonteCarloObs&#39;</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">random_seed</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
                <span class="n">l_ori</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">obsIntens</span>
                <span class="n">e_ori</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">obsError</span>
                <span class="n">l_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">l_ori</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">e_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">e_ori</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">l_new</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                <span class="n">l_new</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">e_new</span> <span class="o">*</span> <span class="n">norm</span><span class="p">)</span>
                <span class="n">l_new</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">l_ori</span>
                <span class="n">l</span><span class="o">.</span><span class="n">obsIntens</span> <span class="o">=</span> <span class="n">l_new</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">l</span><span class="o">.</span><span class="n">obsError</span> <span class="o">=</span> <span class="n">e_new</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">corrected</span><span class="p">:</span>
                    <span class="n">l</span><span class="o">.</span><span class="n">corrIntens</span> <span class="o">=</span> <span class="n">l_new</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                    <span class="n">l</span><span class="o">.</span><span class="n">corrError</span> <span class="o">=</span> <span class="n">e_new</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Adding MC to </span><span class="si">{}</span><span class="s1">. </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">l_new</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> 
                                                                      <span class="n">l_new</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> 
                                                                      <span class="n">l</span><span class="o">.</span><span class="n">obsIntens</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                                                                      <span class="n">l</span><span class="o">.</span><span class="n">corrIntens</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> 
                                <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;addMonteCarloObs&#39;</span><span class="p">)</span>
            <span class="n">new_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">MC_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="s1">&#39;-MC-</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
            <span class="n">MC_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">defchararray</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_names</span> <span class="p">,</span> <span class="n">MC_names</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;Leaving&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;addMonteCarloObs&#39;</span><span class="p">)</span>        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">corrected</span><span class="p">:</span>
                <span class="n">returnObs</span><span class="o">=</span><span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">returnObs</span><span class="o">=</span><span class="kc">True</span>
            <span class="n">intens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">getIntens</span><span class="p">(</span><span class="n">returnObs</span><span class="o">=</span><span class="n">returnObs</span><span class="p">)[</span><span class="n">label</span><span class="p">]</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineLabels</span><span class="p">])[:,</span><span class="n">i_obs</span><span class="p">]</span> <span class="c1"># n_lines</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">getError</span><span class="p">(</span><span class="n">returnObs</span><span class="o">=</span><span class="n">returnObs</span><span class="p">)[</span><span class="n">label</span><span class="p">]</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineLabels</span><span class="p">])[:,</span><span class="n">i_obs</span><span class="p">]</span>
            <span class="n">all_new_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">n_lines</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                <span class="n">new_obs</span> <span class="o">=</span> <span class="n">intens</span> <span class="o">*</span> <span class="p">(</span><span class="n">all_new_obs</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">*</span> <span class="n">error</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">new_obs</span><span class="p">[</span><span class="n">new_obs</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addObs</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">-MC-</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i_obs</span><span class="p">],</span> <span class="n">i</span><span class="p">),</span> <span class="n">new_obs</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MC_added</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N_MC</span> <span class="o">=</span> <span class="n">N</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fits_shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>    
            <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fits_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">fits_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_MC</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N_MC</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">reshape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return data in shape of the original data (use with fits IFUs and/or MC)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="pyneb.core.pynebcore.Observation.lineLabels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">lineLabels</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Property
Array of labels of the lines</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="pyneb.core.pynebcore.Observation.n_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_lines</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Property
Number of lines</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="pyneb.core.pynebcore.Observation.n_obs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_obs</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Property
Number of observations. If the number of observations varies from one line to the other,
    returns the number of observations for each line as an array.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="pyneb.core.pynebcore.Observation.n_obs_origin" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_obs_origin</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Property
Number of observations which are not from MonteCarlo (i.e. without -MC- in the name)</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="pyneb.core.pynebcore.Observation.n_valid_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_valid_lines</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Property
Number of valid lines (i.e., lines with labels recognized by PyNeb)</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Observation.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">obsFile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fileFormat</span><span class="o">=</span><span class="s1">&#39;lines_in_cols&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">err_default</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">corrected</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errIsRelative</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">correcLaw</span><span class="o">=</span><span class="s1">&#39;F99&#39;</span><span class="p">,</span> <span class="n">errStr</span><span class="o">=</span><span class="s1">&#39;err&#39;</span><span class="p">,</span> <span class="n">addErrDefault</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">Cutout2D_position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Cutout2D_size</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Define the observation object, which is a collection of observated intensities of one or more
emission lines for one or more objects, with the corresponding errors.
The observed intensities are read from a file or filled in by the addLine method.
Includes an extinction correction object (pyneb.RedCorr) as Observation.extinction.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>obsFile</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the file containing the observations. May be a file object or a file name 
             If the fileFormat is 'fits_IFU', the obsFile keyword is of the form e.g.:
             'dir/ngc6778_MUSE_*.fits' where * is of the form O3_5007A.
             The associated error file must be named the same way, using errStr keyword value 
             e.g. dir/ngc6778_MUSE_O3_5007A_err.fits</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fileFormat</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>format of the data file, depending on how the wavelengths are ordered.
            Available formats are :
            - 'lines_in_cols' : Each object is on a different row. Each column corresponds to a given emission line. 
               Line labels with tailing "e" are for errors on line intensities.
            - 'lines_in_cols2' : Each object is on a different row. Same as 'lines_in_cols' but using genfromtxt to read the file.
               Allows undefined values.
            - 'lines_in_rows' : Each object is on a different column. Each row corresponds to a given emission line.
            - 'lines_in_rows_err_cols' : Each object is on a different column. Each row corresponds to a given emission line. 
               For each object (eg. "IC418"), an additional column (named eg "errIC418") contains the errors on the line intensities.
            - 'fits_IFU': each emission line is stored into a fits file</p>
              </div>
            </td>
            <td>
                  <code>&#39;lines_in_cols&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>delimiter</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>character separating entries </p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>err_default</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>[0.10] default uncertainty assumed on intensities. Will overwrite the error from the file.</p>
              </div>
            </td>
            <td>
                  <code>0.1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>corrected</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Boolean. True if the observed intensities are already corrected from extinction
                (default: False)</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>errIsRelative</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Boolean. True if the errors are relative to the intensities, False if they
                are in the same unit as the intensity (default: True)</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>correcLaw</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>['F99'] extinction law used to correct the observed lines.</p>
              </div>
            </td>
            <td>
                  <code>&#39;F99&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>errStr</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>String used to identify error file when fileFormat is fits_IFU</p>
              </div>
            </td>
            <td>
                  <code>&#39;err&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>addErrDefault</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if True, the default error is always quadratically added to the read error.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>Cutout2D_position</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>Cutout2D_size</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>In case of reading fits images, crop the image to those pixel limits</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Example:</strong></p>
<p>Read a file containing corrected intensities:</p>
<pre><code>obs = pn.Observation('obs.dat', corrected = True)
</code></pre>
<p>To obtain a dictionary with the observed  corrected intensities:</p>
<pre><code>i_cor = {label: obs.getLine(label = label).corrIntens for label in obs.lineLabels}
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4562</span>
<span class="normal">4563</span>
<span class="normal">4564</span>
<span class="normal">4565</span>
<span class="normal">4566</span>
<span class="normal">4567</span>
<span class="normal">4568</span>
<span class="normal">4569</span>
<span class="normal">4570</span>
<span class="normal">4571</span>
<span class="normal">4572</span>
<span class="normal">4573</span>
<span class="normal">4574</span>
<span class="normal">4575</span>
<span class="normal">4576</span>
<span class="normal">4577</span>
<span class="normal">4578</span>
<span class="normal">4579</span>
<span class="normal">4580</span>
<span class="normal">4581</span>
<span class="normal">4582</span>
<span class="normal">4583</span>
<span class="normal">4584</span>
<span class="normal">4585</span>
<span class="normal">4586</span>
<span class="normal">4587</span>
<span class="normal">4588</span>
<span class="normal">4589</span>
<span class="normal">4590</span>
<span class="normal">4591</span>
<span class="normal">4592</span>
<span class="normal">4593</span>
<span class="normal">4594</span>
<span class="normal">4595</span>
<span class="normal">4596</span>
<span class="normal">4597</span>
<span class="normal">4598</span>
<span class="normal">4599</span>
<span class="normal">4600</span>
<span class="normal">4601</span>
<span class="normal">4602</span>
<span class="normal">4603</span>
<span class="normal">4604</span>
<span class="normal">4605</span>
<span class="normal">4606</span>
<span class="normal">4607</span>
<span class="normal">4608</span>
<span class="normal">4609</span>
<span class="normal">4610</span>
<span class="normal">4611</span>
<span class="normal">4612</span>
<span class="normal">4613</span>
<span class="normal">4614</span>
<span class="normal">4615</span>
<span class="normal">4616</span>
<span class="normal">4617</span>
<span class="normal">4618</span>
<span class="normal">4619</span>
<span class="normal">4620</span>
<span class="normal">4621</span>
<span class="normal">4622</span>
<span class="normal">4623</span>
<span class="normal">4624</span>
<span class="normal">4625</span>
<span class="normal">4626</span>
<span class="normal">4627</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obsFile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fileFormat</span><span class="o">=</span><span class="s1">&#39;lines_in_cols&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">err_default</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span>
             <span class="n">corrected</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errIsRelative</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">correcLaw</span><span class="o">=</span><span class="s1">&#39;F99&#39;</span><span class="p">,</span> <span class="n">errStr</span><span class="o">=</span><span class="s1">&#39;err&#39;</span><span class="p">,</span>
             <span class="n">addErrDefault</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">Cutout2D_position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Cutout2D_size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define the observation object, which is a collection of observated intensities of one or more</span>
<span class="sd">    emission lines for one or more objects, with the corresponding errors.</span>
<span class="sd">    The observed intensities are read from a file or filled in by the addLine method.</span>
<span class="sd">    Includes an extinction correction object (pyneb.RedCorr) as Observation.extinction.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        obsFile:       name of the file containing the observations. May be a file object or a file name </span>
<span class="sd">                         If the fileFormat is &#39;fits_IFU&#39;, the obsFile keyword is of the form e.g.:</span>
<span class="sd">                         &#39;dir/ngc6778_MUSE_*.fits&#39; where * is of the form O3_5007A.</span>
<span class="sd">                         The associated error file must be named the same way, using errStr keyword value </span>
<span class="sd">                         e.g. dir/ngc6778_MUSE_O3_5007A_err.fits</span>
<span class="sd">        fileFormat:    format of the data file, depending on how the wavelengths are ordered.</span>
<span class="sd">                        Available formats are :</span>
<span class="sd">                        - &#39;lines_in_cols&#39; : Each object is on a different row. Each column corresponds to a given emission line. </span>
<span class="sd">                           Line labels with tailing &quot;e&quot; are for errors on line intensities.</span>
<span class="sd">                        - &#39;lines_in_cols2&#39; : Each object is on a different row. Same as &#39;lines_in_cols&#39; but using genfromtxt to read the file.</span>
<span class="sd">                           Allows undefined values.</span>
<span class="sd">                        - &#39;lines_in_rows&#39; : Each object is on a different column. Each row corresponds to a given emission line.</span>
<span class="sd">                        - &#39;lines_in_rows_err_cols&#39; : Each object is on a different column. Each row corresponds to a given emission line. </span>
<span class="sd">                           For each object (eg. &quot;IC418&quot;), an additional column (named eg &quot;errIC418&quot;) contains the errors on the line intensities.</span>
<span class="sd">                        - &#39;fits_IFU&#39;: each emission line is stored into a fits file</span>
<span class="sd">        delimiter:     character separating entries </span>
<span class="sd">        err_default:   [0.10] default uncertainty assumed on intensities. Will overwrite the error from the file.</span>
<span class="sd">        corrected:     Boolean. True if the observed intensities are already corrected from extinction</span>
<span class="sd">                            (default: False)</span>
<span class="sd">        errIsRelative: Boolean. True if the errors are relative to the intensities, False if they</span>
<span class="sd">                            are in the same unit as the intensity (default: True)</span>
<span class="sd">        correcLaw:   [&#39;F99&#39;] extinction law used to correct the observed lines.</span>
<span class="sd">        errStr (str):        String used to identify error file when fileFormat is fits_IFU</span>
<span class="sd">        addErrDefault: if True, the default error is always quadratically added to the read error.</span>
<span class="sd">        Cutout2D_position:</span>
<span class="sd">        Cutout2D_size: In case of reading fits images, crop the image to those pixel limits</span>

<span class="sd">    **Example:**</span>

<span class="sd">    Read a file containing corrected intensities:</span>

<span class="sd">        obs = pn.Observation(&#39;obs.dat&#39;, corrected = True)</span>

<span class="sd">    To obtain a dictionary with the observed  corrected intensities:</span>

<span class="sd">        i_cor = {label: obs.getLine(label = label).corrIntens for label in obs.lineLabels}</span>

<span class="sd">    &quot;&quot;&quot;</span>        
    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span> <span class="o">=</span> <span class="n">log_</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">=</span> <span class="s1">&#39;Observation&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">extinction</span> <span class="o">=</span> <span class="n">RedCorr</span><span class="p">(</span><span class="n">law</span><span class="o">=</span><span class="n">correcLaw</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">corrected</span> <span class="o">=</span> <span class="n">corrected</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">addErrDefault</span> <span class="o">=</span> <span class="n">addErrDefault</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">MC_added</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">N_MC</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fits_shape</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">corrected</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extinction</span><span class="o">.</span><span class="n">law</span> <span class="o">=</span> <span class="s1">&#39;No correction&#39;</span>
    <span class="k">if</span> <span class="n">obsFile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readData</span><span class="p">(</span><span class="n">obsFile</span><span class="o">=</span><span class="n">obsFile</span><span class="p">,</span> <span class="n">fileFormat</span><span class="o">=</span><span class="n">fileFormat</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span>
                      <span class="n">err_default</span><span class="o">=</span><span class="n">err_default</span><span class="p">,</span> <span class="n">corrected</span><span class="o">=</span><span class="n">corrected</span><span class="p">,</span> <span class="n">errIsRelative</span><span class="o">=</span><span class="n">errIsRelative</span><span class="p">,</span>
                      <span class="n">errStr</span><span class="o">=</span><span class="n">errStr</span><span class="p">,</span> 
                      <span class="n">Cutout2D_position</span><span class="o">=</span><span class="n">Cutout2D_position</span><span class="p">,</span> <span class="n">Cutout2D_size</span><span class="o">=</span><span class="n">Cutout2D_size</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Observation.__normalize" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__normalize</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;H1_4861A&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Normalize the line intensities to a reference line (Hbeta by default).
Not yet implemented</p>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5236</span>
<span class="normal">5237</span>
<span class="normal">5238</span>
<span class="normal">5239</span>
<span class="normal">5240</span>
<span class="normal">5241</span>
<span class="normal">5242</span>
<span class="normal">5243</span>
<span class="normal">5244</span>
<span class="normal">5245</span>
<span class="normal">5246</span>
<span class="normal">5247</span>
<span class="normal">5248</span>
<span class="normal">5249</span>
<span class="normal">5250</span>
<span class="normal">5251</span>
<span class="normal">5252</span>
<span class="normal">5253</span>
<span class="normal">5254</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;H1_4861A&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalize the line intensities to a reference line (Hbeta by default).</span>
<span class="sd">    Not yet implemented</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;=&quot;</span> <span class="ow">in</span> <span class="n">label</span><span class="p">:</span>
        <span class="n">line_label</span><span class="p">,</span> <span class="n">factor</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">line_label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="n">line_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLine</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">line_label</span><span class="p">)</span> 
    <span class="k">if</span> <span class="n">line_norm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;No normalization possible as </span><span class="si">{0}</span><span class="s1"> not found&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line_label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
        <span class="n">line</span><span class="o">.</span><span class="n">_obsIntens_n</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">obsIntens</span> <span class="o">/</span> <span class="p">(</span><span class="n">line_norm</span><span class="o">.</span><span class="n">obsIntens</span> <span class="o">*</span> <span class="n">factor</span><span class="p">)</span>
        <span class="n">line</span><span class="o">.</span><span class="n">_unit</span> <span class="o">=</span> <span class="n">line_label</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Observation.addLine" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">addLine</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Add a line to an existing observation</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>line</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the selected emission line (an instance of EmissionLine)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4635</span>
<span class="normal">4636</span>
<span class="normal">4637</span>
<span class="normal">4638</span>
<span class="normal">4639</span>
<span class="normal">4640</span>
<span class="normal">4641</span>
<span class="normal">4642</span>
<span class="normal">4643</span>
<span class="normal">4644</span>
<span class="normal">4645</span>
<span class="normal">4646</span>
<span class="normal">4647</span>
<span class="normal">4648</span>
<span class="normal">4649</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">addLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a line to an existing observation</span>

<span class="sd">    Parameters:</span>
<span class="sd">        line:    the selected emission line (an instance of EmissionLine)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">EmissionLine</span><span class="p">):</span>            
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Trying to add an inappropriate record to observations&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">corrected</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">corrected</span><span class="p">:</span>
        <span class="n">line</span><span class="o">.</span><span class="n">corrected</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">correctData</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Observation.addMonteCarloObs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">addMonteCarloObs</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">i_obs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Adding MonteCarlo random-gauss values of fake observations to an obs object.
The names of the fake observations will be OriginalName-MC-n, n ranging from 0 to N-1</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>N</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of new observations to be added for each original observation.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>i_obs</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>used in case only a given observations needs to be treated</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>random_seed</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>[default] used to initialize the numpy random generator</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5298</span>
<span class="normal">5299</span>
<span class="normal">5300</span>
<span class="normal">5301</span>
<span class="normal">5302</span>
<span class="normal">5303</span>
<span class="normal">5304</span>
<span class="normal">5305</span>
<span class="normal">5306</span>
<span class="normal">5307</span>
<span class="normal">5308</span>
<span class="normal">5309</span>
<span class="normal">5310</span>
<span class="normal">5311</span>
<span class="normal">5312</span>
<span class="normal">5313</span>
<span class="normal">5314</span>
<span class="normal">5315</span>
<span class="normal">5316</span>
<span class="normal">5317</span>
<span class="normal">5318</span>
<span class="normal">5319</span>
<span class="normal">5320</span>
<span class="normal">5321</span>
<span class="normal">5322</span>
<span class="normal">5323</span>
<span class="normal">5324</span>
<span class="normal">5325</span>
<span class="normal">5326</span>
<span class="normal">5327</span>
<span class="normal">5328</span>
<span class="normal">5329</span>
<span class="normal">5330</span>
<span class="normal">5331</span>
<span class="normal">5332</span>
<span class="normal">5333</span>
<span class="normal">5334</span>
<span class="normal">5335</span>
<span class="normal">5336</span>
<span class="normal">5337</span>
<span class="normal">5338</span>
<span class="normal">5339</span>
<span class="normal">5340</span>
<span class="normal">5341</span>
<span class="normal">5342</span>
<span class="normal">5343</span>
<span class="normal">5344</span>
<span class="normal">5345</span>
<span class="normal">5346</span>
<span class="normal">5347</span>
<span class="normal">5348</span>
<span class="normal">5349</span>
<span class="normal">5350</span>
<span class="normal">5351</span>
<span class="normal">5352</span>
<span class="normal">5353</span>
<span class="normal">5354</span>
<span class="normal">5355</span>
<span class="normal">5356</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">addMonteCarloObs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">i_obs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adding MonteCarlo random-gauss values of fake observations to an obs object.</span>
<span class="sd">    The names of the fake observations will be OriginalName-MC-n, n ranging from 0 to N-1</span>

<span class="sd">    Parameters:</span>
<span class="sd">        N: number of new observations to be added for each original observation.</span>
<span class="sd">        i_obs: used in case only a given observations needs to be treated</span>
<span class="sd">        random_seed: [default] used to initialize the numpy random generator</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">MC_added</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Monte Carlo already applied to this observation&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;addMonteCarloObs&#39;</span><span class="p">)</span>
    <span class="n">n_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_lines</span>
    <span class="n">n_obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_obs</span>
    <span class="k">if</span> <span class="n">i_obs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;Entering&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;addMonteCarloObs&#39;</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">random_seed</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="n">l_ori</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">obsIntens</span>
            <span class="n">e_ori</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">obsError</span>
            <span class="n">l_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">l_ori</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">e_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">e_ori</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">l_new</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">l_new</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">e_new</span> <span class="o">*</span> <span class="n">norm</span><span class="p">)</span>
            <span class="n">l_new</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">l_ori</span>
            <span class="n">l</span><span class="o">.</span><span class="n">obsIntens</span> <span class="o">=</span> <span class="n">l_new</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">l</span><span class="o">.</span><span class="n">obsError</span> <span class="o">=</span> <span class="n">e_new</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">corrected</span><span class="p">:</span>
                <span class="n">l</span><span class="o">.</span><span class="n">corrIntens</span> <span class="o">=</span> <span class="n">l_new</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">l</span><span class="o">.</span><span class="n">corrError</span> <span class="o">=</span> <span class="n">e_new</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Adding MC to </span><span class="si">{}</span><span class="s1">. </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">l_new</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> 
                                                                  <span class="n">l_new</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> 
                                                                  <span class="n">l</span><span class="o">.</span><span class="n">obsIntens</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                                                                  <span class="n">l</span><span class="o">.</span><span class="n">corrIntens</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> 
                            <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;addMonteCarloObs&#39;</span><span class="p">)</span>
        <span class="n">new_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">MC_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="s1">&#39;-MC-</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
        <span class="n">MC_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">defchararray</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_names</span> <span class="p">,</span> <span class="n">MC_names</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;Leaving&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;addMonteCarloObs&#39;</span><span class="p">)</span>        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">corrected</span><span class="p">:</span>
            <span class="n">returnObs</span><span class="o">=</span><span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">returnObs</span><span class="o">=</span><span class="kc">True</span>
        <span class="n">intens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">getIntens</span><span class="p">(</span><span class="n">returnObs</span><span class="o">=</span><span class="n">returnObs</span><span class="p">)[</span><span class="n">label</span><span class="p">]</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineLabels</span><span class="p">])[:,</span><span class="n">i_obs</span><span class="p">]</span> <span class="c1"># n_lines</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">getError</span><span class="p">(</span><span class="n">returnObs</span><span class="o">=</span><span class="n">returnObs</span><span class="p">)[</span><span class="n">label</span><span class="p">]</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineLabels</span><span class="p">])[:,</span><span class="n">i_obs</span><span class="p">]</span>
        <span class="n">all_new_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">n_lines</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">new_obs</span> <span class="o">=</span> <span class="n">intens</span> <span class="o">*</span> <span class="p">(</span><span class="n">all_new_obs</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">*</span> <span class="n">error</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">new_obs</span><span class="p">[</span><span class="n">new_obs</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addObs</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">-MC-</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i_obs</span><span class="p">],</span> <span class="n">i</span><span class="p">),</span> <span class="n">new_obs</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">MC_added</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">N_MC</span> <span class="o">=</span> <span class="n">N</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fits_shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>    
        <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fits_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">fits_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_MC</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N_MC</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Observation.addObs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">addObs</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">newObsIntens</span><span class="p">,</span> <span class="n">newObsError</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Add an observation (i.e. a list of intensities corresponding to a new object) to the existing set.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>name</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the new observation/object</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>newObsIntens</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>value(s) of the line intensities. Length must match Observation.n_lines</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4675</span>
<span class="normal">4676</span>
<span class="normal">4677</span>
<span class="normal">4678</span>
<span class="normal">4679</span>
<span class="normal">4680</span>
<span class="normal">4681</span>
<span class="normal">4682</span>
<span class="normal">4683</span>
<span class="normal">4684</span>
<span class="normal">4685</span>
<span class="normal">4686</span>
<span class="normal">4687</span>
<span class="normal">4688</span>
<span class="normal">4689</span>
<span class="normal">4690</span>
<span class="normal">4691</span>
<span class="normal">4692</span>
<span class="normal">4693</span>
<span class="normal">4694</span>
<span class="normal">4695</span>
<span class="normal">4696</span>
<span class="normal">4697</span>
<span class="normal">4698</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">addObs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">newObsIntens</span><span class="p">,</span> <span class="n">newObsError</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add an observation (i.e. a list of intensities corresponding to a new object) to the existing set.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        name:            name of the new observation/object</span>
<span class="sd">        newObsIntens:    value(s) of the line intensities. Length must match Observation.n_lines</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">newObsIntens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">newObsIntens</span> <span class="o">=</span> <span class="p">[</span><span class="n">newObsIntens</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">newObsIntens</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_lines</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Length of observations to be added does not match n_lines = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_lines</span><span class="p">),</span>
                        <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Name </span><span class="si">{0}</span><span class="s1"> already exists&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">return</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">newObsError</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">line</span><span class="o">.</span><span class="n">addObs</span><span class="p">(</span><span class="n">newObsIntens</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">line</span><span class="o">.</span><span class="n">addObs</span><span class="p">(</span><span class="n">newObsIntens</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">newObsError</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Observation.addSum" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">addSum</span><span class="p">(</span><span class="n">labelsToAdd</span><span class="p">,</span> <span class="n">newLabel</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Add a new observation. The intensity is the sum of the intensities of 
the lines defined by the tupple labelsToAdd. The error is the quadratic sum of the absolute errors.</p>
<p><strong>Example:</strong></p>
<pre><code>addSum(('O1r_7771A', 'O1r_7773A', 'O1r_7775A'), 'O1r_7773A+', to_eval = 'S("7773+")')
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4700</span>
<span class="normal">4701</span>
<span class="normal">4702</span>
<span class="normal">4703</span>
<span class="normal">4704</span>
<span class="normal">4705</span>
<span class="normal">4706</span>
<span class="normal">4707</span>
<span class="normal">4708</span>
<span class="normal">4709</span>
<span class="normal">4710</span>
<span class="normal">4711</span>
<span class="normal">4712</span>
<span class="normal">4713</span>
<span class="normal">4714</span>
<span class="normal">4715</span>
<span class="normal">4716</span>
<span class="normal">4717</span>
<span class="normal">4718</span>
<span class="normal">4719</span>
<span class="normal">4720</span>
<span class="normal">4721</span>
<span class="normal">4722</span>
<span class="normal">4723</span>
<span class="normal">4724</span>
<span class="normal">4725</span>
<span class="normal">4726</span>
<span class="normal">4727</span>
<span class="normal">4728</span>
<span class="normal">4729</span>
<span class="normal">4730</span>
<span class="normal">4731</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">addSum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labelsToAdd</span><span class="p">,</span> <span class="n">newLabel</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a new observation. The intensity is the sum of the intensities of </span>
<span class="sd">    the lines defined by the tupple labelsToAdd. The error is the quadratic sum of the absolute errors.</span>


<span class="sd">    **Example:**</span>

<span class="sd">        addSum((&#39;O1r_7771A&#39;, &#39;O1r_7773A&#39;, &#39;O1r_7775A&#39;), &#39;O1r_7773A+&#39;, to_eval = &#39;S(&quot;7773+&quot;)&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">intenses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIntens</span><span class="p">(</span><span class="n">returnObs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getError</span><span class="p">(</span><span class="n">returnObs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">intenses</span><span class="p">[</span><span class="n">labelsToAdd</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">errors</span><span class="p">[</span><span class="n">labelsToAdd</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="n">I</span>


    <span class="n">atom</span> <span class="o">=</span> <span class="n">labelsToAdd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labelsToAdd</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="k">if</span> <span class="n">label</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">atom</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Can not add lines from different atoms </span><span class="si">{}</span><span class="s1"> and </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">label</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">atom</span><span class="p">))</span>
        <span class="n">I</span> <span class="o">+=</span> <span class="n">intenses</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">E</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">*</span><span class="n">I</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">to_eval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">to_eval</span> <span class="o">=</span> <span class="s1">&#39;S(&quot;</span><span class="si">{}</span><span class="s1">&quot;)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">newLabel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">E</span> <span class="o">/</span> <span class="n">I</span>
    <span class="n">newLine</span> <span class="o">=</span> <span class="n">EmissionLine</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">newLabel</span><span class="p">,</span> <span class="n">obsIntens</span><span class="o">=</span><span class="n">I</span><span class="p">,</span> <span class="n">obsError</span><span class="o">=</span><span class="n">E</span><span class="p">,</span> 
                              <span class="n">corrected</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errIsRelative</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                              <span class="n">to_eval</span><span class="o">=</span><span class="n">to_eval</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">newLine</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Observation.correctData" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">correctData</span><span class="p">(</span><span class="n">line</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normWave</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Correct the line intensities with the correction computed with the RedCorr class (extinction.py)
The result is stored in line.corrIntens (corrected intensity in absolute units).</p>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5257</span>
<span class="normal">5258</span>
<span class="normal">5259</span>
<span class="normal">5260</span>
<span class="normal">5261</span>
<span class="normal">5262</span>
<span class="normal">5263</span>
<span class="normal">5264</span>
<span class="normal">5265</span>
<span class="normal">5266</span>
<span class="normal">5267</span>
<span class="normal">5268</span>
<span class="normal">5269</span>
<span class="normal">5270</span>
<span class="normal">5271</span>
<span class="normal">5272</span>
<span class="normal">5273</span>
<span class="normal">5274</span>
<span class="normal">5275</span>
<span class="normal">5276</span>
<span class="normal">5277</span>
<span class="normal">5278</span>
<span class="normal">5279</span>
<span class="normal">5280</span>
<span class="normal">5281</span>
<span class="normal">5282</span>
<span class="normal">5283</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">correctData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normWave</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Correct the line intensities with the correction computed with the RedCorr class (extinction.py)</span>
<span class="sd">    The result is stored in line.corrIntens (corrected intensity in absolute units).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">correctData</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">normWave</span><span class="o">=</span><span class="n">normWave</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">EmissionLine</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Trying to correct something that is not a line&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>  
        <span class="n">line</span><span class="o">.</span><span class="n">correctIntens</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extinction</span><span class="p">,</span> <span class="n">normWave</span><span class="o">=</span><span class="n">normWave</span><span class="p">)</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;            </span>
<span class="sd">        # the following is commented for now, we&#39;ll see latter how to implement normalized intensities.</span>
<span class="sd">        if line._unit is not None:</span>
<span class="sd">            try:</span>
<span class="sd">                line_norm = self.getLine(label=line._unit)</span>
<span class="sd">                line._corrIntens_n = line.obsIntens_n * self.extinction.getCorr(line.wave, line_norm.wave)</span>
<span class="sd">            except:</span>
<span class="sd">                log_.warn(&#39;No normalized correction for {0}&#39;.format(line), calling=&#39;Observation.correctData&#39;)</span>
<span class="sd">                line._corrIntens_n = None</span>
<span class="sd">        &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Observation.def_EBV" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">def_EBV</span><span class="p">(</span><span class="n">label1</span><span class="o">=</span><span class="s1">&#39;H1r_6563A&#39;</span><span class="p">,</span> <span class="n">label2</span><span class="o">=</span><span class="s1">&#39;H1r_4861A&#39;</span><span class="p">,</span> <span class="n">r_theo</span><span class="o">=</span><span class="mf">2.85</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Define the extinction parameter using the ratio of 2 lines.
Calls extinction.setCorr to set the EBV and cHbeta according to the parameters.
Once this is done, one may call correctData to compute the EmissionLine.corrIntens</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>label1</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>[EmissionLine.label] observed line whose intensities are used </p>
              </div>
            </td>
            <td>
                  <code>&#39;H1r_6563A&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>label2</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>[EmissionLine.label] observed line whose intensities are used</p>
              </div>
            </td>
            <td>
                  <code>&#39;H1r_4861A&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5211</span>
<span class="normal">5212</span>
<span class="normal">5213</span>
<span class="normal">5214</span>
<span class="normal">5215</span>
<span class="normal">5216</span>
<span class="normal">5217</span>
<span class="normal">5218</span>
<span class="normal">5219</span>
<span class="normal">5220</span>
<span class="normal">5221</span>
<span class="normal">5222</span>
<span class="normal">5223</span>
<span class="normal">5224</span>
<span class="normal">5225</span>
<span class="normal">5226</span>
<span class="normal">5227</span>
<span class="normal">5228</span>
<span class="normal">5229</span>
<span class="normal">5230</span>
<span class="normal">5231</span>
<span class="normal">5232</span>
<span class="normal">5233</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">def_EBV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label1</span><span class="o">=</span><span class="s2">&quot;H1r_6563A&quot;</span><span class="p">,</span> <span class="n">label2</span><span class="o">=</span><span class="s2">&quot;H1r_4861A&quot;</span><span class="p">,</span> <span class="n">r_theo</span><span class="o">=</span><span class="mf">2.85</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define the extinction parameter using the ratio of 2 lines.</span>
<span class="sd">    Calls extinction.setCorr to set the EBV and cHbeta according to the parameters.</span>
<span class="sd">    Once this is done, one may call correctData to compute the EmissionLine.corrIntens</span>

<span class="sd">    Parameters:</span>
<span class="sd">        label1: [EmissionLine.label] observed line whose intensities are used </span>
<span class="sd">        label2: [EmissionLine.label] observed line whose intensities are used</span>
<span class="sd">        r_theo [float] theoretical line ratio</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">line1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLine</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label1</span><span class="p">)</span>
    <span class="n">line2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLine</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">line1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> is not a valid label or is not observed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line1</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">line2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> is not a valid label or is not observed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line2</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
        <span class="n">obs_over_theo</span> <span class="o">=</span> <span class="p">(</span><span class="n">line1</span><span class="o">.</span><span class="n">obsIntens</span> <span class="o">/</span> <span class="n">line2</span><span class="o">.</span><span class="n">obsIntens</span><span class="p">)</span> <span class="o">/</span> <span class="n">r_theo</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">extinction</span><span class="o">.</span><span class="n">setCorr</span><span class="p">(</span><span class="n">obs_over_theo</span><span class="p">,</span> <span class="n">line1</span><span class="o">.</span><span class="n">wave</span><span class="p">,</span> <span class="n">line2</span><span class="o">.</span><span class="n">wave</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Observation.fillObs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fillObs</span><span class="p">(</span><span class="n">lineLabel</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create a fake observation of a given line, filled with a given value.
Parameters:
    lineLabel: the label of the new line. If the label corresponds to an already 
        defined observation, nothing is done and a warning is issued.
    default: the value of the fake observations. Default is np.nan</p>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4660</span>
<span class="normal">4661</span>
<span class="normal">4662</span>
<span class="normal">4663</span>
<span class="normal">4664</span>
<span class="normal">4665</span>
<span class="normal">4666</span>
<span class="normal">4667</span>
<span class="normal">4668</span>
<span class="normal">4669</span>
<span class="normal">4670</span>
<span class="normal">4671</span>
<span class="normal">4672</span>
<span class="normal">4673</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fillObs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lineLabel</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a fake observation of a given line, filled with a given value.</span>
<span class="sd">    Parameters:</span>
<span class="sd">        lineLabel: the label of the new line. If the label corresponds to an already </span>
<span class="sd">            defined observation, nothing is done and a warning is issued.</span>
<span class="sd">        default: the value of the fake observations. Default is np.nan</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">lineLabel</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineLabels</span><span class="p">:</span>
        <span class="n">newLine</span> <span class="o">=</span> <span class="n">EmissionLine</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">lineLabel</span><span class="p">,</span> <span class="n">obsIntens</span><span class="o">=</span><span class="n">default</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_obs</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">newLine</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Line </span><span class="si">{0}</span><span class="s1"> already in obs&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lineLabel</span><span class="p">),</span> <span class="n">calling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Observation.getError" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getError</span><span class="p">(</span><span class="n">returnObs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">obsName</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return the line intensity error in form of a dictionary with line labels as keys.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>returnObs</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if False (default), prints the corrected values. 
            If True, prints the observed value. </p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>obsName</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of an observation. If not set or None, all the observations are printed</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5149</span>
<span class="normal">5150</span>
<span class="normal">5151</span>
<span class="normal">5152</span>
<span class="normal">5153</span>
<span class="normal">5154</span>
<span class="normal">5155</span>
<span class="normal">5156</span>
<span class="normal">5157</span>
<span class="normal">5158</span>
<span class="normal">5159</span>
<span class="normal">5160</span>
<span class="normal">5161</span>
<span class="normal">5162</span>
<span class="normal">5163</span>
<span class="normal">5164</span>
<span class="normal">5165</span>
<span class="normal">5166</span>
<span class="normal">5167</span>
<span class="normal">5168</span>
<span class="normal">5169</span>
<span class="normal">5170</span>
<span class="normal">5171</span>
<span class="normal">5172</span>
<span class="normal">5173</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">returnObs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">obsName</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the line intensity error in form of a dictionary with line labels as keys.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        returnObs:  if False (default), prints the corrected values. </span>
<span class="sd">                        If True, prints the observed value. </span>
<span class="sd">        obsName:    name of an observation. If not set or None, all the observations are printed</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">obsName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">obsName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="n">obsIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">obsName</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Name </span><span class="si">{}</span><span class="s1"> is not an Observation name&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obsName</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">obsIndex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_obs</span><span class="p">)</span>
    <span class="n">to_return</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">returnObs</span><span class="p">:</span>
            <span class="n">to_return</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">obsError</span><span class="p">[</span><span class="n">obsIndex</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">to_return</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">corrError</span><span class="p">[</span><span class="n">obsIndex</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">to_return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Observation.getIntens" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getIntens</span><span class="p">(</span><span class="n">returnObs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">obsName</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return the line intensities in form of a dictionary with line labels as keys.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>returnObs</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If False (default), prints the corrected values. 
            If True, prints the observed value. </p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>obsName</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of an observation. If not set or None, all the observations are printed</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5122</span>
<span class="normal">5123</span>
<span class="normal">5124</span>
<span class="normal">5125</span>
<span class="normal">5126</span>
<span class="normal">5127</span>
<span class="normal">5128</span>
<span class="normal">5129</span>
<span class="normal">5130</span>
<span class="normal">5131</span>
<span class="normal">5132</span>
<span class="normal">5133</span>
<span class="normal">5134</span>
<span class="normal">5135</span>
<span class="normal">5136</span>
<span class="normal">5137</span>
<span class="normal">5138</span>
<span class="normal">5139</span>
<span class="normal">5140</span>
<span class="normal">5141</span>
<span class="normal">5142</span>
<span class="normal">5143</span>
<span class="normal">5144</span>
<span class="normal">5145</span>
<span class="normal">5146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getIntens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">returnObs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">obsName</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the line intensities in form of a dictionary with line labels as keys.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        returnObs (bool):  If False (default), prints the corrected values. </span>
<span class="sd">                        If True, prints the observed value. </span>
<span class="sd">        obsName:    name of an observation. If not set or None, all the observations are printed</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">obsName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">obsName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="n">obsIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">obsName</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Name </span><span class="si">{}</span><span class="s1"> is not an Observation name&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obsName</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">obsIndex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_obs</span><span class="p">)</span>
    <span class="n">to_return</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">returnObs</span><span class="p">:</span>
            <span class="n">to_return</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">obsIntens</span><span class="p">[</span><span class="n">obsIndex</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">to_return</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">corrIntens</span><span class="p">[</span><span class="n">obsIndex</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">to_return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Observation.getLine" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getLine</span><span class="p">(</span><span class="n">elem</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return the lines corresponding to elem-spec-wave or to the label.</p>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4785</span>
<span class="normal">4786</span>
<span class="normal">4787</span>
<span class="normal">4788</span>
<span class="normal">4789</span>
<span class="normal">4790</span>
<span class="normal">4791</span>
<span class="normal">4792</span>
<span class="normal">4793</span>
<span class="normal">4794</span>
<span class="normal">4795</span>
<span class="normal">4796</span>
<span class="normal">4797</span>
<span class="normal">4798</span>
<span class="normal">4799</span>
<span class="normal">4800</span>
<span class="normal">4801</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the lines corresponding to elem-spec-wave or to the label.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">getLineLabel</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="n">blend</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="n">label</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
    <span class="n">n_lines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n_lines</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;No line for </span><span class="si">{0}</span><span class="s1"> from </span><span class="si">{1}{2}</span><span class="s1"> at wavelength </span><span class="si">{3}</span><span class="s1"> (blend=</span><span class="si">{4}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="n">blend</span><span class="p">),</span>
                       <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">n_lines</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Observation.getSortedLines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getSortedLines</span><span class="p">(</span><span class="n">crit</span><span class="o">=</span><span class="s1">&#39;atom&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return a list of lines sorted by atoms or wavelengths.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>crit</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>criterion to sort the line list ('atom' [default] or 'wave')</p>
              </div>
            </td>
            <td>
                  <code>&#39;atom&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4804</span>
<span class="normal">4805</span>
<span class="normal">4806</span>
<span class="normal">4807</span>
<span class="normal">4808</span>
<span class="normal">4809</span>
<span class="normal">4810</span>
<span class="normal">4811</span>
<span class="normal">4812</span>
<span class="normal">4813</span>
<span class="normal">4814</span>
<span class="normal">4815</span>
<span class="normal">4816</span>
<span class="normal">4817</span>
<span class="normal">4818</span>
<span class="normal">4819</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getSortedLines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crit</span><span class="o">=</span><span class="s1">&#39;atom&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a list of lines sorted by atoms or wavelengths.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        crit:   criterion to sort the line list (&#39;atom&#39; [default] or &#39;wave&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">crit</span> <span class="o">==</span> <span class="s1">&#39;atom&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">atom</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">wave</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">crit</span> <span class="o">==</span> <span class="s1">&#39;wave&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">wave</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">crit</span> <span class="o">==</span> <span class="s1">&#39;mass&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">elem</span><span class="p">],</span> <span class="n">line</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">wave</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;crit = </span><span class="si">{0}</span><span class="s1"> is not valid&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">crit</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">+</span> <span class="s1">&#39;.getSortedLines&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Observation.getUniqueAtoms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getUniqueAtoms</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return a numpy.ndarray of the atoms of the observed lines. If an atom emits 
more than one line, it is returned only once (numpy.unique is applied 
to the list before returning).</p>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4822</span>
<span class="normal">4823</span>
<span class="normal">4824</span>
<span class="normal">4825</span>
<span class="normal">4826</span>
<span class="normal">4827</span>
<span class="normal">4828</span>
<span class="normal">4829</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getUniqueAtoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a numpy.ndarray of the atoms of the observed lines. If an atom emits </span>
<span class="sd">    more than one line, it is returned only once (numpy.unique is applied </span>
<span class="sd">    to the list before returning).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">([</span><span class="n">l</span><span class="o">.</span><span class="n">atom</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Observation.printIntens" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">printIntens</span><span class="p">(</span><span class="n">returnObs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">obsName</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Print the line intensities.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>returnObs</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if False (default), prints the corrected values. 
            If True, prints the observed value. </p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>obsName</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of an observation. Is unset or None, all the observations are printed</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5176</span>
<span class="normal">5177</span>
<span class="normal">5178</span>
<span class="normal">5179</span>
<span class="normal">5180</span>
<span class="normal">5181</span>
<span class="normal">5182</span>
<span class="normal">5183</span>
<span class="normal">5184</span>
<span class="normal">5185</span>
<span class="normal">5186</span>
<span class="normal">5187</span>
<span class="normal">5188</span>
<span class="normal">5189</span>
<span class="normal">5190</span>
<span class="normal">5191</span>
<span class="normal">5192</span>
<span class="normal">5193</span>
<span class="normal">5194</span>
<span class="normal">5195</span>
<span class="normal">5196</span>
<span class="normal">5197</span>
<span class="normal">5198</span>
<span class="normal">5199</span>
<span class="normal">5200</span>
<span class="normal">5201</span>
<span class="normal">5202</span>
<span class="normal">5203</span>
<span class="normal">5204</span>
<span class="normal">5205</span>
<span class="normal">5206</span>
<span class="normal">5207</span>
<span class="normal">5208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">printIntens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">returnObs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">obsName</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print the line intensities.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        returnObs:   if False (default), prints the corrected values. </span>
<span class="sd">                        If True, prints the observed value. </span>
<span class="sd">        obsName:     name of an observation. Is unset or None, all the observations are printed</span>

<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="k">if</span> <span class="n">obsName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">obsName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="n">obsIndex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">obsName</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Name </span><span class="si">{}</span><span class="s1"> is not an Observation name&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obsName</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">obsIndex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_obs</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">corrIntens</span><span class="p">[</span><span class="n">obsIndex</span><span class="p">],</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">returnObs</span><span class="p">:</span>
                <span class="n">to_print</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">line</span><span class="o">.</span><span class="n">obsIntens</span><span class="p">[</span><span class="n">obsIndex</span><span class="p">],))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">to_print</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">line</span><span class="o">.</span><span class="n">corrIntens</span><span class="p">[</span><span class="n">obsIndex</span><span class="p">],))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">returnObs</span><span class="p">:</span>
                <span class="n">to_print</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">obsIntens</span><span class="p">[</span><span class="n">obsIndex</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">to_print</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">corrIntens</span><span class="p">[</span><span class="n">obsIndex</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">returnObs</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">label</span><span class="p">),</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;</span><span class="si">{:8.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">to_print</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">label</span><span class="p">),</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;</span><span class="si">{:8.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">to_print</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Observation.readData" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">readData</span><span class="p">(</span><span class="n">obsFile</span><span class="p">,</span> <span class="n">fileFormat</span><span class="o">=</span><span class="s1">&#39;lines_in_cols&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">err_default</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">corrected</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errIsRelative</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">errStr</span><span class="o">=</span><span class="s1">&#39;err&#39;</span><span class="p">,</span> <span class="n">Cutout2D_position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Cutout2D_size</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Read observational data from an ascii file. The lines can be listed either in columns or in rows
and the observed objects vary in the other direction. The uncertainty on the line intensities
can be read from the file, or a constant relative value can be assumed.
The lines must be identified by a label in PyNeb's format ion_wave (e.g., 'O3_5007'); the list of ions and
corresponding wavelengths can also be found in pn.LINE_LABEL_LIST.
The following optional fields may also be included (without quotes): 'NAME' (object's name, in one string), 
'E(B-V)', 'cHbeta', and 'e' (observational error).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>obsFile</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>file containing the observations. May be a file object or a string.
             If the fileFormat is 'fits_IFU', the obsFile keyword is of the form e.g.:
             'dir/ngc6778_MUSE_*.fits' where * is of the form O3_5007A.
             The associated error file must be named the same way, using errStr keyword value 
             e.g. dir/ngc6778_MUSE_O3_5007A_err.fits</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fileFormat</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>emission lines vary across columns ('lines_in_cols', default) or 
                across rows ('lines_in_rows'), or across rows with errors in columns 
                ('lines_in_rows_err_cols') in which case the column label must start with "err"</p>
<pre><code>            The format may also be 'fits_IFU', in which case each emission line comes
            from a different fits file
</code></pre>
              </div>
            </td>
            <td>
                  <code>&#39;lines_in_cols&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>delimiter</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>field delimiter (default: None)  </p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>err_default</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>default uncertainty on the line intensities</p>
              </div>
            </td>
            <td>
                  <code>0.1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>corrected</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Boolean. True if the observed intensities are already corrected from extinction
                 (default: False)</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>errIsRelative</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Boolean. True if the errors are relative to the intensities, False if they
                 are in the same unit as the intensity (default: False)</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>errStr</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>string to identify the error file in case the fileFormat is fits_IFU.</p>
              </div>
            </td>
            <td>
                  <code>&#39;err&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>Cutout2D_position</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>In case of reading fits images, crop the image to those pixel limits</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>Cutout2D_size</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>In case of reading fits images, crop the image to those pixel limits</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4832</span>
<span class="normal">4833</span>
<span class="normal">4834</span>
<span class="normal">4835</span>
<span class="normal">4836</span>
<span class="normal">4837</span>
<span class="normal">4838</span>
<span class="normal">4839</span>
<span class="normal">4840</span>
<span class="normal">4841</span>
<span class="normal">4842</span>
<span class="normal">4843</span>
<span class="normal">4844</span>
<span class="normal">4845</span>
<span class="normal">4846</span>
<span class="normal">4847</span>
<span class="normal">4848</span>
<span class="normal">4849</span>
<span class="normal">4850</span>
<span class="normal">4851</span>
<span class="normal">4852</span>
<span class="normal">4853</span>
<span class="normal">4854</span>
<span class="normal">4855</span>
<span class="normal">4856</span>
<span class="normal">4857</span>
<span class="normal">4858</span>
<span class="normal">4859</span>
<span class="normal">4860</span>
<span class="normal">4861</span>
<span class="normal">4862</span>
<span class="normal">4863</span>
<span class="normal">4864</span>
<span class="normal">4865</span>
<span class="normal">4866</span>
<span class="normal">4867</span>
<span class="normal">4868</span>
<span class="normal">4869</span>
<span class="normal">4870</span>
<span class="normal">4871</span>
<span class="normal">4872</span>
<span class="normal">4873</span>
<span class="normal">4874</span>
<span class="normal">4875</span>
<span class="normal">4876</span>
<span class="normal">4877</span>
<span class="normal">4878</span>
<span class="normal">4879</span>
<span class="normal">4880</span>
<span class="normal">4881</span>
<span class="normal">4882</span>
<span class="normal">4883</span>
<span class="normal">4884</span>
<span class="normal">4885</span>
<span class="normal">4886</span>
<span class="normal">4887</span>
<span class="normal">4888</span>
<span class="normal">4889</span>
<span class="normal">4890</span>
<span class="normal">4891</span>
<span class="normal">4892</span>
<span class="normal">4893</span>
<span class="normal">4894</span>
<span class="normal">4895</span>
<span class="normal">4896</span>
<span class="normal">4897</span>
<span class="normal">4898</span>
<span class="normal">4899</span>
<span class="normal">4900</span>
<span class="normal">4901</span>
<span class="normal">4902</span>
<span class="normal">4903</span>
<span class="normal">4904</span>
<span class="normal">4905</span>
<span class="normal">4906</span>
<span class="normal">4907</span>
<span class="normal">4908</span>
<span class="normal">4909</span>
<span class="normal">4910</span>
<span class="normal">4911</span>
<span class="normal">4912</span>
<span class="normal">4913</span>
<span class="normal">4914</span>
<span class="normal">4915</span>
<span class="normal">4916</span>
<span class="normal">4917</span>
<span class="normal">4918</span>
<span class="normal">4919</span>
<span class="normal">4920</span>
<span class="normal">4921</span>
<span class="normal">4922</span>
<span class="normal">4923</span>
<span class="normal">4924</span>
<span class="normal">4925</span>
<span class="normal">4926</span>
<span class="normal">4927</span>
<span class="normal">4928</span>
<span class="normal">4929</span>
<span class="normal">4930</span>
<span class="normal">4931</span>
<span class="normal">4932</span>
<span class="normal">4933</span>
<span class="normal">4934</span>
<span class="normal">4935</span>
<span class="normal">4936</span>
<span class="normal">4937</span>
<span class="normal">4938</span>
<span class="normal">4939</span>
<span class="normal">4940</span>
<span class="normal">4941</span>
<span class="normal">4942</span>
<span class="normal">4943</span>
<span class="normal">4944</span>
<span class="normal">4945</span>
<span class="normal">4946</span>
<span class="normal">4947</span>
<span class="normal">4948</span>
<span class="normal">4949</span>
<span class="normal">4950</span>
<span class="normal">4951</span>
<span class="normal">4952</span>
<span class="normal">4953</span>
<span class="normal">4954</span>
<span class="normal">4955</span>
<span class="normal">4956</span>
<span class="normal">4957</span>
<span class="normal">4958</span>
<span class="normal">4959</span>
<span class="normal">4960</span>
<span class="normal">4961</span>
<span class="normal">4962</span>
<span class="normal">4963</span>
<span class="normal">4964</span>
<span class="normal">4965</span>
<span class="normal">4966</span>
<span class="normal">4967</span>
<span class="normal">4968</span>
<span class="normal">4969</span>
<span class="normal">4970</span>
<span class="normal">4971</span>
<span class="normal">4972</span>
<span class="normal">4973</span>
<span class="normal">4974</span>
<span class="normal">4975</span>
<span class="normal">4976</span>
<span class="normal">4977</span>
<span class="normal">4978</span>
<span class="normal">4979</span>
<span class="normal">4980</span>
<span class="normal">4981</span>
<span class="normal">4982</span>
<span class="normal">4983</span>
<span class="normal">4984</span>
<span class="normal">4985</span>
<span class="normal">4986</span>
<span class="normal">4987</span>
<span class="normal">4988</span>
<span class="normal">4989</span>
<span class="normal">4990</span>
<span class="normal">4991</span>
<span class="normal">4992</span>
<span class="normal">4993</span>
<span class="normal">4994</span>
<span class="normal">4995</span>
<span class="normal">4996</span>
<span class="normal">4997</span>
<span class="normal">4998</span>
<span class="normal">4999</span>
<span class="normal">5000</span>
<span class="normal">5001</span>
<span class="normal">5002</span>
<span class="normal">5003</span>
<span class="normal">5004</span>
<span class="normal">5005</span>
<span class="normal">5006</span>
<span class="normal">5007</span>
<span class="normal">5008</span>
<span class="normal">5009</span>
<span class="normal">5010</span>
<span class="normal">5011</span>
<span class="normal">5012</span>
<span class="normal">5013</span>
<span class="normal">5014</span>
<span class="normal">5015</span>
<span class="normal">5016</span>
<span class="normal">5017</span>
<span class="normal">5018</span>
<span class="normal">5019</span>
<span class="normal">5020</span>
<span class="normal">5021</span>
<span class="normal">5022</span>
<span class="normal">5023</span>
<span class="normal">5024</span>
<span class="normal">5025</span>
<span class="normal">5026</span>
<span class="normal">5027</span>
<span class="normal">5028</span>
<span class="normal">5029</span>
<span class="normal">5030</span>
<span class="normal">5031</span>
<span class="normal">5032</span>
<span class="normal">5033</span>
<span class="normal">5034</span>
<span class="normal">5035</span>
<span class="normal">5036</span>
<span class="normal">5037</span>
<span class="normal">5038</span>
<span class="normal">5039</span>
<span class="normal">5040</span>
<span class="normal">5041</span>
<span class="normal">5042</span>
<span class="normal">5043</span>
<span class="normal">5044</span>
<span class="normal">5045</span>
<span class="normal">5046</span>
<span class="normal">5047</span>
<span class="normal">5048</span>
<span class="normal">5049</span>
<span class="normal">5050</span>
<span class="normal">5051</span>
<span class="normal">5052</span>
<span class="normal">5053</span>
<span class="normal">5054</span>
<span class="normal">5055</span>
<span class="normal">5056</span>
<span class="normal">5057</span>
<span class="normal">5058</span>
<span class="normal">5059</span>
<span class="normal">5060</span>
<span class="normal">5061</span>
<span class="normal">5062</span>
<span class="normal">5063</span>
<span class="normal">5064</span>
<span class="normal">5065</span>
<span class="normal">5066</span>
<span class="normal">5067</span>
<span class="normal">5068</span>
<span class="normal">5069</span>
<span class="normal">5070</span>
<span class="normal">5071</span>
<span class="normal">5072</span>
<span class="normal">5073</span>
<span class="normal">5074</span>
<span class="normal">5075</span>
<span class="normal">5076</span>
<span class="normal">5077</span>
<span class="normal">5078</span>
<span class="normal">5079</span>
<span class="normal">5080</span>
<span class="normal">5081</span>
<span class="normal">5082</span>
<span class="normal">5083</span>
<span class="normal">5084</span>
<span class="normal">5085</span>
<span class="normal">5086</span>
<span class="normal">5087</span>
<span class="normal">5088</span>
<span class="normal">5089</span>
<span class="normal">5090</span>
<span class="normal">5091</span>
<span class="normal">5092</span>
<span class="normal">5093</span>
<span class="normal">5094</span>
<span class="normal">5095</span>
<span class="normal">5096</span>
<span class="normal">5097</span>
<span class="normal">5098</span>
<span class="normal">5099</span>
<span class="normal">5100</span>
<span class="normal">5101</span>
<span class="normal">5102</span>
<span class="normal">5103</span>
<span class="normal">5104</span>
<span class="normal">5105</span>
<span class="normal">5106</span>
<span class="normal">5107</span>
<span class="normal">5108</span>
<span class="normal">5109</span>
<span class="normal">5110</span>
<span class="normal">5111</span>
<span class="normal">5112</span>
<span class="normal">5113</span>
<span class="normal">5114</span>
<span class="normal">5115</span>
<span class="normal">5116</span>
<span class="normal">5117</span>
<span class="normal">5118</span>
<span class="normal">5119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">readData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obsFile</span><span class="p">,</span> <span class="n">fileFormat</span><span class="o">=</span><span class="s1">&#39;lines_in_cols&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">err_default</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> <span class="n">corrected</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">errIsRelative</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">errStr</span><span class="o">=</span><span class="s1">&#39;err&#39;</span><span class="p">,</span> <span class="n">Cutout2D_position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Cutout2D_size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read observational data from an ascii file. The lines can be listed either in columns or in rows</span>
<span class="sd">    and the observed objects vary in the other direction. The uncertainty on the line intensities</span>
<span class="sd">    can be read from the file, or a constant relative value can be assumed.</span>
<span class="sd">    The lines must be identified by a label in PyNeb&#39;s format ion_wave (e.g., &#39;O3_5007&#39;); the list of ions and</span>
<span class="sd">    corresponding wavelengths can also be found in pn.LINE_LABEL_LIST.</span>
<span class="sd">    The following optional fields may also be included (without quotes): &#39;NAME&#39; (object&#39;s name, in one string), </span>
<span class="sd">    &#39;E(B-V)&#39;, &#39;cHbeta&#39;, and &#39;e&#39; (observational error).</span>


<span class="sd">    Parameters:</span>
<span class="sd">        obsFile:        file containing the observations. May be a file object or a string.</span>
<span class="sd">                         If the fileFormat is &#39;fits_IFU&#39;, the obsFile keyword is of the form e.g.:</span>
<span class="sd">                         &#39;dir/ngc6778_MUSE_*.fits&#39; where * is of the form O3_5007A.</span>
<span class="sd">                         The associated error file must be named the same way, using errStr keyword value </span>
<span class="sd">                         e.g. dir/ngc6778_MUSE_O3_5007A_err.fits</span>
<span class="sd">        fileFormat:     emission lines vary across columns (&#39;lines_in_cols&#39;, default) or </span>
<span class="sd">                            across rows (&#39;lines_in_rows&#39;), or across rows with errors in columns </span>
<span class="sd">                            (&#39;lines_in_rows_err_cols&#39;) in which case the column label must start with &quot;err&quot;</span>

<span class="sd">                            The format may also be &#39;fits_IFU&#39;, in which case each emission line comes</span>
<span class="sd">                            from a different fits file</span>

<span class="sd">        delimiter:      field delimiter (default: None)  </span>
<span class="sd">        err_default:    default uncertainty on the line intensities</span>
<span class="sd">        corrected:      Boolean. True if the observed intensities are already corrected from extinction</span>
<span class="sd">                             (default: False)</span>
<span class="sd">        errIsRelative:  Boolean. True if the errors are relative to the intensities, False if they</span>
<span class="sd">                             are in the same unit as the intensity (default: False)</span>
<span class="sd">        errStr:         string to identify the error file in case the fileFormat is fits_IFU.</span>
<span class="sd">        Cutout2D_position: In case of reading fits images, crop the image to those pixel limits</span>
<span class="sd">        Cutout2D_size: In case of reading fits images, crop the image to those pixel limits</span>

<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="n">format_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lines_in_cols&#39;</span><span class="p">,</span> <span class="s1">&#39;lines_in_cols2&#39;</span><span class="p">,</span> <span class="s1">&#39;lines_in_rows&#39;</span><span class="p">,</span> 
                   <span class="s1">&#39;lines_in_rows_err_cols&#39;</span><span class="p">,</span> <span class="s1">&#39;fits_IFU&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">fileFormat</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">format_list</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;unknown format </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fileFormat</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;Observation.readData&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obsFile</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">and</span> <span class="n">fileFormat</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;fits_IFU&#39;</span><span class="p">,):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">obsFile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">closeAfterUse</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">obsFile</span>
        <span class="n">closeAfterUse</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">fileFormat</span> <span class="o">==</span> <span class="s1">&#39;lines_in_cols&#39;</span><span class="p">:</span>
        <span class="n">hdr</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">closeAfterUse</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
        <span class="n">data_tab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="n">dd</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">))])</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;NAME&#39;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;cHbeta&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extinction</span><span class="o">.</span><span class="n">cHbeta</span> <span class="o">=</span> <span class="n">data_tab</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;E(B-V)&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extinction</span><span class="o">.</span><span class="n">E_BV</span> <span class="o">=</span> <span class="n">data_tab</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>         
            <span class="k">elif</span> <span class="n">label</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span>
                <span class="n">intens</span> <span class="o">=</span> <span class="n">data_tab</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">i_error</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">label</span> <span class="o">+</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="n">data_tab</span><span class="p">[</span><span class="n">i_error</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">errIsRelative</span><span class="p">:</span>
                        <span class="n">error</span> <span class="o">=</span> <span class="n">quiet_divide</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">intens</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">addErrDefault</span><span class="p">:</span>
                        <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">err_default</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;No error found for line </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="n">data_tab</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.</span> <span class="o">+</span> <span class="n">err_default</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">line2add</span> <span class="o">=</span> <span class="n">EmissionLine</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">obsIntens</span><span class="o">=</span><span class="n">intens</span><span class="p">,</span> <span class="n">obsError</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Unknown line label </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">line2add</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;adding line </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Impossible to add line&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">fileFormat</span> <span class="o">==</span> <span class="s1">&#39;lines_in_cols2&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">closeAfterUse</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">data_tab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">obsFile</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">deletechars</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">data_tab</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;cHbeta&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extinction</span><span class="o">.</span><span class="n">cHbeta</span> <span class="o">=</span> <span class="n">data_tab</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;E(B-V)&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extinction</span><span class="o">.</span><span class="n">E_BV</span> <span class="o">=</span> <span class="n">data_tab</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;NAME&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_tab</span><span class="p">[</span><span class="n">label</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;NAME2&#39;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">names2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_tab</span><span class="p">[</span><span class="n">label</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">n1</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">n2</span> <span class="k">for</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">,</span> <span class="n">names2</span><span class="p">)]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">label</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">data_tab</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">string_</span><span class="p">:</span>
                    <span class="n">intens</span> <span class="o">=</span> <span class="n">data_tab</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">error</span> <span class="o">=</span> <span class="n">data_tab</span><span class="p">[</span><span class="n">label</span> <span class="o">+</span> <span class="s1">&#39;e&#39;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">errIsRelative</span><span class="p">:</span>
                            <span class="n">error</span> <span class="o">=</span> <span class="n">error</span> <span class="o">/</span> <span class="n">intens</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">addErrDefault</span><span class="p">:</span>
                            <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">err_default</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;No error found for line </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                        <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">data_tab</span><span class="p">[</span><span class="n">label</span><span class="p">])</span> <span class="o">*</span> <span class="n">err_default</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">line2add</span> <span class="o">=</span> <span class="n">EmissionLine</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">obsIntens</span><span class="o">=</span><span class="n">intens</span><span class="p">,</span> <span class="n">obsError</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;unkown line label </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">intens</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">line2add</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;adding line </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Impossible to add line&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">intens</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Skipped </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">fileFormat</span> <span class="o">==</span> <span class="s1">&#39;lines_in_rows&#39;</span><span class="p">:</span>
        <span class="n">hdr</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span>  <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">closeAfterUse</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">data_tab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([[</span><span class="n">dd</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">))])</span>
        <span class="n">data_tab</span> <span class="o">=</span> <span class="n">data_tab</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;cHbeta&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extinction</span><span class="o">.</span><span class="n">cHbeta</span> <span class="o">=</span> <span class="n">data_tab</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;E(B-V)&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extinction</span><span class="o">.</span><span class="n">E_BV</span> <span class="o">=</span> <span class="n">data_tab</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">label</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span>
                <span class="n">intens</span> <span class="o">=</span> <span class="n">data_tab</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">i_error</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">label</span> <span class="o">+</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="n">data_tab</span><span class="p">[:,</span> <span class="n">i_error</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">errIsRelative</span><span class="p">:</span>
                        <span class="n">error</span> <span class="o">=</span> <span class="n">error</span> <span class="o">/</span> <span class="n">intens</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">addErrDefault</span><span class="p">:</span>
                        <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">err_default</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;No error found for line </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">data_tab</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">err_default</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">line2add</span> <span class="o">=</span> <span class="n">EmissionLine</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">obsIntens</span><span class="o">=</span><span class="n">intens</span><span class="p">,</span> <span class="n">obsError</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;unkown line label </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">intens</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">line2add</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;adding line </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Impossible to add line&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">intens</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">fileFormat</span> <span class="o">==</span> <span class="s1">&#39;lines_in_rows_err_cols&#39;</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">closeAfterUse</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">data_tab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">obsFile</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data_tab</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">::]</span> <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;err&#39;</span><span class="p">]</span>
        <span class="n">error_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data_tab</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;err&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">error_names</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Number of columns for intensities &lt;&gt; number of columns for errors </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">,</span>
                                                                                                             <span class="n">error_names</span><span class="p">),</span>
                          <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="c1">#names_locations = [name in self.names for name in data_tab.dtype.names]</span>
        <span class="c1">#errors_locations = [name[0:3] == &#39;err&#39; for name in data_tab.dtype.names]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_tab</span><span class="p">[</span><span class="s1">&#39;LINE&#39;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;cHbeta&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extinction</span><span class="o">.</span><span class="n">cHbeta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">data_tab</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;E(B-V)&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extinction</span><span class="o">.</span><span class="n">E_BV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">data_tab</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">intens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">data_tab</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">])</span>
                <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">data_tab</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">error_names</span><span class="p">])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">errIsRelative</span><span class="p">:</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="n">error</span> <span class="o">/</span> <span class="n">intens</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">addErrDefault</span><span class="p">:</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">err_default</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">line2add</span> <span class="o">=</span> <span class="n">EmissionLine</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">obsIntens</span><span class="o">=</span><span class="n">intens</span><span class="p">,</span> <span class="n">obsError</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;unkown line label </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">intens</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">line2add</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;adding line </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Impossible to add line&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">intens</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">fileFormat</span> <span class="o">==</span> <span class="s1">&#39;fits_IFU&#39;</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">obsFile</span><span class="p">)</span>
        <span class="n">dir_</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">parent</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">name</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">dir_</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;path: </span><span class="si">{}</span><span class="s1">, dir_: </span><span class="si">{}</span><span class="s1">, pattern: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">dir_</span><span class="p">,</span> <span class="n">pattern</span><span class="p">),</span>
                        <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;Observation.readData&#39;</span><span class="p">)</span>
        <span class="n">str1</span><span class="p">,</span> <span class="n">str2</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">obs_file</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s1">&#39;.fits&#39;</span> <span class="ow">and</span> <span class="n">errStr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">obs_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;analysing </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;Observation.readData&#39;</span><span class="p">)</span>
                <span class="n">lineID</span> <span class="o">=</span> <span class="n">strExtract</span><span class="p">(</span><span class="n">obs_file</span><span class="p">,</span> <span class="n">str1</span><span class="p">,</span> <span class="n">str2</span><span class="p">)</span>
                <span class="n">spl</span> <span class="o">=</span> <span class="n">lineID</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spl</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">atom</span> <span class="o">=</span> <span class="n">spl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">spl</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">LINE_LABEL_LIST</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;Reading </span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1"> from </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">atom</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                                          <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;Observation.readData&#39;</span><span class="p">)</span>
                        <span class="n">fits_hdu</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">f</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">fits_data</span> <span class="o">=</span> <span class="n">fits_hdu</span><span class="o">.</span><span class="n">data</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">origin_fits_shape</span> <span class="o">=</span> <span class="n">fits_data</span><span class="o">.</span><span class="n">shape</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">fits_header</span> <span class="o">=</span> <span class="n">fits_hdu</span><span class="o">.</span><span class="n">header</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">wcs</span> <span class="o">=</span> <span class="n">WCS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fits_header</span><span class="p">)</span><span class="o">.</span><span class="n">celestial</span>
                        <span class="k">if</span> <span class="n">Cutout2D_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Cutout2D applied to data shape </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fits_data</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
                                            <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;Observation.readData&#39;</span><span class="p">)</span>
                            <span class="n">C2D</span> <span class="o">=</span> <span class="n">Cutout2D</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">fits_data</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">Cutout2D_position</span><span class="p">,</span> 
                                           <span class="n">size</span><span class="o">=</span><span class="n">Cutout2D_size</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="n">WCS</span><span class="p">(</span><span class="n">fits_hdu</span><span class="o">.</span><span class="n">header</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;trim&#39;</span><span class="p">,</span>
                                           <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            <span class="n">fits_data</span> <span class="o">=</span> <span class="n">C2D</span><span class="o">.</span><span class="n">data</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">wcs</span> <span class="o">=</span> <span class="n">C2D</span><span class="o">.</span><span class="n">wcs</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fits_shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">fits_shape</span> <span class="o">=</span> <span class="n">fits_data</span><span class="o">.</span><span class="n">shape</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">fits_data</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fits_shape</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;data shape in file </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">. Previous shape was </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                                <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">fits_data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fits_shape</span><span class="p">))</span>
                        <span class="n">fits_data</span> <span class="o">=</span> <span class="n">fits_data</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                        <span class="n">err_file</span> <span class="o">=</span> <span class="n">dir_</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">stem</span><span class="o">+</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">errStr</span> <span class="o">+</span> <span class="s1">&#39;.fits&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">err_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;Reading error </span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1"> from </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">atom</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">err_file</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                                              <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;Observation.readData&#39;</span><span class="p">)</span>
                            <span class="n">err_fits_hdu</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">err_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">err_fits_hdu</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_fits_shape</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;error shape in file </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{}</span><span class="s1">. data shape is </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                                <span class="n">err_file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">err_fits_hdu</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fits_shape</span><span class="p">))</span>
                            <span class="n">err_fits_data</span> <span class="o">=</span> <span class="n">err_fits_hdu</span><span class="o">.</span><span class="n">data</span>
                            <span class="k">if</span> <span class="n">Cutout2D_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">C2D</span> <span class="o">=</span> <span class="n">Cutout2D</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">err_fits_data</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">Cutout2D_position</span><span class="p">,</span> 
                                               <span class="n">size</span><span class="o">=</span><span class="n">Cutout2D_size</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;trim&#39;</span><span class="p">,</span>
                                               <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                                <span class="n">err_fits_data</span> <span class="o">=</span> <span class="n">C2D</span><span class="o">.</span><span class="n">data</span>
                            <span class="n">err_fits_data</span> <span class="o">=</span> <span class="n">err_fits_data</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">errIsRelative</span><span class="p">:</span>
                                <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
                                    <span class="n">err_fits_data</span> <span class="o">=</span> <span class="n">err_fits_data</span> <span class="o">/</span> <span class="n">fits_data</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">addErrDefault</span><span class="p">:</span>
                                <span class="n">err_fits_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">err_fits_data</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">err_default</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;No error file found for </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                                              <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;Observation.readData&#39;</span><span class="p">)</span>                                
                            <span class="n">err_fits_data</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">fits_data</span><span class="p">)</span> <span class="o">*</span> <span class="n">err_default</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">EmissionLine</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">lineID</span><span class="p">,</span>
                                                  <span class="n">obsIntens</span><span class="o">=</span><span class="n">fits_data</span><span class="p">,</span> 
                                                  <span class="n">obsError</span><span class="o">=</span><span class="n">err_fits_data</span><span class="p">,</span> 
                                                  <span class="n">corrected</span><span class="o">=</span><span class="n">corrected</span><span class="p">,</span> <span class="n">errIsRelative</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;atom </span><span class="si">{}</span><span class="s1"> not in LINE_LABEL_LIST&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">atom</span><span class="p">),</span> 
                                        <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;Observation.readData&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">str1</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_obs</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fits_shape</span>

    <span class="k">if</span> <span class="n">corrected</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">correctData</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Observation.removeLine" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">removeLine</span><span class="p">(</span><span class="n">lineLabel</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4651</span>
<span class="normal">4652</span>
<span class="normal">4653</span>
<span class="normal">4654</span>
<span class="normal">4655</span>
<span class="normal">4656</span>
<span class="normal">4657</span>
<span class="normal">4658</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">removeLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lineLabel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="n">lineLabel</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Observation.reshape" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reshape</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return data in shape of the original data (use with fits IFUs and/or MC)</p>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5358</span>
<span class="normal">5359</span>
<span class="normal">5360</span>
<span class="normal">5361</span>
<span class="normal">5362</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reshape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return data in shape of the original data (use with fits IFUs and/or MC)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.Observation.setAllErrors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setAllErrors</span><span class="p">(</span><span class="n">err_default</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Set the relative uncertainty of all emission lines to a common constant value</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>err_default</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>default value of the relative uncertainty</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5285</span>
<span class="normal">5286</span>
<span class="normal">5287</span>
<span class="normal">5288</span>
<span class="normal">5289</span>
<span class="normal">5290</span>
<span class="normal">5291</span>
<span class="normal">5292</span>
<span class="normal">5293</span>
<span class="normal">5294</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">setAllErrors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">err_default</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set the relative uncertainty of all emission lines to a common constant value</span>

<span class="sd">    Parameters:</span>
<span class="sd">        err_default:     default value of the relative uncertainty</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
        <span class="n">line</span><span class="o">.</span><span class="n">obs_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">obs_err</span><span class="p">)</span> <span class="o">*</span> <span class="n">err_default</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pyneb.core.pynebcore.RecAtom" class="doc doc-heading">
            <code>RecAtom</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


              <details class="quote">
                <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3223</span>
<span class="normal">3224</span>
<span class="normal">3225</span>
<span class="normal">3226</span>
<span class="normal">3227</span>
<span class="normal">3228</span>
<span class="normal">3229</span>
<span class="normal">3230</span>
<span class="normal">3231</span>
<span class="normal">3232</span>
<span class="normal">3233</span>
<span class="normal">3234</span>
<span class="normal">3235</span>
<span class="normal">3236</span>
<span class="normal">3237</span>
<span class="normal">3238</span>
<span class="normal">3239</span>
<span class="normal">3240</span>
<span class="normal">3241</span>
<span class="normal">3242</span>
<span class="normal">3243</span>
<span class="normal">3244</span>
<span class="normal">3245</span>
<span class="normal">3246</span>
<span class="normal">3247</span>
<span class="normal">3248</span>
<span class="normal">3249</span>
<span class="normal">3250</span>
<span class="normal">3251</span>
<span class="normal">3252</span>
<span class="normal">3253</span>
<span class="normal">3254</span>
<span class="normal">3255</span>
<span class="normal">3256</span>
<span class="normal">3257</span>
<span class="normal">3258</span>
<span class="normal">3259</span>
<span class="normal">3260</span>
<span class="normal">3261</span>
<span class="normal">3262</span>
<span class="normal">3263</span>
<span class="normal">3264</span>
<span class="normal">3265</span>
<span class="normal">3266</span>
<span class="normal">3267</span>
<span class="normal">3268</span>
<span class="normal">3269</span>
<span class="normal">3270</span>
<span class="normal">3271</span>
<span class="normal">3272</span>
<span class="normal">3273</span>
<span class="normal">3274</span>
<span class="normal">3275</span>
<span class="normal">3276</span>
<span class="normal">3277</span>
<span class="normal">3278</span>
<span class="normal">3279</span>
<span class="normal">3280</span>
<span class="normal">3281</span>
<span class="normal">3282</span>
<span class="normal">3283</span>
<span class="normal">3284</span>
<span class="normal">3285</span>
<span class="normal">3286</span>
<span class="normal">3287</span>
<span class="normal">3288</span>
<span class="normal">3289</span>
<span class="normal">3290</span>
<span class="normal">3291</span>
<span class="normal">3292</span>
<span class="normal">3293</span>
<span class="normal">3294</span>
<span class="normal">3295</span>
<span class="normal">3296</span>
<span class="normal">3297</span>
<span class="normal">3298</span>
<span class="normal">3299</span>
<span class="normal">3300</span>
<span class="normal">3301</span>
<span class="normal">3302</span>
<span class="normal">3303</span>
<span class="normal">3304</span>
<span class="normal">3305</span>
<span class="normal">3306</span>
<span class="normal">3307</span>
<span class="normal">3308</span>
<span class="normal">3309</span>
<span class="normal">3310</span>
<span class="normal">3311</span>
<span class="normal">3312</span>
<span class="normal">3313</span>
<span class="normal">3314</span>
<span class="normal">3315</span>
<span class="normal">3316</span>
<span class="normal">3317</span>
<span class="normal">3318</span>
<span class="normal">3319</span>
<span class="normal">3320</span>
<span class="normal">3321</span>
<span class="normal">3322</span>
<span class="normal">3323</span>
<span class="normal">3324</span>
<span class="normal">3325</span>
<span class="normal">3326</span>
<span class="normal">3327</span>
<span class="normal">3328</span>
<span class="normal">3329</span>
<span class="normal">3330</span>
<span class="normal">3331</span>
<span class="normal">3332</span>
<span class="normal">3333</span>
<span class="normal">3334</span>
<span class="normal">3335</span>
<span class="normal">3336</span>
<span class="normal">3337</span>
<span class="normal">3338</span>
<span class="normal">3339</span>
<span class="normal">3340</span>
<span class="normal">3341</span>
<span class="normal">3342</span>
<span class="normal">3343</span>
<span class="normal">3344</span>
<span class="normal">3345</span>
<span class="normal">3346</span>
<span class="normal">3347</span>
<span class="normal">3348</span>
<span class="normal">3349</span>
<span class="normal">3350</span>
<span class="normal">3351</span>
<span class="normal">3352</span>
<span class="normal">3353</span>
<span class="normal">3354</span>
<span class="normal">3355</span>
<span class="normal">3356</span>
<span class="normal">3357</span>
<span class="normal">3358</span>
<span class="normal">3359</span>
<span class="normal">3360</span>
<span class="normal">3361</span>
<span class="normal">3362</span>
<span class="normal">3363</span>
<span class="normal">3364</span>
<span class="normal">3365</span>
<span class="normal">3366</span>
<span class="normal">3367</span>
<span class="normal">3368</span>
<span class="normal">3369</span>
<span class="normal">3370</span>
<span class="normal">3371</span>
<span class="normal">3372</span>
<span class="normal">3373</span>
<span class="normal">3374</span>
<span class="normal">3375</span>
<span class="normal">3376</span>
<span class="normal">3377</span>
<span class="normal">3378</span>
<span class="normal">3379</span>
<span class="normal">3380</span>
<span class="normal">3381</span>
<span class="normal">3382</span>
<span class="normal">3383</span>
<span class="normal">3384</span>
<span class="normal">3385</span>
<span class="normal">3386</span>
<span class="normal">3387</span>
<span class="normal">3388</span>
<span class="normal">3389</span>
<span class="normal">3390</span>
<span class="normal">3391</span>
<span class="normal">3392</span>
<span class="normal">3393</span>
<span class="normal">3394</span>
<span class="normal">3395</span>
<span class="normal">3396</span>
<span class="normal">3397</span>
<span class="normal">3398</span>
<span class="normal">3399</span>
<span class="normal">3400</span>
<span class="normal">3401</span>
<span class="normal">3402</span>
<span class="normal">3403</span>
<span class="normal">3404</span>
<span class="normal">3405</span>
<span class="normal">3406</span>
<span class="normal">3407</span>
<span class="normal">3408</span>
<span class="normal">3409</span>
<span class="normal">3410</span>
<span class="normal">3411</span>
<span class="normal">3412</span>
<span class="normal">3413</span>
<span class="normal">3414</span>
<span class="normal">3415</span>
<span class="normal">3416</span>
<span class="normal">3417</span>
<span class="normal">3418</span>
<span class="normal">3419</span>
<span class="normal">3420</span>
<span class="normal">3421</span>
<span class="normal">3422</span>
<span class="normal">3423</span>
<span class="normal">3424</span>
<span class="normal">3425</span>
<span class="normal">3426</span>
<span class="normal">3427</span>
<span class="normal">3428</span>
<span class="normal">3429</span>
<span class="normal">3430</span>
<span class="normal">3431</span>
<span class="normal">3432</span>
<span class="normal">3433</span>
<span class="normal">3434</span>
<span class="normal">3435</span>
<span class="normal">3436</span>
<span class="normal">3437</span>
<span class="normal">3438</span>
<span class="normal">3439</span>
<span class="normal">3440</span>
<span class="normal">3441</span>
<span class="normal">3442</span>
<span class="normal">3443</span>
<span class="normal">3444</span>
<span class="normal">3445</span>
<span class="normal">3446</span>
<span class="normal">3447</span>
<span class="normal">3448</span>
<span class="normal">3449</span>
<span class="normal">3450</span>
<span class="normal">3451</span>
<span class="normal">3452</span>
<span class="normal">3453</span>
<span class="normal">3454</span>
<span class="normal">3455</span>
<span class="normal">3456</span>
<span class="normal">3457</span>
<span class="normal">3458</span>
<span class="normal">3459</span>
<span class="normal">3460</span>
<span class="normal">3461</span>
<span class="normal">3462</span>
<span class="normal">3463</span>
<span class="normal">3464</span>
<span class="normal">3465</span>
<span class="normal">3466</span>
<span class="normal">3467</span>
<span class="normal">3468</span>
<span class="normal">3469</span>
<span class="normal">3470</span>
<span class="normal">3471</span>
<span class="normal">3472</span>
<span class="normal">3473</span>
<span class="normal">3474</span>
<span class="normal">3475</span>
<span class="normal">3476</span>
<span class="normal">3477</span>
<span class="normal">3478</span>
<span class="normal">3479</span>
<span class="normal">3480</span>
<span class="normal">3481</span>
<span class="normal">3482</span>
<span class="normal">3483</span>
<span class="normal">3484</span>
<span class="normal">3485</span>
<span class="normal">3486</span>
<span class="normal">3487</span>
<span class="normal">3488</span>
<span class="normal">3489</span>
<span class="normal">3490</span>
<span class="normal">3491</span>
<span class="normal">3492</span>
<span class="normal">3493</span>
<span class="normal">3494</span>
<span class="normal">3495</span>
<span class="normal">3496</span>
<span class="normal">3497</span>
<span class="normal">3498</span>
<span class="normal">3499</span>
<span class="normal">3500</span>
<span class="normal">3501</span>
<span class="normal">3502</span>
<span class="normal">3503</span>
<span class="normal">3504</span>
<span class="normal">3505</span>
<span class="normal">3506</span>
<span class="normal">3507</span>
<span class="normal">3508</span>
<span class="normal">3509</span>
<span class="normal">3510</span>
<span class="normal">3511</span>
<span class="normal">3512</span>
<span class="normal">3513</span>
<span class="normal">3514</span>
<span class="normal">3515</span>
<span class="normal">3516</span>
<span class="normal">3517</span>
<span class="normal">3518</span>
<span class="normal">3519</span>
<span class="normal">3520</span>
<span class="normal">3521</span>
<span class="normal">3522</span>
<span class="normal">3523</span>
<span class="normal">3524</span>
<span class="normal">3525</span>
<span class="normal">3526</span>
<span class="normal">3527</span>
<span class="normal">3528</span>
<span class="normal">3529</span>
<span class="normal">3530</span>
<span class="normal">3531</span>
<span class="normal">3532</span>
<span class="normal">3533</span>
<span class="normal">3534</span>
<span class="normal">3535</span>
<span class="normal">3536</span>
<span class="normal">3537</span>
<span class="normal">3538</span>
<span class="normal">3539</span>
<span class="normal">3540</span>
<span class="normal">3541</span>
<span class="normal">3542</span>
<span class="normal">3543</span>
<span class="normal">3544</span>
<span class="normal">3545</span>
<span class="normal">3546</span>
<span class="normal">3547</span>
<span class="normal">3548</span>
<span class="normal">3549</span>
<span class="normal">3550</span>
<span class="normal">3551</span>
<span class="normal">3552</span>
<span class="normal">3553</span>
<span class="normal">3554</span>
<span class="normal">3555</span>
<span class="normal">3556</span>
<span class="normal">3557</span>
<span class="normal">3558</span>
<span class="normal">3559</span>
<span class="normal">3560</span>
<span class="normal">3561</span>
<span class="normal">3562</span>
<span class="normal">3563</span>
<span class="normal">3564</span>
<span class="normal">3565</span>
<span class="normal">3566</span>
<span class="normal">3567</span>
<span class="normal">3568</span>
<span class="normal">3569</span>
<span class="normal">3570</span>
<span class="normal">3571</span>
<span class="normal">3572</span>
<span class="normal">3573</span>
<span class="normal">3574</span>
<span class="normal">3575</span>
<span class="normal">3576</span>
<span class="normal">3577</span>
<span class="normal">3578</span>
<span class="normal">3579</span>
<span class="normal">3580</span>
<span class="normal">3581</span>
<span class="normal">3582</span>
<span class="normal">3583</span>
<span class="normal">3584</span>
<span class="normal">3585</span>
<span class="normal">3586</span>
<span class="normal">3587</span>
<span class="normal">3588</span>
<span class="normal">3589</span>
<span class="normal">3590</span>
<span class="normal">3591</span>
<span class="normal">3592</span>
<span class="normal">3593</span>
<span class="normal">3594</span>
<span class="normal">3595</span>
<span class="normal">3596</span>
<span class="normal">3597</span>
<span class="normal">3598</span>
<span class="normal">3599</span>
<span class="normal">3600</span>
<span class="normal">3601</span>
<span class="normal">3602</span>
<span class="normal">3603</span>
<span class="normal">3604</span>
<span class="normal">3605</span>
<span class="normal">3606</span>
<span class="normal">3607</span>
<span class="normal">3608</span>
<span class="normal">3609</span>
<span class="normal">3610</span>
<span class="normal">3611</span>
<span class="normal">3612</span>
<span class="normal">3613</span>
<span class="normal">3614</span>
<span class="normal">3615</span>
<span class="normal">3616</span>
<span class="normal">3617</span>
<span class="normal">3618</span>
<span class="normal">3619</span>
<span class="normal">3620</span>
<span class="normal">3621</span>
<span class="normal">3622</span>
<span class="normal">3623</span>
<span class="normal">3624</span>
<span class="normal">3625</span>
<span class="normal">3626</span>
<span class="normal">3627</span>
<span class="normal">3628</span>
<span class="normal">3629</span>
<span class="normal">3630</span>
<span class="normal">3631</span>
<span class="normal">3632</span>
<span class="normal">3633</span>
<span class="normal">3634</span>
<span class="normal">3635</span>
<span class="normal">3636</span>
<span class="normal">3637</span>
<span class="normal">3638</span>
<span class="normal">3639</span>
<span class="normal">3640</span>
<span class="normal">3641</span>
<span class="normal">3642</span>
<span class="normal">3643</span>
<span class="normal">3644</span>
<span class="normal">3645</span>
<span class="normal">3646</span>
<span class="normal">3647</span>
<span class="normal">3648</span>
<span class="normal">3649</span>
<span class="normal">3650</span>
<span class="normal">3651</span>
<span class="normal">3652</span>
<span class="normal">3653</span>
<span class="normal">3654</span>
<span class="normal">3655</span>
<span class="normal">3656</span>
<span class="normal">3657</span>
<span class="normal">3658</span>
<span class="normal">3659</span>
<span class="normal">3660</span>
<span class="normal">3661</span>
<span class="normal">3662</span>
<span class="normal">3663</span>
<span class="normal">3664</span>
<span class="normal">3665</span>
<span class="normal">3666</span>
<span class="normal">3667</span>
<span class="normal">3668</span>
<span class="normal">3669</span>
<span class="normal">3670</span>
<span class="normal">3671</span>
<span class="normal">3672</span>
<span class="normal">3673</span>
<span class="normal">3674</span>
<span class="normal">3675</span>
<span class="normal">3676</span>
<span class="normal">3677</span>
<span class="normal">3678</span>
<span class="normal">3679</span>
<span class="normal">3680</span>
<span class="normal">3681</span>
<span class="normal">3682</span>
<span class="normal">3683</span>
<span class="normal">3684</span>
<span class="normal">3685</span>
<span class="normal">3686</span>
<span class="normal">3687</span>
<span class="normal">3688</span>
<span class="normal">3689</span>
<span class="normal">3690</span>
<span class="normal">3691</span>
<span class="normal">3692</span>
<span class="normal">3693</span>
<span class="normal">3694</span>
<span class="normal">3695</span>
<span class="normal">3696</span>
<span class="normal">3697</span>
<span class="normal">3698</span>
<span class="normal">3699</span>
<span class="normal">3700</span>
<span class="normal">3701</span>
<span class="normal">3702</span>
<span class="normal">3703</span>
<span class="normal">3704</span>
<span class="normal">3705</span>
<span class="normal">3706</span>
<span class="normal">3707</span>
<span class="normal">3708</span>
<span class="normal">3709</span>
<span class="normal">3710</span>
<span class="normal">3711</span>
<span class="normal">3712</span>
<span class="normal">3713</span>
<span class="normal">3714</span>
<span class="normal">3715</span>
<span class="normal">3716</span>
<span class="normal">3717</span>
<span class="normal">3718</span>
<span class="normal">3719</span>
<span class="normal">3720</span>
<span class="normal">3721</span>
<span class="normal">3722</span>
<span class="normal">3723</span>
<span class="normal">3724</span>
<span class="normal">3725</span>
<span class="normal">3726</span>
<span class="normal">3727</span>
<span class="normal">3728</span>
<span class="normal">3729</span>
<span class="normal">3730</span>
<span class="normal">3731</span>
<span class="normal">3732</span>
<span class="normal">3733</span>
<span class="normal">3734</span>
<span class="normal">3735</span>
<span class="normal">3736</span>
<span class="normal">3737</span>
<span class="normal">3738</span>
<span class="normal">3739</span>
<span class="normal">3740</span>
<span class="normal">3741</span>
<span class="normal">3742</span>
<span class="normal">3743</span>
<span class="normal">3744</span>
<span class="normal">3745</span>
<span class="normal">3746</span>
<span class="normal">3747</span>
<span class="normal">3748</span>
<span class="normal">3749</span>
<span class="normal">3750</span>
<span class="normal">3751</span>
<span class="normal">3752</span>
<span class="normal">3753</span>
<span class="normal">3754</span>
<span class="normal">3755</span>
<span class="normal">3756</span>
<span class="normal">3757</span>
<span class="normal">3758</span>
<span class="normal">3759</span>
<span class="normal">3760</span>
<span class="normal">3761</span>
<span class="normal">3762</span>
<span class="normal">3763</span>
<span class="normal">3764</span>
<span class="normal">3765</span>
<span class="normal">3766</span>
<span class="normal">3767</span>
<span class="normal">3768</span>
<span class="normal">3769</span>
<span class="normal">3770</span>
<span class="normal">3771</span>
<span class="normal">3772</span>
<span class="normal">3773</span>
<span class="normal">3774</span>
<span class="normal">3775</span>
<span class="normal">3776</span>
<span class="normal">3777</span>
<span class="normal">3778</span>
<span class="normal">3779</span>
<span class="normal">3780</span>
<span class="normal">3781</span>
<span class="normal">3782</span>
<span class="normal">3783</span>
<span class="normal">3784</span>
<span class="normal">3785</span>
<span class="normal">3786</span>
<span class="normal">3787</span>
<span class="normal">3788</span>
<span class="normal">3789</span>
<span class="normal">3790</span>
<span class="normal">3791</span>
<span class="normal">3792</span>
<span class="normal">3793</span>
<span class="normal">3794</span>
<span class="normal">3795</span>
<span class="normal">3796</span>
<span class="normal">3797</span>
<span class="normal">3798</span>
<span class="normal">3799</span>
<span class="normal">3800</span>
<span class="normal">3801</span>
<span class="normal">3802</span>
<span class="normal">3803</span>
<span class="normal">3804</span>
<span class="normal">3805</span>
<span class="normal">3806</span>
<span class="normal">3807</span>
<span class="normal">3808</span>
<span class="normal">3809</span>
<span class="normal">3810</span>
<span class="normal">3811</span>
<span class="normal">3812</span>
<span class="normal">3813</span>
<span class="normal">3814</span>
<span class="normal">3815</span>
<span class="normal">3816</span>
<span class="normal">3817</span>
<span class="normal">3818</span>
<span class="normal">3819</span>
<span class="normal">3820</span>
<span class="normal">3821</span>
<span class="normal">3822</span>
<span class="normal">3823</span>
<span class="normal">3824</span>
<span class="normal">3825</span>
<span class="normal">3826</span>
<span class="normal">3827</span>
<span class="normal">3828</span>
<span class="normal">3829</span>
<span class="normal">3830</span>
<span class="normal">3831</span>
<span class="normal">3832</span>
<span class="normal">3833</span>
<span class="normal">3834</span>
<span class="normal">3835</span>
<span class="normal">3836</span>
<span class="normal">3837</span>
<span class="normal">3838</span>
<span class="normal">3839</span>
<span class="normal">3840</span>
<span class="normal">3841</span>
<span class="normal">3842</span>
<span class="normal">3843</span>
<span class="normal">3844</span>
<span class="normal">3845</span>
<span class="normal">3846</span>
<span class="normal">3847</span>
<span class="normal">3848</span>
<span class="normal">3849</span>
<span class="normal">3850</span>
<span class="normal">3851</span>
<span class="normal">3852</span>
<span class="normal">3853</span>
<span class="normal">3854</span>
<span class="normal">3855</span>
<span class="normal">3856</span>
<span class="normal">3857</span>
<span class="normal">3858</span>
<span class="normal">3859</span>
<span class="normal">3860</span>
<span class="normal">3861</span>
<span class="normal">3862</span>
<span class="normal">3863</span>
<span class="normal">3864</span>
<span class="normal">3865</span>
<span class="normal">3866</span>
<span class="normal">3867</span>
<span class="normal">3868</span>
<span class="normal">3869</span>
<span class="normal">3870</span>
<span class="normal">3871</span>
<span class="normal">3872</span>
<span class="normal">3873</span>
<span class="normal">3874</span>
<span class="normal">3875</span>
<span class="normal">3876</span>
<span class="normal">3877</span>
<span class="normal">3878</span>
<span class="normal">3879</span>
<span class="normal">3880</span>
<span class="normal">3881</span>
<span class="normal">3882</span>
<span class="normal">3883</span>
<span class="normal">3884</span>
<span class="normal">3885</span>
<span class="normal">3886</span>
<span class="normal">3887</span>
<span class="normal">3888</span>
<span class="normal">3889</span>
<span class="normal">3890</span>
<span class="normal">3891</span>
<span class="normal">3892</span>
<span class="normal">3893</span>
<span class="normal">3894</span>
<span class="normal">3895</span>
<span class="normal">3896</span>
<span class="normal">3897</span>
<span class="normal">3898</span>
<span class="normal">3899</span>
<span class="normal">3900</span>
<span class="normal">3901</span>
<span class="normal">3902</span>
<span class="normal">3903</span>
<span class="normal">3904</span>
<span class="normal">3905</span>
<span class="normal">3906</span>
<span class="normal">3907</span>
<span class="normal">3908</span>
<span class="normal">3909</span>
<span class="normal">3910</span>
<span class="normal">3911</span>
<span class="normal">3912</span>
<span class="normal">3913</span>
<span class="normal">3914</span>
<span class="normal">3915</span>
<span class="normal">3916</span>
<span class="normal">3917</span>
<span class="normal">3918</span>
<span class="normal">3919</span>
<span class="normal">3920</span>
<span class="normal">3921</span>
<span class="normal">3922</span>
<span class="normal">3923</span>
<span class="normal">3924</span>
<span class="normal">3925</span>
<span class="normal">3926</span>
<span class="normal">3927</span>
<span class="normal">3928</span>
<span class="normal">3929</span>
<span class="normal">3930</span>
<span class="normal">3931</span>
<span class="normal">3932</span>
<span class="normal">3933</span>
<span class="normal">3934</span>
<span class="normal">3935</span>
<span class="normal">3936</span>
<span class="normal">3937</span>
<span class="normal">3938</span>
<span class="normal">3939</span>
<span class="normal">3940</span>
<span class="normal">3941</span>
<span class="normal">3942</span>
<span class="normal">3943</span>
<span class="normal">3944</span>
<span class="normal">3945</span>
<span class="normal">3946</span>
<span class="normal">3947</span>
<span class="normal">3948</span>
<span class="normal">3949</span>
<span class="normal">3950</span>
<span class="normal">3951</span>
<span class="normal">3952</span>
<span class="normal">3953</span>
<span class="normal">3954</span>
<span class="normal">3955</span>
<span class="normal">3956</span>
<span class="normal">3957</span>
<span class="normal">3958</span>
<span class="normal">3959</span>
<span class="normal">3960</span>
<span class="normal">3961</span>
<span class="normal">3962</span>
<span class="normal">3963</span>
<span class="normal">3964</span>
<span class="normal">3965</span>
<span class="normal">3966</span>
<span class="normal">3967</span>
<span class="normal">3968</span>
<span class="normal">3969</span>
<span class="normal">3970</span>
<span class="normal">3971</span>
<span class="normal">3972</span>
<span class="normal">3973</span>
<span class="normal">3974</span>
<span class="normal">3975</span>
<span class="normal">3976</span>
<span class="normal">3977</span>
<span class="normal">3978</span>
<span class="normal">3979</span>
<span class="normal">3980</span>
<span class="normal">3981</span>
<span class="normal">3982</span>
<span class="normal">3983</span>
<span class="normal">3984</span>
<span class="normal">3985</span>
<span class="normal">3986</span>
<span class="normal">3987</span>
<span class="normal">3988</span>
<span class="normal">3989</span>
<span class="normal">3990</span>
<span class="normal">3991</span>
<span class="normal">3992</span>
<span class="normal">3993</span>
<span class="normal">3994</span>
<span class="normal">3995</span>
<span class="normal">3996</span>
<span class="normal">3997</span>
<span class="normal">3998</span>
<span class="normal">3999</span>
<span class="normal">4000</span>
<span class="normal">4001</span>
<span class="normal">4002</span>
<span class="normal">4003</span>
<span class="normal">4004</span>
<span class="normal">4005</span>
<span class="normal">4006</span>
<span class="normal">4007</span>
<span class="normal">4008</span>
<span class="normal">4009</span>
<span class="normal">4010</span>
<span class="normal">4011</span>
<span class="normal">4012</span>
<span class="normal">4013</span>
<span class="normal">4014</span>
<span class="normal">4015</span>
<span class="normal">4016</span>
<span class="normal">4017</span>
<span class="normal">4018</span>
<span class="normal">4019</span>
<span class="normal">4020</span>
<span class="normal">4021</span>
<span class="normal">4022</span>
<span class="normal">4023</span>
<span class="normal">4024</span>
<span class="normal">4025</span>
<span class="normal">4026</span>
<span class="normal">4027</span>
<span class="normal">4028</span>
<span class="normal">4029</span>
<span class="normal">4030</span>
<span class="normal">4031</span>
<span class="normal">4032</span>
<span class="normal">4033</span>
<span class="normal">4034</span>
<span class="normal">4035</span>
<span class="normal">4036</span>
<span class="normal">4037</span>
<span class="normal">4038</span>
<span class="normal">4039</span>
<span class="normal">4040</span>
<span class="normal">4041</span>
<span class="normal">4042</span>
<span class="normal">4043</span>
<span class="normal">4044</span>
<span class="normal">4045</span>
<span class="normal">4046</span>
<span class="normal">4047</span>
<span class="normal">4048</span>
<span class="normal">4049</span>
<span class="normal">4050</span>
<span class="normal">4051</span>
<span class="normal">4052</span>
<span class="normal">4053</span>
<span class="normal">4054</span>
<span class="normal">4055</span>
<span class="normal">4056</span>
<span class="normal">4057</span>
<span class="normal">4058</span>
<span class="normal">4059</span>
<span class="normal">4060</span>
<span class="normal">4061</span>
<span class="normal">4062</span>
<span class="normal">4063</span>
<span class="normal">4064</span>
<span class="normal">4065</span>
<span class="normal">4066</span>
<span class="normal">4067</span>
<span class="normal">4068</span>
<span class="normal">4069</span>
<span class="normal">4070</span>
<span class="normal">4071</span>
<span class="normal">4072</span>
<span class="normal">4073</span>
<span class="normal">4074</span>
<span class="normal">4075</span>
<span class="normal">4076</span>
<span class="normal">4077</span>
<span class="normal">4078</span>
<span class="normal">4079</span>
<span class="normal">4080</span>
<span class="normal">4081</span>
<span class="normal">4082</span>
<span class="normal">4083</span>
<span class="normal">4084</span>
<span class="normal">4085</span>
<span class="normal">4086</span>
<span class="normal">4087</span>
<span class="normal">4088</span>
<span class="normal">4089</span>
<span class="normal">4090</span>
<span class="normal">4091</span>
<span class="normal">4092</span>
<span class="normal">4093</span>
<span class="normal">4094</span>
<span class="normal">4095</span>
<span class="normal">4096</span>
<span class="normal">4097</span>
<span class="normal">4098</span>
<span class="normal">4099</span>
<span class="normal">4100</span>
<span class="normal">4101</span>
<span class="normal">4102</span>
<span class="normal">4103</span>
<span class="normal">4104</span>
<span class="normal">4105</span>
<span class="normal">4106</span>
<span class="normal">4107</span>
<span class="normal">4108</span>
<span class="normal">4109</span>
<span class="normal">4110</span>
<span class="normal">4111</span>
<span class="normal">4112</span>
<span class="normal">4113</span>
<span class="normal">4114</span>
<span class="normal">4115</span>
<span class="normal">4116</span>
<span class="normal">4117</span>
<span class="normal">4118</span>
<span class="normal">4119</span>
<span class="normal">4120</span>
<span class="normal">4121</span>
<span class="normal">4122</span>
<span class="normal">4123</span>
<span class="normal">4124</span>
<span class="normal">4125</span>
<span class="normal">4126</span>
<span class="normal">4127</span>
<span class="normal">4128</span>
<span class="normal">4129</span>
<span class="normal">4130</span>
<span class="normal">4131</span>
<span class="normal">4132</span>
<span class="normal">4133</span>
<span class="normal">4134</span>
<span class="normal">4135</span>
<span class="normal">4136</span>
<span class="normal">4137</span>
<span class="normal">4138</span>
<span class="normal">4139</span>
<span class="normal">4140</span>
<span class="normal">4141</span>
<span class="normal">4142</span>
<span class="normal">4143</span>
<span class="normal">4144</span>
<span class="normal">4145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RecAtom</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">extrapolate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        RecAtom class. Used to manage recombination data and compute emissivities.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            elem:          symbol of the selected element</span>
<span class="sd">            spec:          ionization stage in spectroscopic notation (I = 1, II = 2, etc.)</span>
<span class="sd">            extrapolate: use the function outside the validity range [False]</span>

<span class="sd">        **Usage:**</span>
<span class="sd">            H1 = pn.RecAtom(&#39;H&#39;, 1)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span> <span class="o">=</span> <span class="n">log_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;rec&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_valid</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case</span> <span class="o">=</span> <span class="n">case</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extrapolate</span> <span class="o">=</span> <span class="n">extrapolate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sources</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">atom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elem</span> <span class="o">=</span> <span class="n">parseAtom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parseAtom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elem</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elem</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">sym2name</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">=</span> <span class="s1">&#39;Atom &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;Making rec-atom object for </span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">elem</span> <span class="ow">in</span> <span class="n">IP</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">IP</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">IP</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">])</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">IP</span> <span class="o">=</span> <span class="n">IP</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">IP</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IP</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">recFitsFile</span> <span class="o">=</span> <span class="n">atomicData</span><span class="o">.</span><span class="n">getDataFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="s1">&#39;rec&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recFitsFile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">useNIST</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;fits&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loadFit</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;hdf5&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loadHDF5</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;func&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loadFunctions</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_valid</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="s1">&#39;trc&#39;</span> <span class="ow">in</span> <span class="n">atomicData</span><span class="o">.</span><span class="n">getDataFile</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loadTotRecombination</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">E_in_vacuum</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comments</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">useNIST</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NIST</span> <span class="o">=</span> <span class="n">getLevelsNIST</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">)</span>
            <span class="n">web</span> <span class="o">=</span> <span class="s1">&#39;Ref. </span><span class="si">{0}</span><span class="s1"> of NIST 2014 (try this: http://physics.nist.gov/cgi-bin/ASBib1/get_ASBib_ref.cgi?db=el&amp;db_id=</span><span class="si">{0}</span><span class="s1">&amp;comment_code=&amp;element=</span><span class="si">{1}</span><span class="s1">&amp;spectr_charge=</span><span class="si">{2}</span><span class="s1">&amp;&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NIST</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NIST</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NIST</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1e8</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">[</span><span class="s1">&#39;VACUUM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">[</span><span class="s1">&#39;NOTE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Energy levels&#39;</span>
                <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NIST</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">web</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ref</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initWaves</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NIST</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">atomicData</span><span class="o">.</span><span class="n">add2usedFiles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">recFitsFile</span><span class="p">)</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">_test_lev</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test whether selected level is legal</span>

<span class="sd">        Parameters:</span>
<span class="sd">            level:        selected atom level</span>

<span class="sd">        &quot;&quot;&quot;</span>       
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No levels defined&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">level</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Wrong value for level: </span><span class="si">{0}</span><span class="s1">, maximum = </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">),</span>
                            <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">initWaves</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialization of wave_Ang</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">wave</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_in_vacuum</span><span class="p">:</span>
                    <span class="n">wave</span> <span class="o">=</span> <span class="n">vactoair</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">wave</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">getWave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the wavelength of a transition given the levels </span>

<span class="sd">        Parameters:</span>
<span class="sd">            lev_i: upper level of the transition</span>
<span class="sd">            lev_j: lower level of the transition</span>

<span class="sd">        **Usage:**</span>
<span class="sd">            He2.getWave(4, 3)</span>

<span class="sd">        &quot;&quot;&quot;</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">lev_i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">lev_j</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="p">[</span><span class="n">lev_i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_loadHDF5</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to read the atomic data hdf5 file and store the data</span>
<span class="sd">        Called by __init__</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">INSTALLED</span><span class="p">[</span><span class="s1">&#39;h5py&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">INSTALLED</span><span class="p">[</span><span class="s1">&#39;astropy Table&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;You need to install astropy (prefered) or h5py&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recFitsFile</span> <span class="o">=</span> <span class="n">atomicData</span><span class="o">.</span><span class="n">getDataFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="s1">&#39;rec&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recFitsFile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No hdf5 data for atom: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recFitsFullPath</span> <span class="o">=</span> <span class="n">atomicData</span><span class="o">.</span><span class="n">getDataFullPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="s1">&#39;rec&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">INSTALLED</span><span class="p">[</span><span class="s1">&#39;astropy Table&#39;</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">hf5</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recFitsFullPath</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;updated_data&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_RecombData</span> <span class="o">=</span> <span class="n">hf5</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;HDF5 data read from </span><span class="si">{}</span><span class="s1"> using Astropy.table&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recFitsFullPath</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> recombination file not read&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recFitsFullPath</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">INSTALLED</span><span class="p">[</span><span class="s1">&#39;h5py&#39;</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">hf5</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recFitsFullPath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_RecombData</span> <span class="o">=</span> <span class="n">hf5</span><span class="p">[</span><span class="s1">&#39;updated_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_RecombData</span> <span class="o">=</span> <span class="n">hf5</span><span class="p">[</span><span class="s1">&#39;updated_data&#39;</span><span class="p">]</span>
                <span class="n">hf5</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;HDF5 data read from </span><span class="si">{}</span><span class="s1"> using h5py&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recFitsFullPath</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> recombination file not read&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recFitsFullPath</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_RecombData</span><span class="p">[</span><span class="s1">&#39;TEMP&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No TEMP field in </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recFitsFile</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_dens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_RecombData</span><span class="p">[</span><span class="s1">&#39;DENS&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No DENS field in </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recFitsFile</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_RecombData</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="k">if</span> <span class="n">l</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;TEMP&#39;</span><span class="p">,</span> <span class="s1">&#39;DENS&#39;</span><span class="p">)])</span>
        <span class="k">if</span> <span class="s1">&#39;_&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_RecombData</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_type</span> <span class="o">=</span> <span class="s1">&#39;transitions&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_type</span> <span class="o">=</span> <span class="s1">&#39;wavelengths&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;SOURCE&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_RecombData</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_RecombData</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;SOURCE&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recFitsFile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;SH95&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">useNIST</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> recombination data read from </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">recFitsFile</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_loadFit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to read the atomic data fits file and store the data</span>
<span class="sd">        Called by __init__</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">recFitsFullPath</span> <span class="o">=</span> <span class="n">atomicData</span><span class="o">.</span><span class="n">getDataFullPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="s1">&#39;rec&#39;</span><span class="p">)</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recFitsFullPath</span><span class="p">,</span> <span class="n">ignore_missing_end</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">header</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;SOURCE&#39;</span> <span class="ow">in</span> <span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">number</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;SOURCE&#39;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NOTE&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SOURCE&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="s1">&#39;Atomic data:&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SOURCE&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)))</span>




        <span class="bp">self</span><span class="o">.</span><span class="n">recFitsFile</span> <span class="o">=</span> <span class="n">atomicData</span><span class="o">.</span><span class="n">getDataFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="s1">&#39;rec&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recFitsFile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No fits data for atom: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recFitsFullPath</span> <span class="o">=</span> <span class="n">atomicData</span><span class="o">.</span><span class="n">getDataFullPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="s1">&#39;rec&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">hdu</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recFitsFullPath</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> recombination file not read&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recFitsFile</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_RecombData</span> <span class="o">=</span> <span class="n">hdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">hdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
        <span class="n">hdu</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_RecombData</span><span class="p">[</span><span class="s1">&#39;TEMP&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No TEMP field in </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recFitsFile</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_dens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_RecombData</span><span class="p">[</span><span class="s1">&#39;DENS&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No DENS field in </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recFitsFile</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_RecombData</span><span class="o">.</span><span class="n">names</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;TEMP&#39;</span><span class="p">)]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;DENS&#39;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="s1">&#39;_&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_RecombData</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_type</span> <span class="o">=</span> <span class="s1">&#39;transitions&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_type</span> <span class="o">=</span> <span class="s1">&#39;wavelengths&#39;</span>

        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">header</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;SOURCE&#39;</span> <span class="ow">in</span> <span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">number</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;SOURCE&#39;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NOTE&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span><span class="o">+</span> <span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SOURCE&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="s1">&#39;Atomic data:&#39;</span><span class="o">+</span> <span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SOURCE&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)))</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recFitsFile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;SH95&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">useNIST</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> recombination data read from </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">recFitsFile</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_loadFunctions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read functions to compute emissivities from formulae.</span>
<span class="sd">        Define the emis_func function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">useNIST</span> <span class="o">=</span> <span class="kc">False</span>        

        <span class="bp">self</span><span class="o">.</span><span class="n">recFitsFile</span> <span class="o">=</span> <span class="n">atomicData</span><span class="o">.</span><span class="n">getDataFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="s1">&#39;rec&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recFitsFile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No func data for atom: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recFitsFullPath</span> <span class="o">=</span> <span class="n">atomicData</span><span class="o">.</span><span class="n">getDataFullPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="s1">&#39;rec&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recFitsFullPath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_funcType</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funcType</span> <span class="o">==</span> <span class="s1">&#39;PEQ1991&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recFitsFullPath</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                     <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span> 
                                     <span class="n">names</span><span class="o">=</span><span class="s1">&#39;label, lamb, case, a, b, c, d, Br&#39;</span><span class="p">,</span> 
                                     <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;U5, f8, U1, f8, f8, f8, f8, f8, f8&quot;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error reading </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recFitsFullPath</span><span class="p">))</span>
            <span class="n">case_mask</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;case&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span>
            <span class="k">if</span> <span class="n">case_mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No data for this case </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">case</span><span class="p">))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">case_mask</span><span class="p">]</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;lamb&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">10</span>  <span class="c1"># Angstrom</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">emis_func</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">dens</span><span class="p">):</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">label</span>
                <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
                    <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> 
                    <span class="n">t</span> <span class="o">=</span> <span class="mf">1e-4</span> <span class="o">*</span> <span class="n">temp</span> <span class="o">/</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span>
                    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1e-13</span> <span class="o">*</span> <span class="n">z</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">])</span>
                    <span class="n">E_Ryd</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;lamb&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e-8</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">RYD</span><span class="p">)</span>
                    <span class="n">E_erg</span> <span class="o">=</span> <span class="n">E_Ryd</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">RYD2ERG</span>   <span class="c1">#erg</span>
                    <span class="n">emis</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Br&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">E_erg</span>
                    <span class="n">single</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">extrapolate</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">single</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">t</span><span class="p">])</span>
                        <span class="n">mask</span> <span class="o">=</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mf">0.004</span>
                        <span class="n">emis</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="k">if</span> <span class="n">single</span><span class="p">:</span>
                        <span class="n">emis</span> <span class="o">=</span> <span class="n">emis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">return</span> <span class="n">emis</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not a valid label&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funcType</span> <span class="o">==</span> <span class="s1">&#39;S94&#39;</span><span class="p">:</span> <span class="c1"># O II</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recFitsFullPath</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>  
                                     <span class="n">names</span><span class="o">=</span><span class="s1">&#39;label, lamb, case, a, b, c, d&#39;</span><span class="p">,</span>
                                     <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;U5, f8, U1, f8, f8, f8, f8&quot;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error reading </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recFitsFullPath</span><span class="p">))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;case&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span><span class="p">]</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;lamb&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">10</span>  <span class="c1"># Angstrom</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">emis_func</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">dens</span><span class="p">):</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">label</span>
                <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="mf">1e-4</span> <span class="o">*</span> <span class="n">temp</span> 
                    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1e-14</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">E_Ryd</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;lamb&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e-8</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">RYD</span><span class="p">)</span>
                    <span class="n">E_erg</span> <span class="o">=</span> <span class="n">E_Ryd</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">RYD2ERG</span>   <span class="c1">#erg</span>
                    <span class="n">emis</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">E_erg</span>
                    <span class="n">single</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">extrapolate</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">single</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">t</span><span class="p">])</span>
                        <span class="n">mask</span> <span class="o">=</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mf">0.5</span>
                        <span class="n">emis</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="k">if</span> <span class="n">single</span><span class="p">:</span>
                        <span class="n">emis</span> <span class="o">=</span> <span class="n">emis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">return</span> <span class="n">emis</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not a valid label&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funcType</span> <span class="o">==</span> <span class="s1">&#39;D00&#39;</span><span class="p">:</span> <span class="c1"># C II</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recFitsFullPath</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>  
                                     <span class="n">names</span><span class="o">=</span><span class="s1">&#39;ID, case, lamb, a, b, c, d, f&#39;</span><span class="p">,</span>
                                     <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;i, U1, f8, f8, f8, f8, f8, f8&quot;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error reading </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recFitsFullPath</span><span class="p">))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;case&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span><span class="p">]</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;lamb&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">10</span>  <span class="c1"># Angstrom</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lamb</span><span class="p">)</span> <span class="k">for</span> <span class="n">lamb</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;lamb&#39;</span><span class="p">]])</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">emis_func</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">dens</span><span class="p">):</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">==</span> <span class="n">label</span>
                <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="mf">1e-4</span> <span class="o">*</span> <span class="n">temp</span> 
                    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1e-14</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">]</span> <span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> 
                                     <span class="n">d</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
                    <span class="n">E_Ryd</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;lamb&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e-8</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">RYD</span><span class="p">)</span>
                    <span class="n">E_erg</span> <span class="o">=</span> <span class="n">E_Ryd</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">RYD2ERG</span>   <span class="c1">#erg</span>
                    <span class="n">emis</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">E_erg</span>
                    <span class="n">single</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">extrapolate</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">single</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">t</span><span class="p">])</span>
                        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">t</span> <span class="o">&gt;</span> <span class="mf">2.0</span><span class="p">)</span>
                        <span class="n">emis</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="k">if</span> <span class="n">single</span><span class="p">:</span>
                        <span class="n">emis</span> <span class="o">=</span> <span class="n">emis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">return</span> <span class="n">emis</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not a valid label&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funcType</span> <span class="o">==</span> <span class="s1">&#39;FSL11&#39;</span><span class="p">:</span> <span class="c1"># N II</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recFitsFullPath</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
                                     <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">13</span><span class="p">),</span> 
                                     <span class="n">names</span><span class="o">=</span><span class="s1">&#39;case, mult, lamb, a, b, c, d, e, f, g, h, dens&#39;</span><span class="p">,</span> 
                                     <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;U1, U1, f8, f8, f8, f8, f8, f8, f8, f8, f8, f8&quot;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error reading </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recFitsFullPath</span><span class="p">))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;case&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span><span class="p">]</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lamb</span><span class="p">)</span> <span class="k">for</span> <span class="n">lamb</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;lamb&#39;</span><span class="p">]])</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">emis_func</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">dens</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">temp</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                    <span class="n">single</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                    <span class="n">single</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">dens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">dens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dens</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dens</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="n">mask2</span> <span class="o">=</span> <span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="n">label</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;dens&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">mask3</span> <span class="o">=</span> <span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="n">label</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;dens&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">mask4</span> <span class="o">=</span> <span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="n">label</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;dens&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
                <span class="n">mask5</span> <span class="o">=</span> <span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="n">label</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;dens&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mask2</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">d2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span>
                    <span class="n">d3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">mask3</span><span class="p">]</span>
                    <span class="n">d4</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">mask4</span><span class="p">]</span>
                    <span class="n">d5</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">mask5</span><span class="p">]</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="mf">1e-4</span> <span class="o">*</span> <span class="n">temp</span>
                    <span class="k">def</span><span class="w"> </span><span class="nf">alpha_gen</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
                        <span class="k">return</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">t</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">t</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">15</span><span class="p">)</span>
                    <span class="n">alpha2</span> <span class="o">=</span> <span class="n">alpha_gen</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                    <span class="n">alpha3</span> <span class="o">=</span> <span class="n">alpha_gen</span><span class="p">(</span><span class="n">d3</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                    <span class="n">alpha4</span> <span class="o">=</span> <span class="n">alpha_gen</span><span class="p">(</span><span class="n">d4</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                    <span class="n">alpha5</span> <span class="o">=</span> <span class="n">alpha_gen</span><span class="p">(</span><span class="n">d5</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

                    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

                    <span class="n">mask</span> <span class="o">=</span> <span class="n">dens</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">2</span>
                    <span class="n">alpha</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha2</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
                    <span class="n">mask</span> <span class="o">=</span> <span class="n">dens</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="o">**</span><span class="mi">5</span>
                    <span class="n">alpha</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha5</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
                    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">dens</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dens</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
                    <span class="n">alpha</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha3</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dens</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">alpha2</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dens</span><span class="p">[</span><span class="n">mask</span><span class="p">]))</span>
                    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">dens</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dens</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>
                    <span class="n">alpha</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha4</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dens</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">alpha3</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dens</span><span class="p">[</span><span class="n">mask</span><span class="p">]))</span>
                    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">dens</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dens</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="p">)</span>
                    <span class="n">alpha</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha5</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dens</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">alpha4</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">5</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dens</span><span class="p">[</span><span class="n">mask</span><span class="p">]))</span>

                    <span class="n">E_Ryd</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">d2</span><span class="p">[</span><span class="s1">&#39;lamb&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e-8</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">RYD</span><span class="p">)</span>
                    <span class="n">E_erg</span> <span class="o">=</span> <span class="n">E_Ryd</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">RYD2ERG</span>   <span class="c1">#erg</span>
                    <span class="n">emis</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">E_erg</span>
                    <span class="k">if</span> <span class="n">single</span><span class="p">:</span>
                        <span class="n">emis</span> <span class="o">=</span> <span class="n">emis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">return</span> <span class="n">emis</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not a valid label&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funcType</span> <span class="o">==</span> <span class="s1">&#39;KSDN1998&#39;</span><span class="p">:</span> <span class="c1"># Ne II</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">d1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recFitsFullPath</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">skip_footer</span><span class="o">=</span><span class="mi">38</span><span class="p">,</span> 
                                   <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">),</span> 
                                   <span class="n">names</span><span class="o">=</span><span class="s1">&#39;ID, case, lamb, a, b, c, d, f&#39;</span><span class="p">,</span>
                                   <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;i4, U1, f8, f8, f8, f8, f8, f8&quot;</span><span class="p">)</span>
                <span class="n">d2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recFitsFullPath</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">5</span><span class="o">+</span><span class="mi">215</span><span class="p">,</span> <span class="n">skip_footer</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                                   <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> 
                                   <span class="n">names</span><span class="o">=</span><span class="s1">&#39;ID, lamb, Br&#39;</span><span class="p">,</span>
                                   <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;i4, f8, f8&quot;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error reading </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recFitsFullPath</span><span class="p">))</span>
            <span class="n">d1</span> <span class="o">=</span> <span class="n">d1</span><span class="p">[</span><span class="n">d1</span><span class="p">[</span><span class="s1">&#39;case&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span><span class="p">]</span>
            <span class="n">d1</span><span class="p">[</span><span class="s1">&#39;lamb&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">10</span>  <span class="c1"># Angstrom</span>
            <span class="n">d2</span><span class="p">[</span><span class="s1">&#39;lamb&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">10</span>  <span class="c1"># Angstrom</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">]</span>
            <span class="n">labels1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{:.1f}</span><span class="s1">+&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lamb</span><span class="p">)</span> <span class="k">for</span> <span class="n">lamb</span> <span class="ow">in</span> <span class="n">d1</span><span class="p">[</span><span class="s1">&#39;lamb&#39;</span><span class="p">]])</span>
            <span class="n">labels2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lamb</span><span class="p">)</span> <span class="k">for</span> <span class="n">lamb</span> <span class="ow">in</span> <span class="n">d2</span><span class="p">[</span><span class="s1">&#39;lamb&#39;</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels1</span><span class="p">,</span> <span class="n">labels2</span><span class="p">)</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">emis_func</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">dens</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">label</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;+&#39;</span><span class="p">:</span>
                    <span class="n">mask</span> <span class="o">=</span> <span class="n">labels1</span> <span class="o">==</span> <span class="n">label</span>
                    <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">d</span> <span class="o">=</span> <span class="n">d1</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
                        <span class="n">t</span> <span class="o">=</span> <span class="mf">1e-4</span> <span class="o">*</span> <span class="n">temp</span> 
                        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1e-14</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">]</span> <span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
                        <span class="n">E_Ryd</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;lamb&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e-8</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">RYD</span><span class="p">)</span>
                        <span class="n">E_erg</span> <span class="o">=</span> <span class="n">E_Ryd</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">RYD2ERG</span>   <span class="c1">#erg</span>
                        <span class="n">emis</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">E_erg</span>
                        <span class="n">single</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">extrapolate</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">single</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">t</span><span class="p">])</span>
                            <span class="n">mask</span> <span class="o">=</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mf">0.1</span>
                            <span class="n">emis</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                        <span class="k">if</span> <span class="n">single</span><span class="p">:</span>
                            <span class="n">emis</span> <span class="o">=</span> <span class="n">emis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">return</span> <span class="n">emis</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not a valid label&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mask</span> <span class="o">=</span> <span class="n">labels2</span> <span class="o">==</span> <span class="n">label</span>
                    <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">dd2</span> <span class="o">=</span> <span class="n">d2</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
                        <span class="n">mask1</span> <span class="o">=</span> <span class="p">(</span><span class="n">d1</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">dd2</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">])</span> <span class="o">|</span> <span class="p">(</span><span class="n">d1</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">dd2</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">dd1</span> <span class="o">=</span> <span class="n">d1</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span>
                        <span class="n">t</span> <span class="o">=</span> <span class="mf">1e-4</span> <span class="o">*</span> <span class="n">temp</span>
                        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1e-14</span> <span class="o">*</span> <span class="n">dd1</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="n">dd1</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">]</span> <span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">dd1</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">dd1</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dd1</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
                        <span class="n">E_Ryd</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">dd2</span><span class="p">[</span><span class="s1">&#39;lamb&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e-8</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">RYD</span><span class="p">)</span>
                        <span class="n">E_erg</span> <span class="o">=</span> <span class="n">E_Ryd</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">RYD2ERG</span>   <span class="c1">#erg</span>
                        <span class="n">emis</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">E_erg</span> <span class="o">*</span> <span class="n">dd2</span><span class="p">[</span><span class="s1">&#39;Br&#39;</span><span class="p">]</span>
                        <span class="n">single</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">extrapolate</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">single</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">t</span><span class="p">])</span>
                            <span class="n">mask</span> <span class="o">=</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mf">0.1</span>
                            <span class="n">emis</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                        <span class="k">if</span> <span class="n">single</span><span class="p">:</span>
                            <span class="n">emis</span> <span class="o">=</span> <span class="n">emis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">return</span> <span class="n">emis</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not a valid label&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>       
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not a valid function label&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_funcType</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_func_data</span> <span class="o">=</span> <span class="n">data</span> 
        <span class="k">if</span> <span class="s1">&#39;_&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_type</span> <span class="o">=</span> <span class="s1">&#39;transitions&#39;</span>
        <span class="k">elif</span> <span class="s1">&#39;+&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_type</span> <span class="o">=</span> <span class="s1">&#39;wavelengths&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_type</span> <span class="o">=</span> <span class="s1">&#39;wavelengths&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emis_func</span> <span class="o">=</span> <span class="n">emis_func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> recombination data built from </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">recFitsFile</span><span class="p">),</span> 
                     <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_loadTotRecombination</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load the total recombination coefficient table. The case (A or B) is set by selecting the corresponding trc file. </span>
<span class="sd">        &quot;&quot;&quot;</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">TotRecFile</span> <span class="o">=</span> <span class="n">atomicData</span><span class="o">.</span><span class="n">getDataFullPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="s1">&#39;trc&#39;</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TotRecFile</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">den_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
        <span class="n">tem_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">d</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;***&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">::],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lg_den_grid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg_tem_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">den_points</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tem_points</span><span class="p">))</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">_Transition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="n">maxErrorA</span> <span class="o">=</span> <span class="mf">5.e-3</span><span class="p">,</span> <span class="n">maxErrorm</span> <span class="o">=</span> <span class="mf">5.e-2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an array with computed upper level, computed lower level, computed wavelength, </span>
<span class="sd">            input wavelength</span>

<span class="sd">        Parameters:</span>
<span class="sd">            wave:       wavelength either in Angstrom (a float or a label: e.g., 5007, &#39;5007A&#39;) </span>
<span class="sd">                            or in micron (a label: &#39;51.5m&#39;)</span>
<span class="sd">            maxErrorA: tolerance if the input wavelength is in Angstrom</span>
<span class="sd">            maxErrorm: tolerance if the input wavelength is in micron</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">wave</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
            <span class="n">inputWave</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wave</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">wave</span><span class="p">)</span>
            <span class="n">maxError</span> <span class="o">=</span> <span class="n">maxErrorA</span>
        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">wave</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
            <span class="n">inputWave</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wave</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e4</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">wave</span><span class="p">)</span>
            <span class="n">maxError</span> <span class="o">=</span> <span class="n">maxErrorm</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inputWave</span> <span class="o">=</span> <span class="n">wave</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">A&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">wave</span><span class="p">))</span>
            <span class="n">maxError</span> <span class="o">=</span> <span class="n">maxErrorA</span>

        <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">label2levelDict</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">label2levelDict</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">label2levelDict</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">inputWave</span><span class="p">,</span> <span class="n">inputWave</span><span class="p">]</span>
            <span class="k">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="n">j</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span> <span class="o">-</span> <span class="n">inputWave</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">bestWave</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">bestWave</span> <span class="o">-</span> <span class="n">inputWave</span><span class="p">)</span> <span class="o">/</span> <span class="n">inputWave</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bestWave</span><span class="p">,</span> <span class="n">inputWave</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">error</span> <span class="o">&gt;</span> <span class="n">maxError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;_Transition: wavelengths differ by more than </span><span class="si">{0:.2f}</span><span class="s1">%: input = </span><span class="si">{1:.2f}</span><span class="s1">, output = </span><span class="si">{2:.2f}</span><span class="s1">&#39;</span>\
                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">maxError</span><span class="p">,</span> <span class="n">inputWave</span><span class="p">,</span> <span class="n">bestWave</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">getTotRecombination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the total recombination coefficient. The case (A or B) is set by selecting the corresponding trc file.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            tem:  temperature </span>
<span class="sd">            den: density</span>
<span class="sd">            method:    interpolation method in the grid (&#39;linear&#39; = default, &#39;nearest&#39;, &#39;cubic&#39;)    </span>

<span class="sd">        **Usage:**</span>
<span class="sd">            atomicData.setDataFile(&#39;h_i_trc_SH95-caseA.dat&#39;)</span>
<span class="sd">            h1.getTotRecombination(tem=10000, den=5.e3)</span>

<span class="sd">        &quot;&quot;&quot;</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">=</span> <span class="s1">&#39;getTotRecombination&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;trc&#39;</span> <span class="ow">in</span> <span class="n">atomicData</span><span class="o">.</span><span class="n">getDataFile</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">griddata</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">lg_den_grid</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg_tem_grid</span><span class="o">.</span><span class="n">ravel</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_grid</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">den</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tem</span><span class="p">)),</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;No recombination data available for </span><span class="si">{0}</span><span class="s1"> in the adopted dictionary (but data may exist: please query atomicData.getAllAvailableFiles(&quot;&lt;atom&gt;&quot;) for trc files)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">getTransition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="n">maxErrorA</span> <span class="o">=</span> <span class="mf">5.e-3</span><span class="p">,</span> <span class="n">maxErrorm</span> <span class="o">=</span> <span class="mf">5.e-2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the indexes (upper level, lower level) of a transition for a given atom </span>
<span class="sd">            from the wavelength.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            wave:      wavelength in Angstrom (a float or a label: e.g., 5007, &#39;5007A&#39;) </span>
<span class="sd">                or in micron (a label: &#39;51.5m&#39;)</span>
<span class="sd">            maxErrorA: tolerance if the input wavelength is in Angstrom</span>
<span class="sd">            maxErrorm: tolerance if the input wavelength is in micron</span>

<span class="sd">        **Usage:**</span>

<span class="sd">            O3.getTransition(4959)</span>

<span class="sd">        &quot;&quot;&quot;</span> 
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Transition</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">maxErrorA</span> <span class="o">=</span> <span class="n">maxErrorA</span><span class="p">,</span> <span class="n">maxErrorm</span> <span class="o">=</span> <span class="n">maxErrorm</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">printTransition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wave</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print info on transition associated to input wavelength.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            wave:      wavelength in Angstrom (a float or a label: e.g., 5007, &#39;5007A&#39;) </span>
<span class="sd">                or in micron (a label: &#39;51.5m&#39;)</span>

<span class="sd">        **Usage:**</span>

<span class="sd">            O3.printTransition(4959)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">closestTransition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Transition</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">closestTransition</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No wavelengths defined&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">relativeError</span> <span class="o">=</span> <span class="n">closestTransition</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">closestTransition</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Input wave: </span><span class="si">{0:.1F}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">closestTransition</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Closest wave found: </span><span class="si">{0:.1F}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">closestTransition</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Relative error: </span><span class="si">{0:.0E}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">relativeError</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Transition: </span><span class="si">{0[0]}</span><span class="s1"> -&gt; </span><span class="si">{0[1]}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">closestTransition</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">grepLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">str_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return all the labels containing str_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="k">if</span> <span class="n">str_</span> <span class="ow">in</span> <span class="n">l</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">printSources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getSources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getEnergy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;1/Ang&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return energy level of selected level (or array of energy levels, if level not given) </span>
<span class="sd">            in Angstrom^-1 (default) or another unit</span>

<span class="sd">        Parameters:</span>
<span class="sd">            level:  selected atomic level (default= -1, returns complete array)</span>
<span class="sd">            unit:   [str] one of &#39;1/Ang&#39; (default), &#39;eV&#39;, or &#39;Ryd&#39;    </span>

<span class="sd">        **Usage:**</span>
<span class="sd">            O3.getEnergy(4, unit=&#39;eV&#39;)    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>

        <span class="n">unit_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;1/Ang&#39;</span><span class="p">:</span> <span class="mf">1.</span><span class="p">,</span>
                     <span class="s1">&#39;Ryd&#39;</span><span class="p">:</span> <span class="n">CST</span><span class="o">.</span><span class="n">RYD_ANG</span><span class="p">,</span>
                     <span class="s1">&#39;eV&#39;</span><span class="p">:</span> <span class="n">CST</span><span class="o">.</span><span class="n">RYD_ANG</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">RYD_EV</span><span class="p">,</span>
                     <span class="s1">&#39;cm-1&#39;</span><span class="p">:</span> <span class="mf">1e8</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unit_dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Unit </span><span class="si">{0}</span><span class="s1"> unknown, using 1/Ang&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unit</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">+</span> <span class="s1">&#39;.getEnergy&#39;</span><span class="p">)</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;1/Ang&#39;</span>        

        <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span> <span class="o">*</span> <span class="n">unit_dict</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="n">level</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">unit_dict</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">_checkLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return True if the label is compatible with the type of labels read form the data file</span>
<span class="sd">        &#39;transitions&#39; labels are of the form &quot;J_I&quot;</span>
<span class="sd">        &#39;wavelengths&#39; labels are of the form &quot;1234.5&quot; (dot is mandatory)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;_&#39;</span> <span class="ow">in</span> <span class="n">label</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_type</span> <span class="o">==</span> <span class="s1">&#39;transitions&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;+&#39;</span> <span class="ow">in</span> <span class="n">label</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_type</span> <span class="o">==</span> <span class="s1">&#39;wavelengths&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">label</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_type</span> <span class="o">==</span> <span class="s1">&#39;wavelengths&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">_getLabelStr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a string containing the label. </span>
<span class="sd">        If label is a float, it is transormed into a string .</span>
<span class="sd">        If label is not in the self.labels list, None is returned</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isreal</span><span class="p">(</span><span class="n">label</span><span class="p">):</span>
            <span class="n">label_str0</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">label_str1</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">label_str2</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label_str0</span> <span class="o">=</span> <span class="n">label_str1</span> <span class="o">=</span> <span class="n">label_str2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">label_str0</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">label_str0</span>
        <span class="k">elif</span> <span class="n">label_str1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">label_str1</span>
        <span class="k">elif</span> <span class="n">label_str2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">label_str2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">warn</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Label </span><span class="si">{0}</span><span class="s1"> not in </span><span class="si">{1}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">recFitsFile</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">getEmissivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the emissivity of a recombination line (erg.s-1.cm3). The arguments used to </span>
<span class="sd">        define the line depend on whether the atom is an hydrogenoid or not. </span>
<span class="sd">        In the first case, the transition can be specified either as a pair </span>
<span class="sd">        of levels lev_i, lev_j or as a label. </span>
<span class="sd">        In the second case, the transition can be specified either as a wavelength </span>
<span class="sd">        or as a label.</span>
<span class="sd">        In either case, enter &lt;atom&gt;.labels to display the valid labels.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            tem:            temperature (K)</span>
<span class="sd">            den:            density (cm-3)</span>
<span class="sd">            lev_i: upper level of transition</span>
<span class="sd">            lev_j: lower level of transition</span>
<span class="sd">            wave:           wavelength of the transition</span>
<span class="sd">            label:          label of the transition (e.g. &quot;50_3&quot;, &quot;1234.5&quot;)</span>
<span class="sd">            method:         interpolation method (&#39;linear&#39;, &#39;nearest&#39;, &#39;cubic&#39;), </span>
<span class="sd">                             sent to scipy.interpolate.griddata    </span>
<span class="sd">            product:        Boolean. If True (default), all the combination of (tem, den) are used. </span>
<span class="sd">                             If False, tem and den must have the same size and are joined.</span>

<span class="sd">        Usage:</span>

<span class="sd">            H1 = pn.RecAtom(&#39;H&#39;, 1)</span>

<span class="sd">            H1.getEmissivity([1e4, 1.2e4], [1e3, 1e2], lev_i = 4, lev_j = 2)</span>

<span class="sd">            H1.getEmissivity([1e4, 1.2e4], [1e3, 1e2], label=&#39;4_2&#39;, product=False)</span>

<span class="sd">            tem = np.linspace(5000, 20000, 100)</span>

<span class="sd">            den = np.logspace(2, 6, 100)</span>

<span class="sd">            imHab = H1.getEmissivity(tem, den, label=&#39;3_2&#39;) / H1.getEmissivity(tem, den, label=&#39;4_2&#39;)</span>

<span class="sd">            He1 = pn.RecAtom(&#39;He&#39;, 1)</span>

<span class="sd">            He1.getEmissivity(1e4, 1e2, wave=4471.0)</span>

<span class="sd">            He1.getEmissivity(1e4, 1e2, label=&#39;4471.0&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">INSTALLED</span><span class="p">[</span><span class="s1">&#39;scipy&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Scipy not installed, no RecAtom emissivities available&#39;</span><span class="p">,</span>
                          <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">tem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">den</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">den</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">product</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tem</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">den</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">temg</span> <span class="o">=</span> <span class="n">tem</span>
                <span class="n">deng</span> <span class="o">=</span> <span class="n">den</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">temg</span><span class="p">,</span> <span class="n">deng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span>
                <span class="n">temg</span> <span class="o">=</span> <span class="n">temg</span><span class="o">.</span><span class="n">T</span>
                <span class="n">deng</span> <span class="o">=</span> <span class="n">deng</span><span class="o">.</span><span class="n">T</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tem</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">den</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;tem and den must have the same size&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">temg</span> <span class="o">=</span> <span class="n">tem</span>
                <span class="n">deng</span> <span class="o">=</span> <span class="n">den</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lev_i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">lev_j</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wave</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#label = &#39;{0:.1f}&#39;.format(wave)</span>
            <span class="c1">#label_str = self._getLabelStr(label, warn=False)</span>
            <span class="n">label_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getLabelStr</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">label_str</span>
            <span class="k">if</span> <span class="n">label_str</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ij</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ij</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ij</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ij</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="n">product</span><span class="p">)</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">}</span>
            <span class="k">return</span> <span class="n">res</span>
        <span class="n">label_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getLabelStr</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">label_str</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Wrong label </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkLabel</span><span class="p">(</span><span class="n">label_str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Wrong label </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label_str</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;func&#39;</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emis_func</span><span class="p">(</span><span class="n">label_str</span><span class="p">,</span> <span class="n">temg</span><span class="p">,</span> <span class="n">deng</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">enu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_RecombData</span><span class="p">[</span><span class="n">label_str</span><span class="p">]</span>

            <span class="n">logd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">deng</span><span class="p">)</span>
            <span class="n">temp_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp</span><span class="p">)</span>
            <span class="c1">#temp_max = np.max(self.temp)</span>
            <span class="n">log_dens_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_dens</span><span class="p">)</span>
            <span class="n">log_dens_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_dens</span><span class="p">)</span>
            <span class="n">tt</span> <span class="o">=</span> <span class="p">(</span><span class="n">logd</span> <span class="o">&lt;</span> <span class="n">log_dens_min</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">logd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
                <span class="k">if</span> <span class="n">tt</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">logd</span> <span class="o">=</span> <span class="n">log_dens_min</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logd</span><span class="p">[</span><span class="n">tt</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_dens_min</span>
            <span class="n">tt</span> <span class="o">=</span> <span class="p">(</span><span class="n">logd</span> <span class="o">&gt;</span> <span class="n">log_dens_max</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">logd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tt</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">logd</span> <span class="o">=</span> <span class="n">log_dens_max</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logd</span><span class="p">[</span><span class="n">tt</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_dens_max</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">griddata</span><span class="p">((</span><span class="mf">1.</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_dens</span><span class="o">.</span><span class="n">ravel</span><span class="p">()),</span> <span class="n">enu</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
                                       <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">temg</span><span class="p">,</span> <span class="n">logd</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">temg</span> <span class="o">&lt;</span> <span class="n">temp_min</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">extrapolate</span><span class="p">:</span>
                <span class="n">masklowte</span> <span class="o">=</span> <span class="n">temg</span> <span class="o">&lt;</span> <span class="n">temp_min</span>
                <span class="n">temp_min2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">temp</span> <span class="o">&gt;</span> <span class="n">temp_min</span><span class="p">])</span>

                <span class="n">em_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">temp_min</span><span class="p">,</span> <span class="n">deng</span><span class="p">[</span><span class="n">masklowte</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
                                            <span class="n">lev_i</span><span class="o">=</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span><span class="n">lev_j</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span><span class="n">wave</span><span class="p">,</span> 
                                            <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
                <span class="n">em_min2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">temp_min2</span><span class="p">,</span> <span class="n">deng</span><span class="p">[</span><span class="n">masklowte</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
                                            <span class="n">lev_i</span><span class="o">=</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span><span class="n">lev_j</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span><span class="n">wave</span><span class="p">,</span> 
                                            <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
                <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">em_min</span> <span class="o">-</span> <span class="n">em_min2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">temp_min</span> <span class="o">-</span> <span class="mf">1.</span><span class="o">/</span><span class="n">temp_min2</span><span class="p">)</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">em_min</span> <span class="o">-</span> <span class="n">a</span> <span class="o">/</span> <span class="n">temp_min</span>
                <span class="n">em</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">temg</span><span class="p">[</span><span class="n">masklowte</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="o">+</span> <span class="n">b</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/Te + </span><span class="si">{}</span><span class="s1"> extrapolation on low Te&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
                <span class="n">res</span><span class="p">[</span><span class="n">masklowte</span><span class="p">]</span><span class="o">=</span><span class="n">em</span>
        <span class="k">return</span> <span class="n">res</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">getIonAbundance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">int_ratio</span><span class="p">,</span> <span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Hbeta</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span> <span class="n">tem_HI</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">den_HI</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the ionic abundance relative to H+ given the temperature, the density and the </span>
<span class="sd">            intensity of a line or sum of lines.</span>
<span class="sd">        The arguments used to define the line depend on whether the atom is an hydrogenoid or not. </span>
<span class="sd">        For hydrogenoids, the transition can be specified either as a pair of levels </span>
<span class="sd">            lev_i, lev_j, as a label, or as an I-type expression as the argument of to_eval </span>
<span class="sd">            (e.g. to_eval=&#39;I(50, 19)&#39; for the 50-&gt;19 transition). Wavelengths or L-type expressions </span>
<span class="sd">            will not work in this case. </span>
<span class="sd">        For non-hydrogenoids, the transition can be specified either as an integer wavelength, </span>
<span class="sd">            as a label, or as an A-type expression as the argument of to_eval (e.g. to_eval=&#39;A(4471)&#39; </span>
<span class="sd">            for the lambda=4471 transition). Note that all these alternatives imply that the wavelength</span>
<span class="sd">            is known. Pairs of levels and I or L-type expressions would not work.</span>

<span class="sd">        The preferred method are the label and the I-type expressions, as the remaining parameters </span>
<span class="sd">            are inherently fragile.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            int_ratio:    relative line intensity (default normalization: Hbeta = 100). </span>
<span class="sd">                            May be an array.</span>
<span class="sd">            tem:          electronic temperature in K. May be an array.</span>
<span class="sd">            den:          electronic density in cm^-3. May be an array.</span>
<span class="sd">            lev_i:        upper level of transition</span>
<span class="sd">            lev_j:        lower level of transition</span>
<span class="sd">            wave:         wavelength of transition. Takes precedence on lev_i and lev_j if set, </span>
<span class="sd">                            ignored otherwise </span>
<span class="sd">            to_eval:      expression to be evaluated. Takes precedence on wave if set, </span>
<span class="sd">                            ignored otherwise.</span>
<span class="sd">            Hbeta:        line intensity normalization at Hbeta (default Hbeta = 100)</span>
<span class="sd">            tem_HI:       HI temperature. If not set, tem is used.</span>
<span class="sd">            den_HI:       HI density. If not set, den is used.</span>

<span class="sd">        **Usage:**</span>

<span class="sd">            He2.getIonAbundance(130, 1.5e4, 100., lev_i=5, lev_j=4)</span>

<span class="sd">            He2.getIonAbundance(130, 1.5e4, 100., label=&quot;5_4&quot;)</span>

<span class="sd">            He2.getIonAbundance(130, 1.5e4, 100., to_eval=&#39;I(4,3) + I(4,2)&#39;)</span>

<span class="sd">            He1.getIonAbundance(100, 1.5e4, 100., wave=5016)</span>

<span class="sd">            He1.getIonAbundance(100, 1.5e4, 100., label=&quot;5016.0&quot;)</span>

<span class="sd">            He1.getIonAbundance(100, 1.5e4, 100., to_eval=&#39;S(5016)&#39;)</span>

<span class="sd">            He1.getIonAbundance(np.array([100, 150]), np.array([1.5e4, 1.2e4]), np.array([100., 120]), </span>
<span class="sd">                label=&quot;10830.0&quot;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tem_HI</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tem_HI</span> <span class="o">=</span> <span class="n">tem</span>
        <span class="k">if</span> <span class="n">den_HI</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">den_HI</span> <span class="o">=</span> <span class="n">den</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">den</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;ten and den must have the same shape&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">int_ratio</span><span class="p">))</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">))</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">|</span> 
            <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">den</span><span class="p">))</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">))</span><span class="o">.</span><span class="n">shape</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;int_ratio, tem and den must does not have the same shape&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lev_i</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lev_j</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wave</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">to_eval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;At least one of lev_i, lev_j, or wave, or to_eval must be supplied&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">to_eval</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">wave</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">to_eval</span> <span class="o">=</span> <span class="s1">&#39;L(</span><span class="si">{0}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">to_eval</span> <span class="o">=</span> <span class="s1">&#39;S(&quot;</span><span class="si">{0}</span><span class="s1">&quot;)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">to_eval</span> <span class="o">=</span> <span class="s1">&#39;I(</span><span class="si">{0}</span><span class="s1">, </span><span class="si">{1}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">I</span><span class="p">(</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">L</span><span class="p">(</span><span class="n">wave</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span><span class="n">wave</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">S</span><span class="p">(</span><span class="n">label</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">emis</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">to_eval</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Unable to eval </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">to_eval</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">emis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#int_ratio is in units of Hb = Hbeta keyword</span>
            <span class="n">ionAbundance</span> <span class="o">=</span> <span class="p">((</span><span class="n">int_ratio</span> <span class="o">/</span> <span class="n">Hbeta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">getRecEmissivity</span><span class="p">(</span><span class="n">tem_HI</span><span class="p">,</span> <span class="n">den_HI</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="s1">&#39;H1&#39;</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">/</span> <span class="n">emis</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ionAbundance</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">ionAbundance</span>


    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;Atom </span><span class="si">{0}{1}</span><span class="s1"> from </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">recFitsFile</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.RecAtom.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">elem</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">extrapolate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>RecAtom class. Used to manage recombination data and compute emissivities.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>elem</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>symbol of the selected element</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>spec</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ionization stage in spectroscopic notation (I = 1, II = 2, etc.)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>extrapolate</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>use the function outside the validity range [False]</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong>
    H1 = pn.RecAtom('H', 1)</p>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3225</span>
<span class="normal">3226</span>
<span class="normal">3227</span>
<span class="normal">3228</span>
<span class="normal">3229</span>
<span class="normal">3230</span>
<span class="normal">3231</span>
<span class="normal">3232</span>
<span class="normal">3233</span>
<span class="normal">3234</span>
<span class="normal">3235</span>
<span class="normal">3236</span>
<span class="normal">3237</span>
<span class="normal">3238</span>
<span class="normal">3239</span>
<span class="normal">3240</span>
<span class="normal">3241</span>
<span class="normal">3242</span>
<span class="normal">3243</span>
<span class="normal">3244</span>
<span class="normal">3245</span>
<span class="normal">3246</span>
<span class="normal">3247</span>
<span class="normal">3248</span>
<span class="normal">3249</span>
<span class="normal">3250</span>
<span class="normal">3251</span>
<span class="normal">3252</span>
<span class="normal">3253</span>
<span class="normal">3254</span>
<span class="normal">3255</span>
<span class="normal">3256</span>
<span class="normal">3257</span>
<span class="normal">3258</span>
<span class="normal">3259</span>
<span class="normal">3260</span>
<span class="normal">3261</span>
<span class="normal">3262</span>
<span class="normal">3263</span>
<span class="normal">3264</span>
<span class="normal">3265</span>
<span class="normal">3266</span>
<span class="normal">3267</span>
<span class="normal">3268</span>
<span class="normal">3269</span>
<span class="normal">3270</span>
<span class="normal">3271</span>
<span class="normal">3272</span>
<span class="normal">3273</span>
<span class="normal">3274</span>
<span class="normal">3275</span>
<span class="normal">3276</span>
<span class="normal">3277</span>
<span class="normal">3278</span>
<span class="normal">3279</span>
<span class="normal">3280</span>
<span class="normal">3281</span>
<span class="normal">3282</span>
<span class="normal">3283</span>
<span class="normal">3284</span>
<span class="normal">3285</span>
<span class="normal">3286</span>
<span class="normal">3287</span>
<span class="normal">3288</span>
<span class="normal">3289</span>
<span class="normal">3290</span>
<span class="normal">3291</span>
<span class="normal">3292</span>
<span class="normal">3293</span>
<span class="normal">3294</span>
<span class="normal">3295</span>
<span class="normal">3296</span>
<span class="normal">3297</span>
<span class="normal">3298</span>
<span class="normal">3299</span>
<span class="normal">3300</span>
<span class="normal">3301</span>
<span class="normal">3302</span>
<span class="normal">3303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">extrapolate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    RecAtom class. Used to manage recombination data and compute emissivities.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        elem:          symbol of the selected element</span>
<span class="sd">        spec:          ionization stage in spectroscopic notation (I = 1, II = 2, etc.)</span>
<span class="sd">        extrapolate: use the function outside the validity range [False]</span>

<span class="sd">    **Usage:**</span>
<span class="sd">        H1 = pn.RecAtom(&#39;H&#39;, 1)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span> <span class="o">=</span> <span class="n">log_</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;rec&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_valid</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gs</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">case</span> <span class="o">=</span> <span class="n">case</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">extrapolate</span> <span class="o">=</span> <span class="n">extrapolate</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sources</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">atom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elem</span> <span class="o">=</span> <span class="n">parseAtom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parseAtom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elem</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elem</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">sym2name</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">=</span> <span class="s1">&#39;Atom &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;Making rec-atom object for </span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">elem</span> <span class="ow">in</span> <span class="n">IP</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IP</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">IP</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">])</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IP</span> <span class="o">=</span> <span class="n">IP</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IP</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IP</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">recFitsFile</span> <span class="o">=</span> <span class="n">atomicData</span><span class="o">.</span><span class="n">getDataFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="s1">&#39;rec&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">file_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recFitsFile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">useNIST</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;fits&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loadFit</span><span class="p">()</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;hdf5&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loadHDF5</span><span class="p">()</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;func&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loadFunctions</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_valid</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="s1">&#39;trc&#39;</span> <span class="ow">in</span> <span class="n">atomicData</span><span class="o">.</span><span class="n">getDataFile</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loadTotRecombination</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">E_in_vacuum</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">comments</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">useNIST</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NIST</span> <span class="o">=</span> <span class="n">getLevelsNIST</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">)</span>
        <span class="n">web</span> <span class="o">=</span> <span class="s1">&#39;Ref. </span><span class="si">{0}</span><span class="s1"> of NIST 2014 (try this: http://physics.nist.gov/cgi-bin/ASBib1/get_ASBib_ref.cgi?db=el&amp;db_id=</span><span class="si">{0}</span><span class="s1">&amp;comment_code=&amp;element=</span><span class="si">{1}</span><span class="s1">&amp;spectr_charge=</span><span class="si">{2}</span><span class="s1">&amp;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NIST</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NIST</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NIST</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1e8</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">[</span><span class="s1">&#39;VACUUM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">[</span><span class="s1">&#39;NOTE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Energy levels&#39;</span>
            <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NIST</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">web</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ref</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">elem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initWaves</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NIST</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">atomicData</span><span class="o">.</span><span class="n">add2usedFiles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">recFitsFile</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.RecAtom.getEmissivity" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return the emissivity of a recombination line (erg.s-1.cm3). The arguments used to 
define the line depend on whether the atom is an hydrogenoid or not. 
In the first case, the transition can be specified either as a pair 
of levels lev_i, lev_j or as a label. 
In the second case, the transition can be specified either as a wavelength 
or as a label.
In either case, enter <atom>.labels to display the valid labels.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>tem</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>temperature (K)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>den</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>density (cm-3)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_i</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>upper level of transition</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_j</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>lower level of transition</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>wave</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>wavelength of the transition</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>label</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>label of the transition (e.g. "50_3", "1234.5")</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>method</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>interpolation method ('linear', 'nearest', 'cubic'), 
             sent to scipy.interpolate.griddata    </p>
              </div>
            </td>
            <td>
                  <code>&#39;linear&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>product</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Boolean. If True (default), all the combination of (tem, den) are used. 
             If False, tem and den must have the same size and are joined.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Usage:</p>
<pre><code>H1 = pn.RecAtom('H', 1)

H1.getEmissivity([1e4, 1.2e4], [1e3, 1e2], lev_i = 4, lev_j = 2)

H1.getEmissivity([1e4, 1.2e4], [1e3, 1e2], label='4_2', product=False)

tem = np.linspace(5000, 20000, 100)

den = np.logspace(2, 6, 100)

imHab = H1.getEmissivity(tem, den, label='3_2') / H1.getEmissivity(tem, den, label='4_2')

He1 = pn.RecAtom('He', 1)

He1.getEmissivity(1e4, 1e2, wave=4471.0)

He1.getEmissivity(1e4, 1e2, label='4471.0')
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3924</span>
<span class="normal">3925</span>
<span class="normal">3926</span>
<span class="normal">3927</span>
<span class="normal">3928</span>
<span class="normal">3929</span>
<span class="normal">3930</span>
<span class="normal">3931</span>
<span class="normal">3932</span>
<span class="normal">3933</span>
<span class="normal">3934</span>
<span class="normal">3935</span>
<span class="normal">3936</span>
<span class="normal">3937</span>
<span class="normal">3938</span>
<span class="normal">3939</span>
<span class="normal">3940</span>
<span class="normal">3941</span>
<span class="normal">3942</span>
<span class="normal">3943</span>
<span class="normal">3944</span>
<span class="normal">3945</span>
<span class="normal">3946</span>
<span class="normal">3947</span>
<span class="normal">3948</span>
<span class="normal">3949</span>
<span class="normal">3950</span>
<span class="normal">3951</span>
<span class="normal">3952</span>
<span class="normal">3953</span>
<span class="normal">3954</span>
<span class="normal">3955</span>
<span class="normal">3956</span>
<span class="normal">3957</span>
<span class="normal">3958</span>
<span class="normal">3959</span>
<span class="normal">3960</span>
<span class="normal">3961</span>
<span class="normal">3962</span>
<span class="normal">3963</span>
<span class="normal">3964</span>
<span class="normal">3965</span>
<span class="normal">3966</span>
<span class="normal">3967</span>
<span class="normal">3968</span>
<span class="normal">3969</span>
<span class="normal">3970</span>
<span class="normal">3971</span>
<span class="normal">3972</span>
<span class="normal">3973</span>
<span class="normal">3974</span>
<span class="normal">3975</span>
<span class="normal">3976</span>
<span class="normal">3977</span>
<span class="normal">3978</span>
<span class="normal">3979</span>
<span class="normal">3980</span>
<span class="normal">3981</span>
<span class="normal">3982</span>
<span class="normal">3983</span>
<span class="normal">3984</span>
<span class="normal">3985</span>
<span class="normal">3986</span>
<span class="normal">3987</span>
<span class="normal">3988</span>
<span class="normal">3989</span>
<span class="normal">3990</span>
<span class="normal">3991</span>
<span class="normal">3992</span>
<span class="normal">3993</span>
<span class="normal">3994</span>
<span class="normal">3995</span>
<span class="normal">3996</span>
<span class="normal">3997</span>
<span class="normal">3998</span>
<span class="normal">3999</span>
<span class="normal">4000</span>
<span class="normal">4001</span>
<span class="normal">4002</span>
<span class="normal">4003</span>
<span class="normal">4004</span>
<span class="normal">4005</span>
<span class="normal">4006</span>
<span class="normal">4007</span>
<span class="normal">4008</span>
<span class="normal">4009</span>
<span class="normal">4010</span>
<span class="normal">4011</span>
<span class="normal">4012</span>
<span class="normal">4013</span>
<span class="normal">4014</span>
<span class="normal">4015</span>
<span class="normal">4016</span>
<span class="normal">4017</span>
<span class="normal">4018</span>
<span class="normal">4019</span>
<span class="normal">4020</span>
<span class="normal">4021</span>
<span class="normal">4022</span>
<span class="normal">4023</span>
<span class="normal">4024</span>
<span class="normal">4025</span>
<span class="normal">4026</span>
<span class="normal">4027</span>
<span class="normal">4028</span>
<span class="normal">4029</span>
<span class="normal">4030</span>
<span class="normal">4031</span>
<span class="normal">4032</span>
<span class="normal">4033</span>
<span class="normal">4034</span>
<span class="normal">4035</span>
<span class="normal">4036</span>
<span class="normal">4037</span>
<span class="normal">4038</span>
<span class="normal">4039</span>
<span class="normal">4040</span>
<span class="normal">4041</span>
<span class="normal">4042</span>
<span class="normal">4043</span>
<span class="normal">4044</span>
<span class="normal">4045</span>
<span class="normal">4046</span>
<span class="normal">4047</span>
<span class="normal">4048</span>
<span class="normal">4049</span>
<span class="normal">4050</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getEmissivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the emissivity of a recombination line (erg.s-1.cm3). The arguments used to </span>
<span class="sd">    define the line depend on whether the atom is an hydrogenoid or not. </span>
<span class="sd">    In the first case, the transition can be specified either as a pair </span>
<span class="sd">    of levels lev_i, lev_j or as a label. </span>
<span class="sd">    In the second case, the transition can be specified either as a wavelength </span>
<span class="sd">    or as a label.</span>
<span class="sd">    In either case, enter &lt;atom&gt;.labels to display the valid labels.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        tem:            temperature (K)</span>
<span class="sd">        den:            density (cm-3)</span>
<span class="sd">        lev_i: upper level of transition</span>
<span class="sd">        lev_j: lower level of transition</span>
<span class="sd">        wave:           wavelength of the transition</span>
<span class="sd">        label:          label of the transition (e.g. &quot;50_3&quot;, &quot;1234.5&quot;)</span>
<span class="sd">        method:         interpolation method (&#39;linear&#39;, &#39;nearest&#39;, &#39;cubic&#39;), </span>
<span class="sd">                         sent to scipy.interpolate.griddata    </span>
<span class="sd">        product:        Boolean. If True (default), all the combination of (tem, den) are used. </span>
<span class="sd">                         If False, tem and den must have the same size and are joined.</span>

<span class="sd">    Usage:</span>

<span class="sd">        H1 = pn.RecAtom(&#39;H&#39;, 1)</span>

<span class="sd">        H1.getEmissivity([1e4, 1.2e4], [1e3, 1e2], lev_i = 4, lev_j = 2)</span>

<span class="sd">        H1.getEmissivity([1e4, 1.2e4], [1e3, 1e2], label=&#39;4_2&#39;, product=False)</span>

<span class="sd">        tem = np.linspace(5000, 20000, 100)</span>

<span class="sd">        den = np.logspace(2, 6, 100)</span>

<span class="sd">        imHab = H1.getEmissivity(tem, den, label=&#39;3_2&#39;) / H1.getEmissivity(tem, den, label=&#39;4_2&#39;)</span>

<span class="sd">        He1 = pn.RecAtom(&#39;He&#39;, 1)</span>

<span class="sd">        He1.getEmissivity(1e4, 1e2, wave=4471.0)</span>

<span class="sd">        He1.getEmissivity(1e4, 1e2, label=&#39;4471.0&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">INSTALLED</span><span class="p">[</span><span class="s1">&#39;scipy&#39;</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Scipy not installed, no RecAtom emissivities available&#39;</span><span class="p">,</span>
                      <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">tem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">den</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">den</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">product</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tem</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">den</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">temg</span> <span class="o">=</span> <span class="n">tem</span>
            <span class="n">deng</span> <span class="o">=</span> <span class="n">den</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">temg</span><span class="p">,</span> <span class="n">deng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span>
            <span class="n">temg</span> <span class="o">=</span> <span class="n">temg</span><span class="o">.</span><span class="n">T</span>
            <span class="n">deng</span> <span class="o">=</span> <span class="n">deng</span><span class="o">.</span><span class="n">T</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tem</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">den</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;tem and den must have the same size&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">temg</span> <span class="o">=</span> <span class="n">tem</span>
            <span class="n">deng</span> <span class="o">=</span> <span class="n">den</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lev_i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">lev_j</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wave</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1">#label = &#39;{0:.1f}&#39;.format(wave)</span>
        <span class="c1">#label_str = self._getLabelStr(label, warn=False)</span>
        <span class="n">label_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getLabelStr</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">label_str</span>
        <span class="k">if</span> <span class="n">label_str</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ij</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ij</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ij</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ij</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="n">product</span><span class="p">)</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">res</span>
    <span class="n">label_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getLabelStr</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">label_str</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Wrong label </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkLabel</span><span class="p">(</span><span class="n">label_str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Wrong label </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label_str</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;func&#39;</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emis_func</span><span class="p">(</span><span class="n">label_str</span><span class="p">,</span> <span class="n">temg</span><span class="p">,</span> <span class="n">deng</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">enu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_RecombData</span><span class="p">[</span><span class="n">label_str</span><span class="p">]</span>

        <span class="n">logd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">deng</span><span class="p">)</span>
        <span class="n">temp_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp</span><span class="p">)</span>
        <span class="c1">#temp_max = np.max(self.temp)</span>
        <span class="n">log_dens_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_dens</span><span class="p">)</span>
        <span class="n">log_dens_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_dens</span><span class="p">)</span>
        <span class="n">tt</span> <span class="o">=</span> <span class="p">(</span><span class="n">logd</span> <span class="o">&lt;</span> <span class="n">log_dens_min</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">logd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">tt</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">logd</span> <span class="o">=</span> <span class="n">log_dens_min</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logd</span><span class="p">[</span><span class="n">tt</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_dens_min</span>
        <span class="n">tt</span> <span class="o">=</span> <span class="p">(</span><span class="n">logd</span> <span class="o">&gt;</span> <span class="n">log_dens_max</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">logd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tt</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">logd</span> <span class="o">=</span> <span class="n">log_dens_max</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logd</span><span class="p">[</span><span class="n">tt</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_dens_max</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">griddata</span><span class="p">((</span><span class="mf">1.</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_dens</span><span class="o">.</span><span class="n">ravel</span><span class="p">()),</span> <span class="n">enu</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
                                   <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">temg</span><span class="p">,</span> <span class="n">logd</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">temg</span> <span class="o">&lt;</span> <span class="n">temp_min</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">extrapolate</span><span class="p">:</span>
            <span class="n">masklowte</span> <span class="o">=</span> <span class="n">temg</span> <span class="o">&lt;</span> <span class="n">temp_min</span>
            <span class="n">temp_min2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">temp</span> <span class="o">&gt;</span> <span class="n">temp_min</span><span class="p">])</span>

            <span class="n">em_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">temp_min</span><span class="p">,</span> <span class="n">deng</span><span class="p">[</span><span class="n">masklowte</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
                                        <span class="n">lev_i</span><span class="o">=</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span><span class="n">lev_j</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span><span class="n">wave</span><span class="p">,</span> 
                                        <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
            <span class="n">em_min2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">temp_min2</span><span class="p">,</span> <span class="n">deng</span><span class="p">[</span><span class="n">masklowte</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
                                        <span class="n">lev_i</span><span class="o">=</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span><span class="n">lev_j</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span><span class="n">wave</span><span class="p">,</span> 
                                        <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">em_min</span> <span class="o">-</span> <span class="n">em_min2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">temp_min</span> <span class="o">-</span> <span class="mf">1.</span><span class="o">/</span><span class="n">temp_min2</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">em_min</span> <span class="o">-</span> <span class="n">a</span> <span class="o">/</span> <span class="n">temp_min</span>
            <span class="n">em</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">temg</span><span class="p">[</span><span class="n">masklowte</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="o">+</span> <span class="n">b</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/Te + </span><span class="si">{}</span><span class="s1"> extrapolation on low Te&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
            <span class="n">res</span><span class="p">[</span><span class="n">masklowte</span><span class="p">]</span><span class="o">=</span><span class="n">em</span>
    <span class="k">return</span> <span class="n">res</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.RecAtom.getEnergy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getEnergy</span><span class="p">(</span><span class="n">level</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;1/Ang&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return energy level of selected level (or array of energy levels, if level not given) 
    in Angstrom^-1 (default) or another unit</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>level</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>selected atomic level (default= -1, returns complete array)</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>unit</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>[str] one of '1/Ang' (default), 'eV', or 'Ryd'    </p>
              </div>
            </td>
            <td>
                  <code>&#39;1/Ang&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong>
    O3.getEnergy(4, unit='eV')</p>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3854</span>
<span class="normal">3855</span>
<span class="normal">3856</span>
<span class="normal">3857</span>
<span class="normal">3858</span>
<span class="normal">3859</span>
<span class="normal">3860</span>
<span class="normal">3861</span>
<span class="normal">3862</span>
<span class="normal">3863</span>
<span class="normal">3864</span>
<span class="normal">3865</span>
<span class="normal">3866</span>
<span class="normal">3867</span>
<span class="normal">3868</span>
<span class="normal">3869</span>
<span class="normal">3870</span>
<span class="normal">3871</span>
<span class="normal">3872</span>
<span class="normal">3873</span>
<span class="normal">3874</span>
<span class="normal">3875</span>
<span class="normal">3876</span>
<span class="normal">3877</span>
<span class="normal">3878</span>
<span class="normal">3879</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getEnergy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;1/Ang&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return energy level of selected level (or array of energy levels, if level not given) </span>
<span class="sd">        in Angstrom^-1 (default) or another unit</span>

<span class="sd">    Parameters:</span>
<span class="sd">        level:  selected atomic level (default= -1, returns complete array)</span>
<span class="sd">        unit:   [str] one of &#39;1/Ang&#39; (default), &#39;eV&#39;, or &#39;Ryd&#39;    </span>

<span class="sd">    **Usage:**</span>
<span class="sd">        O3.getEnergy(4, unit=&#39;eV&#39;)    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>

    <span class="n">unit_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;1/Ang&#39;</span><span class="p">:</span> <span class="mf">1.</span><span class="p">,</span>
                 <span class="s1">&#39;Ryd&#39;</span><span class="p">:</span> <span class="n">CST</span><span class="o">.</span><span class="n">RYD_ANG</span><span class="p">,</span>
                 <span class="s1">&#39;eV&#39;</span><span class="p">:</span> <span class="n">CST</span><span class="o">.</span><span class="n">RYD_ANG</span> <span class="o">*</span> <span class="n">CST</span><span class="o">.</span><span class="n">RYD_EV</span><span class="p">,</span>
                 <span class="s1">&#39;cm-1&#39;</span><span class="p">:</span> <span class="mf">1e8</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">unit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unit_dict</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Unit </span><span class="si">{0}</span><span class="s1"> unknown, using 1/Ang&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unit</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">+</span> <span class="s1">&#39;.getEnergy&#39;</span><span class="p">)</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;1/Ang&#39;</span>        

    <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span> <span class="o">*</span> <span class="n">unit_dict</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="n">level</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">unit_dict</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.RecAtom.getIonAbundance" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getIonAbundance</span><span class="p">(</span><span class="n">int_ratio</span><span class="p">,</span> <span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Hbeta</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">tem_HI</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">den_HI</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Compute the ionic abundance relative to H+ given the temperature, the density and the 
    intensity of a line or sum of lines.
The arguments used to define the line depend on whether the atom is an hydrogenoid or not. 
For hydrogenoids, the transition can be specified either as a pair of levels 
    lev_i, lev_j, as a label, or as an I-type expression as the argument of to_eval 
    (e.g. to_eval='I(50, 19)' for the 50-&gt;19 transition). Wavelengths or L-type expressions 
    will not work in this case. 
For non-hydrogenoids, the transition can be specified either as an integer wavelength, 
    as a label, or as an A-type expression as the argument of to_eval (e.g. to_eval='A(4471)' 
    for the lambda=4471 transition). Note that all these alternatives imply that the wavelength
    is known. Pairs of levels and I or L-type expressions would not work.</p>
<p>The preferred method are the label and the I-type expressions, as the remaining parameters 
    are inherently fragile.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>int_ratio</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>relative line intensity (default normalization: Hbeta = 100). 
            May be an array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>tem</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>electronic temperature in K. May be an array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>den</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>electronic density in cm^-3. May be an array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_i</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>upper level of transition</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_j</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>lower level of transition</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>wave</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>wavelength of transition. Takes precedence on lev_i and lev_j if set, 
            ignored otherwise </p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>to_eval</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>expression to be evaluated. Takes precedence on wave if set, 
            ignored otherwise.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>Hbeta</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>line intensity normalization at Hbeta (default Hbeta = 100)</p>
              </div>
            </td>
            <td>
                  <code>100.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>tem_HI</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HI temperature. If not set, tem is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>den_HI</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HI density. If not set, den is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong></p>
<pre><code>He2.getIonAbundance(130, 1.5e4, 100., lev_i=5, lev_j=4)

He2.getIonAbundance(130, 1.5e4, 100., label="5_4")

He2.getIonAbundance(130, 1.5e4, 100., to_eval='I(4,3) + I(4,2)')

He1.getIonAbundance(100, 1.5e4, 100., wave=5016)

He1.getIonAbundance(100, 1.5e4, 100., label="5016.0")

He1.getIonAbundance(100, 1.5e4, 100., to_eval='S(5016)')

He1.getIonAbundance(np.array([100, 150]), np.array([1.5e4, 1.2e4]), np.array([100., 120]), 
    label="10830.0")
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4053</span>
<span class="normal">4054</span>
<span class="normal">4055</span>
<span class="normal">4056</span>
<span class="normal">4057</span>
<span class="normal">4058</span>
<span class="normal">4059</span>
<span class="normal">4060</span>
<span class="normal">4061</span>
<span class="normal">4062</span>
<span class="normal">4063</span>
<span class="normal">4064</span>
<span class="normal">4065</span>
<span class="normal">4066</span>
<span class="normal">4067</span>
<span class="normal">4068</span>
<span class="normal">4069</span>
<span class="normal">4070</span>
<span class="normal">4071</span>
<span class="normal">4072</span>
<span class="normal">4073</span>
<span class="normal">4074</span>
<span class="normal">4075</span>
<span class="normal">4076</span>
<span class="normal">4077</span>
<span class="normal">4078</span>
<span class="normal">4079</span>
<span class="normal">4080</span>
<span class="normal">4081</span>
<span class="normal">4082</span>
<span class="normal">4083</span>
<span class="normal">4084</span>
<span class="normal">4085</span>
<span class="normal">4086</span>
<span class="normal">4087</span>
<span class="normal">4088</span>
<span class="normal">4089</span>
<span class="normal">4090</span>
<span class="normal">4091</span>
<span class="normal">4092</span>
<span class="normal">4093</span>
<span class="normal">4094</span>
<span class="normal">4095</span>
<span class="normal">4096</span>
<span class="normal">4097</span>
<span class="normal">4098</span>
<span class="normal">4099</span>
<span class="normal">4100</span>
<span class="normal">4101</span>
<span class="normal">4102</span>
<span class="normal">4103</span>
<span class="normal">4104</span>
<span class="normal">4105</span>
<span class="normal">4106</span>
<span class="normal">4107</span>
<span class="normal">4108</span>
<span class="normal">4109</span>
<span class="normal">4110</span>
<span class="normal">4111</span>
<span class="normal">4112</span>
<span class="normal">4113</span>
<span class="normal">4114</span>
<span class="normal">4115</span>
<span class="normal">4116</span>
<span class="normal">4117</span>
<span class="normal">4118</span>
<span class="normal">4119</span>
<span class="normal">4120</span>
<span class="normal">4121</span>
<span class="normal">4122</span>
<span class="normal">4123</span>
<span class="normal">4124</span>
<span class="normal">4125</span>
<span class="normal">4126</span>
<span class="normal">4127</span>
<span class="normal">4128</span>
<span class="normal">4129</span>
<span class="normal">4130</span>
<span class="normal">4131</span>
<span class="normal">4132</span>
<span class="normal">4133</span>
<span class="normal">4134</span>
<span class="normal">4135</span>
<span class="normal">4136</span>
<span class="normal">4137</span>
<span class="normal">4138</span>
<span class="normal">4139</span>
<span class="normal">4140</span>
<span class="normal">4141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getIonAbundance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">int_ratio</span><span class="p">,</span> <span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">to_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Hbeta</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span> <span class="n">tem_HI</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">den_HI</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the ionic abundance relative to H+ given the temperature, the density and the </span>
<span class="sd">        intensity of a line or sum of lines.</span>
<span class="sd">    The arguments used to define the line depend on whether the atom is an hydrogenoid or not. </span>
<span class="sd">    For hydrogenoids, the transition can be specified either as a pair of levels </span>
<span class="sd">        lev_i, lev_j, as a label, or as an I-type expression as the argument of to_eval </span>
<span class="sd">        (e.g. to_eval=&#39;I(50, 19)&#39; for the 50-&gt;19 transition). Wavelengths or L-type expressions </span>
<span class="sd">        will not work in this case. </span>
<span class="sd">    For non-hydrogenoids, the transition can be specified either as an integer wavelength, </span>
<span class="sd">        as a label, or as an A-type expression as the argument of to_eval (e.g. to_eval=&#39;A(4471)&#39; </span>
<span class="sd">        for the lambda=4471 transition). Note that all these alternatives imply that the wavelength</span>
<span class="sd">        is known. Pairs of levels and I or L-type expressions would not work.</span>

<span class="sd">    The preferred method are the label and the I-type expressions, as the remaining parameters </span>
<span class="sd">        are inherently fragile.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        int_ratio:    relative line intensity (default normalization: Hbeta = 100). </span>
<span class="sd">                        May be an array.</span>
<span class="sd">        tem:          electronic temperature in K. May be an array.</span>
<span class="sd">        den:          electronic density in cm^-3. May be an array.</span>
<span class="sd">        lev_i:        upper level of transition</span>
<span class="sd">        lev_j:        lower level of transition</span>
<span class="sd">        wave:         wavelength of transition. Takes precedence on lev_i and lev_j if set, </span>
<span class="sd">                        ignored otherwise </span>
<span class="sd">        to_eval:      expression to be evaluated. Takes precedence on wave if set, </span>
<span class="sd">                        ignored otherwise.</span>
<span class="sd">        Hbeta:        line intensity normalization at Hbeta (default Hbeta = 100)</span>
<span class="sd">        tem_HI:       HI temperature. If not set, tem is used.</span>
<span class="sd">        den_HI:       HI density. If not set, den is used.</span>

<span class="sd">    **Usage:**</span>

<span class="sd">        He2.getIonAbundance(130, 1.5e4, 100., lev_i=5, lev_j=4)</span>

<span class="sd">        He2.getIonAbundance(130, 1.5e4, 100., label=&quot;5_4&quot;)</span>

<span class="sd">        He2.getIonAbundance(130, 1.5e4, 100., to_eval=&#39;I(4,3) + I(4,2)&#39;)</span>

<span class="sd">        He1.getIonAbundance(100, 1.5e4, 100., wave=5016)</span>

<span class="sd">        He1.getIonAbundance(100, 1.5e4, 100., label=&quot;5016.0&quot;)</span>

<span class="sd">        He1.getIonAbundance(100, 1.5e4, 100., to_eval=&#39;S(5016)&#39;)</span>

<span class="sd">        He1.getIonAbundance(np.array([100, 150]), np.array([1.5e4, 1.2e4]), np.array([100., 120]), </span>
<span class="sd">            label=&quot;10830.0&quot;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">tem_HI</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tem_HI</span> <span class="o">=</span> <span class="n">tem</span>
    <span class="k">if</span> <span class="n">den_HI</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">den_HI</span> <span class="o">=</span> <span class="n">den</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">den</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;ten and den must have the same shape&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">int_ratio</span><span class="p">))</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">))</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">|</span> 
        <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">den</span><span class="p">))</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">))</span><span class="o">.</span><span class="n">shape</span><span class="p">)):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;int_ratio, tem and den must does not have the same shape&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lev_i</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lev_j</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wave</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">to_eval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;At least one of lev_i, lev_j, or wave, or to_eval must be supplied&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">to_eval</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">wave</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">to_eval</span> <span class="o">=</span> <span class="s1">&#39;L(</span><span class="si">{0}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">to_eval</span> <span class="o">=</span> <span class="s1">&#39;S(&quot;</span><span class="si">{0}</span><span class="s1">&quot;)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">to_eval</span> <span class="o">=</span> <span class="s1">&#39;I(</span><span class="si">{0}</span><span class="s1">, </span><span class="si">{1}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">I</span><span class="p">(</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">L</span><span class="p">(</span><span class="n">wave</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span><span class="n">wave</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">S</span><span class="p">(</span><span class="n">label</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">emis</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">to_eval</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Unable to eval </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">to_eval</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">emis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1">#int_ratio is in units of Hb = Hbeta keyword</span>
        <span class="n">ionAbundance</span> <span class="o">=</span> <span class="p">((</span><span class="n">int_ratio</span> <span class="o">/</span> <span class="n">Hbeta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">getRecEmissivity</span><span class="p">(</span><span class="n">tem_HI</span><span class="p">,</span> <span class="n">den_HI</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="s1">&#39;H1&#39;</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">/</span> <span class="n">emis</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ionAbundance</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">ionAbundance</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.RecAtom.getTotRecombination" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getTotRecombination</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return the total recombination coefficient. The case (A or B) is set by selecting the corresponding trc file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>tem</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>temperature </p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>den</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>density</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>method</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>interpolation method in the grid ('linear' = default, 'nearest', 'cubic')    </p>
              </div>
            </td>
            <td>
                  <code>&#39;linear&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong>
    atomicData.setDataFile('h_i_trc_SH95-caseA.dat')
    h1.getTotRecombination(tem=10000, den=5.e3)</p>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3771</span>
<span class="normal">3772</span>
<span class="normal">3773</span>
<span class="normal">3774</span>
<span class="normal">3775</span>
<span class="normal">3776</span>
<span class="normal">3777</span>
<span class="normal">3778</span>
<span class="normal">3779</span>
<span class="normal">3780</span>
<span class="normal">3781</span>
<span class="normal">3782</span>
<span class="normal">3783</span>
<span class="normal">3784</span>
<span class="normal">3785</span>
<span class="normal">3786</span>
<span class="normal">3787</span>
<span class="normal">3788</span>
<span class="normal">3789</span>
<span class="normal">3790</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getTotRecombination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the total recombination coefficient. The case (A or B) is set by selecting the corresponding trc file.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        tem:  temperature </span>
<span class="sd">        den: density</span>
<span class="sd">        method:    interpolation method in the grid (&#39;linear&#39; = default, &#39;nearest&#39;, &#39;cubic&#39;)    </span>

<span class="sd">    **Usage:**</span>
<span class="sd">        atomicData.setDataFile(&#39;h_i_trc_SH95-caseA.dat&#39;)</span>
<span class="sd">        h1.getTotRecombination(tem=10000, den=5.e3)</span>

<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">calling</span> <span class="o">=</span> <span class="s1">&#39;getTotRecombination&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;trc&#39;</span> <span class="ow">in</span> <span class="n">atomicData</span><span class="o">.</span><span class="n">getDataFile</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">griddata</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">lg_den_grid</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lg_tem_grid</span><span class="o">.</span><span class="n">ravel</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_grid</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">den</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tem</span><span class="p">)),</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;No recombination data available for </span><span class="si">{0}</span><span class="s1"> in the adopted dictionary (but data may exist: please query atomicData.getAllAvailableFiles(&quot;&lt;atom&gt;&quot;) for trc files)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">),</span> <span class="n">calling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calling</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.RecAtom.getTransition" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">maxErrorA</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">maxErrorm</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return the indexes (upper level, lower level) of a transition for a given atom 
    from the wavelength.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>wave</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>wavelength in Angstrom (a float or a label: e.g., 5007, '5007A') 
or in micron (a label: '51.5m')</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>maxErrorA</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tolerance if the input wavelength is in Angstrom</p>
              </div>
            </td>
            <td>
                  <code>0.005</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>maxErrorm</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tolerance if the input wavelength is in micron</p>
              </div>
            </td>
            <td>
                  <code>0.05</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong></p>
<pre><code>O3.getTransition(4959)
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3793</span>
<span class="normal">3794</span>
<span class="normal">3795</span>
<span class="normal">3796</span>
<span class="normal">3797</span>
<span class="normal">3798</span>
<span class="normal">3799</span>
<span class="normal">3800</span>
<span class="normal">3801</span>
<span class="normal">3802</span>
<span class="normal">3803</span>
<span class="normal">3804</span>
<span class="normal">3805</span>
<span class="normal">3806</span>
<span class="normal">3807</span>
<span class="normal">3808</span>
<span class="normal">3809</span>
<span class="normal">3810</span>
<span class="normal">3811</span>
<span class="normal">3812</span>
<span class="normal">3813</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getTransition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="n">maxErrorA</span> <span class="o">=</span> <span class="mf">5.e-3</span><span class="p">,</span> <span class="n">maxErrorm</span> <span class="o">=</span> <span class="mf">5.e-2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the indexes (upper level, lower level) of a transition for a given atom </span>
<span class="sd">        from the wavelength.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        wave:      wavelength in Angstrom (a float or a label: e.g., 5007, &#39;5007A&#39;) </span>
<span class="sd">            or in micron (a label: &#39;51.5m&#39;)</span>
<span class="sd">        maxErrorA: tolerance if the input wavelength is in Angstrom</span>
<span class="sd">        maxErrorm: tolerance if the input wavelength is in micron</span>

<span class="sd">    **Usage:**</span>

<span class="sd">        O3.getTransition(4959)</span>

<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Transition</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">maxErrorA</span> <span class="o">=</span> <span class="n">maxErrorA</span><span class="p">,</span> <span class="n">maxErrorm</span> <span class="o">=</span> <span class="n">maxErrorm</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">res</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.RecAtom.getWave" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getWave</span><span class="p">(</span><span class="n">lev_i</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return the wavelength of a transition given the levels </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>lev_i</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>upper level of the transition</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_j</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>lower level of the transition</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong>
    He2.getWave(4, 3)</p>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3335</span>
<span class="normal">3336</span>
<span class="normal">3337</span>
<span class="normal">3338</span>
<span class="normal">3339</span>
<span class="normal">3340</span>
<span class="normal">3341</span>
<span class="normal">3342</span>
<span class="normal">3343</span>
<span class="normal">3344</span>
<span class="normal">3345</span>
<span class="normal">3346</span>
<span class="normal">3347</span>
<span class="normal">3348</span>
<span class="normal">3349</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getWave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the wavelength of a transition given the levels </span>

<span class="sd">    Parameters:</span>
<span class="sd">        lev_i: upper level of the transition</span>
<span class="sd">        lev_j: lower level of the transition</span>

<span class="sd">    **Usage:**</span>
<span class="sd">        He2.getWave(4, 3)</span>

<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">lev_i</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_test_lev</span><span class="p">(</span><span class="n">lev_j</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="p">[</span><span class="n">lev_i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.RecAtom.grepLabels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">grepLabels</span><span class="p">(</span><span class="n">str_</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return all the labels containing str_</p>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3839</span>
<span class="normal">3840</span>
<span class="normal">3841</span>
<span class="normal">3842</span>
<span class="normal">3843</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">grepLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">str_</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return all the labels containing str_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="k">if</span> <span class="n">str_</span> <span class="ow">in</span> <span class="n">l</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.RecAtom.initWaves" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">initWaves</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialization of wave_Ang</p>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3320</span>
<span class="normal">3321</span>
<span class="normal">3322</span>
<span class="normal">3323</span>
<span class="normal">3324</span>
<span class="normal">3325</span>
<span class="normal">3326</span>
<span class="normal">3327</span>
<span class="normal">3328</span>
<span class="normal">3329</span>
<span class="normal">3330</span>
<span class="normal">3331</span>
<span class="normal">3332</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">initWaves</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialization of wave_Ang</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NLevels</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="n">wave</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Energy</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">E_in_vacuum</span><span class="p">:</span>
                <span class="n">wave</span> <span class="o">=</span> <span class="n">vactoair</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_Ang</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">wave</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyneb.core.pynebcore.RecAtom.printTransition" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">printTransition</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Print info on transition associated to input wavelength.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>wave</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>wavelength in Angstrom (a float or a label: e.g., 5007, '5007A') 
or in micron (a label: '51.5m')</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong></p>
<pre><code>O3.printTransition(4959)
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3816</span>
<span class="normal">3817</span>
<span class="normal">3818</span>
<span class="normal">3819</span>
<span class="normal">3820</span>
<span class="normal">3821</span>
<span class="normal">3822</span>
<span class="normal">3823</span>
<span class="normal">3824</span>
<span class="normal">3825</span>
<span class="normal">3826</span>
<span class="normal">3827</span>
<span class="normal">3828</span>
<span class="normal">3829</span>
<span class="normal">3830</span>
<span class="normal">3831</span>
<span class="normal">3832</span>
<span class="normal">3833</span>
<span class="normal">3834</span>
<span class="normal">3835</span>
<span class="normal">3836</span>
<span class="normal">3837</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">printTransition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wave</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print info on transition associated to input wavelength.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        wave:      wavelength in Angstrom (a float or a label: e.g., 5007, &#39;5007A&#39;) </span>
<span class="sd">            or in micron (a label: &#39;51.5m&#39;)</span>

<span class="sd">    **Usage:**</span>

<span class="sd">        O3.printTransition(4959)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">closestTransition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Transition</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">closestTransition</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No wavelengths defined&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">relativeError</span> <span class="o">=</span> <span class="n">closestTransition</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">closestTransition</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Input wave: </span><span class="si">{0:.1F}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">closestTransition</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Closest wave found: </span><span class="si">{0:.1F}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">closestTransition</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Relative error: </span><span class="si">{0:.0E}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">relativeError</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Transition: </span><span class="si">{0[0]}</span><span class="s1"> -&gt; </span><span class="si">{0[1]}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">closestTransition</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="pyneb.core.pynebcore.getAtomDict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getAtomDict</span><span class="p">(</span><span class="n">atom_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">elem_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spec_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_coll</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initializes all atoms, according to the atomic files available.
The elem objects are given conventional names elem+spec (e.g., O III is O3)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>atom_list</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a list of the ions for which the elem is to be computed 
            Takes precedence on elem_list and spec_list</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>elem_list</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a list of all the elements for which the elem is to be computed (all by default)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>spec_list</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a list of the spectra for which the elem is to be computed (all by default)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>only_coll</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if True, ionly Atom are sent back,. Otherwise (default), Atom and RecAtom are sent back</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong></p>
<pre><code>all = pn.getAtomDict()

print(all['S2'].name)

some = pn.getAtomDict(elem_list=['C', 'N', 'O'])

some = pn.getAtomDict(atom_list=['O2', 'O3', 'Ar3'])
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4222</span>
<span class="normal">4223</span>
<span class="normal">4224</span>
<span class="normal">4225</span>
<span class="normal">4226</span>
<span class="normal">4227</span>
<span class="normal">4228</span>
<span class="normal">4229</span>
<span class="normal">4230</span>
<span class="normal">4231</span>
<span class="normal">4232</span>
<span class="normal">4233</span>
<span class="normal">4234</span>
<span class="normal">4235</span>
<span class="normal">4236</span>
<span class="normal">4237</span>
<span class="normal">4238</span>
<span class="normal">4239</span>
<span class="normal">4240</span>
<span class="normal">4241</span>
<span class="normal">4242</span>
<span class="normal">4243</span>
<span class="normal">4244</span>
<span class="normal">4245</span>
<span class="normal">4246</span>
<span class="normal">4247</span>
<span class="normal">4248</span>
<span class="normal">4249</span>
<span class="normal">4250</span>
<span class="normal">4251</span>
<span class="normal">4252</span>
<span class="normal">4253</span>
<span class="normal">4254</span>
<span class="normal">4255</span>
<span class="normal">4256</span>
<span class="normal">4257</span>
<span class="normal">4258</span>
<span class="normal">4259</span>
<span class="normal">4260</span>
<span class="normal">4261</span>
<span class="normal">4262</span>
<span class="normal">4263</span>
<span class="normal">4264</span>
<span class="normal">4265</span>
<span class="normal">4266</span>
<span class="normal">4267</span>
<span class="normal">4268</span>
<span class="normal">4269</span>
<span class="normal">4270</span>
<span class="normal">4271</span>
<span class="normal">4272</span>
<span class="normal">4273</span>
<span class="normal">4274</span>
<span class="normal">4275</span>
<span class="normal">4276</span>
<span class="normal">4277</span>
<span class="normal">4278</span>
<span class="normal">4279</span>
<span class="normal">4280</span>
<span class="normal">4281</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getAtomDict</span><span class="p">(</span><span class="n">atom_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">elem_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spec_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_coll</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Initializes all atoms, according to the atomic files available.</span>
<span class="sd">    The elem objects are given conventional names elem+spec (e.g., O III is O3)</span>

<span class="sd">    Parameters:</span>
<span class="sd">        atom_list:     a list of the ions for which the elem is to be computed </span>
<span class="sd">                        Takes precedence on elem_list and spec_list</span>
<span class="sd">        elem_list:     a list of all the elements for which the elem is to be computed (all by default)</span>
<span class="sd">        spec_list:     a list of the spectra for which the elem is to be computed (all by default)</span>
<span class="sd">        only_coll:     if True, ionly Atom are sent back,. Otherwise (default), Atom and RecAtom are sent back</span>
<span class="sd">        _ **kwargs      argumentas passed to Atom, e.g. OmegaInterp</span>

<span class="sd">    **Usage:**</span>

<span class="sd">        all = pn.getAtomDict()</span>

<span class="sd">        print(all[&#39;S2&#39;].name)</span>

<span class="sd">        some = pn.getAtomDict(elem_list=[&#39;C&#39;, &#39;N&#39;, &#39;O&#39;])</span>

<span class="sd">        some = pn.getAtomDict(atom_list=[&#39;O2&#39;, &#39;O3&#39;, &#39;Ar3&#39;])</span>

<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="n">all_atoms</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">atom_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>       
        <span class="k">if</span> <span class="n">spec_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">spec_list</span> <span class="o">=</span> <span class="n">SPEC_LIST</span>
        <span class="k">if</span> <span class="n">elem_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">atom_list</span> <span class="o">=</span> <span class="n">atomicData</span><span class="o">.</span><span class="n">getAllAtoms</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">atom_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">elem_list</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">spec_list</span><span class="p">:</span>
                    <span class="n">atom_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">))</span> 

    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atom_list</span><span class="p">:</span>
        <span class="n">elem</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="n">parseAtom</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">this_atom</span> <span class="o">=</span> <span class="n">Atom</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">this_atom</span><span class="o">.</span><span class="n">is_valid</span><span class="p">:</span>
                <span class="n">all_atoms</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_atom</span>
            <span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;Including &#39;</span> <span class="o">+</span> <span class="n">atom</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;getAtomDict&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="n">atom</span> <span class="o">+</span> <span class="s1">&#39; not found&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;getAtomDict&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">only_coll</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">this_atom</span> <span class="o">=</span> <span class="n">RecAtom</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">this_atom</span><span class="o">.</span><span class="n">is_valid</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">atom</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
                        <span class="n">add_r</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">add_r</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                    <span class="n">all_atoms</span><span class="p">[</span><span class="n">atom</span><span class="o">+</span><span class="n">add_r</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_atom</span>
                <span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;Including &#39;</span> <span class="o">+</span> <span class="n">atom</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;getAtomDict&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">log_</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="n">atom</span> <span class="o">+</span> <span class="s1">&#39; not found&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="o">=</span><span class="s1">&#39;getAtomDict&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">all_atoms</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="pyneb.core.pynebcore.getHbEmissivity" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getHbEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Compute Hbeta emissivity in erg/s/(N(H+)*N(e-)) for a given temperature with the formula 
    by Aller (1984)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>tem</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>electronic temperature in K</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong></p>
<pre><code>getHbemissivity(tem=10000)
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4187</span>
<span class="normal">4188</span>
<span class="normal">4189</span>
<span class="normal">4190</span>
<span class="normal">4191</span>
<span class="normal">4192</span>
<span class="normal">4193</span>
<span class="normal">4194</span>
<span class="normal">4195</span>
<span class="normal">4196</span>
<span class="normal">4197</span>
<span class="normal">4198</span>
<span class="normal">4199</span>
<span class="normal">4200</span>
<span class="normal">4201</span>
<span class="normal">4202</span>
<span class="normal">4203</span>
<span class="normal">4204</span>
<span class="normal">4205</span>
<span class="normal">4206</span>
<span class="normal">4207</span>
<span class="normal">4208</span>
<span class="normal">4209</span>
<span class="normal">4210</span>
<span class="normal">4211</span>
<span class="normal">4212</span>
<span class="normal">4213</span>
<span class="normal">4214</span>
<span class="normal">4215</span>
<span class="normal">4216</span>
<span class="normal">4217</span>
<span class="normal">4218</span>
<span class="normal">4219</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getHbEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Compute Hbeta emissivity in erg/s/(N(H+)*N(e-)) for a given temperature with the formula </span>
<span class="sd">        by Aller (1984)</span>

<span class="sd">    Parameters:</span>
<span class="sd">        tem:     electronic temperature in K</span>

<span class="sd">    **Usage:**</span>

<span class="sd">        getHbemissivity(tem=10000)</span>
<span class="sd">    &quot;&quot;&quot;</span> 
<span class="c1">#    tem4 = np.asarray(tem) * 1.0e-4</span>
<span class="c1">#    j_hb = 1.387 / pow(tem4, 0.983) / pow(10., 0.0424 / tem4) * 1.e-25</span>
<span class="c1">#</span>
<span class="c1">#    # Remove jhb for tem4 &lt; 0 or tem4 &gt; 1e2</span>
<span class="c1">#    ((tem4 &lt; 0.) | (tem4 &gt; 1e2)).choose(j_hb, -1)</span>
<span class="c1">#</span>
<span class="c1">#    return j_hb</span>

    <span class="n">tem4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.0e-4</span>
    <span class="n">j_hb</span> <span class="o">=</span> <span class="mf">1.387e-25</span> <span class="o">/</span> <span class="n">tem4</span><span class="o">**</span><span class="mf">0.983</span> <span class="o">/</span> <span class="mf">10.</span><span class="o">**</span><span class="p">(</span><span class="mf">0.0424</span> <span class="o">/</span> <span class="n">tem4</span><span class="p">)</span>

    <span class="n">j_hb_500</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">23.95</span> <span class="o">+</span> <span class="mf">0.00013</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">den</span><span class="p">)</span><span class="o">**</span><span class="mf">4.0</span><span class="p">)</span>
    <span class="n">j_hb_3000</span> <span class="o">=</span> <span class="mf">1.387e-25</span> <span class="o">/</span> <span class="mf">.3</span><span class="o">**</span><span class="mf">0.983</span> <span class="o">/</span> <span class="mf">10.</span><span class="o">**</span><span class="p">(</span><span class="mf">0.0424</span> <span class="o">/</span> <span class="mf">.3</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">j_hb_3000</span> <span class="o">-</span> <span class="n">j_hb_500</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3000</span> <span class="o">-</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">500.</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">j_hb_3000</span> <span class="o">-</span> <span class="n">a</span> <span class="o">/</span> <span class="mf">3000.</span>
    <span class="n">j_hb_low</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tem</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span>

    <span class="n">j_hb</span> <span class="o">=</span> <span class="p">(</span><span class="n">tem4</span> <span class="o">&lt;</span> <span class="mf">0.3</span><span class="p">)</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">j_hb</span><span class="p">,</span> <span class="n">j_hb_low</span><span class="p">)</span>
    <span class="n">j_hb</span> <span class="o">=</span> <span class="p">((</span><span class="n">tem4</span> <span class="o">&lt;</span> <span class="mf">.0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">tem4</span> <span class="o">&gt;</span> <span class="mf">1e2</span><span class="p">))</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">j_hb</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">j_hb</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="pyneb.core.pynebcore.getLineLabel" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getLineLabel</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="n">blend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Build a line label in the standard PyNeb format. Return atom_label, wave_label, and line_label 
        (strings representing the atom and wave fragments of the line label and the 
            complete line label)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>elem</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>symbol of the selected element</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>spec</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ionization stage in spectroscopic notation (I = 1, II = 2, etc.)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>wave</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>wavelength of the line</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>blend</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>blend flag (default = False)</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>@see parseLineLabel</p>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4284</span>
<span class="normal">4285</span>
<span class="normal">4286</span>
<span class="normal">4287</span>
<span class="normal">4288</span>
<span class="normal">4289</span>
<span class="normal">4290</span>
<span class="normal">4291</span>
<span class="normal">4292</span>
<span class="normal">4293</span>
<span class="normal">4294</span>
<span class="normal">4295</span>
<span class="normal">4296</span>
<span class="normal">4297</span>
<span class="normal">4298</span>
<span class="normal">4299</span>
<span class="normal">4300</span>
<span class="normal">4301</span>
<span class="normal">4302</span>
<span class="normal">4303</span>
<span class="normal">4304</span>
<span class="normal">4305</span>
<span class="normal">4306</span>
<span class="normal">4307</span>
<span class="normal">4308</span>
<span class="normal">4309</span>
<span class="normal">4310</span>
<span class="normal">4311</span>
<span class="normal">4312</span>
<span class="normal">4313</span>
<span class="normal">4314</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getLineLabel</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="n">blend</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build a line label in the standard PyNeb format. Return atom_label, wave_label, and line_label </span>
<span class="sd">            (strings representing the atom and wave fragments of the line label and the </span>
<span class="sd">                complete line label)</span>

<span class="sd">    Parameters:</span>
<span class="sd">        elem:      symbol of the selected element</span>
<span class="sd">        spec:      ionization stage in spectroscopic notation (I = 1, II = 2, etc.)</span>
<span class="sd">        wave:      wavelength of the line</span>
<span class="sd">        blend:     blend flag (default = False)</span>

<span class="sd">    @see parseLineLabel</span>

<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">wave_label</span> <span class="o">=</span> <span class="n">wave</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wave4</span> <span class="o">=</span> <span class="n">wave</span> <span class="o">/</span> <span class="mf">1.e4</span>
        <span class="k">if</span> <span class="n">wave</span> <span class="o">&lt;</span> <span class="mf">10000.</span><span class="p">:</span>
            <span class="n">wave_label</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:.0f}</span><span class="s2">A&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wave_label</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:.1f}</span><span class="s2">m&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wave4</span><span class="p">)</span>
    <span class="n">atom_label</span> <span class="o">=</span> <span class="n">elem</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">blend</span><span class="p">:</span>
        <span class="n">blend_flag</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">blend_flag</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">line_label</span> <span class="o">=</span> <span class="n">atom_label</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">wave_label</span> <span class="o">+</span> <span class="n">blend_flag</span>

    <span class="k">return</span> <span class="n">atom_label</span><span class="p">,</span> <span class="n">wave_label</span><span class="p">,</span> <span class="n">line_label</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="pyneb.core.pynebcore.getRecEmissivity" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getRecEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="s1">&#39;H1&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>The function instantiates a RecAtom and store it into atomicData._RecombData for a further use.
More possibilities are obtained using the RecAtom class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>tem</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>temperature in K</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>den</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>density in cm-3</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_i</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>levels (lev_i&gt;lev_j, i_min=1)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lev_j</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>levels (lev_i&gt;lev_j, i_min=1)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>atom</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>atom (e.g. 'H1', 'He1')</p>
              </div>
            </td>
            <td>
                  <code>&#39;H1&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>method</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>interpolation method ('linear', 'nearest', 'cubic'), sent to scipy.interpolate.griddata</p>
              </div>
            </td>
            <td>
                  <code>&#39;linear&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>wave</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>alternative way of identifying emision line.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong></p>
<pre><code>print(getRecEmissivity(1e4, 1e3, 3, 2, atom='H1') / getRecEmissivity(1e4, 1e3, 4, 2, atom='H1')) 
    # return Ha/Hb
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4148</span>
<span class="normal">4149</span>
<span class="normal">4150</span>
<span class="normal">4151</span>
<span class="normal">4152</span>
<span class="normal">4153</span>
<span class="normal">4154</span>
<span class="normal">4155</span>
<span class="normal">4156</span>
<span class="normal">4157</span>
<span class="normal">4158</span>
<span class="normal">4159</span>
<span class="normal">4160</span>
<span class="normal">4161</span>
<span class="normal">4162</span>
<span class="normal">4163</span>
<span class="normal">4164</span>
<span class="normal">4165</span>
<span class="normal">4166</span>
<span class="normal">4167</span>
<span class="normal">4168</span>
<span class="normal">4169</span>
<span class="normal">4170</span>
<span class="normal">4171</span>
<span class="normal">4172</span>
<span class="normal">4173</span>
<span class="normal">4174</span>
<span class="normal">4175</span>
<span class="normal">4176</span>
<span class="normal">4177</span>
<span class="normal">4178</span>
<span class="normal">4179</span>
<span class="normal">4180</span>
<span class="normal">4181</span>
<span class="normal">4182</span>
<span class="normal">4183</span>
<span class="normal">4184</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getRecEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="s1">&#39;H1&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The function instantiates a RecAtom and store it into atomicData._RecombData for a further use.</span>
<span class="sd">    More possibilities are obtained using the RecAtom class.</span>



<span class="sd">    Parameters:</span>
<span class="sd">        tem:           temperature in K</span>
<span class="sd">        den:           density in cm-3</span>
<span class="sd">        lev_i:  levels (lev_i&gt;lev_j, i_min=1)</span>
<span class="sd">        lev_j:  levels (lev_i&gt;lev_j, i_min=1)</span>
<span class="sd">        atom:          atom (e.g. &#39;H1&#39;, &#39;He1&#39;)</span>
<span class="sd">        method:        interpolation method (&#39;linear&#39;, &#39;nearest&#39;, &#39;cubic&#39;), sent to scipy.interpolate.griddata</span>
<span class="sd">        wave:          alternative way of identifying emision line.</span>

<span class="sd">    **Usage:**</span>

<span class="sd">        print(getRecEmissivity(1e4, 1e3, 3, 2, atom=&#39;H1&#39;) / getRecEmissivity(1e4, 1e3, 4, 2, atom=&#39;H1&#39;)) </span>
<span class="sd">            # return Ha/Hb </span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">calling</span> <span class="o">=</span> <span class="s1">&#39;getRecEmissivity&#39;</span>

    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">INSTALLED</span><span class="p">[</span><span class="s1">&#39;scipy&#39;</span><span class="p">]:</span>
        <span class="n">elem</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="n">parseAtom</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">atom</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">atomicData</span><span class="o">.</span><span class="n">_RecombData</span><span class="p">:</span>
            <span class="n">atomicData</span><span class="o">.</span><span class="n">_RecombData</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="n">RecAtom</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">atomicData</span><span class="o">.</span><span class="n">_RecombData</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span><span class="o">.</span><span class="n">getEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="o">=</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="o">=</span><span class="n">den</span><span class="p">,</span> <span class="n">lev_i</span><span class="o">=</span><span class="n">lev_i</span><span class="p">,</span> <span class="n">lev_j</span><span class="o">=</span><span class="n">lev_j</span><span class="p">,</span>
                                                             <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">wave</span><span class="o">=</span><span class="n">wave</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="n">product</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">atom</span> <span class="o">==</span> <span class="s1">&#39;H1&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">lev_i</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">lev_j</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">log_</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Scipy is missing, </span><span class="si">{0}</span><span class="s1"> returning Hbeta from Aller 84&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">calling</span><span class="p">),</span> <span class="n">calling</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">getHbEmissivity</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log_</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Only Hbeta emissivity available, as scipy not installed&#39;</span><span class="p">,</span> <span class="n">calling</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="pyneb.core.pynebcore.isValid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">isValid</span><span class="p">(</span><span class="n">line_label</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Return True if the line label correspond to a valid line from LINE_LABEL_LIST or BLEND_LIST</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>line_label</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>label to be tested</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p><strong>Usage:</strong></p>
<pre><code>isValid('O3_5007A')
</code></pre>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4364</span>
<span class="normal">4365</span>
<span class="normal">4366</span>
<span class="normal">4367</span>
<span class="normal">4368</span>
<span class="normal">4369</span>
<span class="normal">4370</span>
<span class="normal">4371</span>
<span class="normal">4372</span>
<span class="normal">4373</span>
<span class="normal">4374</span>
<span class="normal">4375</span>
<span class="normal">4376</span>
<span class="normal">4377</span>
<span class="normal">4378</span>
<span class="normal">4379</span>
<span class="normal">4380</span>
<span class="normal">4381</span>
<span class="normal">4382</span>
<span class="normal">4383</span>
<span class="normal">4384</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">isValid</span><span class="p">(</span><span class="n">line_label</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return True if the line label correspond to a valid line from LINE_LABEL_LIST or BLEND_LIST</span>

<span class="sd">    Parameters:</span>
<span class="sd">        line_label: label to be tested</span>

<span class="sd">    **Usage:**</span>

<span class="sd">        isValid(&#39;O3_5007A&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">atom</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="n">waveLabel</span><span class="p">,</span> <span class="n">blend</span> <span class="o">=</span> <span class="n">parseLineLabel</span><span class="p">(</span><span class="n">line_label</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">LINE_LABEL_LIST</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">waveLabel</span> <span class="ow">in</span> <span class="n">LINE_LABEL_LIST</span><span class="p">[</span><span class="n">atom</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">line_label</span> <span class="ow">in</span> <span class="n">BLEND_LIST</span><span class="p">):</span>
                <span class="n">is_valid</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">is_valid</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">is_valid</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">is_valid</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="pyneb.core.pynebcore.parseLineLabel" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parseLineLabel</span><span class="p">(</span><span class="n">lineLabel</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Parse the line label to extract the substrings referring to the atom (elem, spec and atom)
and the numerical value of the wave</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>label</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>line label in the standard PyNeb format</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>elem, spec, atom_label, wave, wave_label, blend  strings containing the elem, spec, atom and 
                                                  wave; numerical value of the wave, 
                                                  in Angstrom; and blend flag</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pyneb/core/pynebcore.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4317</span>
<span class="normal">4318</span>
<span class="normal">4319</span>
<span class="normal">4320</span>
<span class="normal">4321</span>
<span class="normal">4322</span>
<span class="normal">4323</span>
<span class="normal">4324</span>
<span class="normal">4325</span>
<span class="normal">4326</span>
<span class="normal">4327</span>
<span class="normal">4328</span>
<span class="normal">4329</span>
<span class="normal">4330</span>
<span class="normal">4331</span>
<span class="normal">4332</span>
<span class="normal">4333</span>
<span class="normal">4334</span>
<span class="normal">4335</span>
<span class="normal">4336</span>
<span class="normal">4337</span>
<span class="normal">4338</span>
<span class="normal">4339</span>
<span class="normal">4340</span>
<span class="normal">4341</span>
<span class="normal">4342</span>
<span class="normal">4343</span>
<span class="normal">4344</span>
<span class="normal">4345</span>
<span class="normal">4346</span>
<span class="normal">4347</span>
<span class="normal">4348</span>
<span class="normal">4349</span>
<span class="normal">4350</span>
<span class="normal">4351</span>
<span class="normal">4352</span>
<span class="normal">4353</span>
<span class="normal">4354</span>
<span class="normal">4355</span>
<span class="normal">4356</span>
<span class="normal">4357</span>
<span class="normal">4358</span>
<span class="normal">4359</span>
<span class="normal">4360</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parseLineLabel</span><span class="p">(</span><span class="n">lineLabel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse the line label to extract the substrings referring to the atom (elem, spec and atom)</span>
<span class="sd">    and the numerical value of the wave</span>

<span class="sd">    Parameters:</span>
<span class="sd">        label:    line label in the standard PyNeb format</span>

<span class="sd">    Returns:</span>
<span class="sd">        elem, spec, atom_label, wave, wave_label, blend  strings containing the elem, spec, atom and </span>
<span class="sd">                                                              wave; numerical value of the wave, </span>
<span class="sd">                                                              in Angstrom; and blend flag </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">##</span>
    <span class="c1"># @todo maybe rearrange the order so 1) it is compatible with getLineLabel, or 2) it lists all the strings first </span>

    <span class="n">blend</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">wave_unit</span> <span class="o">=</span> <span class="s1">&#39;A&#39;</span>
    <span class="c1"># extract information on the atom</span>
    <span class="n">elem_spec</span> <span class="o">=</span> <span class="n">strExtract</span><span class="p">(</span><span class="n">lineLabel</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
    <span class="n">elem</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="n">parseAtom</span><span class="p">(</span><span class="n">elem_spec</span><span class="p">)</span>
    <span class="n">atom_label</span> <span class="o">=</span> <span class="n">elem</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
<span class="c1"># sourcery skip: merge-nested-ifs</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elem_spec</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">elem_spec</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
            <span class="n">atom_label</span> <span class="o">+=</span> <span class="s1">&#39;r&#39;</span>
    <span class="c1"># extract information on the wave</span>
    <span class="n">wave_label</span> <span class="o">=</span> <span class="n">lineLabel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">wave_label</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">or</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>
            <span class="n">wave</span> <span class="o">+=</span> <span class="n">s</span>
        <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;+&#39;</span><span class="p">:</span>
            <span class="n">blend</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">):</span>
            <span class="n">wave_unit</span> <span class="o">=</span> <span class="n">s</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">wave</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">wave</span> <span class="o">=</span> <span class="mf">0.</span>    
    <span class="k">if</span> <span class="n">wave_unit</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
        <span class="n">wave</span> <span class="o">=</span> <span class="n">wave</span> <span class="o">*</span> <span class="mf">1.e4</span>

    <span class="k">return</span> <span class="n">elem</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">atom_label</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="n">wave_label</span><span class="p">,</span> <span class="n">blend</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>